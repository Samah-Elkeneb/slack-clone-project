<turbo-frame id="messages_frame">
  <div id="channel-messages" data-room="<%= channel.name %>_<%= channel.id %>" data-controller="modal" data-modal-target="frame">
    <header class="px-6 py-3 border-b border-slate-200 bg-white/60 backdrop-blur-sm">
      <h2 class="text-lg font-semibold" >
        <a href="<%= channel_path(channel) %>"
          data-action="click->modal#open">
          <%= channel.name%>
        </a>
      </h2>
      <p class="text-xs text-slate-500">channel description</p>
    </header>
    <div class="h-100 overflow-y-auto bg-gray-100 p-4" id="chat-box" data-controller="infinite" data-infinite-target="box" data-load-more-url="<%= load_more_channel_path(channel)%>">
      <% if messages.empty? %>
        <div id="no-messages-div" class="text-center text-slate-500 py-12"> no messages yet </div>
      <% else %> <% messages.each do |msg| %>
          <%= render partial: "message_item", locals: { message: msg } %>
        <% end %>
      <% end %>
    </div>
    <%= form_with model: new_message,
         local: true do |f| %>
      <%= f.hidden_field :channel_id, value: channel.id %>
      <%= f.hidden_field :user_id, value: current_user.id %>
      <div class="border rounded-lg p-2 flex flex-col">
        <%= f.rich_text_area :content, id: "message_content", class: "trix-editor p-2 border rounded-lg w-full" %>
        <div class="flex justify-end mt-2">
          <button type="submit"
            id="send_button",
            class="p-2 bg-green-700 rounded-full transition-all duration-200">
            <svg xmlns="http://www.w3.org/2000/svg"
           class="h-6 w-6 text-white transform rotate-180 transition-colors duration-200"
           fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M2 12l19-7-10 7 10 7-19-7z"/>
            </svg>
          </button>
        </div>
      </div>
    <% end %>
  </div>
</turbo_frame>
<%# <script>
  document.addEventListener("trix-change", () => {
    const editor = document.querySelector("#message_content");
    const button = document.querySelector("#send_button svg");
    console.log("i am here");
    if (editor && button) {
      console.log("i am in");
      editor.addEventListener("trix-change", () => {
        if(editor.value.trim().length > 0){
          button.classList.remove("text-gray-400");
          button.classList.add("text-green-500");
          button.disabled = false;
        } else {
          button.classList.remove("text-green-500");
          button.classList.add("text-gray-400");
          button.disabled = true;
        }
      });
    }
  });
</script> %>
