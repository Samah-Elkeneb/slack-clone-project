import{a as Zp}from"./chunk-TFYPXWC7.js";import{a as Ho,f as Up,k as Hp,l as $p,m as qo,n as jp,o as Wp,p as zp,q as Gp,r as Yp,s as Xp,t as wa,u as Kp,v as qp,w as Sc,x as Qp}from"./chunk-3X3RYUVG.js";import{$ as Xn,$a as $e,$b as ia,$c as gr,$e as ha,$f as ci,$g as De,$h as Mp,$i as to,A as Ji,Ab as ea,Ac as na,Ai as Ko,B as Ys,Bb as Mi,Bc as oa,Bi as Ca,C as vl,Ca as El,Cb as Ri,Cc as ra,Cd as Oo,Ch as ji,Ci as zr,Da as Lo,Db as Ii,Dd as Zn,Df as Ee,Dg as fp,E as lc,Eb as xe,Ee as Vn,Eg as ga,Eh as fe,F as bo,Fb as di,Fc as Qn,Fe as tp,Fg as mc,Fh as it,G as Xs,Ga as si,Gb as ta,Gh as xp,Gi as cn,H as Ge,Hb as vt,Hc as Dn,Hd as Bo,He as Vr,Hh as ot,I as lr,Ia as Pl,Ib as dc,Ic as St,Id as wo,Ie as ip,J as _l,Ja as Ml,Jc as Hl,Jh as Tp,K as ut,Ka as Sn,Kc as Cs,Kd as xn,Ke as la,Kg as vc,Kh as Op,L as Ks,La as x,Lb as Y,Ld as Tn,Le as pa,Lg as mp,Lh as En,M as F,Mb as X,Mc as Cn,Md as yo,Mg as vp,Mh as wp,Mi as B,N as pr,Ne as np,Ng as _p,O as Sl,Oa as jt,Ob as Vi,Oc as $l,Og as Gt,Oi as ys,P as qs,Pa as _,Pb as Me,Pc as Xt,Pg as sn,Ph as Br,Pi as xa,Q as bl,Qa as pc,Qc as ur,Qf as dp,Qh as yp,Qi as Se,R as dr,Ra as Ce,Rc as jl,Rg as Zt,Rh as Ur,Ri as kp,S as Cl,Sa as ai,Sc as Wl,Sd as xs,Sf as hp,Sg as Yt,Si as lt,T as xl,Ta as bn,Tb as kl,Tc as zl,Tf as Lr,Ti as ln,U as Tl,Ub as xo,Uc as Gl,Ud as fc,Ue as op,Ug as $o,Uh as Yo,V as Qs,Va as se,Vb as Ei,Vc as Yl,Ve as rp,Vf as Le,Vg as jo,W as ni,Wa as Rl,Wb as bt,Wc as Xl,We as sp,Wf as Ai,Wg as fa,Wi as Vp,X as en,Xa as Il,Xd as ee,Xe as ap,Xi as Lp,Y as Zs,Ya as ge,Yc as To,Yd as Ts,Ye as cp,Yf as gi,Yi as Gr,Z as Yn,Za as T,Zc as hc,Zg as Mt,Zh as Ep,_ as Ol,_a as nn,_b as Wt,_c as Kl,_d as kn,_e as da,_f as up,_g as Rt,_h as Pp,_i as Ta,a as pi,ac as Vl,ae as G,af as ua,ah as Ln,ai as Rp,aj as Fp,b as Rr,bb as Kn,bd as Nn,bf as lp,bg as Fr,bh as ue,bi as Ip,bj as Yr,cb as Ut,cd as Qe,ce as Jn,cf as pp,ch as $,ci as Ap,cj as Oa,d as Dh,db as Al,dc as $i,dd as Li,de as aa,dg as Uo,dh as fi,di as va,dj as Jt,e as gl,eb as Dl,eh as Ki,ei as Hr,f as D,fb as I,fd as Kt,fe as Os,fg as zt,fi as $r,fj as Bp,ga as Js,gb as N,gc as Ll,gg as on,ha as Vo,hb as q,hh as Wo,i as Et,ia as st,ib as Ht,ic as Fl,id as Ze,ie as On,ih as Sp,ii as li,j as Oi,jb as $t,jd as Ar,je as Zl,jh as bp,k as Vt,ka as wl,kb as Co,la as rt,lb as ve,le as Jl,lg as Re,ma as hr,mb as Nl,md as ql,me as fr,mg as Fi,mh as ma,mi as _a,n as cc,na as yl,ne as Eo,ng as rn,ni as Dp,ob as ae,od as Lt,oe as ep,oh as zo,oi as Ne,p as _n,pa as oi,pb as E,pd as Ql,pe as ws,ph as mi,pi as ct,q as ze,qa as ri,qd as w,qf as He,qg as ie,qh as Go,qi as Di,rc as Bl,rd as uc,rf as wn,rg as Tt,rh as at,ri as Sa,sa as ke,sb as Fo,sd as Xi,sh as an,t as So,tb as Ye,tc as Ul,td as ti,th as eo,ti as Xo,u as dt,ub as Ie,ue as ca,ug as gp,ui as ba,v as Gn,va as tn,vb as Ae,vc as Ir,vd as Nh,vh as yn,vi as _c,wa as j,wb as yi,we as Nr,wg as K,wi as jr,x as fl,xa as W,xb as _e,xd as Dr,xe as kr,xi as Wr,y as ml,ya as wi,yb as we,yd as sa,yh as Cp,yi as Np,z as Ue,zb as qn,zc as J,zd as gc}from"./chunk-R6FPMO7L.js";var md=Dh((fd,Ds)=>{"use strict";(function(s,t){"use strict";typeof Ds=="object"&&typeof Ds.exports=="object"?Ds.exports=s.document?t(s,!0):function(i){if(!i.document)throw new Error("jQuery requires a window with a document");return t(i)}:t(s)})(typeof window<"u"?window:fd,function(s,t){"use strict";var i=[],e=s.document,n=Object.getPrototypeOf,r=i.slice,c=i.concat,g=i.push,v=i.indexOf,y={},M=y.toString,k=y.hasOwnProperty,Z=k.toString,le=Z.call(Object),pe={};function he(o,a){a=a||e;var l=a.createElement("script");l.text=o,a.head.appendChild(l).parentNode.removeChild(l)}var Te="3.2.0",p=function(o,a){return new p.fn.init(o,a)},ht=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,_t=/^-ms-/,gt=/-([a-z])/g,Pi=function(o,a){return a.toUpperCase()};p.fn=p.prototype={jquery:Te,constructor:p,length:0,toArray:function(){return r.call(this)},get:function(o){return o==null?r.call(this):o<0?this[o+this.length]:this[o]},pushStack:function(o){var a=p.merge(this.constructor(),o);return a.prevObject=this,a},each:function(o){return p.each(this,o)},map:function(o){return this.pushStack(p.map(this,function(a,l){return o.call(a,l,a)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(o){var a=this.length,l=+o+(o<0?a:0);return this.pushStack(l>=0&&l<a?[this[l]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:i.sort,splice:i.splice},p.extend=p.fn.extend=function(){var o,a,l,d,m,f,S=arguments[0]||{},R=1,L=arguments.length,H=!1;for(typeof S=="boolean"&&(H=S,S=arguments[R]||{},R++),typeof S=="object"||p.isFunction(S)||(S={}),R===L&&(S=this,R--);R<L;R++)if((o=arguments[R])!=null)for(a in o)l=S[a],d=o[a],S!==d&&(H&&d&&(p.isPlainObject(d)||(m=Array.isArray(d)))?(m?(m=!1,f=l&&Array.isArray(l)?l:[]):f=l&&p.isPlainObject(l)?l:{},S[a]=p.extend(H,f,d)):d!==void 0&&(S[a]=d));return S},p.extend({expando:"jQuery"+(Te+Math.random()).replace(/\D/g,""),isReady:!0,error:function(o){throw new Error(o)},noop:function(){},isFunction:function(o){return p.type(o)==="function"},isWindow:function(o){return o!=null&&o===o.window},isNumeric:function(o){var a=p.type(o);return(a==="number"||a==="string")&&!isNaN(o-parseFloat(o))},isPlainObject:function(o){var a,l;return!(!o||M.call(o)!=="[object Object]")&&(!(a=n(o))||(l=k.call(a,"constructor")&&a.constructor,typeof l=="function"&&Z.call(l)===le))},isEmptyObject:function(o){var a;for(a in o)return!1;return!0},type:function(o){return o==null?o+"":typeof o=="object"||typeof o=="function"?y[M.call(o)]||"object":typeof o},globalEval:function(o){he(o)},camelCase:function(o){return o.replace(_t,"ms-").replace(gt,Pi)},each:function(o,a){var l,d=0;if(At(o))for(l=o.length;d<l&&a.call(o[d],d,o[d])!==!1;d++);else for(d in o)if(a.call(o[d],d,o[d])===!1)break;return o},trim:function(o){return o==null?"":(o+"").replace(ht,"")},makeArray:function(o,a){var l=a||[];return o!=null&&(At(Object(o))?p.merge(l,typeof o=="string"?[o]:o):g.call(l,o)),l},inArray:function(o,a,l){return a==null?-1:v.call(a,o,l)},merge:function(o,a){for(var l=+a.length,d=0,m=o.length;d<l;d++)o[m++]=a[d];return o.length=m,o},grep:function(o,a,l){for(var d,m=[],f=0,S=o.length,R=!l;f<S;f++)d=!a(o[f],f),d!==R&&m.push(o[f]);return m},map:function(o,a,l){var d,m,f=0,S=[];if(At(o))for(d=o.length;f<d;f++)m=a(o[f],f,l),m!=null&&S.push(m);else for(f in o)m=a(o[f],f,l),m!=null&&S.push(m);return c.apply([],S)},guid:1,proxy:function(o,a){var l,d,m;if(typeof a=="string"&&(l=o[a],a=o,o=l),p.isFunction(o))return d=r.call(arguments,2),m=function(){return o.apply(a||this,d.concat(r.call(arguments)))},m.guid=o.guid=o.guid||p.guid++,m},now:Date.now,support:pe}),typeof Symbol=="function"&&(p.fn[Symbol.iterator]=i[Symbol.iterator]),p.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(o,a){y["[object "+a+"]"]=a.toLowerCase()});function At(o){var a=!!o&&"length"in o&&o.length,l=p.type(o);return l!=="function"&&!p.isWindow(o)&&(l==="array"||a===0||typeof a=="number"&&a>0&&a-1 in o)}var hi=function(o){var a,l,d,m,f,S,R,L,H,ne,de,z,re,Ke,tt,Ve,Ci,ui,hn,Nt="sizzle"+1*new Date,et=o.document,Zi=0,Ct=0,ii=ic(),ms=ic(),Mr=ic(),In=function(C,P){return C===P&&(de=!0),0},vs={}.hasOwnProperty,un=[],No=un.pop,ko=un.push,xi=un.push,sl=un.slice,sr=function(C,P){for(var V=0,te=C.length;V<te;V++)if(C[V]===P)return V;return-1},Ja="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",kt="[\\x20\\t\\r\\n\\f]",ar="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",al="\\["+kt+"*("+ar+")(?:"+kt+"*([*^$|!~]?=)"+kt+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+ar+"))|)"+kt+"*\\]",ec=":("+ar+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+al+")*)|.*)\\)|)",Sh=new RegExp(kt+"+","g"),$s=new RegExp("^"+kt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+kt+"+$","g"),bh=new RegExp("^"+kt+"*,"+kt+"*"),Ch=new RegExp("^"+kt+"*([>+~]|"+kt+")"+kt+"*"),xh=new RegExp("="+kt+`*([^\\]'"]*?)`+kt+"*\\]","g"),Th=new RegExp(ec),Oh=new RegExp("^"+ar+"$"),js={ID:new RegExp("^#("+ar+")"),CLASS:new RegExp("^\\.("+ar+")"),TAG:new RegExp("^("+ar+"|[*])"),ATTR:new RegExp("^"+al),PSEUDO:new RegExp("^"+ec),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+kt+"*(even|odd|(([+-]|)(\\d*)n|)"+kt+"*(?:([+-]|)"+kt+"*(\\d+)|))"+kt+"*\\)|)","i"),bool:new RegExp("^(?:"+Ja+")$","i"),needsContext:new RegExp("^"+kt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+kt+"*((?:-\\d)?\\d*)"+kt+"*\\)|)(?=[^-]|$)","i")},wh=/^(?:input|select|textarea|button)$/i,yh=/^h\d$/i,_s=/^[^{]+\{\s*\[native \w/,Eh=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tc=/[+~]/,vo=new RegExp("\\\\([\\da-f]{1,6}"+kt+"?|("+kt+")|.)","ig"),_o=function(C,P,V){var te="0x"+P-65536;return te!==te||V?P:te<0?String.fromCharCode(te+65536):String.fromCharCode(te>>10|55296,1023&te|56320)},cl=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ll=function(C,P){return P?C==="\0"?"\uFFFD":C.slice(0,-1)+"\\"+C.charCodeAt(C.length-1).toString(16)+" ":"\\"+C},pl=function(){z()},Ph=zs(function(C){return C.disabled===!0&&("form"in C||"label"in C)},{dir:"parentNode",next:"legend"});try{xi.apply(un=sl.call(et.childNodes),et.childNodes),un[et.childNodes.length].nodeType}catch{xi={apply:un.length?function(P,V){ko.apply(P,sl.call(V))}:function(P,V){for(var te=P.length,U=0;P[te++]=V[U++];);P.length=te-1}}}function Ft(C,P,V,te){var U,oe,ce,me,be,je,Be,qe=P&&P.ownerDocument,ft=P?P.nodeType:9;if(V=V||[],typeof C!="string"||!C||ft!==1&&ft!==9&&ft!==11)return V;if(!te&&((P?P.ownerDocument||P:et)!==re&&z(P),P=P||re,tt)){if(ft!==11&&(be=Eh.exec(C)))if(U=be[1]){if(ft===9){if(!(ce=P.getElementById(U)))return V;if(ce.id===U)return V.push(ce),V}else if(qe&&(ce=qe.getElementById(U))&&hn(P,ce)&&ce.id===U)return V.push(ce),V}else{if(be[2])return xi.apply(V,P.getElementsByTagName(C)),V;if((U=be[3])&&l.getElementsByClassName&&P.getElementsByClassName)return xi.apply(V,P.getElementsByClassName(U)),V}if(l.qsa&&!Mr[C+" "]&&(!Ve||!Ve.test(C))){if(ft!==1)qe=P,Be=C;else if(P.nodeName.toLowerCase()!=="object"){for((me=P.getAttribute("id"))?me=me.replace(cl,ll):P.setAttribute("id",me=Nt),je=S(C),oe=je.length;oe--;)je[oe]="#"+me+" "+Ws(je[oe]);Be=je.join(","),qe=tc.test(C)&&oc(P.parentNode)||P}if(Be)try{return xi.apply(V,qe.querySelectorAll(Be)),V}catch{}finally{me===Nt&&P.removeAttribute("id")}}}return L(C.replace($s,"$1"),P,V,te)}function ic(){var C=[];function P(V,te){return C.push(V+" ")>d.cacheLength&&delete P[C.shift()],P[V+" "]=te}return P}function An(C){return C[Nt]=!0,C}function zn(C){var P=re.createElement("fieldset");try{return!!C(P)}catch{return!1}finally{P.parentNode&&P.parentNode.removeChild(P),P=null}}function nc(C,P){for(var V=C.split("|"),te=V.length;te--;)d.attrHandle[V[te]]=P}function dl(C,P){var V=P&&C,te=V&&C.nodeType===1&&P.nodeType===1&&C.sourceIndex-P.sourceIndex;if(te)return te;if(V){for(;V=V.nextSibling;)if(V===P)return-1}return C?1:-1}function Mh(C){return function(P){var V=P.nodeName.toLowerCase();return V==="input"&&P.type===C}}function Rh(C){return function(P){var V=P.nodeName.toLowerCase();return(V==="input"||V==="button")&&P.type===C}}function hl(C){return function(P){return"form"in P?P.parentNode&&P.disabled===!1?"label"in P?"label"in P.parentNode?P.parentNode.disabled===C:P.disabled===C:P.isDisabled===C||P.isDisabled!==!C&&Ph(P)===C:P.disabled===C:"label"in P&&P.disabled===C}}function cr(C){return An(function(P){return P=+P,An(function(V,te){for(var U,oe=C([],V.length,P),ce=oe.length;ce--;)V[U=oe[ce]]&&(V[U]=!(te[U]=V[U]))})})}function oc(C){return C&&typeof C.getElementsByTagName<"u"&&C}l=Ft.support={},f=Ft.isXML=function(C){var P=C&&(C.ownerDocument||C).documentElement;return!!P&&P.nodeName!=="HTML"},z=Ft.setDocument=function(C){var P,V,te=C?C.ownerDocument||C:et;return te!==re&&te.nodeType===9&&te.documentElement&&(re=te,Ke=re.documentElement,tt=!f(re),et!==re&&(V=re.defaultView)&&V.top!==V&&(V.addEventListener?V.addEventListener("unload",pl,!1):V.attachEvent&&V.attachEvent("onunload",pl)),l.attributes=zn(function(U){return U.className="i",!U.getAttribute("className")}),l.getElementsByTagName=zn(function(U){return U.appendChild(re.createComment("")),!U.getElementsByTagName("*").length}),l.getElementsByClassName=_s.test(re.getElementsByClassName),l.getById=zn(function(U){return Ke.appendChild(U).id=Nt,!re.getElementsByName||!re.getElementsByName(Nt).length}),l.getById?(d.filter.ID=function(U){var oe=U.replace(vo,_o);return function(ce){return ce.getAttribute("id")===oe}},d.find.ID=function(U,oe){if(typeof oe.getElementById<"u"&&tt){var ce=oe.getElementById(U);return ce?[ce]:[]}}):(d.filter.ID=function(U){var oe=U.replace(vo,_o);return function(ce){var me=typeof ce.getAttributeNode<"u"&&ce.getAttributeNode("id");return me&&me.value===oe}},d.find.ID=function(U,oe){if(typeof oe.getElementById<"u"&&tt){var ce,me,be,je=oe.getElementById(U);if(je){if(ce=je.getAttributeNode("id"),ce&&ce.value===U)return[je];for(be=oe.getElementsByName(U),me=0;je=be[me++];)if(ce=je.getAttributeNode("id"),ce&&ce.value===U)return[je]}return[]}}),d.find.TAG=l.getElementsByTagName?function(U,oe){return typeof oe.getElementsByTagName<"u"?oe.getElementsByTagName(U):l.qsa?oe.querySelectorAll(U):void 0}:function(U,oe){var ce,me=[],be=0,je=oe.getElementsByTagName(U);if(U==="*"){for(;ce=je[be++];)ce.nodeType===1&&me.push(ce);return me}return je},d.find.CLASS=l.getElementsByClassName&&function(U,oe){if(typeof oe.getElementsByClassName<"u"&&tt)return oe.getElementsByClassName(U)},Ci=[],Ve=[],(l.qsa=_s.test(re.querySelectorAll))&&(zn(function(U){Ke.appendChild(U).innerHTML="<a id='"+Nt+"'></a><select id='"+Nt+"-\r\\' msallowcapture=''><option selected=''></option></select>",U.querySelectorAll("[msallowcapture^='']").length&&Ve.push("[*^$]="+kt+`*(?:''|"")`),U.querySelectorAll("[selected]").length||Ve.push("\\["+kt+"*(?:value|"+Ja+")"),U.querySelectorAll("[id~="+Nt+"-]").length||Ve.push("~="),U.querySelectorAll(":checked").length||Ve.push(":checked"),U.querySelectorAll("a#"+Nt+"+*").length||Ve.push(".#.+[+~]")}),zn(function(U){U.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var oe=re.createElement("input");oe.setAttribute("type","hidden"),U.appendChild(oe).setAttribute("name","D"),U.querySelectorAll("[name=d]").length&&Ve.push("name"+kt+"*[*^$|!~]?="),U.querySelectorAll(":enabled").length!==2&&Ve.push(":enabled",":disabled"),Ke.appendChild(U).disabled=!0,U.querySelectorAll(":disabled").length!==2&&Ve.push(":enabled",":disabled"),U.querySelectorAll("*,:x"),Ve.push(",.*:")})),(l.matchesSelector=_s.test(ui=Ke.matches||Ke.webkitMatchesSelector||Ke.mozMatchesSelector||Ke.oMatchesSelector||Ke.msMatchesSelector))&&zn(function(U){l.disconnectedMatch=ui.call(U,"*"),ui.call(U,"[s!='']:x"),Ci.push("!=",ec)}),Ve=Ve.length&&new RegExp(Ve.join("|")),Ci=Ci.length&&new RegExp(Ci.join("|")),P=_s.test(Ke.compareDocumentPosition),hn=P||_s.test(Ke.contains)?function(U,oe){var ce=U.nodeType===9?U.documentElement:U,me=oe&&oe.parentNode;return U===me||!(!me||me.nodeType!==1||!(ce.contains?ce.contains(me):U.compareDocumentPosition&&16&U.compareDocumentPosition(me)))}:function(U,oe){if(oe){for(;oe=oe.parentNode;)if(oe===U)return!0}return!1},In=P?function(U,oe){if(U===oe)return de=!0,0;var ce=!U.compareDocumentPosition-!oe.compareDocumentPosition;return ce||(ce=(U.ownerDocument||U)===(oe.ownerDocument||oe)?U.compareDocumentPosition(oe):1,1&ce||!l.sortDetached&&oe.compareDocumentPosition(U)===ce?U===re||U.ownerDocument===et&&hn(et,U)?-1:oe===re||oe.ownerDocument===et&&hn(et,oe)?1:ne?sr(ne,U)-sr(ne,oe):0:4&ce?-1:1)}:function(U,oe){if(U===oe)return de=!0,0;var ce,me=0,be=U.parentNode,je=oe.parentNode,Be=[U],qe=[oe];if(!be||!je)return U===re?-1:oe===re?1:be?-1:je?1:ne?sr(ne,U)-sr(ne,oe):0;if(be===je)return dl(U,oe);for(ce=U;ce=ce.parentNode;)Be.unshift(ce);for(ce=oe;ce=ce.parentNode;)qe.unshift(ce);for(;Be[me]===qe[me];)me++;return me?dl(Be[me],qe[me]):Be[me]===et?-1:qe[me]===et?1:0}),re},Ft.matches=function(C,P){return Ft(C,null,null,P)},Ft.matchesSelector=function(C,P){if((C.ownerDocument||C)!==re&&z(C),P=P.replace(xh,"='$1']"),l.matchesSelector&&tt&&!Mr[P+" "]&&(!Ci||!Ci.test(P))&&(!Ve||!Ve.test(P)))try{var V=ui.call(C,P);if(V||l.disconnectedMatch||C.document&&C.document.nodeType!==11)return V}catch{}return Ft(P,re,null,[C]).length>0},Ft.contains=function(C,P){return(C.ownerDocument||C)!==re&&z(C),hn(C,P)},Ft.attr=function(C,P){(C.ownerDocument||C)!==re&&z(C);var V=d.attrHandle[P.toLowerCase()],te=V&&vs.call(d.attrHandle,P.toLowerCase())?V(C,P,!tt):void 0;return te!==void 0?te:l.attributes||!tt?C.getAttribute(P):(te=C.getAttributeNode(P))&&te.specified?te.value:null},Ft.escape=function(C){return(C+"").replace(cl,ll)},Ft.error=function(C){throw new Error("Syntax error, unrecognized expression: "+C)},Ft.uniqueSort=function(C){var P,V=[],te=0,U=0;if(de=!l.detectDuplicates,ne=!l.sortStable&&C.slice(0),C.sort(In),de){for(;P=C[U++];)P===C[U]&&(te=V.push(U));for(;te--;)C.splice(V[te],1)}return ne=null,C},m=Ft.getText=function(C){var P,V="",te=0,U=C.nodeType;if(U){if(U===1||U===9||U===11){if(typeof C.textContent=="string")return C.textContent;for(C=C.firstChild;C;C=C.nextSibling)V+=m(C)}else if(U===3||U===4)return C.nodeValue}else for(;P=C[te++];)V+=m(P);return V},d=Ft.selectors={cacheLength:50,createPseudo:An,match:js,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(C){return C[1]=C[1].replace(vo,_o),C[3]=(C[3]||C[4]||C[5]||"").replace(vo,_o),C[2]==="~="&&(C[3]=" "+C[3]+" "),C.slice(0,4)},CHILD:function(C){return C[1]=C[1].toLowerCase(),C[1].slice(0,3)==="nth"?(C[3]||Ft.error(C[0]),C[4]=+(C[4]?C[5]+(C[6]||1):2*(C[3]==="even"||C[3]==="odd")),C[5]=+(C[7]+C[8]||C[3]==="odd")):C[3]&&Ft.error(C[0]),C},PSEUDO:function(C){var P,V=!C[6]&&C[2];return js.CHILD.test(C[0])?null:(C[3]?C[2]=C[4]||C[5]||"":V&&Th.test(V)&&(P=S(V,!0))&&(P=V.indexOf(")",V.length-P)-V.length)&&(C[0]=C[0].slice(0,P),C[2]=V.slice(0,P)),C.slice(0,3))}},filter:{TAG:function(C){var P=C.replace(vo,_o).toLowerCase();return C==="*"?function(){return!0}:function(V){return V.nodeName&&V.nodeName.toLowerCase()===P}},CLASS:function(C){var P=ii[C+" "];return P||(P=new RegExp("(^|"+kt+")"+C+"("+kt+"|$)"))&&ii(C,function(V){return P.test(typeof V.className=="string"&&V.className||typeof V.getAttribute<"u"&&V.getAttribute("class")||"")})},ATTR:function(C,P,V){return function(te){var U=Ft.attr(te,C);return U==null?P==="!=":!P||(U+="",P==="="?U===V:P==="!="?U!==V:P==="^="?V&&U.indexOf(V)===0:P==="*="?V&&U.indexOf(V)>-1:P==="$="?V&&U.slice(-V.length)===V:P==="~="?(" "+U.replace(Sh," ")+" ").indexOf(V)>-1:P==="|="&&(U===V||U.slice(0,V.length+1)===V+"-"))}},CHILD:function(C,P,V,te,U){var oe=C.slice(0,3)!=="nth",ce=C.slice(-4)!=="last",me=P==="of-type";return te===1&&U===0?function(be){return!!be.parentNode}:function(be,je,Be){var qe,ft,Bt,We,Ti,Hi,gn=oe!==ce?"nextSibling":"previousSibling",Qt=be.parentNode,Ss=me&&be.nodeName.toLowerCase(),bs=!Be&&!me,fn=!1;if(Qt){if(oe){for(;gn;){for(We=be;We=We[gn];)if(me?We.nodeName.toLowerCase()===Ss:We.nodeType===1)return!1;Hi=gn=C==="only"&&!Hi&&"nextSibling"}return!0}if(Hi=[ce?Qt.firstChild:Qt.lastChild],ce&&bs){for(We=Qt,Bt=We[Nt]||(We[Nt]={}),ft=Bt[We.uniqueID]||(Bt[We.uniqueID]={}),qe=ft[C]||[],Ti=qe[0]===Zi&&qe[1],fn=Ti&&qe[2],We=Ti&&Qt.childNodes[Ti];We=++Ti&&We&&We[gn]||(fn=Ti=0)||Hi.pop();)if(We.nodeType===1&&++fn&&We===be){ft[C]=[Zi,Ti,fn];break}}else if(bs&&(We=be,Bt=We[Nt]||(We[Nt]={}),ft=Bt[We.uniqueID]||(Bt[We.uniqueID]={}),qe=ft[C]||[],Ti=qe[0]===Zi&&qe[1],fn=Ti),fn===!1)for(;(We=++Ti&&We&&We[gn]||(fn=Ti=0)||Hi.pop())&&!((me?We.nodeName.toLowerCase()===Ss:We.nodeType===1)&&++fn&&(bs&&(Bt=We[Nt]||(We[Nt]={}),ft=Bt[We.uniqueID]||(Bt[We.uniqueID]={}),ft[C]=[Zi,fn]),We===be)););return fn-=U,fn===te||fn%te===0&&fn/te>=0}}},PSEUDO:function(C,P){var V,te=d.pseudos[C]||d.setFilters[C.toLowerCase()]||Ft.error("unsupported pseudo: "+C);return te[Nt]?te(P):te.length>1?(V=[C,C,"",P],d.setFilters.hasOwnProperty(C.toLowerCase())?An(function(U,oe){for(var ce,me=te(U,P),be=me.length;be--;)ce=sr(U,me[be]),U[ce]=!(oe[ce]=me[be])}):function(U){return te(U,0,V)}):te}},pseudos:{not:An(function(C){var P=[],V=[],te=R(C.replace($s,"$1"));return te[Nt]?An(function(U,oe,ce,me){for(var be,je=te(U,null,me,[]),Be=U.length;Be--;)(be=je[Be])&&(U[Be]=!(oe[Be]=be))}):function(U,oe,ce){return P[0]=U,te(P,null,ce,V),P[0]=null,!V.pop()}}),has:An(function(C){return function(P){return Ft(C,P).length>0}}),contains:An(function(C){return C=C.replace(vo,_o),function(P){return(P.textContent||P.innerText||m(P)).indexOf(C)>-1}}),lang:An(function(C){return Oh.test(C||"")||Ft.error("unsupported lang: "+C),C=C.replace(vo,_o).toLowerCase(),function(P){var V;do if(V=tt?P.lang:P.getAttribute("xml:lang")||P.getAttribute("lang"))return V=V.toLowerCase(),V===C||V.indexOf(C+"-")===0;while((P=P.parentNode)&&P.nodeType===1);return!1}}),target:function(C){var P=o.location&&o.location.hash;return P&&P.slice(1)===C.id},root:function(C){return C===Ke},focus:function(C){return C===re.activeElement&&(!re.hasFocus||re.hasFocus())&&!!(C.type||C.href||~C.tabIndex)},enabled:hl(!1),disabled:hl(!0),checked:function(C){var P=C.nodeName.toLowerCase();return P==="input"&&!!C.checked||P==="option"&&!!C.selected},selected:function(C){return C.parentNode&&C.parentNode.selectedIndex,C.selected===!0},empty:function(C){for(C=C.firstChild;C;C=C.nextSibling)if(C.nodeType<6)return!1;return!0},parent:function(C){return!d.pseudos.empty(C)},header:function(C){return yh.test(C.nodeName)},input:function(C){return wh.test(C.nodeName)},button:function(C){var P=C.nodeName.toLowerCase();return P==="input"&&C.type==="button"||P==="button"},text:function(C){var P;return C.nodeName.toLowerCase()==="input"&&C.type==="text"&&((P=C.getAttribute("type"))==null||P.toLowerCase()==="text")},first:cr(function(){return[0]}),last:cr(function(C,P){return[P-1]}),eq:cr(function(C,P,V){return[V<0?V+P:V]}),even:cr(function(C,P){for(var V=0;V<P;V+=2)C.push(V);return C}),odd:cr(function(C,P){for(var V=1;V<P;V+=2)C.push(V);return C}),lt:cr(function(C,P,V){for(var te=V<0?V+P:V;--te>=0;)C.push(te);return C}),gt:cr(function(C,P,V){for(var te=V<0?V+P:V;++te<P;)C.push(te);return C})}},d.pseudos.nth=d.pseudos.eq;for(a in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[a]=Mh(a);for(a in{submit:!0,reset:!0})d.pseudos[a]=Rh(a);function ul(){}ul.prototype=d.filters=d.pseudos,d.setFilters=new ul,S=Ft.tokenize=function(C,P){var V,te,U,oe,ce,me,be,je=ms[C+" "];if(je)return P?0:je.slice(0);for(ce=C,me=[],be=d.preFilter;ce;){V&&!(te=bh.exec(ce))||(te&&(ce=ce.slice(te[0].length)||ce),me.push(U=[])),V=!1,(te=Ch.exec(ce))&&(V=te.shift(),U.push({value:V,type:te[0].replace($s," ")}),ce=ce.slice(V.length));for(oe in d.filter)!(te=js[oe].exec(ce))||be[oe]&&!(te=be[oe](te))||(V=te.shift(),U.push({value:V,type:oe,matches:te}),ce=ce.slice(V.length));if(!V)break}return P?ce.length:ce?Ft.error(C):ms(C,me).slice(0)};function Ws(C){for(var P=0,V=C.length,te="";P<V;P++)te+=C[P].value;return te}function zs(C,P,V){var te=P.dir,U=P.next,oe=U||te,ce=V&&oe==="parentNode",me=Ct++;return P.first?function(be,je,Be){for(;be=be[te];)if(be.nodeType===1||ce)return C(be,je,Be);return!1}:function(be,je,Be){var qe,ft,Bt,We=[Zi,me];if(Be){for(;be=be[te];)if((be.nodeType===1||ce)&&C(be,je,Be))return!0}else for(;be=be[te];)if(be.nodeType===1||ce)if(Bt=be[Nt]||(be[Nt]={}),ft=Bt[be.uniqueID]||(Bt[be.uniqueID]={}),U&&U===be.nodeName.toLowerCase())be=be[te]||be;else{if((qe=ft[oe])&&qe[0]===Zi&&qe[1]===me)return We[2]=qe[2];if(ft[oe]=We,We[2]=C(be,je,Be))return!0}return!1}}function rc(C){return C.length>1?function(P,V,te){for(var U=C.length;U--;)if(!C[U](P,V,te))return!1;return!0}:C[0]}function Ih(C,P,V){for(var te=0,U=P.length;te<U;te++)Ft(C,P[te],V);return V}function Gs(C,P,V,te,U){for(var oe,ce=[],me=0,be=C.length,je=P!=null;me<be;me++)(oe=C[me])&&(V&&!V(oe,te,U)||(ce.push(oe),je&&P.push(me)));return ce}function sc(C,P,V,te,U,oe){return te&&!te[Nt]&&(te=sc(te)),U&&!U[Nt]&&(U=sc(U,oe)),An(function(ce,me,be,je){var Be,qe,ft,Bt=[],We=[],Ti=me.length,Hi=ce||Ih(P||"*",be.nodeType?[be]:be,[]),gn=!C||!ce&&P?Hi:Gs(Hi,Bt,C,be,je),Qt=V?U||(ce?C:Ti||te)?[]:me:gn;if(V&&V(gn,Qt,be,je),te)for(Be=Gs(Qt,We),te(Be,[],be,je),qe=Be.length;qe--;)(ft=Be[qe])&&(Qt[We[qe]]=!(gn[We[qe]]=ft));if(ce){if(U||C){if(U){for(Be=[],qe=Qt.length;qe--;)(ft=Qt[qe])&&Be.push(gn[qe]=ft);U(null,Qt=[],Be,je)}for(qe=Qt.length;qe--;)(ft=Qt[qe])&&(Be=U?sr(ce,ft):Bt[qe])>-1&&(ce[Be]=!(me[Be]=ft))}}else Qt=Gs(Qt===me?Qt.splice(Ti,Qt.length):Qt),U?U(null,me,Qt,je):xi.apply(me,Qt)})}function ac(C){for(var P,V,te,U=C.length,oe=d.relative[C[0].type],ce=oe||d.relative[" "],me=oe?1:0,be=zs(function(qe){return qe===P},ce,!0),je=zs(function(qe){return sr(P,qe)>-1},ce,!0),Be=[function(qe,ft,Bt){var We=!oe&&(Bt||ft!==H)||((P=ft).nodeType?be(qe,ft,Bt):je(qe,ft,Bt));return P=null,We}];me<U;me++)if(V=d.relative[C[me].type])Be=[zs(rc(Be),V)];else{if(V=d.filter[C[me].type].apply(null,C[me].matches),V[Nt]){for(te=++me;te<U&&!d.relative[C[te].type];te++);return sc(me>1&&rc(Be),me>1&&Ws(C.slice(0,me-1).concat({value:C[me-2].type===" "?"*":""})).replace($s,"$1"),V,me<te&&ac(C.slice(me,te)),te<U&&ac(C=C.slice(te)),te<U&&Ws(C))}Be.push(V)}return rc(Be)}function Ah(C,P){var V=P.length>0,te=C.length>0,U=function(oe,ce,me,be,je){var Be,qe,ft,Bt=0,We="0",Ti=oe&&[],Hi=[],gn=H,Qt=oe||te&&d.find.TAG("*",je),Ss=Zi+=gn==null?1:Math.random()||.1,bs=Qt.length;for(je&&(H=ce===re||ce||je);We!==bs&&(Be=Qt[We])!=null;We++){if(te&&Be){for(qe=0,ce||Be.ownerDocument===re||(z(Be),me=!tt);ft=C[qe++];)if(ft(Be,ce||re,me)){be.push(Be);break}je&&(Zi=Ss)}V&&((Be=!ft&&Be)&&Bt--,oe&&Ti.push(Be))}if(Bt+=We,V&&We!==Bt){for(qe=0;ft=P[qe++];)ft(Ti,Hi,ce,me);if(oe){if(Bt>0)for(;We--;)Ti[We]||Hi[We]||(Hi[We]=No.call(be));Hi=Gs(Hi)}xi.apply(be,Hi),je&&!oe&&Hi.length>0&&Bt+P.length>1&&Ft.uniqueSort(be)}return je&&(Zi=Ss,H=gn),Ti};return V?An(U):U}return R=Ft.compile=function(C,P){var V,te=[],U=[],oe=Mr[C+" "];if(!oe){for(P||(P=S(C)),V=P.length;V--;)oe=ac(P[V]),oe[Nt]?te.push(oe):U.push(oe);oe=Mr(C,Ah(U,te)),oe.selector=C}return oe},L=Ft.select=function(C,P,V,te){var U,oe,ce,me,be,je=typeof C=="function"&&C,Be=!te&&S(C=je.selector||C);if(V=V||[],Be.length===1){if(oe=Be[0]=Be[0].slice(0),oe.length>2&&(ce=oe[0]).type==="ID"&&P.nodeType===9&&tt&&d.relative[oe[1].type]){if(P=(d.find.ID(ce.matches[0].replace(vo,_o),P)||[])[0],!P)return V;je&&(P=P.parentNode),C=C.slice(oe.shift().value.length)}for(U=js.needsContext.test(C)?0:oe.length;U--&&(ce=oe[U],!d.relative[me=ce.type]);)if((be=d.find[me])&&(te=be(ce.matches[0].replace(vo,_o),tc.test(oe[0].type)&&oc(P.parentNode)||P))){if(oe.splice(U,1),C=te.length&&Ws(oe),!C)return xi.apply(V,te),V;break}}return(je||R(C,Be))(te,P,!tt,V,!P||tc.test(C)&&oc(P.parentNode)||P),V},l.sortStable=Nt.split("").sort(In).join("")===Nt,l.detectDuplicates=!!de,z(),l.sortDetached=zn(function(C){return 1&C.compareDocumentPosition(re.createElement("fieldset"))}),zn(function(C){return C.innerHTML="<a href='#'></a>",C.firstChild.getAttribute("href")==="#"})||nc("type|href|height|width",function(C,P,V){if(!V)return C.getAttribute(P,P.toLowerCase()==="type"?1:2)}),l.attributes&&zn(function(C){return C.innerHTML="<input/>",C.firstChild.setAttribute("value",""),C.firstChild.getAttribute("value")===""})||nc("value",function(C,P,V){if(!V&&C.nodeName.toLowerCase()==="input")return C.defaultValue}),zn(function(C){return C.getAttribute("disabled")==null})||nc(Ja,function(C,P,V){var te;if(!V)return C[P]===!0?P.toLowerCase():(te=C.getAttributeNode(P))&&te.specified?te.value:null}),Ft}(s);p.find=hi,p.expr=hi.selectors,p.expr[":"]=p.expr.pseudos,p.uniqueSort=p.unique=hi.uniqueSort,p.text=hi.getText,p.isXMLDoc=hi.isXML,p.contains=hi.contains,p.escapeSelector=hi.escape;var vi=function(o,a,l){for(var d=[],m=l!==void 0;(o=o[a])&&o.nodeType!==9;)if(o.nodeType===1){if(m&&p(o).is(l))break;d.push(o)}return d},Oe=function(o,a){for(var l=[];o;o=o.nextSibling)o.nodeType===1&&o!==a&&l.push(o);return l},Fe=p.expr.match.needsContext;function h(o,a){return o.nodeName&&o.nodeName.toLowerCase()===a.toLowerCase()}var u=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,b=/^.[^:#\[\.,]*$/;function O(o,a,l){return p.isFunction(a)?p.grep(o,function(d,m){return!!a.call(d,m,d)!==l}):a.nodeType?p.grep(o,function(d){return d===a!==l}):typeof a!="string"?p.grep(o,function(d){return v.call(a,d)>-1!==l}):b.test(a)?p.filter(a,o,l):(a=p.filter(a,o),p.grep(o,function(d){return v.call(a,d)>-1!==l&&d.nodeType===1}))}p.filter=function(o,a,l){var d=a[0];return l&&(o=":not("+o+")"),a.length===1&&d.nodeType===1?p.find.matchesSelector(d,o)?[d]:[]:p.find.matches(o,p.grep(a,function(m){return m.nodeType===1}))},p.fn.extend({find:function(o){var a,l,d=this.length,m=this;if(typeof o!="string")return this.pushStack(p(o).filter(function(){for(a=0;a<d;a++)if(p.contains(m[a],this))return!0}));for(l=this.pushStack([]),a=0;a<d;a++)p.find(o,m[a],l);return d>1?p.uniqueSort(l):l},filter:function(o){return this.pushStack(O(this,o||[],!1))},not:function(o){return this.pushStack(O(this,o||[],!0))},is:function(o){return!!O(this,typeof o=="string"&&Fe.test(o)?p(o):o||[],!1).length}});var A,Q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,ye=p.fn.init=function(o,a,l){var d,m;if(!o)return this;if(l=l||A,typeof o=="string"){if(d=o[0]==="<"&&o[o.length-1]===">"&&o.length>=3?[null,o,null]:Q.exec(o),!d||!d[1]&&a)return!a||a.jquery?(a||l).find(o):this.constructor(a).find(o);if(d[1]){if(a=a instanceof p?a[0]:a,p.merge(this,p.parseHTML(d[1],a&&a.nodeType?a.ownerDocument||a:e,!0)),u.test(d[1])&&p.isPlainObject(a))for(d in a)p.isFunction(this[d])?this[d](a[d]):this.attr(d,a[d]);return this}return m=e.getElementById(d[2]),m&&(this[0]=m,this.length=1),this}return o.nodeType?(this[0]=o,this.length=1,this):p.isFunction(o)?l.ready!==void 0?l.ready(o):o(p):p.makeArray(o,this)};ye.prototype=p.fn,A=p(e);var Je=/^(?:parents|prev(?:Until|All))/,pt={children:!0,contents:!0,next:!0,prev:!0};p.fn.extend({has:function(o){var a=p(o,this),l=a.length;return this.filter(function(){for(var d=0;d<l;d++)if(p.contains(this,a[d]))return!0})},closest:function(o,a){var l,d=0,m=this.length,f=[],S=typeof o!="string"&&p(o);if(!Fe.test(o)){for(;d<m;d++)for(l=this[d];l&&l!==a;l=l.parentNode)if(l.nodeType<11&&(S?S.index(l)>-1:l.nodeType===1&&p.find.matchesSelector(l,o))){f.push(l);break}}return this.pushStack(f.length>1?p.uniqueSort(f):f)},index:function(o){return o?typeof o=="string"?v.call(p(o),this[0]):v.call(this,o.jquery?o[0]:o):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(o,a){return this.pushStack(p.uniqueSort(p.merge(this.get(),p(o,a))))},addBack:function(o){return this.add(o==null?this.prevObject:this.prevObject.filter(o))}});function yt(o,a){for(;(o=o[a])&&o.nodeType!==1;);return o}p.each({parent:function(o){var a=o.parentNode;return a&&a.nodeType!==11?a:null},parents:function(o){return vi(o,"parentNode")},parentsUntil:function(o,a,l){return vi(o,"parentNode",l)},next:function(o){return yt(o,"nextSibling")},prev:function(o){return yt(o,"previousSibling")},nextAll:function(o){return vi(o,"nextSibling")},prevAll:function(o){return vi(o,"previousSibling")},nextUntil:function(o,a,l){return vi(o,"nextSibling",l)},prevUntil:function(o,a,l){return vi(o,"previousSibling",l)},siblings:function(o){return Oe((o.parentNode||{}).firstChild,o)},children:function(o){return Oe(o.firstChild)},contents:function(o){return h(o,"iframe")?o.contentDocument:(h(o,"template")&&(o=o.content||o),p.merge([],o.childNodes))}},function(o,a){p.fn[o]=function(l,d){var m=p.map(this,a,l);return o.slice(-5)!=="Until"&&(d=l),d&&typeof d=="string"&&(m=p.filter(d,m)),this.length>1&&(pt[o]||p.uniqueSort(m),Je.test(o)&&m.reverse()),this.pushStack(m)}});var mt=/[^\x20\t\r\n\f]+/g;function _i(o){var a={};return p.each(o.match(mt)||[],function(l,d){a[d]=!0}),a}p.Callbacks=function(o){o=typeof o=="string"?_i(o):p.extend({},o);var a,l,d,m,f=[],S=[],R=-1,L=function(){for(m=m||o.once,d=a=!0;S.length;R=-1)for(l=S.shift();++R<f.length;)f[R].apply(l[0],l[1])===!1&&o.stopOnFalse&&(R=f.length,l=!1);o.memory||(l=!1),a=!1,m&&(f=l?[]:"")},H={add:function(){return f&&(l&&!a&&(R=f.length-1,S.push(l)),function ne(de){p.each(de,function(z,re){p.isFunction(re)?o.unique&&H.has(re)||f.push(re):re&&re.length&&p.type(re)!=="string"&&ne(re)})}(arguments),l&&!a&&L()),this},remove:function(){return p.each(arguments,function(ne,de){for(var z;(z=p.inArray(de,f,z))>-1;)f.splice(z,1),z<=R&&R--}),this},has:function(ne){return ne?p.inArray(ne,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return m=S=[],f=l="",this},disabled:function(){return!f},lock:function(){return m=S=[],l||a||(f=l=""),this},locked:function(){return!!m},fireWith:function(ne,de){return m||(de=de||[],de=[ne,de.slice?de.slice():de],S.push(de),a||L()),this},fire:function(){return H.fireWith(this,arguments),this},fired:function(){return!!d}};return H};function pn(o){return o}function co(o){throw o}function lo(o,a,l,d){var m;try{o&&p.isFunction(m=o.promise)?m.call(o).done(a).fail(l):o&&p.isFunction(m=o.then)?m.call(o,a,l):a.apply(void 0,[o].slice(d))}catch(f){l.apply(void 0,[f])}}p.extend({Deferred:function(o){var a=[["notify","progress",p.Callbacks("memory"),p.Callbacks("memory"),2],["resolve","done",p.Callbacks("once memory"),p.Callbacks("once memory"),0,"resolved"],["reject","fail",p.Callbacks("once memory"),p.Callbacks("once memory"),1,"rejected"]],l="pending",d={state:function(){return l},always:function(){return m.done(arguments).fail(arguments),this},catch:function(f){return d.then(null,f)},pipe:function(){var f=arguments;return p.Deferred(function(S){p.each(a,function(R,L){var H=p.isFunction(f[L[4]])&&f[L[4]];m[L[1]](function(){var ne=H&&H.apply(this,arguments);ne&&p.isFunction(ne.promise)?ne.promise().progress(S.notify).done(S.resolve).fail(S.reject):S[L[0]+"With"](this,H?[ne]:arguments)})}),f=null}).promise()},then:function(f,S,R){var L=0;function H(ne,de,z,re){return function(){var Ke=this,tt=arguments,Ve=function(){var ui,hn;if(!(ne<L)){if(ui=z.apply(Ke,tt),ui===de.promise())throw new TypeError("Thenable self-resolution");hn=ui&&(typeof ui=="object"||typeof ui=="function")&&ui.then,p.isFunction(hn)?re?hn.call(ui,H(L,de,pn,re),H(L,de,co,re)):(L++,hn.call(ui,H(L,de,pn,re),H(L,de,co,re),H(L,de,pn,de.notifyWith))):(z!==pn&&(Ke=void 0,tt=[ui]),(re||de.resolveWith)(Ke,tt))}},Ci=re?Ve:function(){try{Ve()}catch(ui){p.Deferred.exceptionHook&&p.Deferred.exceptionHook(ui,Ci.stackTrace),ne+1>=L&&(z!==co&&(Ke=void 0,tt=[ui]),de.rejectWith(Ke,tt))}};ne?Ci():(p.Deferred.getStackHook&&(Ci.stackTrace=p.Deferred.getStackHook()),s.setTimeout(Ci))}}return p.Deferred(function(ne){a[0][3].add(H(0,ne,p.isFunction(R)?R:pn,ne.notifyWith)),a[1][3].add(H(0,ne,p.isFunction(f)?f:pn)),a[2][3].add(H(0,ne,p.isFunction(S)?S:co))}).promise()},promise:function(f){return f!=null?p.extend(f,d):d}},m={};return p.each(a,function(f,S){var R=S[2],L=S[5];d[S[1]]=R.add,L&&R.add(function(){l=L},a[3-f][2].disable,a[0][2].lock),R.add(S[3].fire),m[S[0]]=function(){return m[S[0]+"With"](this===m?void 0:this,arguments),this},m[S[0]+"With"]=R.fireWith}),d.promise(m),o&&o.call(m,m),m},when:function(o){var a=arguments.length,l=a,d=Array(l),m=r.call(arguments),f=p.Deferred(),S=function(R){return function(L){d[R]=this,m[R]=arguments.length>1?r.call(arguments):L,--a||f.resolveWith(d,m)}};if(a<=1&&(lo(o,f.done(S(l)).resolve,f.reject,!a),f.state()==="pending"||p.isFunction(m[l]&&m[l].then)))return f.then();for(;l--;)lo(m[l],S(l),f.reject);return f.promise()}});var ir=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;p.Deferred.exceptionHook=function(o,a){s.console&&s.console.warn&&o&&ir.test(o.name)&&s.console.warn("jQuery.Deferred exception: "+o.message,o.stack,a)},p.readyException=function(o){s.setTimeout(function(){throw o})};var Ao=p.Deferred();p.fn.ready=function(o){return Ao.then(o).catch(function(a){p.readyException(a)}),this},p.extend({isReady:!1,readyWait:1,ready:function(o){(o===!0?--p.readyWait:p.isReady)||(p.isReady=!0,o!==!0&&--p.readyWait>0||Ao.resolveWith(e,[p]))}}),p.ready.then=Ao.then;function po(){e.removeEventListener("DOMContentLoaded",po),s.removeEventListener("load",po),p.ready()}e.readyState==="complete"||e.readyState!=="loading"&&!e.documentElement.doScroll?s.setTimeout(p.ready):(e.addEventListener("DOMContentLoaded",po),s.addEventListener("load",po));var Gi=function(o,a,l,d,m,f,S){var R=0,L=o.length,H=l==null;if(p.type(l)==="object"){m=!0;for(R in l)Gi(o,a,R,l[R],!0,f,S)}else if(d!==void 0&&(m=!0,p.isFunction(d)||(S=!0),H&&(S?(a.call(o,d),a=null):(H=a,a=function(ne,de,z){return H.call(p(ne),z)})),a))for(;R<L;R++)a(o[R],l,S?d:d.call(o[R],R,a(o[R],l)));return m?o:H?a.call(o):L?a(o[0],l):f},Do=function(o){return o.nodeType===1||o.nodeType===9||!+o.nodeType};function dn(){this.expando=p.expando+dn.uid++}dn.uid=1,dn.prototype={cache:function(o){var a=o[this.expando];return a||(a={},Do(o)&&(o.nodeType?o[this.expando]=a:Object.defineProperty(o,this.expando,{value:a,configurable:!0}))),a},set:function(o,a,l){var d,m=this.cache(o);if(typeof a=="string")m[p.camelCase(a)]=l;else for(d in a)m[p.camelCase(d)]=a[d];return m},get:function(o,a){return a===void 0?this.cache(o):o[this.expando]&&o[this.expando][p.camelCase(a)]},access:function(o,a,l){return a===void 0||a&&typeof a=="string"&&l===void 0?this.get(o,a):(this.set(o,a,l),l!==void 0?l:a)},remove:function(o,a){var l,d=o[this.expando];if(d!==void 0){if(a!==void 0)for(Array.isArray(a)?a=a.map(p.camelCase):(a=p.camelCase(a),a=a in d?[a]:a.match(mt)||[]),l=a.length;l--;)delete d[a[l]];(a===void 0||p.isEmptyObject(d))&&(o.nodeType?o[this.expando]=void 0:delete o[this.expando])}},hasData:function(o){var a=o[this.expando];return a!==void 0&&!p.isEmptyObject(a)}};var Xe=new dn,Si=new dn,jn=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Tr=/[A-Z]/g;function Ls(o){return o==="true"||o!=="false"&&(o==="null"?null:o===+o+""?+o:jn.test(o)?JSON.parse(o):o)}function vn(o,a,l){var d;if(l===void 0&&o.nodeType===1)if(d="data-"+a.replace(Tr,"-$&").toLowerCase(),l=o.getAttribute(d),typeof l=="string"){try{l=Ls(l)}catch{}Si.set(o,a,l)}else l=void 0;return l}p.extend({hasData:function(o){return Si.hasData(o)||Xe.hasData(o)},data:function(o,a,l){return Si.access(o,a,l)},removeData:function(o,a){Si.remove(o,a)},_data:function(o,a,l){return Xe.access(o,a,l)},_removeData:function(o,a){Xe.remove(o,a)}}),p.fn.extend({data:function(o,a){var l,d,m,f=this[0],S=f&&f.attributes;if(o===void 0){if(this.length&&(m=Si.get(f),f.nodeType===1&&!Xe.get(f,"hasDataAttrs"))){for(l=S.length;l--;)S[l]&&(d=S[l].name,d.indexOf("data-")===0&&(d=p.camelCase(d.slice(5)),vn(f,d,m[d])));Xe.set(f,"hasDataAttrs",!0)}return m}return typeof o=="object"?this.each(function(){Si.set(this,o)}):Gi(this,function(R){var L;if(f&&R===void 0){if(L=Si.get(f,o),L!==void 0||(L=vn(f,o),L!==void 0))return L}else this.each(function(){Si.set(this,o,R)})},null,a,arguments.length>1,null,!0)},removeData:function(o){return this.each(function(){Si.remove(this,o)})}}),p.extend({queue:function(o,a,l){var d;if(o)return a=(a||"fx")+"queue",d=Xe.get(o,a),l&&(!d||Array.isArray(l)?d=Xe.access(o,a,p.makeArray(l)):d.push(l)),d||[]},dequeue:function(o,a){a=a||"fx";var l=p.queue(o,a),d=l.length,m=l.shift(),f=p._queueHooks(o,a),S=function(){p.dequeue(o,a)};m==="inprogress"&&(m=l.shift(),d--),m&&(a==="fx"&&l.unshift("inprogress"),delete f.stop,m.call(o,S,f)),!d&&f&&f.empty.fire()},_queueHooks:function(o,a){var l=a+"queueHooks";return Xe.get(o,l)||Xe.access(o,l,{empty:p.Callbacks("once memory").add(function(){Xe.remove(o,[a+"queue",l])})})}}),p.fn.extend({queue:function(o,a){var l=2;return typeof o!="string"&&(a=o,o="fx",l--),arguments.length<l?p.queue(this[0],o):a===void 0?this:this.each(function(){var d=p.queue(this,o,a);p._queueHooks(this,o),o==="fx"&&d[0]!=="inprogress"&&p.dequeue(this,o)})},dequeue:function(o){return this.each(function(){p.dequeue(this,o)})},clearQueue:function(o){return this.queue(o||"fx",[])},promise:function(o,a){var l,d=1,m=p.Deferred(),f=this,S=this.length,R=function(){--d||m.resolveWith(f,[f])};for(typeof o!="string"&&(a=o,o=void 0),o=o||"fx";S--;)l=Xe.get(f[S],o+"queueHooks"),l&&l.empty&&(d++,l.empty.add(R));return R(),m.promise(a)}});var Or=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,qt=new RegExp("^(?:([+-])=|)("+Or+")([a-z%]*)$","i"),ho=["Top","Right","Bottom","Left"],uo=function(o,a){return o=a||o,o.style.display==="none"||o.style.display===""&&p.contains(o.ownerDocument,o)&&p.css(o,"display")==="none"},wr=function(o,a,l,d){var m,f,S={};for(f in a)S[f]=o.style[f],o.style[f]=a[f];m=l.apply(o,d||[]);for(f in a)o.style[f]=S[f];return m};function go(o,a,l,d){var m,f=1,S=20,R=d?function(){return d.cur()}:function(){return p.css(o,a,"")},L=R(),H=l&&l[3]||(p.cssNumber[a]?"":"px"),ne=(p.cssNumber[a]||H!=="px"&&+L)&&qt.exec(p.css(o,a));if(ne&&ne[3]!==H){H=H||ne[3],l=l||[],ne=+L||1;do f=f||".5",ne/=f,p.style(o,a,ne+H);while(f!==(f=R()/L)&&f!==1&&--S)}return l&&(ne=+ne||+L||0,m=l[1]?ne+(l[1]+1)*l[2]:+l[2],d&&(d.unit=H,d.start=ne,d.end=m)),m}var Wn={};function nr(o){var a,l=o.ownerDocument,d=o.nodeName,m=Wn[d];return m||(a=l.body.appendChild(l.createElement(d)),m=p.css(a,"display"),a.parentNode.removeChild(a),m==="none"&&(m="block"),Wn[d]=m,m)}function nt(o,a){for(var l,d,m=[],f=0,S=o.length;f<S;f++)d=o[f],d.style&&(l=d.style.display,a?(l==="none"&&(m[f]=Xe.get(d,"display")||null,m[f]||(d.style.display="")),d.style.display===""&&uo(d)&&(m[f]=nr(d))):l!=="none"&&(m[f]="none",Xe.set(d,"display",l)));for(f=0;f<S;f++)m[f]!=null&&(o[f].style.display=m[f]);return o}p.fn.extend({show:function(){return nt(this,!0)},hide:function(){return nt(this)},toggle:function(o){return typeof o=="boolean"?o?this.show():this.hide():this.each(function(){uo(this)?p(this).show():p(this).hide()})}});var Ni=/^(?:checkbox|radio)$/i,Dt=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,bi=/^$|\/(?:java|ecma)script/i,Yi={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Yi.optgroup=Yi.option,Yi.tbody=Yi.tfoot=Yi.colgroup=Yi.caption=Yi.thead,Yi.th=Yi.td;function ki(o,a){var l;return l=typeof o.getElementsByTagName<"u"?o.getElementsByTagName(a||"*"):typeof o.querySelectorAll<"u"?o.querySelectorAll(a||"*"):[],a===void 0||a&&h(o,a)?p.merge([o],l):l}function Mn(o,a){for(var l=0,d=o.length;l<d;l++)Xe.set(o[l],"globalEval",!a||Xe.get(a[l],"globalEval"))}var fo=/<|&#?\w+;/;function ds(o,a,l,d,m){for(var f,S,R,L,H,ne,de=a.createDocumentFragment(),z=[],re=0,Ke=o.length;re<Ke;re++)if(f=o[re],f||f===0)if(p.type(f)==="object")p.merge(z,f.nodeType?[f]:f);else if(fo.test(f)){for(S=S||de.appendChild(a.createElement("div")),R=(Dt.exec(f)||["",""])[1].toLowerCase(),L=Yi[R]||Yi._default,S.innerHTML=L[1]+p.htmlPrefilter(f)+L[2],ne=L[0];ne--;)S=S.lastChild;p.merge(z,S.childNodes),S=de.firstChild,S.textContent=""}else z.push(a.createTextNode(f));for(de.textContent="",re=0;f=z[re++];)if(d&&p.inArray(f,d)>-1)m&&m.push(f);else if(H=p.contains(f.ownerDocument,f),S=ki(de.appendChild(f),"script"),H&&Mn(S),l)for(ne=0;f=S[ne++];)bi.test(f.type||"")&&l.push(f);return de}(function(){var o=e.createDocumentFragment(),a=o.appendChild(e.createElement("div")),l=e.createElement("input");l.setAttribute("type","radio"),l.setAttribute("checked","checked"),l.setAttribute("name","t"),a.appendChild(l),pe.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,a.innerHTML="<textarea>x</textarea>",pe.noCloneChecked=!!a.cloneNode(!0).lastChild.defaultValue})();var mo=e.documentElement,Fd=/^key/,Bd=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Nc=/^([^.]*)(?:\.(.+)|)/;function Fs(){return!0}function yr(){return!1}function kc(){try{return e.activeElement}catch{}}function Wa(o,a,l,d,m,f){var S,R;if(typeof a=="object"){typeof l!="string"&&(d=d||l,l=void 0);for(R in a)Wa(o,R,l,d,a[R],f);return o}if(d==null&&m==null?(m=l,d=l=void 0):m==null&&(typeof l=="string"?(m=d,d=void 0):(m=d,d=l,l=void 0)),m===!1)m=yr;else if(!m)return o;return f===1&&(S=m,m=function(L){return p().off(L),S.apply(this,arguments)},m.guid=S.guid||(S.guid=p.guid++)),o.each(function(){p.event.add(this,a,m,d,l)})}p.event={global:{},add:function(o,a,l,d,m){var f,S,R,L,H,ne,de,z,re,Ke,tt,Ve=Xe.get(o);if(Ve)for(l.handler&&(f=l,l=f.handler,m=f.selector),m&&p.find.matchesSelector(mo,m),l.guid||(l.guid=p.guid++),(L=Ve.events)||(L=Ve.events={}),(S=Ve.handle)||(S=Ve.handle=function(Ci){return typeof p<"u"&&p.event.triggered!==Ci.type?p.event.dispatch.apply(o,arguments):void 0}),a=(a||"").match(mt)||[""],H=a.length;H--;)R=Nc.exec(a[H])||[],re=tt=R[1],Ke=(R[2]||"").split(".").sort(),re&&(de=p.event.special[re]||{},re=(m?de.delegateType:de.bindType)||re,de=p.event.special[re]||{},ne=p.extend({type:re,origType:tt,data:d,handler:l,guid:l.guid,selector:m,needsContext:m&&p.expr.match.needsContext.test(m),namespace:Ke.join(".")},f),(z=L[re])||(z=L[re]=[],z.delegateCount=0,de.setup&&de.setup.call(o,d,Ke,S)!==!1||o.addEventListener&&o.addEventListener(re,S)),de.add&&(de.add.call(o,ne),ne.handler.guid||(ne.handler.guid=l.guid)),m?z.splice(z.delegateCount++,0,ne):z.push(ne),p.event.global[re]=!0)},remove:function(o,a,l,d,m){var f,S,R,L,H,ne,de,z,re,Ke,tt,Ve=Xe.hasData(o)&&Xe.get(o);if(Ve&&(L=Ve.events)){for(a=(a||"").match(mt)||[""],H=a.length;H--;)if(R=Nc.exec(a[H])||[],re=tt=R[1],Ke=(R[2]||"").split(".").sort(),re){for(de=p.event.special[re]||{},re=(d?de.delegateType:de.bindType)||re,z=L[re]||[],R=R[2]&&new RegExp("(^|\\.)"+Ke.join("\\.(?:.*\\.|)")+"(\\.|$)"),S=f=z.length;f--;)ne=z[f],!m&&tt!==ne.origType||l&&l.guid!==ne.guid||R&&!R.test(ne.namespace)||d&&d!==ne.selector&&(d!=="**"||!ne.selector)||(z.splice(f,1),ne.selector&&z.delegateCount--,de.remove&&de.remove.call(o,ne));S&&!z.length&&(de.teardown&&de.teardown.call(o,Ke,Ve.handle)!==!1||p.removeEvent(o,re,Ve.handle),delete L[re])}else for(re in L)p.event.remove(o,re+a[H],l,d,!0);p.isEmptyObject(L)&&Xe.remove(o,"handle events")}},dispatch:function(o){var a=p.event.fix(o),l,d,m,f,S,R,L=new Array(arguments.length),H=(Xe.get(this,"events")||{})[a.type]||[],ne=p.event.special[a.type]||{};for(L[0]=a,l=1;l<arguments.length;l++)L[l]=arguments[l];if(a.delegateTarget=this,!ne.preDispatch||ne.preDispatch.call(this,a)!==!1){for(R=p.event.handlers.call(this,a,H),l=0;(f=R[l++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,d=0;(S=f.handlers[d++])&&!a.isImmediatePropagationStopped();)a.rnamespace&&!a.rnamespace.test(S.namespace)||(a.handleObj=S,a.data=S.data,m=((p.event.special[S.origType]||{}).handle||S.handler).apply(f.elem,L),m!==void 0&&(a.result=m)===!1&&(a.preventDefault(),a.stopPropagation()));return ne.postDispatch&&ne.postDispatch.call(this,a),a.result}},handlers:function(o,a){var l,d,m,f,S,R=[],L=a.delegateCount,H=o.target;if(L&&H.nodeType&&!(o.type==="click"&&o.button>=1)){for(;H!==this;H=H.parentNode||this)if(H.nodeType===1&&(o.type!=="click"||H.disabled!==!0)){for(f=[],S={},l=0;l<L;l++)d=a[l],m=d.selector+" ",S[m]===void 0&&(S[m]=d.needsContext?p(m,this).index(H)>-1:p.find(m,this,null,[H]).length),S[m]&&f.push(d);f.length&&R.push({elem:H,handlers:f})}}return H=this,L<a.length&&R.push({elem:H,handlers:a.slice(L)}),R},addProp:function(o,a){Object.defineProperty(p.Event.prototype,o,{enumerable:!0,configurable:!0,get:p.isFunction(a)?function(){if(this.originalEvent)return a(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[o]},set:function(l){Object.defineProperty(this,o,{enumerable:!0,configurable:!0,writable:!0,value:l})}})},fix:function(o){return o[p.expando]?o:new p.Event(o)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==kc()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===kc()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(Ni.test(this.type)&&this.click&&h(this,"input"))return this.click(),!1},_default:function(o){return h(o.target,"a")}},beforeunload:{postDispatch:function(o){o.result!==void 0&&o.originalEvent&&(o.originalEvent.returnValue=o.result)}}}},p.removeEvent=function(o,a,l){o.removeEventListener&&o.removeEventListener(a,l)},p.Event=function(o,a){return this instanceof p.Event?(o&&o.type?(this.originalEvent=o,this.type=o.type,this.isDefaultPrevented=o.defaultPrevented||o.defaultPrevented===void 0&&o.returnValue===!1?Fs:yr,this.target=o.target&&o.target.nodeType===3?o.target.parentNode:o.target,this.currentTarget=o.currentTarget,this.relatedTarget=o.relatedTarget):this.type=o,a&&p.extend(this,a),this.timeStamp=o&&o.timeStamp||p.now(),void(this[p.expando]=!0)):new p.Event(o,a)},p.Event.prototype={constructor:p.Event,isDefaultPrevented:yr,isPropagationStopped:yr,isImmediatePropagationStopped:yr,isSimulated:!1,preventDefault:function(){var o=this.originalEvent;this.isDefaultPrevented=Fs,o&&!this.isSimulated&&o.preventDefault()},stopPropagation:function(){var o=this.originalEvent;this.isPropagationStopped=Fs,o&&!this.isSimulated&&o.stopPropagation()},stopImmediatePropagation:function(){var o=this.originalEvent;this.isImmediatePropagationStopped=Fs,o&&!this.isSimulated&&o.stopImmediatePropagation(),this.stopPropagation()}},p.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(o){var a=o.button;return o.which==null&&Fd.test(o.type)?o.charCode!=null?o.charCode:o.keyCode:!o.which&&a!==void 0&&Bd.test(o.type)?1&a?1:2&a?3:4&a?2:0:o.which}},p.event.addProp),p.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(o,a){p.event.special[o]={delegateType:a,bindType:a,handle:function(l){var d,m=this,f=l.relatedTarget,S=l.handleObj;return f&&(f===m||p.contains(m,f))||(l.type=S.origType,d=S.handler.apply(this,arguments),l.type=a),d}}}),p.fn.extend({on:function(o,a,l,d){return Wa(this,o,a,l,d)},one:function(o,a,l,d){return Wa(this,o,a,l,d,1)},off:function(o,a,l){var d,m;if(o&&o.preventDefault&&o.handleObj)return d=o.handleObj,p(o.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if(typeof o=="object"){for(m in o)this.off(m,a,o[m]);return this}return a!==!1&&typeof a!="function"||(l=a,a=void 0),l===!1&&(l=yr),this.each(function(){p.event.remove(this,o,l,a)})}});var Ud=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Hd=/<script|<style|<link/i,$d=/checked\s*(?:[^=]|=\s*.checked.)/i,jd=/^true\/(.*)/,Wd=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Vc(o,a){return h(o,"table")&&h(a.nodeType!==11?a:a.firstChild,"tr")&&p(">tbody",o)[0]||o}function zd(o){return o.type=(o.getAttribute("type")!==null)+"/"+o.type,o}function Gd(o){var a=jd.exec(o.type);return a?o.type=a[1]:o.removeAttribute("type"),o}function Lc(o,a){var l,d,m,f,S,R,L,H;if(a.nodeType===1){if(Xe.hasData(o)&&(f=Xe.access(o),S=Xe.set(a,f),H=f.events)){delete S.handle,S.events={};for(m in H)for(l=0,d=H[m].length;l<d;l++)p.event.add(a,m,H[m][l])}Si.hasData(o)&&(R=Si.access(o),L=p.extend({},R),Si.set(a,L))}}function Yd(o,a){var l=a.nodeName.toLowerCase();l==="input"&&Ni.test(o.type)?a.checked=o.checked:l!=="input"&&l!=="textarea"||(a.defaultValue=o.defaultValue)}function Er(o,a,l,d){a=c.apply([],a);var m,f,S,R,L,H,ne=0,de=o.length,z=de-1,re=a[0],Ke=p.isFunction(re);if(Ke||de>1&&typeof re=="string"&&!pe.checkClone&&$d.test(re))return o.each(function(tt){var Ve=o.eq(tt);Ke&&(a[0]=re.call(this,tt,Ve.html())),Er(Ve,a,l,d)});if(de&&(m=ds(a,o[0].ownerDocument,!1,o,d),f=m.firstChild,m.childNodes.length===1&&(m=f),f||d)){for(S=p.map(ki(m,"script"),zd),R=S.length;ne<de;ne++)L=m,ne!==z&&(L=p.clone(L,!0,!0),R&&p.merge(S,ki(L,"script"))),l.call(o[ne],L,ne);if(R)for(H=S[S.length-1].ownerDocument,p.map(S,Gd),ne=0;ne<R;ne++)L=S[ne],bi.test(L.type||"")&&!Xe.access(L,"globalEval")&&p.contains(H,L)&&(L.src?p._evalUrl&&p._evalUrl(L.src):he(L.textContent.replace(Wd,""),H))}return o}function Fc(o,a,l){for(var d,m=a?p.filter(a,o):o,f=0;(d=m[f])!=null;f++)l||d.nodeType!==1||p.cleanData(ki(d)),d.parentNode&&(l&&p.contains(d.ownerDocument,d)&&Mn(ki(d,"script")),d.parentNode.removeChild(d));return o}p.extend({htmlPrefilter:function(o){return o.replace(Ud,"<$1></$2>")},clone:function(o,a,l){var d,m,f,S,R=o.cloneNode(!0),L=p.contains(o.ownerDocument,o);if(!(pe.noCloneChecked||o.nodeType!==1&&o.nodeType!==11||p.isXMLDoc(o)))for(S=ki(R),f=ki(o),d=0,m=f.length;d<m;d++)Yd(f[d],S[d]);if(a)if(l)for(f=f||ki(o),S=S||ki(R),d=0,m=f.length;d<m;d++)Lc(f[d],S[d]);else Lc(o,R);return S=ki(R,"script"),S.length>0&&Mn(S,!L&&ki(o,"script")),R},cleanData:function(o){for(var a,l,d,m=p.event.special,f=0;(l=o[f])!==void 0;f++)if(Do(l)){if(a=l[Xe.expando]){if(a.events)for(d in a.events)m[d]?p.event.remove(l,d):p.removeEvent(l,d,a.handle);l[Xe.expando]=void 0}l[Si.expando]&&(l[Si.expando]=void 0)}}}),p.fn.extend({detach:function(o){return Fc(this,o,!0)},remove:function(o){return Fc(this,o)},text:function(o){return Gi(this,function(a){return a===void 0?p.text(this):this.empty().each(function(){this.nodeType!==1&&this.nodeType!==11&&this.nodeType!==9||(this.textContent=a)})},null,o,arguments.length)},append:function(){return Er(this,arguments,function(o){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var a=Vc(this,o);a.appendChild(o)}})},prepend:function(){return Er(this,arguments,function(o){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var a=Vc(this,o);a.insertBefore(o,a.firstChild)}})},before:function(){return Er(this,arguments,function(o){this.parentNode&&this.parentNode.insertBefore(o,this)})},after:function(){return Er(this,arguments,function(o){this.parentNode&&this.parentNode.insertBefore(o,this.nextSibling)})},empty:function(){for(var o,a=0;(o=this[a])!=null;a++)o.nodeType===1&&(p.cleanData(ki(o,!1)),o.textContent="");return this},clone:function(o,a){return o=o!=null&&o,a=a??o,this.map(function(){return p.clone(this,o,a)})},html:function(o){return Gi(this,function(a){var l=this[0]||{},d=0,m=this.length;if(a===void 0&&l.nodeType===1)return l.innerHTML;if(typeof a=="string"&&!Hd.test(a)&&!Yi[(Dt.exec(a)||["",""])[1].toLowerCase()]){a=p.htmlPrefilter(a);try{for(;d<m;d++)l=this[d]||{},l.nodeType===1&&(p.cleanData(ki(l,!1)),l.innerHTML=a);l=0}catch{}}l&&this.empty().append(a)},null,o,arguments.length)},replaceWith:function(){var o=[];return Er(this,arguments,function(a){var l=this.parentNode;p.inArray(this,o)<0&&(p.cleanData(ki(this)),l&&l.replaceChild(a,this))},o)}}),p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(o,a){p.fn[o]=function(l){for(var d,m=[],f=p(l),S=f.length-1,R=0;R<=S;R++)d=R===S?this:this.clone(!0),p(f[R])[a](d),g.apply(m,d.get());return this.pushStack(m)}});var Bc=/^margin/,za=new RegExp("^("+Or+")(?!px)[a-z%]+$","i"),Bs=function(o){var a=o.ownerDocument.defaultView;return a&&a.opener||(a=s),a.getComputedStyle(o)};(function(){function o(){if(S){S.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",S.innerHTML="",mo.appendChild(f);var R=s.getComputedStyle(S);a=R.top!=="1%",m=R.marginLeft==="2px",l=R.width==="4px",S.style.marginRight="50%",d=R.marginRight==="4px",mo.removeChild(f),S=null}}var a,l,d,m,f=e.createElement("div"),S=e.createElement("div");S.style&&(S.style.backgroundClip="content-box",S.cloneNode(!0).style.backgroundClip="",pe.clearCloneStyle=S.style.backgroundClip==="content-box",f.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",f.appendChild(S),p.extend(pe,{pixelPosition:function(){return o(),a},boxSizingReliable:function(){return o(),l},pixelMarginRight:function(){return o(),d},reliableMarginLeft:function(){return o(),m}}))})();function hs(o,a,l){var d,m,f,S,R=o.style;return l=l||Bs(o),l&&(S=l.getPropertyValue(a)||l[a],S!==""||p.contains(o.ownerDocument,o)||(S=p.style(o,a)),!pe.pixelMarginRight()&&za.test(S)&&Bc.test(a)&&(d=R.width,m=R.minWidth,f=R.maxWidth,R.minWidth=R.maxWidth=R.width=S,S=l.width,R.width=d,R.minWidth=m,R.maxWidth=f)),S!==void 0?S+"":S}function Uc(o,a){return{get:function(){return o()?void delete this.get:(this.get=a).apply(this,arguments)}}}var Xd=/^(none|table(?!-c[ea]).+)/,Hc=/^--/,Kd={position:"absolute",visibility:"hidden",display:"block"},$c={letterSpacing:"0",fontWeight:"400"},jc=["Webkit","Moz","ms"],Wc=e.createElement("div").style;function qd(o){if(o in Wc)return o;for(var a=o[0].toUpperCase()+o.slice(1),l=jc.length;l--;)if(o=jc[l]+a,o in Wc)return o}function zc(o){var a=p.cssProps[o];return a||(a=p.cssProps[o]=qd(o)||o),a}function Gc(o,a,l){var d=qt.exec(a);return d?Math.max(0,d[2]-(l||0))+(d[3]||"px"):a}function Yc(o,a,l,d,m){var f,S=0;for(f=l===(d?"border":"content")?4:a==="width"?1:0;f<4;f+=2)l==="margin"&&(S+=p.css(o,l+ho[f],!0,m)),d?(l==="content"&&(S-=p.css(o,"padding"+ho[f],!0,m)),l!=="margin"&&(S-=p.css(o,"border"+ho[f]+"Width",!0,m))):(S+=p.css(o,"padding"+ho[f],!0,m),l!=="padding"&&(S+=p.css(o,"border"+ho[f]+"Width",!0,m)));return S}function Xc(o,a,l){var d,m=Bs(o),f=hs(o,a,m),S=p.css(o,"boxSizing",!1,m)==="border-box";return za.test(f)?f:(d=S&&(pe.boxSizingReliable()||f===o.style[a]),f=parseFloat(f)||0,f+Yc(o,a,l||(S?"border":"content"),d,m)+"px")}p.extend({cssHooks:{opacity:{get:function(o,a){if(a){var l=hs(o,"opacity");return l===""?"1":l}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(o,a,l,d){if(o&&o.nodeType!==3&&o.nodeType!==8&&o.style){var m,f,S,R=p.camelCase(a),L=Hc.test(a),H=o.style;return L||(a=zc(R)),S=p.cssHooks[a]||p.cssHooks[R],l===void 0?S&&"get"in S&&(m=S.get(o,!1,d))!==void 0?m:H[a]:(f=typeof l,f==="string"&&(m=qt.exec(l))&&m[1]&&(l=go(o,a,m),f="number"),l!=null&&l===l&&(f==="number"&&(l+=m&&m[3]||(p.cssNumber[R]?"":"px")),pe.clearCloneStyle||l!==""||a.indexOf("background")!==0||(H[a]="inherit"),S&&"set"in S&&(l=S.set(o,l,d))===void 0||(L?H.setProperty(a,l):H[a]=l)),void 0)}},css:function(o,a,l,d){var m,f,S,R=p.camelCase(a),L=Hc.test(a);return L||(a=zc(R)),S=p.cssHooks[a]||p.cssHooks[R],S&&"get"in S&&(m=S.get(o,!0,l)),m===void 0&&(m=hs(o,a,d)),m==="normal"&&a in $c&&(m=$c[a]),l===""||l?(f=parseFloat(m),l===!0||isFinite(f)?f||0:m):m}}),p.each(["height","width"],function(o,a){p.cssHooks[a]={get:function(l,d,m){if(d)return!Xd.test(p.css(l,"display"))||l.getClientRects().length&&l.getBoundingClientRect().width?Xc(l,a,m):wr(l,Kd,function(){return Xc(l,a,m)})},set:function(l,d,m){var f,S=m&&Bs(l),R=m&&Yc(l,a,m,p.css(l,"boxSizing",!1,S)==="border-box",S);return R&&(f=qt.exec(d))&&(f[3]||"px")!=="px"&&(l.style[a]=d,d=p.css(l,a)),Gc(l,d,R)}}}),p.cssHooks.marginLeft=Uc(pe.reliableMarginLeft,function(o,a){if(a)return(parseFloat(hs(o,"marginLeft"))||o.getBoundingClientRect().left-wr(o,{marginLeft:0},function(){return o.getBoundingClientRect().left}))+"px"}),p.each({margin:"",padding:"",border:"Width"},function(o,a){p.cssHooks[o+a]={expand:function(l){for(var d=0,m={},f=typeof l=="string"?l.split(" "):[l];d<4;d++)m[o+ho[d]+a]=f[d]||f[d-2]||f[0];return m}},Bc.test(o)||(p.cssHooks[o+a].set=Gc)}),p.fn.extend({css:function(o,a){return Gi(this,function(l,d,m){var f,S,R={},L=0;if(Array.isArray(d)){for(f=Bs(l),S=d.length;L<S;L++)R[d[L]]=p.css(l,d[L],!1,f);return R}return m!==void 0?p.style(l,d,m):p.css(l,d)},o,a,arguments.length>1)}});function Qi(o,a,l,d,m){return new Qi.prototype.init(o,a,l,d,m)}p.Tween=Qi,Qi.prototype={constructor:Qi,init:function(o,a,l,d,m,f){this.elem=o,this.prop=l,this.easing=m||p.easing._default,this.options=a,this.start=this.now=this.cur(),this.end=d,this.unit=f||(p.cssNumber[l]?"":"px")},cur:function(){var o=Qi.propHooks[this.prop];return o&&o.get?o.get(this):Qi.propHooks._default.get(this)},run:function(o){var a,l=Qi.propHooks[this.prop];return this.options.duration?this.pos=a=p.easing[this.easing](o,this.options.duration*o,0,1,this.options.duration):this.pos=a=o,this.now=(this.end-this.start)*a+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),l&&l.set?l.set(this):Qi.propHooks._default.set(this),this}},Qi.prototype.init.prototype=Qi.prototype,Qi.propHooks={_default:{get:function(o){var a;return o.elem.nodeType!==1||o.elem[o.prop]!=null&&o.elem.style[o.prop]==null?o.elem[o.prop]:(a=p.css(o.elem,o.prop,""),a&&a!=="auto"?a:0)},set:function(o){p.fx.step[o.prop]?p.fx.step[o.prop](o):o.elem.nodeType!==1||o.elem.style[p.cssProps[o.prop]]==null&&!p.cssHooks[o.prop]?o.elem[o.prop]=o.now:p.style(o.elem,o.prop,o.now+o.unit)}}},Qi.propHooks.scrollTop=Qi.propHooks.scrollLeft={set:function(o){o.elem.nodeType&&o.elem.parentNode&&(o.elem[o.prop]=o.now)}},p.easing={linear:function(o){return o},swing:function(o){return .5-Math.cos(o*Math.PI)/2},_default:"swing"},p.fx=Qi.prototype.init,p.fx.step={};var Pr,Us,Qd=/^(?:toggle|show|hide)$/,Zd=/queueHooks$/;function Ga(){Us&&(e.hidden===!1&&s.requestAnimationFrame?s.requestAnimationFrame(Ga):s.setTimeout(Ga,p.fx.interval),p.fx.tick())}function Kc(){return s.setTimeout(function(){Pr=void 0}),Pr=p.now()}function Hs(o,a){var l,d=0,m={height:o};for(a=a?1:0;d<4;d+=2-a)l=ho[d],m["margin"+l]=m["padding"+l]=o;return a&&(m.opacity=m.width=o),m}function qc(o,a,l){for(var d,m=(Rn.tweeners[a]||[]).concat(Rn.tweeners["*"]),f=0,S=m.length;f<S;f++)if(d=m[f].call(l,a,o))return d}function Jd(o,a,l){var d,m,f,S,R,L,H,ne,de="width"in a||"height"in a,z=this,re={},Ke=o.style,tt=o.nodeType&&uo(o),Ve=Xe.get(o,"fxshow");l.queue||(S=p._queueHooks(o,"fx"),S.unqueued==null&&(S.unqueued=0,R=S.empty.fire,S.empty.fire=function(){S.unqueued||R()}),S.unqueued++,z.always(function(){z.always(function(){S.unqueued--,p.queue(o,"fx").length||S.empty.fire()})}));for(d in a)if(m=a[d],Qd.test(m)){if(delete a[d],f=f||m==="toggle",m===(tt?"hide":"show")){if(m!=="show"||!Ve||Ve[d]===void 0)continue;tt=!0}re[d]=Ve&&Ve[d]||p.style(o,d)}if(L=!p.isEmptyObject(a),L||!p.isEmptyObject(re)){de&&o.nodeType===1&&(l.overflow=[Ke.overflow,Ke.overflowX,Ke.overflowY],H=Ve&&Ve.display,H==null&&(H=Xe.get(o,"display")),ne=p.css(o,"display"),ne==="none"&&(H?ne=H:(nt([o],!0),H=o.style.display||H,ne=p.css(o,"display"),nt([o]))),(ne==="inline"||ne==="inline-block"&&H!=null)&&p.css(o,"float")==="none"&&(L||(z.done(function(){Ke.display=H}),H==null&&(ne=Ke.display,H=ne==="none"?"":ne)),Ke.display="inline-block")),l.overflow&&(Ke.overflow="hidden",z.always(function(){Ke.overflow=l.overflow[0],Ke.overflowX=l.overflow[1],Ke.overflowY=l.overflow[2]})),L=!1;for(d in re)L||(Ve?"hidden"in Ve&&(tt=Ve.hidden):Ve=Xe.access(o,"fxshow",{display:H}),f&&(Ve.hidden=!tt),tt&&nt([o],!0),z.done(function(){tt||nt([o]),Xe.remove(o,"fxshow");for(d in re)p.style(o,d,re[d])})),L=qc(tt?Ve[d]:0,d,z),d in Ve||(Ve[d]=L.start,tt&&(L.end=L.start,L.start=0))}}function eh(o,a){var l,d,m,f,S;for(l in o)if(d=p.camelCase(l),m=a[d],f=o[l],Array.isArray(f)&&(m=f[1],f=o[l]=f[0]),l!==d&&(o[d]=f,delete o[l]),S=p.cssHooks[d],S&&"expand"in S){f=S.expand(f),delete o[d];for(l in f)l in o||(o[l]=f[l],a[l]=m)}else a[d]=m}function Rn(o,a,l){var d,m,f=0,S=Rn.prefilters.length,R=p.Deferred().always(function(){delete L.elem}),L=function(){if(m)return!1;for(var de=Pr||Kc(),z=Math.max(0,H.startTime+H.duration-de),re=z/H.duration||0,Ke=1-re,tt=0,Ve=H.tweens.length;tt<Ve;tt++)H.tweens[tt].run(Ke);return R.notifyWith(o,[H,Ke,z]),Ke<1&&Ve?z:(Ve||R.notifyWith(o,[H,1,0]),R.resolveWith(o,[H]),!1)},H=R.promise({elem:o,props:p.extend({},a),opts:p.extend(!0,{specialEasing:{},easing:p.easing._default},l),originalProperties:a,originalOptions:l,startTime:Pr||Kc(),duration:l.duration,tweens:[],createTween:function(de,z){var re=p.Tween(o,H.opts,de,z,H.opts.specialEasing[de]||H.opts.easing);return H.tweens.push(re),re},stop:function(de){var z=0,re=de?H.tweens.length:0;if(m)return this;for(m=!0;z<re;z++)H.tweens[z].run(1);return de?(R.notifyWith(o,[H,1,0]),R.resolveWith(o,[H,de])):R.rejectWith(o,[H,de]),this}}),ne=H.props;for(eh(ne,H.opts.specialEasing);f<S;f++)if(d=Rn.prefilters[f].call(H,o,ne,H.opts))return p.isFunction(d.stop)&&(p._queueHooks(H.elem,H.opts.queue).stop=p.proxy(d.stop,d)),d;return p.map(ne,qc,H),p.isFunction(H.opts.start)&&H.opts.start.call(o,H),H.progress(H.opts.progress).done(H.opts.done,H.opts.complete).fail(H.opts.fail).always(H.opts.always),p.fx.timer(p.extend(L,{elem:o,anim:H,queue:H.opts.queue})),H}p.Animation=p.extend(Rn,{tweeners:{"*":[function(o,a){var l=this.createTween(o,a);return go(l.elem,o,qt.exec(a),l),l}]},tweener:function(o,a){p.isFunction(o)?(a=o,o=["*"]):o=o.match(mt);for(var l,d=0,m=o.length;d<m;d++)l=o[d],Rn.tweeners[l]=Rn.tweeners[l]||[],Rn.tweeners[l].unshift(a)},prefilters:[Jd],prefilter:function(o,a){a?Rn.prefilters.unshift(o):Rn.prefilters.push(o)}}),p.speed=function(o,a,l){var d=o&&typeof o=="object"?p.extend({},o):{complete:l||!l&&a||p.isFunction(o)&&o,duration:o,easing:l&&a||a&&!p.isFunction(a)&&a};return p.fx.off?d.duration=0:typeof d.duration!="number"&&(d.duration in p.fx.speeds?d.duration=p.fx.speeds[d.duration]:d.duration=p.fx.speeds._default),d.queue!=null&&d.queue!==!0||(d.queue="fx"),d.old=d.complete,d.complete=function(){p.isFunction(d.old)&&d.old.call(this),d.queue&&p.dequeue(this,d.queue)},d},p.fn.extend({fadeTo:function(o,a,l,d){return this.filter(uo).css("opacity",0).show().end().animate({opacity:a},o,l,d)},animate:function(o,a,l,d){var m=p.isEmptyObject(o),f=p.speed(a,l,d),S=function(){var R=Rn(this,p.extend({},o),f);(m||Xe.get(this,"finish"))&&R.stop(!0)};return S.finish=S,m||f.queue===!1?this.each(S):this.queue(f.queue,S)},stop:function(o,a,l){var d=function(m){var f=m.stop;delete m.stop,f(l)};return typeof o!="string"&&(l=a,a=o,o=void 0),a&&o!==!1&&this.queue(o||"fx",[]),this.each(function(){var m=!0,f=o!=null&&o+"queueHooks",S=p.timers,R=Xe.get(this);if(f)R[f]&&R[f].stop&&d(R[f]);else for(f in R)R[f]&&R[f].stop&&Zd.test(f)&&d(R[f]);for(f=S.length;f--;)S[f].elem!==this||o!=null&&S[f].queue!==o||(S[f].anim.stop(l),m=!1,S.splice(f,1));!m&&l||p.dequeue(this,o)})},finish:function(o){return o!==!1&&(o=o||"fx"),this.each(function(){var a,l=Xe.get(this),d=l[o+"queue"],m=l[o+"queueHooks"],f=p.timers,S=d?d.length:0;for(l.finish=!0,p.queue(this,o,[]),m&&m.stop&&m.stop.call(this,!0),a=f.length;a--;)f[a].elem===this&&f[a].queue===o&&(f[a].anim.stop(!0),f.splice(a,1));for(a=0;a<S;a++)d[a]&&d[a].finish&&d[a].finish.call(this);delete l.finish})}}),p.each(["toggle","show","hide"],function(o,a){var l=p.fn[a];p.fn[a]=function(d,m,f){return d==null||typeof d=="boolean"?l.apply(this,arguments):this.animate(Hs(a,!0),d,m,f)}}),p.each({slideDown:Hs("show"),slideUp:Hs("hide"),slideToggle:Hs("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(o,a){p.fn[o]=function(l,d,m){return this.animate(a,l,d,m)}}),p.timers=[],p.fx.tick=function(){var o,a=0,l=p.timers;for(Pr=p.now();a<l.length;a++)o=l[a],o()||l[a]!==o||l.splice(a--,1);l.length||p.fx.stop(),Pr=void 0},p.fx.timer=function(o){p.timers.push(o),p.fx.start()},p.fx.interval=13,p.fx.start=function(){Us||(Us=!0,Ga())},p.fx.stop=function(){Us=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fn.delay=function(o,a){return o=p.fx&&p.fx.speeds[o]||o,a=a||"fx",this.queue(a,function(l,d){var m=s.setTimeout(l,o);d.stop=function(){s.clearTimeout(m)}})},function(){var o=e.createElement("input"),a=e.createElement("select"),l=a.appendChild(e.createElement("option"));o.type="checkbox",pe.checkOn=o.value!=="",pe.optSelected=l.selected,o=e.createElement("input"),o.value="t",o.type="radio",pe.radioValue=o.value==="t"}();var Qc,us=p.expr.attrHandle;p.fn.extend({attr:function(o,a){return Gi(this,p.attr,o,a,arguments.length>1)},removeAttr:function(o){return this.each(function(){p.removeAttr(this,o)})}}),p.extend({attr:function(o,a,l){var d,m,f=o.nodeType;if(f!==3&&f!==8&&f!==2)return typeof o.getAttribute>"u"?p.prop(o,a,l):(f===1&&p.isXMLDoc(o)||(m=p.attrHooks[a.toLowerCase()]||(p.expr.match.bool.test(a)?Qc:void 0)),l!==void 0?l===null?void p.removeAttr(o,a):m&&"set"in m&&(d=m.set(o,l,a))!==void 0?d:(o.setAttribute(a,l+""),l):m&&"get"in m&&(d=m.get(o,a))!==null?d:(d=p.find.attr(o,a),d??void 0))},attrHooks:{type:{set:function(o,a){if(!pe.radioValue&&a==="radio"&&h(o,"input")){var l=o.value;return o.setAttribute("type",a),l&&(o.value=l),a}}}},removeAttr:function(o,a){var l,d=0,m=a&&a.match(mt);if(m&&o.nodeType===1)for(;l=m[d++];)o.removeAttribute(l)}}),Qc={set:function(o,a,l){return a===!1?p.removeAttr(o,l):o.setAttribute(l,l),l}},p.each(p.expr.match.bool.source.match(/\w+/g),function(o,a){var l=us[a]||p.find.attr;us[a]=function(d,m,f){var S,R,L=m.toLowerCase();return f||(R=us[L],us[L]=S,S=l(d,m,f)!=null?L:null,us[L]=R),S}});var th=/^(?:input|select|textarea|button)$/i,ih=/^(?:a|area)$/i;p.fn.extend({prop:function(o,a){return Gi(this,p.prop,o,a,arguments.length>1)},removeProp:function(o){return this.each(function(){delete this[p.propFix[o]||o]})}}),p.extend({prop:function(o,a,l){var d,m,f=o.nodeType;if(f!==3&&f!==8&&f!==2)return f===1&&p.isXMLDoc(o)||(a=p.propFix[a]||a,m=p.propHooks[a]),l!==void 0?m&&"set"in m&&(d=m.set(o,l,a))!==void 0?d:o[a]=l:m&&"get"in m&&(d=m.get(o,a))!==null?d:o[a]},propHooks:{tabIndex:{get:function(o){var a=p.find.attr(o,"tabindex");return a?parseInt(a,10):th.test(o.nodeName)||ih.test(o.nodeName)&&o.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),pe.optSelected||(p.propHooks.selected={get:function(o){var a=o.parentNode;return a&&a.parentNode&&a.parentNode.selectedIndex,null},set:function(o){var a=o.parentNode;a&&(a.selectedIndex,a.parentNode&&a.parentNode.selectedIndex)}}),p.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){p.propFix[this.toLowerCase()]=this});function or(o){var a=o.match(mt)||[];return a.join(" ")}function rr(o){return o.getAttribute&&o.getAttribute("class")||""}p.fn.extend({addClass:function(o){var a,l,d,m,f,S,R,L=0;if(p.isFunction(o))return this.each(function(H){p(this).addClass(o.call(this,H,rr(this)))});if(typeof o=="string"&&o){for(a=o.match(mt)||[];l=this[L++];)if(m=rr(l),d=l.nodeType===1&&" "+or(m)+" "){for(S=0;f=a[S++];)d.indexOf(" "+f+" ")<0&&(d+=f+" ");R=or(d),m!==R&&l.setAttribute("class",R)}}return this},removeClass:function(o){var a,l,d,m,f,S,R,L=0;if(p.isFunction(o))return this.each(function(H){p(this).removeClass(o.call(this,H,rr(this)))});if(!arguments.length)return this.attr("class","");if(typeof o=="string"&&o){for(a=o.match(mt)||[];l=this[L++];)if(m=rr(l),d=l.nodeType===1&&" "+or(m)+" "){for(S=0;f=a[S++];)for(;d.indexOf(" "+f+" ")>-1;)d=d.replace(" "+f+" "," ");R=or(d),m!==R&&l.setAttribute("class",R)}}return this},toggleClass:function(o,a){var l=typeof o;return typeof a=="boolean"&&l==="string"?a?this.addClass(o):this.removeClass(o):p.isFunction(o)?this.each(function(d){p(this).toggleClass(o.call(this,d,rr(this),a),a)}):this.each(function(){var d,m,f,S;if(l==="string")for(m=0,f=p(this),S=o.match(mt)||[];d=S[m++];)f.hasClass(d)?f.removeClass(d):f.addClass(d);else o!==void 0&&l!=="boolean"||(d=rr(this),d&&Xe.set(this,"__className__",d),this.setAttribute&&this.setAttribute("class",d||o===!1?"":Xe.get(this,"__className__")||""))})},hasClass:function(o){var a,l,d=0;for(a=" "+o+" ";l=this[d++];)if(l.nodeType===1&&(" "+or(rr(l))+" ").indexOf(a)>-1)return!0;return!1}});var nh=/\r/g;p.fn.extend({val:function(o){var a,l,d,m=this[0];{if(arguments.length)return d=p.isFunction(o),this.each(function(f){var S;this.nodeType===1&&(S=d?o.call(this,f,p(this).val()):o,S==null?S="":typeof S=="number"?S+="":Array.isArray(S)&&(S=p.map(S,function(R){return R==null?"":R+""})),a=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()],a&&"set"in a&&a.set(this,S,"value")!==void 0||(this.value=S))});if(m)return a=p.valHooks[m.type]||p.valHooks[m.nodeName.toLowerCase()],a&&"get"in a&&(l=a.get(m,"value"))!==void 0?l:(l=m.value,typeof l=="string"?l.replace(nh,""):l??"")}}}),p.extend({valHooks:{option:{get:function(o){var a=p.find.attr(o,"value");return a??or(p.text(o))}},select:{get:function(o){var a,l,d,m=o.options,f=o.selectedIndex,S=o.type==="select-one",R=S?null:[],L=S?f+1:m.length;for(d=f<0?L:S?f:0;d<L;d++)if(l=m[d],(l.selected||d===f)&&!l.disabled&&(!l.parentNode.disabled||!h(l.parentNode,"optgroup"))){if(a=p(l).val(),S)return a;R.push(a)}return R},set:function(o,a){for(var l,d,m=o.options,f=p.makeArray(a),S=m.length;S--;)d=m[S],(d.selected=p.inArray(p.valHooks.option.get(d),f)>-1)&&(l=!0);return l||(o.selectedIndex=-1),f}}}}),p.each(["radio","checkbox"],function(){p.valHooks[this]={set:function(o,a){if(Array.isArray(a))return o.checked=p.inArray(p(o).val(),a)>-1}},pe.checkOn||(p.valHooks[this].get=function(o){return o.getAttribute("value")===null?"on":o.value})});var Zc=/^(?:focusinfocus|focusoutblur)$/;p.extend(p.event,{trigger:function(o,a,l,d){var m,f,S,R,L,H,ne,de=[l||e],z=k.call(o,"type")?o.type:o,re=k.call(o,"namespace")?o.namespace.split("."):[];if(f=S=l=l||e,l.nodeType!==3&&l.nodeType!==8&&!Zc.test(z+p.event.triggered)&&(z.indexOf(".")>-1&&(re=z.split("."),z=re.shift(),re.sort()),L=z.indexOf(":")<0&&"on"+z,o=o[p.expando]?o:new p.Event(z,typeof o=="object"&&o),o.isTrigger=d?2:3,o.namespace=re.join("."),o.rnamespace=o.namespace?new RegExp("(^|\\.)"+re.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,o.result=void 0,o.target||(o.target=l),a=a==null?[o]:p.makeArray(a,[o]),ne=p.event.special[z]||{},d||!ne.trigger||ne.trigger.apply(l,a)!==!1)){if(!d&&!ne.noBubble&&!p.isWindow(l)){for(R=ne.delegateType||z,Zc.test(R+z)||(f=f.parentNode);f;f=f.parentNode)de.push(f),S=f;S===(l.ownerDocument||e)&&de.push(S.defaultView||S.parentWindow||s)}for(m=0;(f=de[m++])&&!o.isPropagationStopped();)o.type=m>1?R:ne.bindType||z,H=(Xe.get(f,"events")||{})[o.type]&&Xe.get(f,"handle"),H&&H.apply(f,a),H=L&&f[L],H&&H.apply&&Do(f)&&(o.result=H.apply(f,a),o.result===!1&&o.preventDefault());return o.type=z,d||o.isDefaultPrevented()||ne._default&&ne._default.apply(de.pop(),a)!==!1||!Do(l)||L&&p.isFunction(l[z])&&!p.isWindow(l)&&(S=l[L],S&&(l[L]=null),p.event.triggered=z,l[z](),p.event.triggered=void 0,S&&(l[L]=S)),o.result}},simulate:function(o,a,l){var d=p.extend(new p.Event,l,{type:o,isSimulated:!0});p.event.trigger(d,null,a)}}),p.fn.extend({trigger:function(o,a){return this.each(function(){p.event.trigger(o,a,this)})},triggerHandler:function(o,a){var l=this[0];if(l)return p.event.trigger(o,a,l,!0)}}),p.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(o,a){p.fn[a]=function(l,d){return arguments.length>0?this.on(a,null,l,d):this.trigger(a)}}),p.fn.extend({hover:function(o,a){return this.mouseenter(o).mouseleave(a||o)}}),pe.focusin="onfocusin"in s,pe.focusin||p.each({focus:"focusin",blur:"focusout"},function(o,a){var l=function(d){p.event.simulate(a,d.target,p.event.fix(d))};p.event.special[a]={setup:function(){var d=this.ownerDocument||this,m=Xe.access(d,a);m||d.addEventListener(o,l,!0),Xe.access(d,a,(m||0)+1)},teardown:function(){var d=this.ownerDocument||this,m=Xe.access(d,a)-1;m?Xe.access(d,a,m):(d.removeEventListener(o,l,!0),Xe.remove(d,a))}}});var gs=s.location,Jc=p.now(),Ya=/\?/;p.parseXML=function(o){var a;if(!o||typeof o!="string")return null;try{a=new s.DOMParser().parseFromString(o,"text/xml")}catch{a=void 0}return a&&!a.getElementsByTagName("parsererror").length||p.error("Invalid XML: "+o),a};var oh=/\[\]$/,el=/\r?\n/g,rh=/^(?:submit|button|image|reset|file)$/i,sh=/^(?:input|select|textarea|keygen)/i;function Xa(o,a,l,d){var m;if(Array.isArray(a))p.each(a,function(f,S){l||oh.test(o)?d(o,S):Xa(o+"["+(typeof S=="object"&&S!=null?f:"")+"]",S,l,d)});else if(l||p.type(a)!=="object")d(o,a);else for(m in a)Xa(o+"["+m+"]",a[m],l,d)}p.param=function(o,a){var l,d=[],m=function(f,S){var R=p.isFunction(S)?S():S;d[d.length]=encodeURIComponent(f)+"="+encodeURIComponent(R??"")};if(Array.isArray(o)||o.jquery&&!p.isPlainObject(o))p.each(o,function(){m(this.name,this.value)});else for(l in o)Xa(l,o[l],a,m);return d.join("&")},p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var o=p.prop(this,"elements");return o?p.makeArray(o):this}).filter(function(){var o=this.type;return this.name&&!p(this).is(":disabled")&&sh.test(this.nodeName)&&!rh.test(o)&&(this.checked||!Ni.test(o))}).map(function(o,a){var l=p(this).val();return l==null?null:Array.isArray(l)?p.map(l,function(d){return{name:a.name,value:d.replace(el,`\r
`)}}):{name:a.name,value:l.replace(el,`\r
`)}}).get()}});var ah=/%20/g,ch=/#.*$/,lh=/([?&])_=[^&]*/,ph=/^(.*?):[ \t]*([^\r\n]*)$/gm,dh=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,hh=/^(?:GET|HEAD)$/,uh=/^\/\//,tl={},Ka={},il="*/".concat("*"),qa=e.createElement("a");qa.href=gs.href;function nl(o){return function(a,l){typeof a!="string"&&(l=a,a="*");var d,m=0,f=a.toLowerCase().match(mt)||[];if(p.isFunction(l))for(;d=f[m++];)d[0]==="+"?(d=d.slice(1)||"*",(o[d]=o[d]||[]).unshift(l)):(o[d]=o[d]||[]).push(l)}}function ol(o,a,l,d){var m={},f=o===Ka;function S(R){var L;return m[R]=!0,p.each(o[R]||[],function(H,ne){var de=ne(a,l,d);return typeof de!="string"||f||m[de]?f?!(L=de):void 0:(a.dataTypes.unshift(de),S(de),!1)}),L}return S(a.dataTypes[0])||!m["*"]&&S("*")}function Qa(o,a){var l,d,m=p.ajaxSettings.flatOptions||{};for(l in a)a[l]!==void 0&&((m[l]?o:d||(d={}))[l]=a[l]);return d&&p.extend(!0,o,d),o}function gh(o,a,l){for(var d,m,f,S,R=o.contents,L=o.dataTypes;L[0]==="*";)L.shift(),d===void 0&&(d=o.mimeType||a.getResponseHeader("Content-Type"));if(d){for(m in R)if(R[m]&&R[m].test(d)){L.unshift(m);break}}if(L[0]in l)f=L[0];else{for(m in l){if(!L[0]||o.converters[m+" "+L[0]]){f=m;break}S||(S=m)}f=f||S}if(f)return f!==L[0]&&L.unshift(f),l[f]}function fh(o,a,l,d){var m,f,S,R,L,H={},ne=o.dataTypes.slice();if(ne[1])for(S in o.converters)H[S.toLowerCase()]=o.converters[S];for(f=ne.shift();f;)if(o.responseFields[f]&&(l[o.responseFields[f]]=a),!L&&d&&o.dataFilter&&(a=o.dataFilter(a,o.dataType)),L=f,f=ne.shift()){if(f==="*")f=L;else if(L!=="*"&&L!==f){if(S=H[L+" "+f]||H["* "+f],!S){for(m in H)if(R=m.split(" "),R[1]===f&&(S=H[L+" "+R[0]]||H["* "+R[0]])){S===!0?S=H[m]:H[m]!==!0&&(f=R[0],ne.unshift(R[1]));break}}if(S!==!0)if(S&&o.throws)a=S(a);else try{a=S(a)}catch(de){return{state:"parsererror",error:S?de:"No conversion from "+L+" to "+f}}}}return{state:"success",data:a}}p.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:gs.href,type:"GET",isLocal:dh.test(gs.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":il,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":p.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(o,a){return a?Qa(Qa(o,p.ajaxSettings),a):Qa(p.ajaxSettings,o)},ajaxPrefilter:nl(tl),ajaxTransport:nl(Ka),ajax:function(o,a){typeof o=="object"&&(a=o,o=void 0),a=a||{};var l,d,m,f,S,R,L,H,ne,de,z=p.ajaxSetup({},a),re=z.context||z,Ke=z.context&&(re.nodeType||re.jquery)?p(re):p.event,tt=p.Deferred(),Ve=p.Callbacks("once memory"),Ci=z.statusCode||{},ui={},hn={},Nt="canceled",et={readyState:0,getResponseHeader:function(Ct){var ii;if(L){if(!f)for(f={};ii=ph.exec(m);)f[ii[1].toLowerCase()]=ii[2];ii=f[Ct.toLowerCase()]}return ii??null},getAllResponseHeaders:function(){return L?m:null},setRequestHeader:function(Ct,ii){return L==null&&(Ct=hn[Ct.toLowerCase()]=hn[Ct.toLowerCase()]||Ct,ui[Ct]=ii),this},overrideMimeType:function(Ct){return L==null&&(z.mimeType=Ct),this},statusCode:function(Ct){var ii;if(Ct)if(L)et.always(Ct[et.status]);else for(ii in Ct)Ci[ii]=[Ci[ii],Ct[ii]];return this},abort:function(Ct){var ii=Ct||Nt;return l&&l.abort(ii),Zi(0,ii),this}};if(tt.promise(et),z.url=((o||z.url||gs.href)+"").replace(uh,gs.protocol+"//"),z.type=a.method||a.type||z.method||z.type,z.dataTypes=(z.dataType||"*").toLowerCase().match(mt)||[""],z.crossDomain==null){R=e.createElement("a");try{R.href=z.url,R.href=R.href,z.crossDomain=qa.protocol+"//"+qa.host!=R.protocol+"//"+R.host}catch{z.crossDomain=!0}}if(z.data&&z.processData&&typeof z.data!="string"&&(z.data=p.param(z.data,z.traditional)),ol(tl,z,a,et),L)return et;H=p.event&&z.global,H&&p.active++===0&&p.event.trigger("ajaxStart"),z.type=z.type.toUpperCase(),z.hasContent=!hh.test(z.type),d=z.url.replace(ch,""),z.hasContent?z.data&&z.processData&&(z.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(z.data=z.data.replace(ah,"+")):(de=z.url.slice(d.length),z.data&&(d+=(Ya.test(d)?"&":"?")+z.data,delete z.data),z.cache===!1&&(d=d.replace(lh,"$1"),de=(Ya.test(d)?"&":"?")+"_="+Jc+++de),z.url=d+de),z.ifModified&&(p.lastModified[d]&&et.setRequestHeader("If-Modified-Since",p.lastModified[d]),p.etag[d]&&et.setRequestHeader("If-None-Match",p.etag[d])),(z.data&&z.hasContent&&z.contentType!==!1||a.contentType)&&et.setRequestHeader("Content-Type",z.contentType),et.setRequestHeader("Accept",z.dataTypes[0]&&z.accepts[z.dataTypes[0]]?z.accepts[z.dataTypes[0]]+(z.dataTypes[0]!=="*"?", "+il+"; q=0.01":""):z.accepts["*"]);for(ne in z.headers)et.setRequestHeader(ne,z.headers[ne]);if(z.beforeSend&&(z.beforeSend.call(re,et,z)===!1||L))return et.abort();if(Nt="abort",Ve.add(z.complete),et.done(z.success),et.fail(z.error),l=ol(Ka,z,a,et)){if(et.readyState=1,H&&Ke.trigger("ajaxSend",[et,z]),L)return et;z.async&&z.timeout>0&&(S=s.setTimeout(function(){et.abort("timeout")},z.timeout));try{L=!1,l.send(ui,Zi)}catch(Ct){if(L)throw Ct;Zi(-1,Ct)}}else Zi(-1,"No Transport");function Zi(Ct,ii,ms,Mr){var In,vs,un,No,ko,xi=ii;L||(L=!0,S&&s.clearTimeout(S),l=void 0,m=Mr||"",et.readyState=Ct>0?4:0,In=Ct>=200&&Ct<300||Ct===304,ms&&(No=gh(z,et,ms)),No=fh(z,No,et,In),In?(z.ifModified&&(ko=et.getResponseHeader("Last-Modified"),ko&&(p.lastModified[d]=ko),ko=et.getResponseHeader("etag"),ko&&(p.etag[d]=ko)),Ct===204||z.type==="HEAD"?xi="nocontent":Ct===304?xi="notmodified":(xi=No.state,vs=No.data,un=No.error,In=!un)):(un=xi,!Ct&&xi||(xi="error",Ct<0&&(Ct=0))),et.status=Ct,et.statusText=(ii||xi)+"",In?tt.resolveWith(re,[vs,xi,et]):tt.rejectWith(re,[et,xi,un]),et.statusCode(Ci),Ci=void 0,H&&Ke.trigger(In?"ajaxSuccess":"ajaxError",[et,z,In?vs:un]),Ve.fireWith(re,[et,xi]),H&&(Ke.trigger("ajaxComplete",[et,z]),--p.active||p.event.trigger("ajaxStop")))}return et},getJSON:function(o,a,l){return p.get(o,a,l,"json")},getScript:function(o,a){return p.get(o,void 0,a,"script")}}),p.each(["get","post"],function(o,a){p[a]=function(l,d,m,f){return p.isFunction(d)&&(f=f||m,m=d,d=void 0),p.ajax(p.extend({url:l,type:a,dataType:f,data:d,success:m},p.isPlainObject(l)&&l))}}),p._evalUrl=function(o){return p.ajax({url:o,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},p.fn.extend({wrapAll:function(o){var a;return this[0]&&(p.isFunction(o)&&(o=o.call(this[0])),a=p(o,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&a.insertBefore(this[0]),a.map(function(){for(var l=this;l.firstElementChild;)l=l.firstElementChild;return l}).append(this)),this},wrapInner:function(o){return p.isFunction(o)?this.each(function(a){p(this).wrapInner(o.call(this,a))}):this.each(function(){var a=p(this),l=a.contents();l.length?l.wrapAll(o):a.append(o)})},wrap:function(o){var a=p.isFunction(o);return this.each(function(l){p(this).wrapAll(a?o.call(this,l):o)})},unwrap:function(o){return this.parent(o).not("body").each(function(){p(this).replaceWith(this.childNodes)}),this}}),p.expr.pseudos.hidden=function(o){return!p.expr.pseudos.visible(o)},p.expr.pseudos.visible=function(o){return!!(o.offsetWidth||o.offsetHeight||o.getClientRects().length)},p.ajaxSettings.xhr=function(){try{return new s.XMLHttpRequest}catch{}};var mh={0:200,1223:204},fs=p.ajaxSettings.xhr();pe.cors=!!fs&&"withCredentials"in fs,pe.ajax=fs=!!fs,p.ajaxTransport(function(o){var a,l;if(pe.cors||fs&&!o.crossDomain)return{send:function(d,m){var f,S=o.xhr();if(S.open(o.type,o.url,o.async,o.username,o.password),o.xhrFields)for(f in o.xhrFields)S[f]=o.xhrFields[f];o.mimeType&&S.overrideMimeType&&S.overrideMimeType(o.mimeType),o.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");for(f in d)S.setRequestHeader(f,d[f]);a=function(R){return function(){a&&(a=l=S.onload=S.onerror=S.onabort=S.onreadystatechange=null,R==="abort"?S.abort():R==="error"?typeof S.status!="number"?m(0,"error"):m(S.status,S.statusText):m(mh[S.status]||S.status,S.statusText,(S.responseType||"text")!=="text"||typeof S.responseText!="string"?{binary:S.response}:{text:S.responseText},S.getAllResponseHeaders()))}},S.onload=a(),l=S.onerror=a("error"),S.onabort!==void 0?S.onabort=l:S.onreadystatechange=function(){S.readyState===4&&s.setTimeout(function(){a&&l()})},a=a("abort");try{S.send(o.hasContent&&o.data||null)}catch(R){if(a)throw R}},abort:function(){a&&a()}}}),p.ajaxPrefilter(function(o){o.crossDomain&&(o.contents.script=!1)}),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(o){return p.globalEval(o),o}}}),p.ajaxPrefilter("script",function(o){o.cache===void 0&&(o.cache=!1),o.crossDomain&&(o.type="GET")}),p.ajaxTransport("script",function(o){if(o.crossDomain){var a,l;return{send:function(d,m){a=p("<script>").prop({charset:o.scriptCharset,src:o.url}).on("load error",l=function(f){a.remove(),l=null,f&&m(f.type==="error"?404:200,f.type)}),e.head.appendChild(a[0])},abort:function(){l&&l()}}}});var rl=[],Za=/(=)\?(?=&|$)|\?\?/;p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var o=rl.pop()||p.expando+"_"+Jc++;return this[o]=!0,o}}),p.ajaxPrefilter("json jsonp",function(o,a,l){var d,m,f,S=o.jsonp!==!1&&(Za.test(o.url)?"url":typeof o.data=="string"&&(o.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&Za.test(o.data)&&"data");if(S||o.dataTypes[0]==="jsonp")return d=o.jsonpCallback=p.isFunction(o.jsonpCallback)?o.jsonpCallback():o.jsonpCallback,S?o[S]=o[S].replace(Za,"$1"+d):o.jsonp!==!1&&(o.url+=(Ya.test(o.url)?"&":"?")+o.jsonp+"="+d),o.converters["script json"]=function(){return f||p.error(d+" was not called"),f[0]},o.dataTypes[0]="json",m=s[d],s[d]=function(){f=arguments},l.always(function(){m===void 0?p(s).removeProp(d):s[d]=m,o[d]&&(o.jsonpCallback=a.jsonpCallback,rl.push(d)),f&&p.isFunction(m)&&m(f[0]),f=m=void 0}),"script"}),pe.createHTMLDocument=function(){var o=e.implementation.createHTMLDocument("").body;return o.innerHTML="<form></form><form></form>",o.childNodes.length===2}(),p.parseHTML=function(o,a,l){if(typeof o!="string")return[];typeof a=="boolean"&&(l=a,a=!1);var d,m,f;return a||(pe.createHTMLDocument?(a=e.implementation.createHTMLDocument(""),d=a.createElement("base"),d.href=e.location.href,a.head.appendChild(d)):a=e),m=u.exec(o),f=!l&&[],m?[a.createElement(m[1])]:(m=ds([o],a,f),f&&f.length&&p(f).remove(),p.merge([],m.childNodes))},p.fn.load=function(o,a,l){var d,m,f,S=this,R=o.indexOf(" ");return R>-1&&(d=or(o.slice(R)),o=o.slice(0,R)),p.isFunction(a)?(l=a,a=void 0):a&&typeof a=="object"&&(m="POST"),S.length>0&&p.ajax({url:o,type:m||"GET",dataType:"html",data:a}).done(function(L){f=arguments,S.html(d?p("<div>").append(p.parseHTML(L)).find(d):L)}).always(l&&function(L,H){S.each(function(){l.apply(this,f||[L.responseText,H,L])})}),this},p.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(o,a){p.fn[a]=function(l){return this.on(a,l)}}),p.expr.pseudos.animated=function(o){return p.grep(p.timers,function(a){return o===a.elem}).length},p.offset={setOffset:function(o,a,l){var d,m,f,S,R,L,H,ne=p.css(o,"position"),de=p(o),z={};ne==="static"&&(o.style.position="relative"),R=de.offset(),f=p.css(o,"top"),L=p.css(o,"left"),H=(ne==="absolute"||ne==="fixed")&&(f+L).indexOf("auto")>-1,H?(d=de.position(),S=d.top,m=d.left):(S=parseFloat(f)||0,m=parseFloat(L)||0),p.isFunction(a)&&(a=a.call(o,l,p.extend({},R))),a.top!=null&&(z.top=a.top-R.top+S),a.left!=null&&(z.left=a.left-R.left+m),"using"in a?a.using.call(o,z):de.css(z)}},p.fn.extend({offset:function(o){if(arguments.length)return o===void 0?this:this.each(function(S){p.offset.setOffset(this,o,S)});var a,l,d,m,f=this[0];if(f)return f.getClientRects().length?(d=f.getBoundingClientRect(),a=f.ownerDocument,l=a.documentElement,m=a.defaultView,{top:d.top+m.pageYOffset-l.clientTop,left:d.left+m.pageXOffset-l.clientLeft}):{top:0,left:0}},position:function(){if(this[0]){var o,a,l=this[0],d={top:0,left:0};return p.css(l,"position")==="fixed"?a=l.getBoundingClientRect():(o=this.offsetParent(),a=this.offset(),h(o[0],"html")||(d=o.offset()),d={top:d.top+p.css(o[0],"borderTopWidth",!0),left:d.left+p.css(o[0],"borderLeftWidth",!0)}),{top:a.top-d.top-p.css(l,"marginTop",!0),left:a.left-d.left-p.css(l,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var o=this.offsetParent;o&&p.css(o,"position")==="static";)o=o.offsetParent;return o||mo})}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(o,a){var l=a==="pageYOffset";p.fn[o]=function(d){return Gi(this,function(m,f,S){var R;return p.isWindow(m)?R=m:m.nodeType===9&&(R=m.defaultView),S===void 0?R?R[a]:m[f]:void(R?R.scrollTo(l?R.pageXOffset:S,l?S:R.pageYOffset):m[f]=S)},o,d,arguments.length)}}),p.each(["top","left"],function(o,a){p.cssHooks[a]=Uc(pe.pixelPosition,function(l,d){if(d)return d=hs(l,a),za.test(d)?p(l).position()[a]+"px":d})}),p.each({Height:"height",Width:"width"},function(o,a){p.each({padding:"inner"+o,content:a,"":"outer"+o},function(l,d){p.fn[d]=function(m,f){var S=arguments.length&&(l||typeof m!="boolean"),R=l||(m===!0||f===!0?"margin":"border");return Gi(this,function(L,H,ne){var de;return p.isWindow(L)?d.indexOf("outer")===0?L["inner"+o]:L.document.documentElement["client"+o]:L.nodeType===9?(de=L.documentElement,Math.max(L.body["scroll"+o],de["scroll"+o],L.body["offset"+o],de["offset"+o],de["client"+o])):ne===void 0?p.css(L,H,R):p.style(L,H,ne,R)},a,S?m:void 0,S)}})}),p.fn.extend({bind:function(o,a,l){return this.on(o,null,a,l)},unbind:function(o,a){return this.off(o,null,a)},delegate:function(o,a,l,d){return this.on(a,o,l,d)},undelegate:function(o,a,l){return arguments.length===1?this.off(o,"**"):this.off(a,o||"**",l)},holdReady:function(o){o?p.readyWait++:p.ready(!0)}}),p.isArray=Array.isArray,p.parseJSON=JSON.parse,p.nodeName=h,typeof define=="function"&&define.amd&&define("jquery",[],function(){return p});var vh=s.jQuery,_h=s.$;return p.noConflict=function(o){return s.$===p&&(s.$=_h),o&&s.jQuery===p&&(s.jQuery=vh),p},t||(s.jQuery=s.$=p),p});jQuery=Ds.exports;(function(s){function t(h,u,b){if(!b[0]||typeof b[0]=="object")return u.init.apply(h,b);if(u[b[0]])return u[b[0]].apply(h,Array.prototype.slice.call(b,1));throw k(b[0]+" is not a method or property")}function i(h,u,b,O){return{css:{position:"absolute",top:h,left:u,overflow:O||"hidden",zIndex:b||"auto"}}}function e(h,u,b,O,A){var Q=1-A,ye=Q*Q*Q,Je=A*A*A;return n(Math.round(ye*h.x+3*A*Q*Q*u.x+3*A*A*Q*b.x+Je*O.x),Math.round(ye*h.y+3*A*Q*Q*u.y+3*A*A*Q*b.y+Je*O.y))}function n(h,u){return{x:h,y:u}}function r(h,u,b){return le&&b?" translate3d("+h+"px,"+u+"px, 0px) ":" translate("+h+"px, "+u+"px) "}function c(h){return" rotate("+h+"deg) "}function g(h,u){return Object.prototype.hasOwnProperty.call(u,h)}function v(){for(var h=["Moz","Webkit","Khtml","O","ms"],u=h.length,b="";u--;)h[u]+"Transform"in document.body.style&&(b="-"+h[u].toLowerCase()+"-");return b}function y(h,u,b,O,A){var Q,ye=[];if(he=="-webkit-"){for(Q=0;Q<A;Q++)ye.push("color-stop("+O[Q][0]+", "+O[Q][1]+")");h.css({"background-image":"-webkit-gradient(linear, "+u.x+"% "+u.y+"%,"+b.x+"% "+b.y+"%, "+ye.join(",")+" )"})}else{var u={x:u.x/100*h.width(),y:u.y/100*h.height()},b={x:b.x/100*h.width(),y:b.y/100*h.height()},yt=b.x-u.x;Q=b.y-u.y;var Je=Math.atan2(Q,yt),pt=Je-Math.PI/2,pt=Math.abs(h.width()*Math.sin(pt))+Math.abs(h.height()*Math.cos(pt)),yt=Math.sqrt(Q*Q+yt*yt),b=n(b.x<u.x?h.width():0,b.y<u.y?h.height():0),mt=Math.tan(Je);for(Q=-1/mt,mt=(Q*b.x-b.y-mt*u.x+u.y)/(Q-mt),b=Q*mt-Q*b.x+b.y,u=Math.sqrt(Math.pow(mt-u.x,2)+Math.pow(b-u.y,2)),Q=0;Q<A;Q++)ye.push(" "+O[Q][1]+" "+100*(u+yt*O[Q][0])/pt+"%");h.css({"background-image":he+"linear-gradient("+-Je+"rad,"+ye.join(",")+")"})}}function M(h,u,b){return h=s.Event(h),u.trigger(h,b),h.isDefaultPrevented()?"prevented":h.isPropagationStopped()?"stopped":""}function k(h){function u(b){this.name="TurnJsError",this.message=b}return u.prototype=Error(),u.prototype.constructor=u,new u(h)}function Z(h){var u={top:0,left:0};do u.left+=h.offsetLeft,u.top+=h.offsetTop;while(h=h.offsetParent);return u}var le,pe,he="",Te=Math.PI,p=Te/2,ht="ontouchstart"in window,_t=ht?{down:"touchstart",move:"touchmove",up:"touchend",over:"touchstart",out:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup",over:"mouseover",out:"mouseout"},gt={backward:["bl","tl"],forward:["br","tr"],all:"tl bl tr br l r".split(" ")},Pi=["single","double"],At=["ltr","rtl"],hi={acceleration:!0,display:"double",duration:600,page:1,gradients:!0,turnCorners:"bl,br",when:null},vi={cornerSize:100},Oe={init:function(Q){le="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style;var u;pe=(u=/AppleWebkit\/([0-9\.]+)/i.exec(navigator.userAgent))?534.3<parseFloat(u[1]):!0,he=v();var b;u=0;var O=this.data(),A=this.children(),Q=s.extend({width:this.width(),height:this.height(),direction:this.attr("dir")||this.css("direction")||"ltr"},hi,Q);if(O.opts=Q,O.pageObjs={},O.pages={},O.pageWrap={},O.pageZoom={},O.pagePlace={},O.pageMv=[],O.zoom=1,O.totalPages=Q.pages||0,O.eventHandlers={touchStart:s.proxy(Oe._touchStart,this),touchMove:s.proxy(Oe._touchMove,this),touchEnd:s.proxy(Oe._touchEnd,this),start:s.proxy(Oe._eventStart,this)},Q.when)for(b in Q.when)g(b,Q.when)&&this.bind(b,Q.when[b]);for(this.css({position:"relative",width:Q.width,height:Q.height}),this.turn("display",Q.display),Q.direction!==""&&this.turn("direction",Q.direction),le&&!ht&&Q.acceleration&&this.transform(r(0,0,!0)),b=0;b<A.length;b++)s(A[b]).attr("ignore")!="1"&&this.turn("addPage",A[b],++u);return s(this).bind(_t.down,O.eventHandlers.touchStart).bind("end",Oe._eventEnd).bind("pressed",Oe._eventPressed).bind("released",Oe._eventReleased).bind("flip",Oe._flip),s(this).parent().bind("start",O.eventHandlers.start),s(document).bind(_t.move,O.eventHandlers.touchMove).bind(_t.up,O.eventHandlers.touchEnd),this.turn("page",Q.page),O.done=!0,this},addPage:function(h,u){var b,O=!1,A=this.data(),Q=A.totalPages+1;if(A.destroying)return!1;if((b=/\bp([0-9]+)\b/.exec(s(h).attr("class")))&&(u=parseInt(b[1],10)),u){if(u==Q)O=!0;else if(u>Q)throw k('Page "'+u+'" cannot be inserted')}else u=Q,O=!0;return 1<=u&&u<=Q&&(b=A.display=="double"?u%2?" odd":" even":"",A.done&&this.turn("stop"),u in A.pageObjs&&Oe._movePages.call(this,u,1),O&&(A.totalPages=Q),A.pageObjs[u]=s(h).css({float:"left"}).addClass("page p"+u+b),navigator.userAgent.indexOf("MSIE 9.0")!=-1&&A.pageObjs[u].hasClass("hard")&&A.pageObjs[u].removeClass("hard"),Oe._addPage.call(this,u),Oe._removeFromDOM.call(this)),this},_addPage:function(h){var u=this.data(),b=u.pageObjs[h];if(b)if(Oe._necessPage.call(this,h)){if(!u.pageWrap[h]){u.pageWrap[h]=s("<div/>",{class:"page-wrapper",page:h,css:{position:"absolute",overflow:"hidden"}}),this.append(u.pageWrap[h]),u.pagePlace[h]||(u.pagePlace[h]=h,u.pageObjs[h].appendTo(u.pageWrap[h]));var O=Oe._pageSize.call(this,h,!0);b.css({width:O.width,height:O.height}),u.pageWrap[h].css(O)}u.pagePlace[h]==h&&Oe._makeFlip.call(this,h)}else u.pagePlace[h]=0,u.pageObjs[h]&&u.pageObjs[h].remove()},hasPage:function(h){return g(h,this.data().pageObjs)},center:function(h){var u=this.data(),b=s(this).turn("size"),O=0;return u.noCenter||(u.display=="double"&&(h=this.turn("view",h||u.tpage||u.page),u.direction=="ltr"?h[0]?h[1]||(O+=b.width/4):O-=b.width/4:h[0]?h[1]||(O-=b.width/4):O+=b.width/4),s(this).css({marginLeft:O})),this},destroy:function(){var h=this,u=this.data(),b="end first flip last pressed released start turning turned zooming missing".split(" ");if(M("destroying",this)!="prevented"){for(u.destroying=!0,s.each(b,function(O,A){h.unbind(A)}),this.parent().unbind("start",u.eventHandlers.start),s(document).unbind(_t.move,u.eventHandlers.touchMove).unbind(_t.up,u.eventHandlers.touchEnd);u.totalPages!==0;)this.turn("removePage",u.totalPages);return u.fparent&&u.fparent.remove(),u.shadow&&u.shadow.remove(),this.removeData(),u=null,this}},is:function(){return typeof this.data().pages=="object"},zoom:function(h){var u=this.data();if(typeof h=="number"){if(.001>h||100<h)throw k(h+" is not a value for zoom");if(M("zooming",this,[h,u.zoom])=="prevented")return this;var Q=this.turn("size"),b=this.turn("view"),O=1/u.zoom,A=Math.round(Q.width*O*h),Q=Math.round(Q.height*O*h);for(u.zoom=h,s(this).turn("stop").turn("size",A,Q),u.opts.autoCenter&&this.turn("center"),Oe._updateShadow.call(this),h=0;h<b.length;h++)b[h]&&u.pageZoom[b[h]]!=u.zoom&&(this.trigger("zoomed",[b[h],b,u.pageZoom[b[h]],u.zoom]),u.pageZoom[b[h]]=u.zoom);return this}return u.zoom},_pageSize:function(h,u){var b=this.data(),O={};if(b.display=="single")O.width=this.width(),O.height=this.height(),u&&(O.top=0,O.left=0,O.right="auto");else{var A=this.width()/2,Q=this.height();if(b.pageObjs[h].hasClass("own-size")?(O.width=b.pageObjs[h].width(),O.height=b.pageObjs[h].height()):(O.width=A,O.height=Q),u){var ye=h%2;O.top=(Q-O.height)/2,b.direction=="ltr"?(O[ye?"right":"left"]=A-O.width,O[ye?"left":"right"]="auto"):(O[ye?"left":"right"]=A-O.width,O[ye?"right":"left"]="auto")}}return O},_makeFlip:function(h){var u=this.data();if(!u.pages[h]&&u.pagePlace[h]==h){var b=u.display=="single",O=h%2;u.pages[h]=u.pageObjs[h].css(Oe._pageSize.call(this,h)).flip({page:h,next:O||b?h+1:h-1,turn:this}).flip("disable",u.disabled),Oe._setPageLoc.call(this,h),u.pageZoom[h]=u.zoom}return u.pages[h]},_makeRange:function(){var h,u;if(!(1>this.data().totalPages))for(u=this.turn("range"),h=u[0];h<=u[1];h++)Oe._addPage.call(this,h)},range:function(Q){var u,b,O,A=this.data(),Q=Q||A.tpage||A.page||1;if(O=Oe._view.call(this,Q),1>Q||Q>A.totalPages)throw k('"'+Q+'" is not a valid page');return O[1]=O[1]||O[0],1<=O[0]&&O[1]<=A.totalPages?(Q=Math.floor(2),A.totalPages-O[1]>O[0]?(u=Math.min(O[0]-1,Q),b=2*Q-u):(b=Math.min(A.totalPages-O[1],Q),u=2*Q-b)):b=u=5,[Math.max(1,O[0]-u),Math.min(A.totalPages,O[1]+b)]},_necessPage:function(h){if(h===0)return!0;var u=this.turn("range");return this.data().pageObjs[h].hasClass("fixed")||h>=u[0]&&h<=u[1]},_removeFromDOM:function(){var h,u=this.data();for(h in u.pageWrap)g(h,u.pageWrap)&&!Oe._necessPage.call(this,h)&&Oe._removePageFromDOM.call(this,h)},_removePageFromDOM:function(h){var u=this.data();if(u.pages[h]){var b=u.pages[h].data();Fe._moveFoldingPage.call(u.pages[h],!1),b.f&&b.f.fwrapper&&b.f.fwrapper.remove(),u.pages[h].removeData(),u.pages[h].remove(),delete u.pages[h]}u.pageObjs[h]&&u.pageObjs[h].remove(),u.pageWrap[h]&&(u.pageWrap[h].remove(),delete u.pageWrap[h]),Oe._removeMv.call(this,h),delete u.pagePlace[h],delete u.pageZoom[h]},removePage:function(h){var u=this.data();if(h=="*")for(;u.totalPages!==0;)this.turn("removePage",u.totalPages);else{if(1>h||h>u.totalPages)throw k("The page "+h+" doesn't exist");u.pageObjs[h]&&(this.turn("stop"),Oe._removePageFromDOM.call(this,h),delete u.pageObjs[h]),Oe._movePages.call(this,h,-1),u.totalPages-=1,u.page>u.totalPages?(u.page=null,Oe._fitPage.call(this,u.totalPages)):(Oe._makeRange.call(this),this.turn("update"))}return this},_movePages:function(h,u){var b,O=this,A=this.data(),Q=A.display=="single",ye=function(Je){var pt=Je+u,yt=pt%2,mt=yt?" odd ":" even ";A.pageObjs[Je]&&(A.pageObjs[pt]=A.pageObjs[Je].removeClass("p"+Je+" odd even").addClass("p"+pt+mt)),A.pagePlace[Je]&&A.pageWrap[Je]&&(A.pagePlace[pt]=pt,A.pageWrap[pt]=A.pageObjs[pt].hasClass("fixed")?A.pageWrap[Je].attr("page",pt):A.pageWrap[Je].css(Oe._pageSize.call(O,pt,!0)).attr("page",pt),A.pages[Je]&&(A.pages[pt]=A.pages[Je].flip("options",{page:pt,next:Q||yt?pt+1:pt-1})),u&&(delete A.pages[Je],delete A.pagePlace[Je],delete A.pageZoom[Je],delete A.pageObjs[Je],delete A.pageWrap[Je]))};if(0<u)for(b=A.totalPages;b>=h;b--)ye(b);else for(b=h;b<=A.totalPages;b++)ye(b)},display:function(h){var u=this.data(),b=u.display;if(h===void 0)return b;if(s.inArray(h,Pi)==-1)throw k('"'+h+'" is not a value for display');switch(h){case"single":u.pageObjs[0]||(this.turn("stop").css({overflow:"hidden"}),u.pageObjs[0]=s("<div />",{class:"page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)),this.addClass("shadow");break;case"double":u.pageObjs[0]&&(this.turn("stop").css({overflow:""}),u.pageObjs[0].remove(),delete u.pageObjs[0]),this.removeClass("shadow")}return u.display=h,b&&(h=this.turn("size"),Oe._movePages.call(this,1,0),this.turn("size",h.width,h.height).turn("update")),this},direction:function(h){var u=this.data();if(h===void 0)return u.direction;if(h=h.toLowerCase(),s.inArray(h,At)==-1)throw k('"'+h+'" is not a value for direction');return h=="rtl"&&s(this).attr("dir","ltr").css({direction:"ltr"}),u.direction=h,u.done&&this.turn("size",s(this).width(),s(this).height()),this},animating:function(){return 0<this.data().pageMv.length},corner:function(){var h,u,b=this.data();for(u in b.pages)if(g(u,b.pages)&&(h=b.pages[u].flip("corner")))return h;return!1},data:function(){return this.data()},disable:function(h){var u,b=this.data(),O=this.turn("view");b.disabled=h===void 0||h===!0;for(u in b.pages)g(u,b.pages)&&b.pages[u].flip("disable",b.disabled?!0:s.inArray(parseInt(u,10),O)==-1);return this},disabled:function(h){return h===void 0?this.data().disabled===!0:this.turn("disable",h)},size:function(h,u){if(h===void 0||u===void 0)return{width:this.width(),height:this.height()};this.turn("stop");var b,O,A=this.data();O=A.display=="double"?h/2:h,this.css({width:h,height:u}),A.pageObjs[0]&&A.pageObjs[0].css({width:O,height:u});for(b in A.pageWrap)g(b,A.pageWrap)&&(O=Oe._pageSize.call(this,b,!0),A.pageObjs[b].css({width:O.width,height:O.height}),A.pageWrap[b].css(O),A.pages[b]&&A.pages[b].css({width:O.width,height:O.height}));return this.turn("resize"),this},resize:function(){var h,u=this.data();for(u.pages[0]&&(u.pageWrap[0].css({left:-this.width()}),u.pages[0].flip("resize",!0)),h=1;h<=u.totalPages;h++)u.pages[h]&&u.pages[h].flip("resize",!0);Oe._updateShadow.call(this),u.opts.autoCenter&&this.turn("center")},_removeMv:function(h){var u,b=this.data();for(u=0;u<b.pageMv.length;u++)if(b.pageMv[u]==h)return b.pageMv.splice(u,1),!0;return!1},_addMv:function(h){var u=this.data();Oe._removeMv.call(this,h),u.pageMv.push(h)},_view:function(b){var u=this.data(),b=b||u.page;return u.display=="double"?b%2?[b-1,b]:[b,b+1]:[b]},view:function(b){var u=this.data(),b=Oe._view.call(this,b);return u.display=="double"?[0<b[0]?b[0]:0,b[1]<=u.totalPages?b[1]:0]:[0<b[0]&&b[0]<=u.totalPages?b[0]:0]},stop:function(h,u){if(this.turn("animating")){var b,O,A,Q=this.data();for(Q.tpage&&(Q.page=Q.tpage,delete Q.tpage),b=0;b<Q.pageMv.length;b++)Q.pageMv[b]&&Q.pageMv[b]!==h&&(A=Q.pages[Q.pageMv[b]],O=A.data().f.opts,A.flip("hideFoldedPage",u),u||Fe._moveFoldingPage.call(A,!1),O.force&&(O.next=O.page%2===0?O.page-1:O.page+1,delete O.force))}return this.turn("update"),this},pages:function(h){var u=this.data();if(h){if(h<u.totalPages)for(var b=u.totalPages;b>h;b--)this.turn("removePage",b);return u.totalPages=h,Oe._fitPage.call(this,u.page),this}return u.totalPages},_missing:function(h){var u=this.data();if(!(1>u.totalPages)){for(var b=this.turn("range",h),O=[],h=b[0];h<=b[1];h++)u.pageObjs[h]||O.push(h);0<O.length&&this.trigger("missing",[O])}},_fitPage:function(h){var u=this.data(),b=this.turn("view",h);if(Oe._missing.call(this,h),u.pageObjs[h]){u.page=h,this.turn("stop");for(var O=0;O<b.length;O++)b[O]&&u.pageZoom[b[O]]!=u.zoom&&(this.trigger("zoomed",[b[O],b,u.pageZoom[b[O]],u.zoom]),u.pageZoom[b[O]]=u.zoom);Oe._removeFromDOM.call(this),Oe._makeRange.call(this),Oe._updateShadow.call(this),this.trigger("turned",[h,b]),this.turn("update"),u.opts.autoCenter&&this.turn("center")}},_turnPage:function(h){var u,b,O=this.data(),A=O.pagePlace[h],Q=this.turn("view"),ye=this.turn("view",h);if(O.page!=h){var Je=O.page;if(M("turning",this,[h,ye])=="prevented"){Je==O.page&&s.inArray(A,O.pageMv)!=-1&&O.pages[A].flip("hideFoldedPage",!0);return}s.inArray(1,ye)!=-1&&this.trigger("first"),s.inArray(O.totalPages,ye)!=-1&&this.trigger("last")}O.display=="single"?(u=Q[0],b=ye[0]):Q[1]&&h>Q[1]?(u=Q[1],b=ye[0]):Q[0]&&h<Q[0]&&(u=Q[0],b=ye[1]),A=O.opts.turnCorners.split(","),Q=O.pages[u].data().f,ye=Q.opts,Je=Q.point,Oe._missing.call(this,h),O.pageObjs[h]&&(this.turn("stop"),O.page=h,Oe._makeRange.call(this),O.tpage=b,ye.next!=b&&(ye.next=b,ye.force=!0),this.turn("update"),Q.point=Je,Q.effect=="hard"?O.direction=="ltr"?O.pages[u].flip("turnPage",h>u?"r":"l"):O.pages[u].flip("turnPage",h>u?"l":"r"):O.direction=="ltr"?O.pages[u].flip("turnPage",A[h>u?1:0]):O.pages[u].flip("turnPage",A[h>u?0:1]))},page:function(h){var u=this.data();if(h===void 0)return u.page;if(!u.disabled&&!u.destroying){if(h=parseInt(h,10),0<h&&h<=u.totalPages)return h!=u.page&&(!u.done||s.inArray(h,this.turn("view"))!=-1?Oe._fitPage.call(this,h):Oe._turnPage.call(this,h)),this;throw k("The page "+h+" does not exist")}},next:function(){return this.turn("page",Math.min(this.data().totalPages,Oe._view.call(this,this.data().page).pop()+1))},previous:function(){return this.turn("page",Math.max(1,Oe._view.call(this,this.data().page).shift()-1))},peel:function(h,A){var b=this.data(),O=this.turn("view"),A=A===void 0?!0:A===!0;return h===!1?this.turn("stop",null,A):b.display=="single"?b.pages[b.page].flip("peel",h,A):(O=b.direction=="ltr"?h.indexOf("l")!=-1?O[0]:O[1]:h.indexOf("l")!=-1?O[1]:O[0],b.pages[O]&&b.pages[O].flip("peel",h,A)),this},_addMotionPage:function(){var h=s(this).data().f.opts,u=h.turn;u.data(),Oe._addMv.call(u,h.page)},_eventStart:function(h,u,b){var O=u.turn.data(),A=O.pageZoom[u.page];h.isDefaultPrevented()||(A&&A!=O.zoom&&(u.turn.trigger("zoomed",[u.page,u.turn.turn("view",u.page),A,O.zoom]),O.pageZoom[u.page]=O.zoom),O.display=="single"&&b&&(b.charAt(1)=="l"&&O.direction=="ltr"||b.charAt(1)=="r"&&O.direction=="rtl"?(u.next=u.next<u.page?u.next:u.page-1,u.force=!0):u.next=u.next>u.page?u.next:u.page+1),Oe._addMotionPage.call(h.target)),Oe._updateShadow.call(u.turn)},_eventEnd:function(O,u,b){s(O.target).data();var O=u.turn,A=O.data();b?(b=A.tpage||A.page,(b==u.next||b==u.page)&&(delete A.tpage,Oe._fitPage.call(O,b||u.next,!0))):(Oe._removeMv.call(O,u.page),Oe._updateShadow.call(O),O.turn("update"))},_eventPressed:function(u){var u=s(u.target).data().f,b=u.opts.turn;return b.data().mouseAction=!0,b.turn("update"),u.time=new Date().getTime()},_eventReleased:function(h,u){var b;b=s(h.target);var O=b.data().f,A=O.opts.turn,Q=A.data();b=Q.display=="single"?u.corner=="br"||u.corner=="tr"?u.x<b.width()/2:u.x>b.width()/2:0>u.x||u.x>b.width(),(200>new Date().getTime()-O.time||b)&&(h.preventDefault(),Oe._turnPage.call(A,O.opts.next)),Q.mouseAction=!1},_flip:function(h){h.stopPropagation(),h=s(h.target).data().f.opts,h.turn.trigger("turn",[h.next]),h.turn.data().opts.autoCenter&&h.turn.turn("center",h.next)},_touchStart:function(){var h=this.data(),u;for(u in h.pages)if(g(u,h.pages)&&Fe._eventStart.apply(h.pages[u],arguments)===!1)return!1},_touchMove:function(){var h=this.data(),u;for(u in h.pages)g(u,h.pages)&&Fe._eventMove.apply(h.pages[u],arguments)},_touchEnd:function(){var h=this.data(),u;for(u in h.pages)g(u,h.pages)&&Fe._eventEnd.apply(h.pages[u],arguments)},calculateZ:function(h){var u,b,O,A,Q=this,ye=this.data();u=this.turn("view");var Je=u[0]||u[1],pt=h.length-1,yt={pageZ:{},partZ:{},pageV:{}},mt=function(_i){_i=Q.turn("view",_i),_i[0]&&(yt.pageV[_i[0]]=!0),_i[1]&&(yt.pageV[_i[1]]=!0)};for(u=0;u<=pt;u++)b=h[u],O=ye.pages[b].data().f.opts.next,A=ye.pagePlace[b],mt(b),mt(O),b=ye.pagePlace[O]==O?O:b,yt.pageZ[b]=ye.totalPages-Math.abs(Je-b),yt.partZ[A]=2*ye.totalPages-pt+u;return yt},update:function(){var h,u=this.data();if(this.turn("animating")&&u.pageMv[0]!==0){var b,O=this.turn("calculateZ",u.pageMv),A=this.turn("corner"),Q=this.turn("view"),ye=this.turn("view",u.tpage);for(h in u.pageWrap)g(h,u.pageWrap)&&(b=u.pageObjs[h].hasClass("fixed"),u.pageWrap[h].css({display:O.pageV[h]||b?"":"none",zIndex:(u.pageObjs[h].hasClass("hard")?O.partZ[h]:O.pageZ[h])||(b?-1:0)}),b=u.pages[h])&&(b.flip("z",O.partZ[h]||null),O.pageV[h]&&b.flip("resize"),u.tpage?b.flip("hover",!1).flip("disable",s.inArray(parseInt(h,10),u.pageMv)==-1&&h!=ye[0]&&h!=ye[1]):b.flip("hover",A===!1).flip("disable",h!=Q[0]&&h!=Q[1]))}else for(h in u.pageWrap)g(h,u.pageWrap)&&(O=Oe._setPageLoc.call(this,h),u.pages[h]&&u.pages[h].flip("disable",u.disabled||O!=1).flip("hover",!0).flip("z",null));return this},_updateShadow:function(){var h,u,b=this.data(),O=this.width(),A=this.height(),Q=b.display=="single"?O:O/2;h=this.turn("view"),b.shadow||(b.shadow=s("<div />",{class:"shadow",css:i(0,0,0).css}).appendTo(this));for(var ye=0;ye<b.pageMv.length&&h[0]&&h[1];ye++)h=this.turn("view",b.pages[b.pageMv[ye]].data().f.opts.next),u=this.turn("view",b.pageMv[ye]),h[0]=h[0]&&u[0],h[1]=h[1]&&u[1];switch(h[0]?h[1]?3:b.direction=="ltr"?2:1:b.direction=="ltr"?1:2){case 1:b.shadow.css({width:Q,height:A,top:0,left:Q});break;case 2:b.shadow.css({width:Q,height:A,top:0,left:0});break;case 3:b.shadow.css({width:O,height:A,top:0,left:0})}},_setPageLoc:function(h){var u=this.data(),b=this.turn("view"),O=0;if(h==b[0]||h==b[1]?O=1:(u.display=="single"&&h==b[0]+1||u.display=="double"&&h==b[0]-2||h==b[1]+2)&&(O=2),!this.turn("animating"))switch(O){case 1:u.pageWrap[h].css({zIndex:u.totalPages,display:""});break;case 2:u.pageWrap[h].css({zIndex:u.totalPages-1,display:""});break;case 0:u.pageWrap[h].css({zIndex:0,display:u.pageObjs[h].hasClass("fixed")?"":"none"})}return O},options:function(h){if(h===void 0)return this.data().opts;var u=this.data();if(s.extend(u.opts,h),h.pages&&this.turn("pages",h.pages),h.page&&this.turn("page",h.page),h.display&&this.turn("display",h.display),h.direction&&this.turn("direction",h.direction),h.width&&h.height&&this.turn("size",h.width,h.height),h.when)for(var b in h.when)g(b,h.when)&&this.unbind(b).bind(b,h.when[b]);return this},version:function(){return"4.1.0"}},Fe={init:function(h){return this.data({f:{disabled:!1,hover:!1,effect:this.hasClass("hard")?"hard":"sheet"}}),this.flip("options",h),Fe._addPageWrapper.call(this),this},setData:function(h){var u=this.data();return u.f=s.extend(u.f,h),this},options:function(h){var u=this.data().f;return h?(Fe.setData.call(this,{opts:s.extend({},u.opts||vi,h)}),this):u.opts},z:function(h){var u=this.data().f;return u.opts["z-index"]=h,u.fwrapper&&u.fwrapper.css({zIndex:h||parseInt(u.parent.css("z-index"),10)||0}),this},_cAllowed:function(){var h=this.data().f,u=h.opts.page,b=h.opts.turn.data(),O=u%2;return h.effect=="hard"?b.direction=="ltr"?[O?"r":"l"]:[O?"l":"r"]:b.display=="single"?u==1?b.direction=="ltr"?gt.forward:gt.backward:u==b.totalPages?b.direction=="ltr"?gt.backward:gt.forward:gt.all:b.direction=="ltr"?gt[O?"forward":"backward"]:gt[O?"backward":"forward"]},_cornerActivated:function(A){var u=this.data().f,b=this.width(),O=this.height(),A={x:A.x,y:A.y,corner:""},Q=u.opts.cornerSize;if(0>=A.x||0>=A.y||A.x>=b||A.y>=O)return!1;var ye=Fe._cAllowed.call(this);switch(u.effect){case"hard":if(A.x>b-Q)A.corner="r";else if(A.x<Q)A.corner="l";else return!1;break;case"sheet":if(A.y<Q)A.corner+="t";else if(A.y>=O-Q)A.corner+="b";else return!1;if(A.x<=Q)A.corner+="l";else if(A.x>=b-Q)A.corner+="r";else return!1}return!A.corner||s.inArray(A.corner,ye)==-1?!1:A},_isIArea:function(b){var u=this.data().f.parent.offset(),b=ht&&b.originalEvent?b.originalEvent.touches[0]:b;return Fe._cornerActivated.call(this,{x:b.pageX-u.left,y:b.pageY-u.top})},_c:function(h,u){switch(u=u||0,h){case"tl":return n(u,u);case"tr":return n(this.width()-u,u);case"bl":return n(u,this.height()-u);case"br":return n(this.width()-u,this.height()-u);case"l":return n(u,0);case"r":return n(this.width()-u,0)}},_c2:function(h){switch(h){case"tl":return n(2*this.width(),0);case"tr":return n(-this.width(),0);case"bl":return n(2*this.width(),this.height());case"br":return n(-this.width(),this.height());case"l":return n(2*this.width(),0);case"r":return n(-this.width(),0)}},_foldingPage:function(){var h=this.data().f;if(h){var u=h.opts;if(u.turn)return h=u.turn.data(),h.display=="single"?1<u.next||1<u.page?h.pageObjs[0]:null:h.pageObjs[u.next]}},_backGradient:function(){var h=this.data().f,u=h.opts.turn.data();return(u=u.opts.gradients&&(u.display=="single"||h.opts.page!=2&&h.opts.page!=u.totalPages-1))&&!h.bshadow&&(h.bshadow=s("<div/>",i(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(h.parent)),u},type:function(){return this.data().f.effect},resize:function(h){var u=this.data().f,b=u.opts.turn.data(),O=this.width(),A=this.height();switch(u.effect){case"hard":h&&(u.wrapper.css({width:O,height:A}),u.fpage.css({width:O,height:A}),b.opts.gradients&&(u.ashadow.css({width:O,height:A}),u.bshadow.css({width:O,height:A})));break;case"sheet":h&&(h=Math.round(Math.sqrt(Math.pow(O,2)+Math.pow(A,2))),u.wrapper.css({width:h,height:h}),u.fwrapper.css({width:h,height:h}).children(":first-child").css({width:O,height:A}),u.fpage.css({width:O,height:A}),b.opts.gradients&&u.ashadow.css({width:O,height:A}),Fe._backGradient.call(this)&&u.bshadow.css({width:O,height:A})),u.parent.is(":visible")&&(b=Z(u.parent[0]),u.fwrapper.css({top:b.top,left:b.left}),b=Z(u.opts.turn[0]),u.fparent.css({top:-b.top,left:-b.left})),this.flip("z",u.opts["z-index"])}},_addPageWrapper:function(){var h=this.data().f,u=h.opts.turn.data(),b=this.parent();if(h.parent=b,!h.wrapper)switch(h.effect){case"hard":var O={};O[he+"transform-style"]="preserve-3d",O[he+"backface-visibility"]="hidden",h.wrapper=s("<div/>",i(0,0,2)).css(O).appendTo(b).prepend(this),h.fpage=s("<div/>",i(0,0,1)).css(O).appendTo(b),u.opts.gradients&&(h.ashadow=s("<div/>",i(0,0,0)).hide().appendTo(b),h.bshadow=s("<div/>",i(0,0,0)));break;case"sheet":var O=this.width(),A=this.height();Math.round(Math.sqrt(Math.pow(O,2)+Math.pow(A,2))),h.fparent=h.opts.turn.data().fparent,h.fparent||(O=s("<div/>",{css:{"pointer-events":"none"}}).hide(),O.data().flips=0,O.css(i(0,0,"auto","visible").css).appendTo(h.opts.turn),h.opts.turn.data().fparent=O,h.fparent=O),this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"}),h.wrapper=s("<div/>",i(0,0,this.css("z-index"))).appendTo(b).prepend(this),h.fwrapper=s("<div/>",i(b.offset().top,b.offset().left)).hide().appendTo(h.fparent),h.fpage=s("<div/>",i(0,0,0,"visible")).css({cursor:"default"}).appendTo(h.fwrapper),u.opts.gradients&&(h.ashadow=s("<div/>",i(0,0,1)).appendTo(h.fpage)),Fe.setData.call(this,h)}Fe.resize.call(this,!0)},_fold:function(h){var u=this.data().f,b=u.opts.turn.data(),O=Fe._c.call(this,h.corner),A=this.width(),Q=this.height();switch(u.effect){case"hard":h.x=h.corner=="l"?Math.min(Math.max(h.x,0),2*A):Math.max(Math.min(h.x,A),-A);var ye,Je,pt,yt,mt,_i=b.totalPages,pn=u.opts["z-index"]||_i,co={overflow:"visible"},lo=O.x?(O.x-h.x)/A:h.x/A,ir=90*lo,Ao=90>ir;switch(h.corner){case"l":yt="0% 50%",mt="100% 50%",Ao?(ye=0,Je=0<u.opts.next-1,pt=1):(ye="100%",Je=u.opts.page+1<_i,pt=0);break;case"r":yt="100% 50%",mt="0% 50%",ir=-ir,A=-A,Ao?(ye=0,Je=u.opts.next+1<_i,pt=0):(ye="-100%",Je=u.opts.page!=1,pt=1)}co[he+"perspective-origin"]=mt,u.wrapper.transform("rotateY("+ir+"deg)translate3d(0px, 0px, "+(this.attr("depth")||0)+"px)",mt),u.fpage.transform("translateX("+A+"px) rotateY("+(180+ir)+"deg)",yt),u.parent.css(co),Ao?(lo=-lo+1,u.wrapper.css({zIndex:pn+1}),u.fpage.css({zIndex:pn})):(lo-=1,u.wrapper.css({zIndex:pn}),u.fpage.css({zIndex:pn+1})),b.opts.gradients&&(Je?u.ashadow.css({display:"",left:ye,backgroundColor:"rgba(0,0,0,"+.5*lo+")"}).transform("rotateY(0deg)"):u.ashadow.hide(),u.bshadow.css({opacity:-lo+1}),Ao?u.bshadow.parent()[0]!=u.wrapper[0]&&u.bshadow.appendTo(u.wrapper):u.bshadow.parent()[0]!=u.fpage[0]&&u.bshadow.appendTo(u.fpage),y(u.bshadow,n(100*pt,0),n(100*(-pt+1),0),[[0,"rgba(0,0,0,0.3)"],[1,"rgba(0,0,0,0)"]],2));break;case"sheet":var po=this,Gi=0,Do,dn,Xe,Si,jn,Tr,Ls,vn=n(0,0),Or=n(0,0),qt=n(0,0),ho=Fe._foldingPage.call(this);Math.tan(0);var uo=b.opts.acceleration,wr=u.wrapper.height(),go=h.corner.substr(0,1)=="t",Wn=h.corner.substr(1,1)=="l",nr=function(){var nt=n(0,0),Ni=n(0,0);nt.x=O.x?O.x-h.x:h.x,nt.y=pe?O.y?O.y-h.y:h.y:0,Ni.x=Wn?A-nt.x/2:h.x+nt.x/2,Ni.y=nt.y/2;var Dt=p-Math.atan2(nt.y,nt.x),bi=Dt-Math.atan2(Ni.y,Ni.x),bi=Math.max(0,Math.sin(bi)*Math.sqrt(Math.pow(Ni.x,2)+Math.pow(Ni.y,2)));return Gi=180*(Dt/Te),qt=n(bi*Math.sin(Dt),bi*Math.cos(Dt)),Dt>p&&(qt.x+=Math.abs(qt.y*nt.y/nt.x),qt.y=0,Math.round(qt.x*Math.tan(Te-Dt))<Q)?(h.y=Math.sqrt(Math.pow(Q,2)+2*Ni.x*nt.x),go&&(h.y=Q-h.y),nr()):(Dt>p&&(nt=Te-Dt,Ni=wr-Q/Math.sin(nt),vn=n(Math.round(Ni*Math.cos(nt)),Math.round(Ni*Math.sin(nt))),Wn&&(vn.x=-vn.x),go&&(vn.y=-vn.y)),Do=Math.round(qt.y/Math.tan(Dt)+qt.x),nt=A-Do,Ni=nt*Math.cos(2*Dt),bi=nt*Math.sin(2*Dt),Or=n(Math.round(Wn?nt-Ni:Do+Ni),Math.round(go?bi:Q-bi)),b.opts.gradients&&(jn=nt*Math.sin(Dt),nt=Fe._c2.call(po,h.corner),nt=Math.sqrt(Math.pow(nt.x-h.x,2)+Math.pow(nt.y-h.y,2))/A,Ls=Math.sin(p*(1<nt?2-nt:nt)),Tr=Math.min(nt,1),Si=100<jn?(jn-100)/jn:0,dn=n(100*(jn*Math.sin(Dt)/A),100*(jn*Math.cos(Dt)/Q)),Fe._backGradient.call(po)&&(Xe=n(100*(1.2*jn*Math.sin(Dt)/A),100*(1.2*jn*Math.cos(Dt)/Q)),Wn||(Xe.x=100-Xe.x),go||(Xe.y=100-Xe.y))),qt.x=Math.round(qt.x),qt.y=Math.round(qt.y),!0)};switch(ye=function(nt,Mn,Dt,bi){var fo=["0","auto"],Yi=(A-wr)*Dt[0]/100,ki=(Q-wr)*Dt[1]/100,Mn={left:fo[Mn[0]],top:fo[Mn[1]],right:fo[Mn[2]],bottom:fo[Mn[3]]},fo={},ds=bi!=90&&bi!=-90?Wn?-1:1:0,mo=Dt[0]+"% "+Dt[1]+"%";po.css(Mn).transform(c(bi)+r(nt.x+ds,nt.y,uo),mo),u.fpage.css(Mn).transform(c(bi)+r(nt.x+Or.x-vn.x-A*Dt[0]/100,nt.y+Or.y-vn.y-Q*Dt[1]/100,uo)+c((180/bi-2)*bi),mo),u.wrapper.transform(r(-nt.x+Yi-ds,-nt.y+ki,uo)+c(-bi),mo),u.fwrapper.transform(r(-nt.x+vn.x+Yi,-nt.y+vn.y+ki,uo)+c(-bi),mo),b.opts.gradients&&(Dt[0]&&(dn.x=100-dn.x),Dt[1]&&(dn.y=100-dn.y),fo["box-shadow"]="0 0 20px rgba(0,0,0,"+.5*Ls+")",ho.css(fo),y(u.ashadow,n(Wn?100:0,go?0:100),n(dn.x,dn.y),[[Si,"rgba(0,0,0,0)"],[.8*(1-Si)+Si,"rgba(0,0,0,"+.2*Tr+")"],[1,"rgba(255,255,255,"+.2*Tr+")"]],3,0),Fe._backGradient.call(po)&&y(u.bshadow,n(Wn?0:100,go?0:100),n(Xe.x,Xe.y),[[.6,"rgba(0,0,0,0)"],[.8,"rgba(0,0,0,"+.3*Tr+")"],[1,"rgba(0,0,0,0)"]],3))},h.corner){case"tl":h.x=Math.max(h.x,1),nr(),ye(qt,[1,0,0,1],[100,0],Gi);break;case"tr":h.x=Math.min(h.x,A-1),nr(),ye(n(-qt.x,qt.y),[0,0,0,1],[0,0],-Gi);break;case"bl":h.x=Math.max(h.x,1),nr(),ye(n(qt.x,-qt.y),[1,1,0,0],[100,100],-Gi);break;case"br":h.x=Math.min(h.x,A-1),nr(),ye(n(-qt.x,-qt.y),[0,1,1,0],[0,100],Gi)}}u.point=h},_moveFoldingPage:function(h){var u=this.data().f;if(u){var b=u.opts.turn,O=b.data(),A=O.pagePlace;h?(O=u.opts.next,A[O]!=u.opts.page&&(u.folding&&Fe._moveFoldingPage.call(this,!1),Fe._foldingPage.call(this).appendTo(u.fpage),A[O]=u.opts.page,u.folding=O),b.turn("update")):u.folding&&(O.pages[u.folding]?(b=O.pages[u.folding].data().f,O.pageObjs[u.folding].appendTo(b.wrapper)):O.pageWrap[u.folding]&&O.pageObjs[u.folding].appendTo(O.pageWrap[u.folding]),u.folding in A&&(A[u.folding]=u.folding),delete u.folding)}},_showFoldedPage:function(h,u){var b=Fe._foldingPage.call(this),O=this.data(),A=O.f,Q=A.visible;if(b){if((!Q||!A.point||A.point.corner!=h.corner)&&(b=A.status=="hover"||A.status=="peel"||A.opts.turn.data().mouseAction?h.corner:null,Q=!1,M("start",this,[A.opts,b])=="prevented"))return!1;if(u){var ye=this,O=A.point&&A.point.corner==h.corner?A.point:Fe._c.call(this,h.corner,1);this.animatef({from:[O.x,O.y],to:[h.x,h.y],duration:500,frame:function(pt){h.x=Math.round(pt[0]),h.y=Math.round(pt[1]),Fe._fold.call(ye,h)}})}else Fe._fold.call(this,h),O.effect&&!O.effect.turning&&this.animatef(!1);if(!Q)switch(A.effect){case"hard":A.visible=!0,Fe._moveFoldingPage.call(this,!0),A.fpage.show(),A.opts.shadows&&A.bshadow.show();break;case"sheet":A.visible=!0,A.fparent.show().data().flips++,Fe._moveFoldingPage.call(this,!0),A.fwrapper.show(),A.bshadow&&A.bshadow.show()}return!0}return!1},hide:function(){var h=this.data().f,u=h.opts.turn.data(),b=Fe._foldingPage.call(this);switch(h.effect){case"hard":u.opts.gradients&&(h.bshadowLoc=0,h.bshadow.remove(),h.ashadow.hide()),h.wrapper.transform(""),h.fpage.hide();break;case"sheet":--h.fparent.data().flips===0&&h.fparent.hide(),this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform(""),h.wrapper.transform(""),h.fwrapper.hide(),h.bshadow&&h.bshadow.hide(),b.transform("")}return h.visible=!1,this},hideFoldedPage:function(h){var u=this.data().f;if(u.point){var b=this,O=u.point,A=function(){u.point=null,u.status="",b.flip("hide"),b.trigger("end",[u.opts,!1])};if(h){var Q=Fe._c.call(this,O.corner),h=O.corner.substr(0,1)=="t"?Math.min(0,O.y-Q.y)/2:Math.max(0,O.y-Q.y)/2,ye=n(O.x,O.y+h),Je=n(Q.x,Q.y-h);this.animatef({from:0,to:1,frame:function(yt){yt=e(O,ye,Je,Q,yt),O.x=yt.x,O.y=yt.y,Fe._fold.call(b,O)},complete:A,duration:800,hiding:!0})}else this.animatef(!1),A()}},turnPage:function(A){var u=this,b=this.data().f,O=b.opts.turn.data(),A={corner:b.corner?b.corner.corner:A||Fe._cAllowed.call(this)[0]},Q=b.point||Fe._c.call(this,A.corner,b.opts.turn?O.opts.elevation:0),ye=Fe._c2.call(this,A.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(Je){Je=e(Q,Q,ye,ye,Je),A.x=Je.x,A.y=Je.y,Fe._showFoldedPage.call(u,A)},complete:function(){u.trigger("end",[b.opts,!0])},duration:O.opts.duration,turning:!0}),b.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},corner:function(){return this.data().f.corner},_eventStart:function(h){var u=this.data().f,b=u.opts.turn;if(!u.corner&&!u.disabled&&!this.flip("isTurning")&&u.opts.page==b.data().pagePlace[u.opts.page]){if(u.corner=Fe._isIArea.call(this,h),u.corner&&Fe._foldingPage.call(this))return this.trigger("pressed",[u.point]),Fe._showFoldedPage.call(this,u.corner),!1;u.corner=null}},_eventMove:function(h){var u=this.data().f;if(!u.disabled)if(h=ht?h.originalEvent.touches:[h],u.corner){var b=u.parent.offset();u.corner.x=h[0].pageX-b.left,u.corner.y=h[0].pageY-b.top,Fe._showFoldedPage.call(this,u.corner)}else u.hover&&!this.data().effect&&this.is(":visible")&&((h=Fe._isIArea.call(this,h[0]))?(u.effect=="sheet"&&h.corner.length==2||u.effect=="hard")&&(u.status="hover",u=Fe._c.call(this,h.corner,u.opts.cornerSize/2),h.x=u.x,h.y=u.y,Fe._showFoldedPage.call(this,h,!0)):u.status=="hover"&&(u.status="",Fe.hideFoldedPage.call(this,!0)))},_eventEnd:function(){var h=this.data().f,u=h.corner;!h.disabled&&u&&M("released",this,[h.point||u])!="prevented"&&Fe.hideFoldedPage.call(this,!0),h.corner=null},disable:function(h){return Fe.setData.call(this,{disabled:h}),this},hover:function(h){return Fe.setData.call(this,{hover:h}),this},peel:function(h,u){var b=this.data().f;if(h){if(s.inArray(h,gt.all)==-1)throw k("Corner "+h+" is not permitted");if(s.inArray(h,Fe._cAllowed.call(this))!=-1){var O=Fe._c.call(this,h,b.opts.cornerSize/2);b.status="peel",Fe._showFoldedPage.call(this,{corner:h,x:O.x,y:O.y},u)}}else b.status="",Fe.hideFoldedPage.call(this,u);return this}};window.requestAnim=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(h){window.setTimeout(h,1e3/60)},s.extend(s.fn,{flip:function(){return t(s(this[0]),Fe,arguments)},turn:function(){return t(s(this[0]),Oe,arguments)},transform:function(h,u){var b={};return u&&(b[he+"transform-origin"]=u),b[he+"transform"]=h,this.css(b)},animatef:function(h){var u=this.data();if(u.effect&&u.effect.stop(),h){h.to.length||(h.to=[h.to]),h.from.length||(h.from=[h.from]);for(var b=[],O=h.to.length,A=!0,Q=this,ye=new Date().getTime(),Je=function(){if(u.effect&&A){for(var yt=[],mt=Math.min(h.duration,new Date().getTime()-ye),_i=0;_i<O;_i++)yt.push(u.effect.easing(1,mt,h.from[_i],b[_i],h.duration));h.frame(O==1?yt[0]:yt),mt==h.duration?(delete u.effect,Q.data(u),h.complete&&h.complete()):window.requestAnim(Je)}},pt=0;pt<O;pt++)b.push(h.to[pt]-h.from[pt]);u.effect=s.extend({stop:function(){A=!1},easing:function(yt,mt,_i,pn,co){return pn*Math.sqrt(1-(mt=mt/co-1)*mt)+_i}},h),this.data(u),Je()}else delete u.effect}}),s.isTouch=ht,s.mouseEvents=_t,s.cssPrefix=v,s.cssTransitionEnd=function(){var h,u=document.createElement("fakeelement"),b={transition:"transitionend",OTransition:"oTransitionEnd",MSTransition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(h in b)if(u.style[h]!==void 0)return b[h]},s.findPos=Z})(jQuery)});var ya=(()=>{let t=class t{store$;documentService;loggingService;leftSideViewModeMap={THUMBNAIL:De.Thumbnail,BOOKMARK:De.Outline,ANNOTATION:De.Annotation,REDACTION:De.Redaction,REDACTION_SEARCHING:De.SearchingRedaction,ATTACHMENT:De.EmbeddedFile,FORM:De.Form,SIGNATURE:De.Signature};rightSideViewModeMap={DAP:Rt.DAP,TEXT_SEARCH:Rt.TextSearch,ANNOTATION_PROPERTY:Rt.AnnotProperty};sideViewVisible;sideViewMode;rightSideViewVisible;rightSideViewMode;constructor(e,n,r){this.store$=e,this.documentService=n,this.loggingService=r,this.store$.pipe($("sideViewVisible")).subscribe({next:c=>this.sideViewVisible=c}),this.store$.pipe($("sideViewMode")).subscribe({next:c=>this.sideViewMode=c}),this.store$.pipe($("rightSideViewVisible")).subscribe({next:c=>this.rightSideViewVisible=c}),this.store$.pipe($("rightSideViewMode")).subscribe({next:c=>this.rightSideViewMode=c})}getExportableFunctions(){return[{name:"openPanel",function:e=>{let n;if(e.type in this.leftSideViewModeMap)n=this.openSideView(this.leftSideViewModeMap[e.type]);else if(e.type in this.rightSideViewModeMap)n=this.openRightSideView(this.rightSideViewModeMap[e.type]);else throw this.loggingService.common("warn",Le.INVALID,"args.type"),new St("Cannot find suitable sideview");if(n)throw n;return dt(void 0)}},{name:"closePanel",function:e=>(e.type==="LEFT"?this.closeSideView():e.type==="RIGHT"&&this.closeRightSideView(),dt(void 0))},{name:"togglePanel",function:e=>{let n;if(e.type in this.leftSideViewModeMap)n=this.toggleSideView(this.leftSideViewModeMap[e.type]);else if(e.type in this.rightSideViewModeMap)n=this.toggleRightSideView(this.rightSideViewModeMap[e.type]);else throw this.loggingService.common("warn",Le.INVALID,"sideview args.type"),new St("Cannot find suitable sideview");if(n)throw n;return dt(void 0)}}]}getExportableEvents(){return[{type:"sideViewOpen",subject:ut(this.store$.pipe($("sideViewVisible"),F(e=>e),Ue(()=>({type:"LEFT"}))),this.store$.pipe($("rightSideViewVisible"),F(e=>e),Ue(()=>({type:"RIGHT"}))))},{type:"sideViewClose",subject:ut(this.store$.pipe($("sideViewVisible"),F(e=>!e),Ue(()=>({type:"LEFT"}))),this.store$.pipe($("rightSideViewVisible"),F(e=>!e),Ue(()=>({type:"RIGHT"}))))}]}toggleSideView(e){return this.sideViewVisible&&this.sideViewMode===e?this.closeSideView():this.openSideView(e)}openSideView(e){let n={[De.Thumbnail]:!0,[De.EmbeddedFile]:this.documentService.checkAuthority(Ne.DOWNLOAD_EMBEDDED_FILE)||this.documentService.checkAuthority(Ne.UPLOAD_EMBEDDED_FILE)||this.documentService.checkAuthority(Ne.REMOVE_EMBEDDED_FILE),[De.Outline]:!0,[De.Redaction]:this.documentService.checkAuthority(Ne.ANNOTATION),[De.SearchingRedaction]:this.documentService.checkAuthority(Ne.ANNOTATION),[De.Annotation]:this.documentService.checkAuthority(Ne.ANNOTATION),[De.Form]:this.documentService.checkAuthority(Ne.FORM),[De.Signature]:this.documentService.checkAuthority(Ne.FORM)},r={[De.Thumbnail]:!0,[De.EmbeddedFile]:!1,[De.Outline]:!1,[De.Redaction]:!1,[De.SearchingRedaction]:!1,[De.Annotation]:!1,[De.Form]:!1,[De.Signature]:!1};return n[e]?this.documentService.isDAP&&!r[e]?new St("Error detail: Not supported in DAP"):(this.store$.dispatch(ue.set({key:"sideViewMode",value:e})),this.store$.dispatch(ue.set({key:"sideViewVisible",value:!0})),null):new St("Error detail: Unauthorized")}closeSideView(){return this.store$.dispatch(ue.set({key:"sideViewVisible",value:!1})),null}toggleRightSideView(e){return this.rightSideViewVisible&&this.rightSideViewMode===e?this.closeRightSideView():this.openRightSideView(e)}openRightSideView(e){let n={[Rt.DAP]:!0,[Rt.TextSearch]:this.documentService.checkAuthority(Ne.SEARCH_TEXT),[Rt.AnnotProperty]:this.documentService.checkAuthority(Ne.EDIT_ANNOTATION)},r={[Rt.DAP]:!0,[Rt.TextSearch]:!0,[Rt.AnnotProperty]:!0};return n[e]?this.documentService.isDAP&&!r[e]?new St("Error detail: Not supported in DAP"):!this.documentService.isDAP&&e===Rt.DAP?new St("Error detail: Not supported in PDF"):(this.store$.dispatch(ue.set({key:"rightSideViewMode",value:e})),this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!0})),null):new St("Error detail: Unauthorized")}closeRightSideView(){return this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1})),null}};D(t,"\u0275fac",function(n){return new(n||t)(ke(Ee),ke(ct),ke(Ai))}),D(t,"\u0275prov",oi({token:t,factory:t.\u0275fac}));let s=t;return s})();var Zo=(()=>{let t=class t{pageService;documentService;loggingService;store$;textSearchService;highlightInfoMapChange$;get highlightInfoMap(){return this._highlightInfoMap}highlightInfoMapChangeSrc=new Oi;_highlightInfoMap={};idPageIndexMap={};viewMode;pdfPages=[];constructor(e,n,r,c,g){this.pageService=e,this.documentService=n,this.loggingService=r,this.store$=c,this.textSearchService=g,this.highlightInfoMapChange$=this.highlightInfoMapChangeSrc.asObservable(),this.store$.pipe($("viewMode")).subscribe({next:v=>this.viewMode=v}),this.pageService.pdfPages$.subscribe({next:v=>this.pdfPages=v})}getExportableFunctions(){return[{name:"highlightRects",function:e=>{if(this.viewMode===4)throw this.loggingService.error(hc,"NOT_SUPPORTED_ON_EBOOK");if(!this.documentService.checkAuthority(Ne.ANNOTATION))throw this.loggingService.error(To,"NO_AUTHORITY");let n=new Et(c=>{if(!w.isDefined(e.rects)||e.rects.length===0){c.next([]),c.complete();return}c.next(e.rects.map(g=>({id:this.appendRect(g.pageIndex,g.rect,g.color,g.opacity)}))),c.complete()}),r=w.isDefined(e.keywords)?So(e.keywords).pipe(qs(3),Qs(c=>Xs(c.map(g=>{let{color:v,keyword:y,caseSensitive:M=!0,useRegex:k=!0,opacity:Z=.5,pageRange:le}=g,pe=le&&le!=="all"?Nn.parse(le,{min:0,max:this.pdfPages.length-1}):Array.from({length:this.pdfPages.length},(he,Te)=>Te);if(!w.isDefined(pe))throw new Xt(`Failed to parse page range.
Input: "${le}", Total pages: ${this.pdfPages.length}`);return this.textSearchService.getSearchResult(this.documentService.openedDocument.streamdocsId,y,M,k,pe).pipe(Ue(he=>this.flattenSearchResults(he,v,Z)),Ue(he=>he.flatMap(Te=>({id:this.appendRect(Te.pageIndex,Te.rect,Te.color,Te.opacity)}))))}))),Ys(c=>So(c)),xl()):dt([]);return pr([n,r]).pipe(dr(c=>{let g=c instanceof Error?c.message:String(c);throw new St(`Error detail: ${g}`)}),Ue(([c,g])=>[...c,...g.flat()].sort((v,y)=>y.id-v.id)))}},{name:"unhighlightRects",function:e=>{if(this.viewMode===4)throw this.loggingService.error(hc,"NOT_SUPPORTED_ON_EBOOK");if(!this.documentService.checkAuthority(Ne.ANNOTATION))throw this.loggingService.error(To,"NO_AUTHORITY");return e.rects.forEach(n=>this.removeRect(n.id)),dt(void 0)}}]}appendRect(e,n,r,c=.5){if(e<0||this.pdfPages.length-1<e)throw new Error("pageIndex is invalid");let{r:g,bbox:v}=this.pdfPages[e],{left:y,top:M,right:k,bottom:Z}=aa.deviceRectToUser(n,g,v.w,v.h);if(y>k||Z>M)throw new Error("rect is invalid");M=Math.min(v.y+v.h,v.y+v.h-M),k=Math.min(v.x+v.w,k),Z=Math.max(v.y,v.y+v.h-Z),y=Math.max(v.x,y),this._highlightInfoMap[e]||(this._highlightInfoMap[e]=[]);let le=bp.getNewOid();return this.idPageIndexMap[le]=e,this._highlightInfoMap[e].push({id:le,path:`M ${y.toFixed(2)} ${M.toFixed(2)} L ${k.toFixed(2)} ${M.toFixed(2)} L ${k.toFixed(2)} ${Z.toFixed(2)} L ${y.toFixed(2)} ${Z.toFixed(2)} Z`,color:Ql.applyOpacityToHex(r,c)}),this.highlightInfoMapChangeSrc.next({pageIndex:e}),le}removeRect(e){let n=this.idPageIndexMap[e];if(n===void 0)throw new Error("id is invalid");delete this.idPageIndexMap[e];let r=this.highlightInfoMap[n].findIndex(c=>c.id===e);if(r<0)throw new Error("id is invalid");this.highlightInfoMap[n].splice(r,1),this.highlightInfoMapChangeSrc.next({pageIndex:n})}flattenSearchResults(e,n,r=.5){return e.flatMap(c=>c.words.flatMap(g=>this.mergeKeywordRects(g.rects).map(v=>({rect:v,color:n,opacity:r,pageIndex:c.pageIdx}))))}mergeKeywordRects(e){let n=e.slice().sort((c,g)=>c.top-g.top||c.left-g.left),r=[];for(let c of n){let g=r[r.length-1];g&&Math.abs(g.top-c.top)<1&&Math.abs(g.bottom-c.bottom)<1&&c.left-g.right>=-1&&c.left-g.right<=1?(g.right=Math.max(g.right,c.right),g.left=Math.min(g.left,c.left),g.top=Math.max(g.top,c.top),g.bottom=Math.min(g.bottom,c.bottom)):r.push(pi({},c))}return r}};D(t,"\u0275fac",function(n){return new(n||t)(ke(Yt),ke(ct),ke(Ai),ke(Ee),ke(to))}),D(t,"\u0275prov",oi({token:t,factory:t.\u0275fac}));let s=t;return s})();var o0=(()=>{let t=class t{static forRoot(){return{ngModule:t,providers:[Zo]}}};D(t,"\u0275fac",function(n){return new(n||t)}),D(t,"\u0275mod",ai({type:t})),D(t,"\u0275inj",ri({}));let s=t;return s})();var ei=function(s){return s[s.CREATING=0]="CREATING",s[s.EDITING=1]="EDITING",s[s.READY=2]="READY",s[s.NONE=3]="NONE",s}(ei||{}),Pn=function(s){return s[s.DOWNLOAD=0]="DOWNLOAD",s[s.COPY=1]="COPY",s[s.EXPORT=2]="EXPORT",s}(Pn||{}),io=function(s){return s.LEFT="left",s.CENTER="center",s.RIGHT="right",s}(io||{}),no=function(s){return s.TOP="top",s.MIDDLE="middle",s.BOTTOM="bottom",s}(no||{}),bc=function(s){return s.PNG="png",s.JPEG="jpeg",s.WEBP="webp",s}(bc||{});var Wi=(()=>{let t=class t{apiEventBridgeService;store$;MIN_BBOX_SIZE=20;INITIAL_CAPTURED_AREA={bbox:{x:0,y:0,w:0,h:0},pageIndex:-1,status:ei.NONE};lastestMousePositionSrc=new Oi;lastestMousePosition$=this.lastestMousePositionSrc.asObservable();capturedAreaSrc=new Vt(this.INITIAL_CAPTURED_AREA);capturedArea$=this.capturedAreaSrc.asObservable();get capturedArea(){return this.capturedAreaSrc.getValue()}captureActionSrc=new Oi;captureAction$=this.captureActionSrc.asObservable();readyToExportSrc=new Vt(!1);readyToExport$=this.readyToExportSrc.asObservable();constructor(e,n){this.apiEventBridgeService=e,this.store$=n,this.store$.pipe($("isCaptureMode"),F(r=>!r)).subscribe({next:()=>{this.apiEventBridgeService.captureExportedSrc.next({ok:!1,error:new Yl("User cancelled a capture.")}),this.fireReadyToExport(!1),this.capturedAreaSrc.next(this.INITIAL_CAPTURED_AREA)}})}getExportableFunctions(){return[{name:"selectAndExportCapture",function:()=>(G.nativeWindow.focus(),this.store$.dispatch(ue.set({key:"isCaptureMode",value:!0})),this.readyToExport$.pipe(F(e=>e)).subscribe({next:()=>this.fireCaptureAction(Pn.EXPORT)}),this.apiEventBridgeService.handleResultObservable(this.apiEventBridgeService.captureExportedSrc))}]}publishCapture(e){this.capturedAreaSrc.next(e)}updateCaptureBBox(e){this.capturedAreaSrc.next(Rr(pi({},this.capturedArea),{bbox:e}))}updateCaptureStatus(e){this.capturedAreaSrc.next(Rr(pi({},this.capturedArea),{status:e}))}publishLastestMousePosition(e){this.lastestMousePositionSrc.next(e)}fireReadyToExport(e){this.readyToExportSrc.next(e)}fireCaptureAction(e){this.captureActionSrc.next(e)}};D(t,"\u0275fac",function(n){return new(n||t)(ke(Zt),ke(Ee))}),D(t,"\u0275prov",oi({token:t,factory:t.\u0275fac}));let s=t;return s})();var ed=(()=>{let t=class t{captureService;subscriptionService;changeDetectorRef;store$;translatePipe;showFloating=!0;showButton=!1;get isSecureContext(){return G.nativeWindow.isSecureContext}get copyToClipboardText(){return G.isSmallWidth()?this.translatePipe.transform("CAPTURE_EXPORT_TO_CLIPBOARD"):`${this.translatePipe.transform("CAPTURE_EXPORT_TO_CLIPBOARD")}
      (${ti.getShortcutString({ctrlKey:!0,shiftKey:!1,altKey:!1,key:"c"})})`}constructor(e,n,r,c,g){this.captureService=e,this.subscriptionService=n,this.changeDetectorRef=r,this.store$=c,this.translatePipe=g}ngOnInit(){this.subscriptionService.push(this.captureService.capturedArea$.subscribe({next:e=>{this.showFloating=e.status===ei.READY||e.status===ei.NONE,this.showButton=e.status===ei.READY,this.changeDetectorRef.markForCheck()}}),Ge(G.nativeWindow,"keydown").subscribe({next:e=>{e.key==="Escape"&&this.exitCaptureMode()}}),G.windowResize$.subscribe({next:()=>this.changeDetectorRef.markForCheck()}))}exitCaptureMode(){this.store$.dispatch(ue.set({key:"isCaptureMode",value:!1}))}onClickCopy(){this.captureService.fireCaptureAction(Pn.COPY)}onClickDownload(){this.captureService.fireCaptureAction(Pn.DOWNLOAD)}};D(t,"\u0275fac",function(n){return new(n||t)(_(Wi),_(J),_(Me),_(Ee),_(He))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-backdrop"]],standalone:!1,features:[xe([J])],decls:1,vars:0,consts:[[1,"capture-backdrop"]],template:function(n,r){n&1&&q(0,"div",0)},styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}.capture-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:4;background-color:#1e1e1e40}.capture-floating[_ngcontent-%COMP%]{padding:14px 20px;display:flex;gap:12px;height:44px;align-items:center;position:fixed;top:54px;left:50%;background-color:var(--mono-00);border:1px solid var(--mono-30);border-radius:21px;box-sizing:border-box;transform:translate(-50%);z-index:5;cursor:default}.capture-floating[_ngcontent-%COMP%]   .divider[_ngcontent-%COMP%]{width:1px;height:24px;background-color:var(--mono-30)}.capture-floating[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px;cursor:pointer}.capture-floating[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--mono-70);font-size:15px;font-weight:500;white-space:pre}.capture-floating[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;align-items:center}.capture-floating[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .ep-button[_ngcontent-%COMP%]{padding:4px 8px;display:flex;gap:4px;color:var(--mono-99);background-color:var(--mono-00)}.capture-floating[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .ep-button[_ngcontent-%COMP%]:hover{background-color:var(--mono-30)}"],changeDetection:0}));let s=t;return s})();function Vh(s,t){if(s&1&&q(0,"sd-capture-edit",0),s&2){let i=E();T("pdfPage",i.pdfPage)}}function Lh(s,t){if(s&1&&q(0,"sd-capture-create",0),s&2){let i=E();T("pdfPage",i.pdfPage)}}var Ea=(()=>{let t=class t{subscriptionService;captureService;renderingService;documentService;renderer;toastService;translatePipe;changeDetectorRef;store$;loggingService;annotService;acroFormService;pageService;apiEventBridgeService;EXPORT_IMAGE_TYPE=bc.PNG;pdfPage;annot;pdfInfo=null;degree;isCreated=!1;capturedArea=null;drawTool={sdImage:null,imgEl:null,annots:[]};readyPdfImageSrc=new Vt(!1);readyPdfImage$=this.readyPdfImageSrc.asObservable();get readyPdfImage(){return this.readyPdfImageSrc.getValue()}constructor(e,n,r,c,g,v,y,M,k,Z,le,pe,he,Te){this.subscriptionService=e,this.captureService=n,this.renderingService=r,this.documentService=c,this.renderer=g,this.toastService=v,this.translatePipe=y,this.changeDetectorRef=M,this.store$=k,this.loggingService=Z,this.annotService=le,this.acroFormService=pe,this.pageService=he,this.apiEventBridgeService=Te}ngOnInit(){this.subscriptionService.push(this.store$.pipe($("degree")).subscribe({next:e=>this.degree=e}),this.captureService.capturedArea$.pipe(rt(e=>{this.isCreated=e.status!==ei.CREATING&&e.status!==ei.NONE}),F(e=>e.pageIndex===this.pdfPage.i)).subscribe({next:e=>{this.capturedArea=e,this.changeDetectorRef.markForCheck()}}),this.captureService.capturedArea$.pipe(F(e=>e.pageIndex===this.pdfPage.i&&e.status===ei.READY),en(1),st(()=>w.isDefined(this.documentService.openedDocument)?pr([this.renderingService.fetchImage(this.documentService.openedDocument.streamdocsId,this.pdfPage.ref,{jpegQuality:mp.HIGH,increasePrint:!1,renderAnnots:!1,zoom:Ze.captureImageScale}).pipe(Ue(e=>{if(!w.isDefined(e.data))throw new St("Cannot handle image data");switch(e.type){case"BLOB":return URL.createObjectURL(e.data);case"BASE64":return e.data;default:throw new St("Cannot handle image data")}})),this.store$.pipe(Yo("ALL"),Ue(e=>kn.filterChanges(e,n=>n.allowView?n.range==="all"?!0:!!Nn.parse(n.range,{min:0,max:this.pageService.pdfPages.length-1})?.includes(this.pdfPage.i):!1)),Ue(e=>kn.flattenWatermarks(e)))]):Gn(()=>new St("No opened document."))),st(([e,n])=>new Ur({imgSrc:e,width:this.pdfPage.bbox.w,height:this.pdfPage.bbox.h,rotation:this.pdfPage.r},n).draw()),rt(e=>{this.drawTool.imgEl=document.createElement("img"),this.drawTool.sdImage=new fp(this.drawTool.imgEl,this.renderer,e,!0),this.drawTool.imgEl.addEventListener("load",()=>this.readyPdfImageSrc.next(!0)),this.drawTool.sdImage.render()})).subscribe(),this.captureService.captureAction$.pipe(F(()=>w.isDefined(this.capturedArea)&&this.readyPdfImage),en(1),st(e=>this.exportCapture(e)),Xn(()=>this.store$.dispatch(ue.set({key:"isCaptureMode",value:!1})))).subscribe({error:e=>{console.error(e),this.apiEventBridgeService.captureExportedSrc.next({ok:!1,error:new St("Failed to export capture")})}}),this.documentService.pdfInfo$.subscribe({next:e=>this.pdfInfo=e}),this.readyPdfImage$.pipe(F(e=>e)).subscribe({next:()=>this.annotCompToImage(this.annot.editableComps?.filter(e=>w.isDefined(e.data))??[])}))}ngOnDestroy(){this.clearImage(),this.exitCaptureModeIfTargetDestroyed()}exportCapture(e){return new Et(n=>{let r=this.getCapturedImage();if(!w.isDefined(r)){this.toastService.create({toastStyle:Gt.NOTIFICATION,header:this.translatePipe.transform("CAPTURE_FAILURE"),content:this.translatePipe.transform("CAPTURE_IMAGE_LOADING")}),n.next(!1),n.complete();return}switch(e){case Pn.COPY:let c=uc.base64ToBlob(r),g=()=>{this.toastService.create({toastStyle:Gt.FAILURE,header:this.translatePipe.transform("CAPTURE_FAILURE"),content:this.translatePipe.transform("NO_CLIPBOARD_AUTHORITY")}),n.next(!1),n.complete()},v=()=>{this.toastService.create({toastStyle:Gt.SUCCESS,header:this.translatePipe.transform("CAPTURE_SUCCESS"),content:this.translatePipe.transform("CAPTURE_EXPORT_SUCCESS_CLIPBOARD")}),n.next(!0),n.complete()};G.copyToClipboard("",void 0,{blob:c,type:`image/${this.EXPORT_IMAGE_TYPE}`},v,g);break;case Pn.DOWNLOAD:let y=document.createElement("a");y.href=r,y.download=`${this.pdfInfo.FileName}_${this.pdfPage.i+1}.${this.EXPORT_IMAGE_TYPE}`,y.click(),this.toastService.create({toastStyle:Gt.SUCCESS,header:this.translatePipe.transform("CAPTURE_SUCCESS"),content:this.translatePipe.transform("CAPTURE_EXPORT_SUCCESS_FILE")}),n.next(!0),n.complete();break;case Pn.EXPORT:So(uc.base64ToBlob(r).arrayBuffer()).subscribe({next:M=>{this.apiEventBridgeService.captureExportedSrc.next({ok:!0,data:{imageBytes:new Uint8Array(M)}}),n.next(!0),n.complete()},error:M=>{console.error(M),this.apiEventBridgeService.captureExportedSrc.next({ok:!1,error:new St("Failed to export capture")}),n.next(!1),n.complete()}});break}})}getCapturedImage(){if(!w.isDefined(this.capturedArea))return null;let e=document.createElement("canvas"),n=e.getContext("2d");return w.isDefined(n)?(this.drawImage(e),this.drawAnnots(e),e.toDataURL(`image/${this.EXPORT_IMAGE_TYPE}`)):(this.loggingService.common("debug",Le.NOT_EXIST,"Failed to get CanvasRenderingContext2D"),null)}drawImage(e){let n=e.getContext("2d");if(!w.isDefined(n)){this.loggingService.common("debug",Le.NOT_EXIST,"CanvasRenderingContext2D");return}if(!w.isDefined(this.drawTool.imgEl)){this.loggingService.common("debug",Le.NOT_EXIST,"drawTool.imgEl");return}if(!w.isDefined(this.capturedArea)){this.loggingService.common("debug",Le.NOT_EXIST,"capturedArea");return}let r=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,c=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,g=(this.degree+this.pdfPage.r)%360,v=g/90%2===1,y=this.capturedArea.bbox.w*r,M=this.capturedArea.bbox.h*c;e.width=v?M:y,e.height=v?y:M,n.save(),n.translate(e.width/2,e.height/2),n.rotate(g*Math.PI/180),n.drawImage(this.drawTool.imgEl,this.capturedArea.bbox.x*r,this.capturedArea.bbox.y*c,this.capturedArea.bbox.w*r,this.capturedArea.bbox.h*c,-y/2,-M/2,y,M),n.restore()}drawAnnots(e){let n=e.getContext("2d");if(!w.isDefined(n)){this.loggingService.common("debug",Le.NOT_EXIST,"CanvasRenderingContext2D");return}if(!w.isDefined(this.drawTool.imgEl)){this.loggingService.common("debug",Le.NOT_EXIST,"drawTool.imgEl");return}let r=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,c=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h;this.drawTool.annots.sort((y,M)=>{let k=this.annot.oidToZIndexMap;return Number(k[y.oid])-Number(k[M.oid])});let g=(this.degree+this.pdfPage.r)%360,v=g/90%2===1;n.save(),n.translate(e.width/2,e.height/2),n.rotate(g*Math.PI/180),n.translate(v?-e.height/2:-e.width/2,v?-e.width/2:-e.height/2),this.drawTool.annots.forEach(y=>{if(!w.isDefined(this.capturedArea)){this.loggingService.common("debug",Le.NOT_EXIST,"capturedArea");return}let{canvas:M,point:k}=y,Z=(k.x-this.capturedArea.bbox.x)*r,le=(k.y-this.capturedArea.bbox.y)*c,pe=n.globalCompositeOperation;y.composite&&(n.globalCompositeOperation=y.composite),n.drawImage(M,0,0,M.width,M.height,Z,le,M.width,M.height),n.globalCompositeOperation=pe}),n.restore()}annotCompToImage(e){if(this.drawTool.annots.splice(0),e.length===0){this.captureService.fireReadyToExport(!0);return}pr(e.map(n=>w.isDefined(n.data)?(Lt.isWidget(n.data)&&!(Lt.isRadioWidgetComponent(n)||Lt.isCheckBoxComponent(n))?w.isDefined(n.data.attributes.appearance)&&!this.isWidgetEdited(n):w.isDefined(n.data.attributes.appearance))?this.createAnnotImageUsingAP(n):this.createAnnotImageUsingAttribute(n):dt())).pipe(Xn(()=>this.captureService.fireReadyToExport(!0))).subscribe()}createAnnotImageUsingAttribute(e){switch(e.data.type){case"Ink":case"Circle":case"Highlight":case"Underline":case"StrikeOut":case"Line":case"Link":case"Polygon":case"PolyLine":case"Redact":case"Square":case"FreeText":return this.createAnnotImageUsingSVG(e);case"Widget":return this.createAnnotImageUsingAcroForm(e);case"Text":return this.createAnnotImageUsingIcon(e)}return dt()}createAnnotImageUsingSVG(e){return new Et(n=>{let r=document.createElement("canvas"),c=r.getContext("2d");if(!w.isDefined(c)){this.loggingService.common("debug",Le.NOT_EXIST,"CanvasRenderingContext2D"),n.error();return}if(!w.isDefined(this.drawTool.imgEl)){this.loggingService.common("debug",Le.NOT_EXIST,"drawTool.imgEl"),n.error();return}let g=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,v=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,{rect:y}=e.data.attributes;if(r.width=Math.abs(y.left-y.right)*g,r.height=Math.abs(y.top-y.bottom)*v,c.scale(g,v),(Lt.isFreeText(e.data)||Lt.isFreeTextCallout(e.data))&&this.drawFreeTextContent(r,e.data),!w.isDefined(e.elementRef)){this.loggingService.common("debug",Le.NOT_EXIST,"elementRef"),n.error();return}e.elementRef.nativeElement.querySelectorAll("svg").forEach(M=>{let Z=new XMLSerializer().serializeToString(M).replace(/url\([^\#]*\#([^\)]+)\)/g,"url(#$1)").replace(/xlink:href="[^#]*#([^"]+)"/,'xlink:href="#$1"'),le=new Image,pe=new Blob([Z],{type:"image/svg+xml"}),he=URL.createObjectURL(pe);le.addEventListener("load",()=>{c.drawImage(le,0,0);let Te=this.drawTool.annots.findIndex(ht=>ht.oid===e.data.oid),p={canvas:r,oid:e.data.oid,point:{x:y.left,y:this.pdfPage.bbox.y+this.pdfPage.bbox.h-y.top},composite:Lt.isTextMarkup(e.data)?"multiply":void 0};Te<0?this.drawTool.annots.push(p):this.drawTool.annots.splice(Te,1,p),n.next(),n.complete()}),le.src=he})})}createAnnotImageUsingAcroForm(e){return new Et(n=>{if(!w.isDefined(e.acroField)){n.error();return}let r=document.createElement("canvas"),c=r.getContext("2d");if(!w.isDefined(c)){this.loggingService.common("debug",Le.NOT_EXIST,"CanvasRenderingContext2D"),n.error();return}if(!w.isDefined(this.drawTool.imgEl)){this.loggingService.common("debug",Le.NOT_EXIST,"drawTool.imgEl"),n.error();return}let{rect:g}=e.data.attributes,v={x:0,y:0,w:0,h:0,border:0,margin:0,ratio:{width:1,height:1}},y=0,M=!1;if(v.ratio.width=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,v.ratio.height=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,v.w=Math.abs(g.left-g.right),v.h=Math.abs(g.top-g.bottom),r.width=v.w*v.ratio.width,r.height=v.h*v.ratio.height,c.scale(v.ratio.width,v.ratio.height),w.isDefined(e.data.attributes.MK)){let{backgroundColor:k,borderColor:Z,R:le}=e.data.attributes.MK,{width:pe}=e.data.attributes;if(w.isDefined(le)&&(y=-le,M=le/90%2===1),w.isDefined(k)&&(c.save(),c.fillStyle=k,c.fillRect(0,0,r.width,r.height),c.fill(),c.restore()),w.isDefined(Z)){let he=pe??1;v.border=he,c.save(),c.strokeStyle=Z,c.lineWidth=he,c.moveTo(0,he/2),c.lineTo(r.width-he/2,he/2),c.lineTo(r.width-he/2,r.height-he/2),c.lineTo(he/2,r.height-he/2),c.lineTo(he/2,he/2),c.stroke(),c.restore()}}if(M&&([v.x,v.y,v.w,v.h]=[v.y,v.x,v.h,v.w]),Lt.isTextFieldComponent(e)){let{V:k,Ff:Z}=e.acroField;if(w.isDefined(k)){let{alignment:le,fontSize:pe,fontName:he,fontColor:Te}=e.data.attributes,p=w.isDefined(Z)?gr.get(Z,12):!1;this.drawText(r,k,v,{alignment:this.isAlignment(le)?le:io.LEFT,baseline:p?no.TOP:no.MIDDLE,font:{color:Te,name:he,size:pe},isMultiLine:p,rotate:y})}}else if(Lt.isComboBoxComponent(e)){let{I:k,Opt:Z}=e.acroField;if(Array.isArray(k)&&Array.isArray(Z)){let pe=(Z[k[0]]??[])[1];if(w.isDefined(pe)){let{fontSize:he,fontColor:Te,fontName:p}=e.data.attributes;this.drawText(r,pe,v,{alignment:io.LEFT,baseline:no.MIDDLE,font:{color:Te,name:p,size:he},isMultiLine:!1,rotate:y})}}}else if(Lt.isListBoxComponent(e)){let{I:k,Opt:Z}=e.acroField,{fontSize:le,fontName:pe,fontColor:he}=e.data.attributes;Array.isArray(k)&&Array.isArray(Z)&&(v.h=le+5,v.border=0,v.margin=5/2,Z.forEach(([p,ht],_t)=>{let gt=_t===k[0];w.isDefined(ht)&&(v.y=(5+le)*_t,this.drawText(r,ht,v,{alignment:io.LEFT,baseline:no.MIDDLE,font:{color:gt?"#fff":he,name:pe,size:le},isMultiLine:!1,backgroundColor:gt?"#4D90FE":void 0,rotate:y}))}))}this.drawTool.annots.push({canvas:r,oid:e.data.oid,point:{x:g.left,y:this.pdfPage.bbox.y+this.pdfPage.bbox.h-g.top}}),n.next(),n.complete()})}createAnnotImageUsingIcon(e){return new Et(n=>{let r=e.elementRef?.nativeElement.querySelector(".papycon"),c=1.5;if(!w.isDefined(r)){this.loggingService.common("debug",Le.NOT_EXIST,"Not Exist Icon HTMLElement."),n.error();return}let g=document.createElement("canvas"),v=g.getContext("2d");if(!w.isDefined(v)){this.loggingService.common("debug",Le.NOT_EXIST,"CanvasRenderingContext2D"),n.error();return}if(!w.isDefined(this.drawTool.imgEl)){this.loggingService.common("debug",Le.NOT_EXIST,"drawTool.imgEl"),n.error();return}let{rect:y}=e.data.attributes,M=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,k=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h;g.width=(Math.abs(y.left-y.right)+c*2)*M,g.height=(Math.abs(y.top-y.bottom)+c*2)*k,v.scale(M,k);let{fontFamily:Z,fontSize:le,content:pe,color:he,textShadow:Te}=window.getComputedStyle(r,"::before"),p=pe.replaceAll('"',""),ht=c,_t=Math.floor(c)+Number(le.replace("px",""));if(v.font=`${le} ${Z}`,v.textBaseline="bottom",w.isDefined(Te)){let gt=/rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)\s*(-?\d+(?:\.\d+)?)px\s*(-?\d+(?:\.\d+)?)px\s*(-?\d+(?:\.\d+)?)px/g,Pi=Array.from(Te.matchAll(gt),At=>({color:`rgb(${At[1]}, ${At[2]}, ${At[3]})`,offsetX:Number.parseFloat(At[4]),offsetY:Number.parseFloat(At[5]),blur:Number.parseFloat(At[6])}));v.save(),Pi.forEach(At=>{v.shadowOffsetX=At.offsetX,v.shadowOffsetY=At.offsetY,v.shadowBlur=At.blur,v.shadowColor=At.color,v.fillText(p,ht,_t)}),v.restore()}v.fillStyle=he,v.fillText(p,ht,_t),this.drawTool.annots.push({canvas:g,oid:e.data.oid,point:{x:y.left,y:this.pdfPage.bbox.y+this.pdfPage.bbox.h-y.top}}),n.next(),n.complete()})}createAnnotImageUsingAP(e){return new Et(n=>{let{appearance:r,rect:c}=e.data.attributes,g={data:null,format:null};if(Array.isArray(r)){let M=r.find(k=>k.state===e.acroField?.V)??r.find(k=>k.state==="Off");if(!w.isDefined(M)){this.loggingService.common("debug",Le.INVALID,"appearance"),n.error();return}g.data=M.data,g.format=M.format}else g.data=r?.data??null,g.format=r?.format??null;if(!w.isDefined(g.data)){this.loggingService.common("debug",Le.INVALID,"appearance data"),n.error();return}let v=`data:image/${g.format};base64,${g.data}`,y=new Image;y.addEventListener("load",()=>{let M=document.createElement("canvas"),k=M.getContext("2d");if(!w.isDefined(k)){this.loggingService.common("debug",Le.NOT_EXIST,"CanvasRenderingContext2D"),n.error();return}if(!w.isDefined(this.drawTool.imgEl)){this.loggingService.common("debug",Le.NOT_EXIST,"drawTool.imgEl"),n.error();return}let Z=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,le=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,pe=Math.abs(c.left-c.right),he=Math.abs(c.top-c.bottom),Te=e.data.type.toLowerCase(),p=Jn.hasKey(Sc,Te)?Sc[Te]:1;M.width=pe*Z,M.height=he*le,k.scale(Z,le),k.globalAlpha=e.data.attributes.opacity??p,k.drawImage(y,0,0,pe,he),this.drawTool.annots.push({canvas:M,oid:e.data.oid,point:{x:c.left,y:this.pdfPage.bbox.y+this.pdfPage.bbox.h-c.top},composite:Lt.isTextMarkup(e.data)?"multiply":void 0}),n.next(),n.complete()}),y.src=v})}drawFreeTextContent(e,n){let{textRect:r,contentsRichtext:c,width:g,color:v,rect:y,Rotate:M}=n.attributes,k={x:0,y:0,w:0,h:0,border:g,margin:0,ratio:{width:1,height:1}},Z=M/90%2===1;if(w.isDefined(r)?(k.x=Math.max(Math.abs(r.left-y.left),Math.abs(r.right-y.right)),k.y=Math.max(Math.abs(r.top-y.top),Math.abs(r.bottom-y.bottom)),k.w=Math.abs(r.right-r.left),k.h=Math.abs(r.bottom-r.top)):(k.w=Math.abs(y.right-y.left),k.h=Math.abs(y.bottom-y.top)),Z&&([k.x,k.y,k.w,k.h]=[k.y,k.x,k.h,k.w]),!w.isDefined(this.drawTool.imgEl)){this.loggingService.common("debug",Le.NOT_EXIST,"drawTool.imgEl");return}let le=c.fontSize/10;k.margin=Math.min(g*4,Math.min(k.w,k.h))/2/le,k.ratio.width=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,k.ratio.height=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,this.drawText(e,c.text,k,{baseline:no.TOP,alignment:io.LEFT,backgroundColor:v,isMultiLine:!0,rotate:-M,font:{size:c.fontSize,color:c.fontColor,name:c.fontName}})}drawText(e,n,r,c){let g=he=>!ti.isEnglish(he)&&!ti.isNumber(he)&&!ti.isSpecialCharacters(he,["s","-","?"]),v=e.getContext("2d");if(!w.isDefined(v)){this.loggingService.common("debug",Le.NOT_EXIST,"CanvasRenderingContext2D");return}let y=new Path2D,M=[],k=Math.abs(c.rotate)/90%2===1,Z={word:"",line:[]};if(v.save(),v.fillStyle=c.font.color,v.font=`${c.font.size}px ${c.font.name}`,v.textAlign=c.alignment,v.textBaseline=c.baseline,c.isMultiLine){for(let he of n){if(he===`
`){Z.word.length>0&&(Z.line.push(Z.word),Z.word=""),M.push(Z.line),Z.line=[];continue}else Z.word+=he;let Te=Z.line.reduce((p,ht)=>p+ht,"").concat(Z.word);if(v.measureText(Te).width+r.margin*2+r.border*2>=r.w){if(Z.line.length===0){M.push([Z.word.slice(0,-1)]),Z.word=he;continue}M.push(Z.line),Z.line=[],v.measureText(Z.word).width+r.margin*2+r.border*2>=r.w&&(M.push([Z.word.slice(0,-1)]),Z.word=he)}g(he)&&(Z.line.push(Z.word),Z.word="")}Z.word.length>0&&Z.line.push(Z.word),Z.line.length>0&&M.push(Z.line)}else M.push([n]);let le=e.width/r.ratio.width,pe=e.height/r.ratio.height;v.translate(le/2,pe/2),v.rotate(c.rotate*Math.PI/180),v.translate(k?-pe/2:-le/2,k?-le/2:-pe/2),y.rect(r.x,r.y,r.w,r.h),v.clip(y),w.isDefined(c.backgroundColor)&&(v.save(),v.fillStyle=c.backgroundColor,v.rect(r.x,r.y,r.w,r.h),v.fill(),v.restore()),M.forEach((he,Te)=>{let p=he.reduce((gt,Pi)=>gt+Pi,""),ht=this.getTextDeltaX(c.alignment,r.border+r.margin,r.w),_t=this.getTextDeltaY(c.baseline,r.border+r.margin,r.h,M.length,c.font.size,Te);v.fillText(p,r.x+ht,r.y+_t)}),v.restore()}getTextDeltaX(e,n,r){switch(e){case io.LEFT:return n;case io.CENTER:return r/2;case io.RIGHT:return r}}getTextDeltaY(e,n,r,c,g,v){let y=v+1;switch(e){case no.TOP:return n+v*g;case no.MIDDLE:let M=r/2,k=(c+1)/2,Z=(y-k)*g;if(c%2===0){let le=Math.abs(y-k)<1,pe=y<k;return le?M+(pe?-g/2:g/2):M+Z}return M+Z;case no.BOTTOM:return r-n-(c-y)*g}}isAlignment(e){return Object.values(io).some(n=>n===e)}isWidgetEdited(e){if(e.data.attributes.Parent<0)return!0;let r=this.annotService.getActionLogAnnots(e.data.attributes.pageIdx).findIndex(y=>y.oid===e.data.oid)>-1,c=e.acroField?.V??e.data.attributes.V,g=this.acroFormService.lastFetchedAcroFields?.get(e.data.attributes.Parent)?.V,v=JSON.stringify(c)!==JSON.stringify(g);return r||v}clearImage(){w.isDefined(this.drawTool.sdImage)&&(this.drawTool.sdImage.destroy(!0),this.drawTool.sdImage=null)}exitCaptureModeIfTargetDestroyed(){!w.isDefined(this.capturedArea)||w.isDefined(this.capturedArea)&&this.capturedArea.pageIndex!==this.pdfPage.i||this.store$.dispatch(ue.set({key:"isCaptureMode",value:!1}))}};D(t,"\u0275fac",function(n){return new(n||t)(_(J),_(Wi),_(jo),_(ct),_(jt),_(sn),_(He),_(Me),_(Ee),_(Ai),_(li),_(yn),_(Yt),_(Zt))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-tool"]],inputs:{pdfPage:"pdfPage",annot:"annot"},standalone:!1,features:[xe([J])],decls:3,vars:2,consts:[[3,"pdfPage"],[3,"pageIndex"]],template:function(n,r){n&1&&(se(0,Vh,1,1,"sd-capture-edit",0)(1,Lh,1,1,"sd-capture-create",0),q(2,"sd-capture-overlay",1)),n&2&&(Ut(r.isCreated?0:1),x(2),T("pageIndex",r.pdfPage.i))},encapsulation:2,changeDetection:0}));let s=t;return s})();var Bh=["dragArea"],td=(()=>{let t=class t{subscriptionService;captureService;store$;dragAreaRef;pdfPage;scale;degree;mainSub=[];point=null;layout={};constructor(e,n,r){this.subscriptionService=e,this.captureService=n,this.store$=r}ngOnInit(){this.subscriptionService.push(this.store$.pipe($("scale")).subscribe({next:e=>this.scale=e}),this.store$.pipe($("degree")).subscribe({next:e=>this.degree=e}),ut(Ge(this.dragAreaRef.nativeElement,"mousemove").pipe(Ue(e=>({point:{x:e.offsetX,y:e.offsetY},pageIndex:this.pdfPage.i}))),Ge(this.dragAreaRef.nativeElement,"mouseenter").pipe(Ue(e=>({point:{x:e.offsetX,y:e.offsetY},pageIndex:this.pdfPage.i}))),Ge(this.dragAreaRef.nativeElement,"mouseleave").pipe(Ue(()=>null))).subscribe({next:e=>this.captureService.publishLastestMousePosition(e)})),ee.bindLayoutOrder(this.layout,ee.LayoutOrder.Capture)}ngOnDestroy(){this.captureService.publishLastestMousePosition(null),this.point=null}createMover(e){e.preventDefault(),e.stopPropagation();let n=e.type.startsWith("touch"),r=this.ensureMouseEvent(e);this.point={start:{x:r.offsetX,y:r.offsetY},end:{x:r.offsetX,y:r.offsetY}};let c={bbox:{x:Math.min(this.point.start.x,this.point.end.x),y:Math.min(this.point.start.y,this.point.end.y),w:Math.abs(this.point.start.x-this.point.end.x),h:Math.abs(this.point.start.y-this.point.end.y)},pageIndex:this.pdfPage.i,status:ei.CREATING};if(this.captureService.publishCapture(c),n){this.captureService.publishLastestMousePosition({point:{x:r.offsetX,y:r.offsetY},pageIndex:this.pdfPage.i}),this.mainSub.push(Ge(this.dragAreaRef.nativeElement,"touchmove").subscribe({next:g=>{let v=this.ensureMouseEvent(g);this.captureService.publishLastestMousePosition({point:{x:v.offsetX,y:v.offsetY},pageIndex:this.pdfPage.i}),this.onMouseMove(v)}}),Ge(this.dragAreaRef.nativeElement,"touchend").subscribe({next:g=>{let v=this.ensureMouseEvent(g);this.captureService.publishLastestMousePosition({point:{x:v.offsetX,y:v.offsetY},pageIndex:this.pdfPage.i}),this.onMouseUp(this.ensureMouseEvent(g))}}));return}this.mainSub.push(Ge(this.dragAreaRef.nativeElement,"mousemove").subscribe({next:g=>this.onMouseMove(g)}),Ge(this.dragAreaRef.nativeElement,"mouseup").subscribe({next:g=>this.onMouseUp(g)}))}onMouseMove(e){if(!w.isDefined(this.point))throw new Xt("point is not initialized. Call createMover() first.");e.stopPropagation(),this.point.end.x=Math.max(0,Math.min(e.offsetX,this.pdfPage.bbox.x+this.pdfPage.bbox.w)),this.point.end.y=Math.max(0,Math.min(e.offsetY,this.pdfPage.bbox.y+this.pdfPage.bbox.h)),this.captureService.updateCaptureBBox({x:Math.min(this.point.start.x,this.point.end.x),y:Math.min(this.point.start.y,this.point.end.y),w:Math.abs(this.point.start.x-this.point.end.x),h:Math.abs(this.point.start.y-this.point.end.y)})}onMouseUp(e){if(!w.isDefined(this.point))throw new Xt("point is not initialized. Call createMover() first.");e.stopPropagation(),this.point.end.x=e.offsetX,this.point.end.y=e.offsetY;let n=this.captureService.MIN_BBOX_SIZE,r=Math.abs(this.point.start.x-this.point.end.x)<n||Math.abs(this.point.start.y-this.point.end.y)<n;this.captureService.updateCaptureStatus(r?ei.NONE:ei.READY),this.mainSub.forEach(c=>c.unsubscribe()),this.mainSub.splice(0)}onMouseLeave(e){this.mainSub.length!==0&&this.onMouseUp(e)}ensureMouseEvent(e){return w.ensureMouseEvent(e,this.degree,this.scale,this.pdfPage,this.dragAreaRef.nativeElement)}};D(t,"\u0275fac",function(n){return new(n||t)(_(J),_(Wi),_(Ee))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-create"]],viewQuery:function(n,r){if(n&1&&Ye(Bh,7),n&2){let c;Ie(c=Ae())&&(r.dragAreaRef=c.first)}},inputs:{pdfPage:"pdfPage"},standalone:!1,features:[xe([J])],decls:2,vars:1,consts:[["dragArea",""],[1,"capture-drag-area",3,"mousedown","mouseleave","touchstart","ngStyle"]],template:function(n,r){if(n&1){let c=ve();I(0,"div",1,0),ae("mousedown",function(v){return j(c),W(r.createMover(v))})("mouseleave",function(v){return j(c),W(r.onMouseLeave(v))})("touchstart",function(v){return j(c),W(r.createMover(v))}),N()}n&2&&T("ngStyle",r.layout)},dependencies:[Wt],styles:[".capture-drag-area[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:2;cursor:none}"],changeDetection:0}));let s=t;return s})();var Uh=["captureEdit"];function Hh(s,t){if(s&1){let i=ve();wi(),I(0,"rect",5),ae("mousedown",function(n){let r=j(i).index,c=E(2);return W(c.createMover(n,r))})("touchstart",function(n){let r=j(i).index,c=E(2);return W(c.createMover(n,r))}),N()}if(s&2){let i=t.$implicit,e=t.index,n=E(2);nn("cursor",n.cursorStyle(e)),ge("x",i.x)("y",i.y)("rx",n.vertex.style.width/2)("ry",n.vertex.style.height/2)("width",n.vertex.style.width)("height",n.vertex.style.height)("stroke-width",n.vertex.stroke)}}function $h(s,t){if(s&1){let i=ve();wi(),I(0,"g")(1,"rect",3),ae("mousedown",function(n){j(i);let r=E();return W(r.createMover(n))})("touchstart",function(n){j(i);let r=E();return W(r.createMover(n))}),N(),se(2,Hh,1,9,"rect",4),N()}if(s&2){let i=E();x(),ge("stroke-width",i.vertex.stroke)("x",i.capturedArea.bbox.x)("y",i.capturedArea.bbox.y)("width",i.capturedArea.bbox.w)("height",i.capturedArea.bbox.h),x(),T("ngForOf",i.vertex.coords)}}var id=(()=>{let t=class t{subscriptionService;captureService;changeDetectorRef;store$;DEFAULT_VERTEX_SIZE=9;DEFAULT_STROKE_WIDTH=2;captureEditRef;pdfPage;degree;scale;style={layout:{width:null,height:null}};vertex={size:this.DEFAULT_VERTEX_SIZE,style:{width:this.DEFAULT_VERTEX_SIZE,height:this.DEFAULT_VERTEX_SIZE},stroke:this.DEFAULT_STROKE_WIDTH,coords:[]};moverSub=[];capturedArea;constructor(e,n,r,c){this.subscriptionService=e,this.captureService=n,this.changeDetectorRef=r,this.store$=c}ngOnInit(){this.style.layout.width=`${this.pdfPage.bbox.w+this.pdfPage.bbox.x}px`,this.style.layout.height=`${this.pdfPage.bbox.h+this.pdfPage.bbox.y}px`,this.subscriptionService.push(this.store$.pipe($("scale")).subscribe({next:e=>{this.scale=e,this.render()}}),this.store$.pipe($("degree")).subscribe({next:e=>this.degree=e}),this.captureService.capturedArea$.pipe(F(e=>this.pdfPage.i===e.pageIndex)).subscribe({next:e=>{this.capturedArea=e,this.render(),this.changeDetectorRef.markForCheck()}}),Ge(G.nativeWindow,"copy").pipe(F(()=>w.isDefined(this.capturedArea))).subscribe({next:e=>{e.preventDefault(),this.captureService.fireCaptureAction(Pn.COPY)}})),ee.bindLayoutOrder(this.style.layout,ee.LayoutOrder.Capture)}ngOnDestroy(){this.moverSub.forEach(e=>e.unsubscribe())}cursorStyle(e){let n=(this.pdfPage.r+this.degree+360)%360;return Ar.resizeCursorOf(!0,e,n)}renderVertex(e){let n=this.createRectVertices(e,this.vertex.size);if(this.vertex.coords.length===0){this.vertex.coords=n;return}this.vertex.coords.forEach((r,c)=>{r.x=n[c].x,r.y=n[c].y})}createRectVertices(e,n){let r=n/2,[c,g,v]=[-r,e.h/2-r,e.w/2-r],[y,M]=[e.w-r,e.h-r];return[{x:e.x+c,y:e.y+c},{x:e.x+c,y:e.y+g},{x:e.x+c,y:e.y+M},{x:e.x+v,y:e.y+M},{x:e.x+y,y:e.y+M},{x:e.x+y,y:e.y+g},{x:e.x+y,y:e.y+c},{x:e.x+v,y:e.y+c}]}createMover(e,n){e.preventDefault(),e.stopPropagation();let r=e.type.startsWith("touch"),c=this.ensureMouseEvent(e);this.moverSub.forEach(y=>y.unsubscribe()),this.moverSub.splice(0),this.captureService.updateCaptureStatus(ei.EDITING);let g=w.isDefined(n)?this.moveVertex(c,n):this.moveBBox(c),v=()=>{this.captureService.updateCaptureStatus(ei.READY),this.moverSub.forEach(y=>y.unsubscribe()),this.moverSub.splice(0)};if(r){this.moverSub.push(Ge(this.captureEditRef.nativeElement,"touchmove").subscribe({next:y=>{y.preventDefault(),g(this.ensureMouseEvent(y))}}),Ge(this.captureEditRef.nativeElement,"touchend").subscribe({next:()=>v()}));return}this.moverSub.push(Ge(this.captureEditRef.nativeElement,"mousemove").subscribe({next:y=>g(y)}),ut(Ge(this.captureEditRef.nativeElement,"mouseup"),Ge(this.captureEditRef.nativeElement,"mouseleave")).subscribe({next:()=>v()}))}moveVertex(e,n){let r={offsetX:e.offsetX,offsetY:e.offsetY};return c=>{if(!w.isDefined(this.capturedArea))return;let g=w.deepClone(this.capturedArea.bbox),v={x:c.offsetX-r.offsetX,y:c.offsetY-r.offsetY};switch(r.offsetX=c.offsetX,r.offsetY=c.offsetY,n){case Kt.TOP_LEFT:case Kt.TOP:case Kt.TOP_RIGHT:g.y+v.y>=0&&(g.y+=v.y,g.h-=v.y);break;default:break}switch(n){case Kt.LEFT:case Kt.TOP_LEFT:case Kt.BOTTOM_LEFT:g.x+v.x>=this.pdfPage.bbox.x&&(g.x+=v.x,g.w-=v.x);break;default:break}switch(n){case Kt.BOTTOM:case Kt.BOTTOM_LEFT:case Kt.BOTTOM_RIGHT:g.y+g.h+v.y<=this.pdfPage.bbox.y+this.pdfPage.bbox.h&&(g.h+=v.y);break;default:break}switch(n){case Kt.RIGHT:case Kt.TOP_RIGHT:case Kt.BOTTOM_RIGHT:g.x+g.w+v.x<=this.pdfPage.bbox.x+this.pdfPage.bbox.w&&(g.w+=v.x);break;default:break}this.captureService.updateCaptureBBox(this.resizeBBox(g,n)),this.changeDetectorRef.markForCheck()}}moveBBox(e){let n={offsetX:e.offsetX,offsetY:e.offsetY};return r=>{let c={x:r.offsetX-n.offsetX,y:r.offsetY-n.offsetY};n.offsetX=r.offsetX,n.offsetY=r.offsetY;let g=w.deepClone(this.capturedArea.bbox);g.x+=c.x,g.y+=c.y,this.captureService.updateCaptureBBox(this.resizeBBox(g))}}resizeBBox(e,n){let r=this.captureService.MIN_BBOX_SIZE;switch(n){case Kt.TOP:case Kt.TOP_LEFT:case Kt.TOP_RIGHT:if(e.h<r){let c=r-e.h;e.y-=c,e.h+=c}break;default:break}switch(n){case Kt.LEFT:case Kt.TOP_LEFT:case Kt.BOTTOM_LEFT:if(e.w<r){let c=r-e.w;e.x-=c,e.w+=c}break;default:break}switch(n){case Kt.BOTTOM:case Kt.BOTTOM_LEFT:case Kt.BOTTOM_RIGHT:e.h<r&&(e.h=r);break;default:break}switch(n){case Kt.RIGHT:case Kt.TOP_RIGHT:case Kt.BOTTOM_RIGHT:e.w<r&&(e.w=r);break;default:break}if(e.x+e.w>this.pdfPage.bbox.x+this.pdfPage.bbox.w){let c=this.pdfPage.bbox.x+this.pdfPage.bbox.w-e.w;e.x=c}if(e.x<this.pdfPage.bbox.x&&(e.x=this.pdfPage.bbox.x),e.y+e.h>this.pdfPage.bbox.h){let c=this.pdfPage.bbox.y+this.pdfPage.bbox.h-e.h;e.y=c}return e.y<0&&(e.y=0),e}render(){!w.isDefined(this.capturedArea)||this.capturedArea.status===ei.CREATING||this.capturedArea.status===ei.NONE||(this.calcScale(),this.renderVertex(this.capturedArea.bbox),this.changeDetectorRef.markForCheck())}calcScale(){let e=ee.normalizeScale(this.scale);this.vertex.size=Number((this.DEFAULT_VERTEX_SIZE/e).toFixed(1)),this.vertex.style.width=this.vertex.size,this.vertex.style.height=this.vertex.size,this.vertex.stroke=Number((this.DEFAULT_STROKE_WIDTH/e).toFixed(1))}ensureMouseEvent(e){return w.ensureMouseEvent(e,this.degree,this.scale,this.pdfPage,this.captureEditRef.nativeElement)}};D(t,"\u0275fac",function(n){return new(n||t)(_(J),_(Wi),_(Me),_(Ee))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-edit"]],viewQuery:function(n,r){if(n&1&&Ye(Uh,7),n&2){let c;Ie(c=Ae())&&(r.captureEditRef=c.first)}},inputs:{pdfPage:"pdfPage"},standalone:!1,features:[xe([J])],decls:3,vars:2,consts:[["captureEdit",""],[3,"ngStyle"],[4,"ngIf"],[1,"bbox",3,"mousedown","touchstart"],["class","vertex",3,"cursor","mousedown","touchstart",4,"ngFor","ngForOf"],[1,"vertex",3,"mousedown","touchstart"]],template:function(n,r){n&1&&(wi(),I(0,"svg",1,0),se(2,$h,3,6,"g",2),N()),n&2&&(T("ngStyle",r.style.layout),x(2),T("ngIf",r.capturedArea))},dependencies:[Ei,bt,Wt],styles:["svg[_ngcontent-%COMP%]{position:absolute;right:0;top:0;-webkit-user-select:none;user-select:none;width:100%;height:100%;cursor:default;overflow:visible;z-index:10}svg[_ngcontent-%COMP%]   rect.bbox[_ngcontent-%COMP%]{fill:#0000;stroke:var(--primary-50);cursor:move}svg[_ngcontent-%COMP%]   rect.vertex[_ngcontent-%COMP%]{fill:#fff;stroke:var(--primary-50);-webkit-user-select:none;user-select:none;font-size:12px}"],changeDetection:0}));let s=t;return s})();var jh=["captureOverlay"],Wh=["captureClipPath"];function zh(s,t){if(s&1&&(wi(),I(0,"g"),q(1,"line",5)(2,"line",6),N()),s&2){let i=E();x(),ge("y1",i.lastestMousePosition.point.y)("y2",i.lastestMousePosition.point.y)("stroke-dashoffset",-(i.lastestMousePosition.point.x%8)-6)("stroke-width",i.crossHairLineWidth),x(),ge("x1",i.lastestMousePosition.point.x)("x2",i.lastestMousePosition.point.x)("stroke-dashoffset",-(i.lastestMousePosition.point.y%8)-6)("stroke-width",i.crossHairLineWidth)}}var nd=(()=>{let t=class t{subscriptionService;captureService;changeDetectorRef;store$;CROSS_HAIR_LINE_WIDTH=2;pageIndex;captureOverlayRef;captureClipPathRef;lastestMousePosition=null;isCreated=!1;crossHairLineWidth=this.CROSS_HAIR_LINE_WIDTH;get showCrossHair(){return w.isDefined(this.lastestMousePosition)&&this.lastestMousePosition.pageIndex===this.pageIndex&&!this.isCreated}get clipPathId(){return`clip-path-${this.pageIndex}`}constructor(e,n,r,c){this.subscriptionService=e,this.captureService=n,this.changeDetectorRef=r,this.store$=c}ngOnInit(){this.subscriptionService.push(this.store$.pipe($("scale")).subscribe({next:e=>{this.crossHairLineWidth=this.CROSS_HAIR_LINE_WIDTH/ee.normalizeScale(e),this.changeDetectorRef.markForCheck()}}),this.captureService.lastestMousePosition$.subscribe({next:e=>{this.lastestMousePosition=e,this.changeDetectorRef.markForCheck()}}),this.captureService.capturedArea$.pipe(F(e=>e.pageIndex===this.pageIndex),rt(e=>{this.isCreated=e.status!==ei.CREATING&&e.status!==ei.NONE})).subscribe({next:e=>{let n=(k,Z,le,pe)=>{let he=document.createElementNS("http://www.w3.org/2000/svg","rect");return he.setAttribute("x",k),he.setAttribute("y",Z),he.setAttribute("width",le),he.setAttribute("height",pe),he};if(this.captureClipPathRef.nativeElement.innerHTML="",e.status===ei.NONE){let k=n("0","0","100%","100%");this.captureClipPathRef.nativeElement.appendChild(k),this.changeDetectorRef.markForCheck();return}let{x:r,y:c,w:g,h:v}=e.bbox,y=this.captureOverlayRef.nativeElement.clientWidth,M=this.captureOverlayRef.nativeElement.clientHeight;r>0&&this.captureClipPathRef.nativeElement.appendChild(n("0","0",`${r}`,"100%")),c>0&&this.captureClipPathRef.nativeElement.appendChild(n("0","0","100%",`${c}`)),y>r+g&&this.captureClipPathRef.nativeElement.appendChild(n(`${r+g}`,"0",`${y-(r+g)}`,"100%")),M>c+v&&this.captureClipPathRef.nativeElement.appendChild(n("0",`${c+v}`,"100%",`${M-(c+v)}`)),this.changeDetectorRef.markForCheck()}}))}};D(t,"\u0275fac",function(n){return new(n||t)(_(J),_(Wi),_(Me),_(Ee))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-overlay"]],viewQuery:function(n,r){if(n&1&&(Ye(jh,7),Ye(Wh,7)),n&2){let c;Ie(c=Ae())&&(r.captureOverlayRef=c.first),Ie(c=Ae())&&(r.captureClipPathRef=c.first)}},inputs:{pageIndex:"pageIndex"},standalone:!1,features:[xe([J])],decls:8,vars:3,consts:[["captureOverlay",""],["captureClipPath",""],["id","capture-overlay"],["x","0","y","0","width","100%","height","100%"],[4,"ngIf"],["x1","0","x2","100%","stroke","#FFFFFF","stroke-dasharray","4 4"],["y1","0","y2","100%","stroke","#FFFFFF","stroke-dasharray","4 4"]],template:function(n,r){n&1&&(wi(),I(0,"svg",2,0)(2,"defs")(3,"clipPath",null,1),q(5,"rect",3),N()(),q(6,"rect",3),se(7,zh,3,8,"g",4),N()),n&2&&(x(3),ge("id",r.clipPathId),x(3),ge("clip-path","url(#"+r.clipPathId+")"),x(),T("ngIf",r.showCrossHair))},dependencies:[bt],styles:["#capture-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:1}#capture-overlay[_ngcontent-%COMP%]   rect[_ngcontent-%COMP%]{fill:#1e1e1e;fill-opacity:.25}"],changeDetection:0}));let s=t;return s})();var Pa=(()=>{let t=class t{};D(t,"\u0275fac",function(n){return new(n||t)}),D(t,"\u0275mod",ai({type:t})),D(t,"\u0275inj",ri({providers:[Wi],imports:[$i,wn]}));let s=t;return s})();di(Ea,[td,id,nd],[]);function Ms(s){let t,i,e;return typeof s=="object"?(t=s.hashFunction,i=s.expiring,e=s.tags):t=s,(n,r,c)=>{if(c.value!=null)c.value=od(c.value,t,i,e);else if(c.get!=null)c.get=od(c.get,t,i,e);else throw"Only put a Memoize() decorator on a method or get accessor."}}var xc=new Map;function od(s,t,i=0,e){let n=Symbol("__memoized_map__");return function(...r){let c;this.hasOwnProperty(n)||Object.defineProperty(this,n,{configurable:!1,enumerable:!1,writable:!1,value:new Map});let g=this[n];if(Array.isArray(e))for(let v of e)xc.has(v)?xc.get(v).push(g):xc.set(v,[g]);if(t||r.length>0||i>0){let v;t===!0?v=r.map(k=>k.toString()).join("!"):t?v=t.apply(this,r):v=r[0];let y=`${v}__timestamp`,M=!1;if(i>0)if(!g.has(y))M=!0;else{let k=g.get(y);M=Date.now()-k>i}g.has(v)&&!M?c=g.get(v):(c=s.apply(this,r),g.set(v,c),i>0&&g.set(y,Date.now()))}else{let v=this;g.has(v)?c=g.get(v):(c=s.apply(this,r),g.set(v,c))}return c}}var Jo=class Jo{pdfPages;constructor(t){this.pdfPages=t}getPageContainerSize(t,i,e,n){if(!ee.isContinuousMode(t))return this.getRowSize(t,i,e??-1,n);let r=ee.getPageMovement(t);return Array.from({length:this.pdfPages.length}).map((c,g)=>g).filter(c=>c%r===0).map(c=>this.getRowSize(t,i,c)).reduce((c,g)=>({width:Math.max(c.width,g.width),height:c.height+g.height}),{width:0,height:0})}getRowSize(t,i,e,n){let r=ee.getPageMovement(t),c=Math.floor(e/r);return this.pdfPages.slice(c*r,(c+1)*r).reduce((v,y,M)=>{let k=this.getPageSize(i,c*r+M),Z=k.width+(n?0:Jo.HORIZONTAL_MARGIN*2),le=k.height+(n?0:Jo.VERTICAL_MARGIN*2);return{width:v.width+Z,height:Math.max(v.height,le)}},{width:0,height:0})}getPageSize(t,i){if(!this.pdfPages.length)return{width:0,height:0};let e=this.pdfPages[i],n=e.bbox.w,r=e.bbox.h;return(e.r+t)%180!==0&&([n,r]=[r,n]),{width:n,height:r}}getPageFrameOffset(t,i,e,n,r){let c=ee.getPageMovement(t),g=Math.floor(n/c),v=this.getRowSize(t,i,n),y=this.getPageSize(i,n).height+Jo.VERTICAL_MARGIN*2,M={offsetX:0,offsetY:0};if(ee.isContinuousMode(t)){let Z=this.getPageContainerSize(t,i).width;M.offsetX=(Z-v.width)/2,M.offsetY=Array.from({length:g}).reduce((le,pe,he)=>le+this.getRowSize(t,i,he*c).height,0)}let k=(()=>{let Z=Array.from({length:this.pdfPages.length}).map((le,pe)=>pe);return e?Z.slice(n+1,(g+1)*c):Z.slice(g*c,n)})();return M.offsetX+=k.reduce((Z,le)=>{let pe=this.getPageSize(i,le).width+Jo.HORIZONTAL_MARGIN*2;return Z+pe},0),r||(M.offsetY+=(v.height-y)/2),M}};D(Jo,"HORIZONTAL_MARGIN",5),D(Jo,"VERTICAL_MARGIN",5);var Un=Jo;ze([Ms((s,t,i)=>ee.isContinuousMode(s)?`${s}.${t}`:`${s}.${t}.${i-i%ee.getPageMovement(s)}`)],Un.prototype,"getPageContainerSize",null);ze([Ms((s,t,i)=>`${s}.${t}.${i-i%ee.getPageMovement(s)}`)],Un.prototype,"getRowSize",null);ze([Ms((s,t)=>`${s}.${t}`)],Un.prototype,"getPageSize",null);ze([Ms((s,t,i,e)=>`${s}.${t}.${i}.${e}`)],Un.prototype,"getPageFrameOffset",null);var Xr=class{scrollController;rootElement;get currentPageNo(){return this.scrollController.currentPageNo}constructor(t,i){this.scrollController=t,this.rootElement=i}discontinuousOnScroll(t){let i=this.isScrollAtLeft(),e=this.isScrollAtRight(),n=this.isScrollAtTop(t),r=this.isScrollAtBottom(t),c=this.rootElement.scrollTop,g=this.rootElement.scrollLeft,v=t&&t.srcEvent||t;(this.scrollController.isR2L&&i||!this.scrollController.isR2L&&e||r)&&!this.isLastRowPage()?(this.scrollController.moveToNextPage(),v.stopPropagation(),v.preventDefault(),this.scrollController.scrollTo(e?0:g,e?c:0),this.scrollController.fitMode!==null&&this.scrollController.contentService.requestViewChange({fitMode:this.scrollController.fitMode})):(this.scrollController.isR2L&&e||!this.scrollController.isR2L&&i||n)&&!this.isFirstRowPage()&&(this.scrollController.moveToPrevPage(),v.stopPropagation(),v.preventDefault(),this.scrollController.scrollTo(i?this.rootElement.scrollWidth-this.rootElement.scrollLeft:g,i?c:this.rootElement.scrollHeight-this.rootElement.scrollTop),this.scrollController.fitMode!==null&&this.scrollController.contentService.requestViewChange({fitMode:this.scrollController.fitMode}))}isFirstRowPage(){return ee.isTwoPageMode(this.scrollController.viewMode)?this.currentPageNo<3:this.currentPageNo===1}isLastRowPage(){return ee.isTwoPageMode(this.scrollController.viewMode)?this.currentPageNo>=Math.ceil(this.scrollController.pageCount/2)*2-1:this.currentPageNo===this.scrollController.pageCount}};var Ma=class extends Xr{isScrollAtTop(t){return this.rootElement.scrollTop<=0&&t.key==="PageUp"}isScrollAtBottom(t){let i=this.rootElement.offsetHeight,e=this.rootElement.offsetWidth;return this.rootElement.scrollWidth>e&&(i-=15),this.rootElement.scrollHeight-this.rootElement.scrollTop<=i&&t.key==="PageDown"}isScrollAtLeft(){return!1}isScrollAtRight(){return!1}};var Ra=class extends Xr{isScrollAtTop(t){return this.rootElement.scrollTop+t.deltaY<=0&&t.deltaY<0}isScrollAtBottom(t){let i=this.rootElement.offsetHeight,e=this.rootElement.offsetWidth;return this.rootElement.scrollWidth>e&&(i-=15),this.rootElement.scrollHeight-this.rootElement.scrollTop-t.deltaY<=i&&t.deltaY>=0}isScrollAtLeft(){return!1}isScrollAtRight(){return!1}};var zi=(()=>{let t=class t{contentService;store$;documentService;sdContextMenuService;apiEventBridgeService;pageService;annotService;loggingService;stateHolder=null;rootElement;currentViewRectSrc=new Vt(null);currentViewRect$=this.currentViewRectSrc.asObservable();viewScrollSrc=new Oi;viewScroll$=this.viewScrollSrc.asObservable();lastScrollTop=0;lastIndex;viewMode;currentPageNo;pageCount;isR2L;isContextMenuOpened=!1;get currentPageIndex(){return this.currentPageNo-1}wheel$;scroll$;touchStart$;touchMove$;touchEnd$;mouseWheelSub;scrollEdgeSub;windowKeyDownSub;wheelControl;keyDownControl;subs=[];scale=null;jumping;jumpingSrc=new Oi;calcViewRectSrc=new Oi;jumpingOrigin={x:0,y:0};fitMode=null;constructor(e,n,r,c,g,v,y,M){this.contentService=e,this.store$=n,this.documentService=r,this.sdContextMenuService=c,this.apiEventBridgeService=g,this.pageService=v,this.annotService=y,this.loggingService=M,this.store$.pipe($("viewMode")).subscribe({next:k=>this.viewMode=k}),this.store$.pipe($("currentPageNo")).subscribe({next:k=>this.currentPageNo=k}),this.store$.pipe($("pageCount")).subscribe({next:k=>this.pageCount=k}),this.store$.pipe($("isR2L")).subscribe({next:k=>this.isR2L=k}),this.store$.pipe($("fitMode")).subscribe({next:k=>this.fitMode=k}),this.store$.pipe($("scale")).subscribe({next:k=>this.scale=k})}getExportableFunctions(){return[{name:"scrollToPage",function:e=>new Et(n=>{this.viewMode===4&&n.error(new St("Error detail: Not supported in ebook mode"));let r=this.stateHolder.pdfPages,c=e.pageIndex;if(c<0&&(c=r.length+c),c=Math.max(Math.min(c,r.length-1),0),this.lastIndex=void 0,e.centerPoint){let g=aa.deviceToUser({x:e.centerPoint.x??0,y:e.centerPoint.y??0},r[c].r,r[c].bbox.w,r[c].bbox.h);this.contentService.requestViewChange({pageNo:c+1,center:g})}else this.contentService.requestViewChange({pageNo:c+1});n.next(),n.complete()})},{name:"scrollToAnnotation",function:e=>{if(!w.isDefined(this.documentService.openedDocument))throw new Cn("No opened document found.");if(this.viewMode===4)throw new St("Error detail: Not supported in ebook mode");return this.annotService.getAnnotations().pipe(st(n=>{for(let r of n)for(let c of r){if(w.isDefined(e.oid)&&c.oid===e.oid)return dt(c);if(w.isDefined(e.name)&&w.isDefined(e.pageIndex)&&c.attributes.pageIdx===e.pageIndex&&c.attributes.NM===e.name)return dt(c)}throw new Cs("Cannot find annotation")}),st(n=>{let r=n.attributes.pageIdx,c=n.attributes.rect;return new Et(g=>{this.contentService.requestViewChange({pageNo:r+1,center:{x:(c.left+c.right)/2,y:(c.top+c.bottom)/2}}),e.select&&this.contentService.fireAnnotEvent({sdEventType:an.SELECTED,annot:n}),g.next(),g.complete()})}))}}]}getExportableEvents(){return[{type:"scrollPositionChange",subject:this.apiEventBridgeService.handleResultObservable(this.apiEventBridgeService.scrollEventSrc).pipe(Ue(e=>({position:e.position})))},{type:"currentReadingPageChange",subject:this.apiEventBridgeService.currentReadingPageChange$.pipe(Ue(e=>({pageInfos:e.pageInfos})))}]}start(e,n){this.loggingService.common("debug",Le.STARTED,"scroll service"),this.wheelControl=new Ra(this,n),this.keyDownControl=new Ma(this,n),this.stateHolder=e,this.rootElement=n,this.wheel$=Ge(this.rootElement,"wheel",{passive:!0}),this.scroll$=Ge(this.rootElement,"scroll",{passive:!0}),this.touchStart$=Ge(this.rootElement,"touchstart"),this.touchMove$=Ge(this.rootElement,"touchmove",{passive:!0}),this.touchEnd$=Ge(this.rootElement,"touchend",{passive:!0}),this.subscribeEvents()}stop(){this.loggingService.common("debug",Le.STOPPED,"scroll service"),Xi.unsubscribe(this.scrollEdgeSub,this.mouseWheelSub,this.windowKeyDownSub,...this.subs),this.subs.splice(0),this.stateHolder=null,this.scale=null}publishScrollEvent(e){this.viewScrollSrc.next(e)}moveToPage(e){let n=ee.getNextPageNo(e,this.viewMode,this.pageCount);this.contentService.requestViewChange({pageNo:n})}moveToPrevPage(){let e=ee.getPageMovement(this.viewMode);this.moveToPage(this.currentPageNo-e)}moveToNextPage(){let e=ee.getPageMovement(this.viewMode);this.moveToPage(this.currentPageNo+e)}scrollTo(e,n){if(!w.isDefined(this.rootElement)){this.loggingService.common("debug",Le.NOT_EXIST,"rootElement","Call start() first.");return}this.lockScrollEvent(),this.rootElement.scrollLeft=e,this.rootElement.scrollTop=n,this.releaseScrollEvent()}updateReadStatus(){if(!w.isDefined(this.rootElement)){this.loggingService.common("debug",Le.NOT_EXIST,"rootElement","Call start() first.");return}if(ee.isContinuousMode(this.viewMode)){let e=ee.normalizeScale(this.scale),n=this.rootElement.scrollTop/e,r=(this.rootElement.scrollTop+this.rootElement.clientHeight)/e,c=[],g=M=>{if(!w.isDefined(this.stateHolder))throw new Xt("stateHolder is undefined. Call start() first.");let k=this.stateHolder.getPageFrameOffset(this.viewMode,M),Z=this.stateHolder.getPageSize(M),le=k.offsetY,pe=k.offsetY+Z.height+Un.VERTICAL_MARGIN*2,he=Math.max(n,le),Te=Math.min(r,pe);return he+1<Te};g(this.currentPageIndex)&&this.pageService.pdfPages.length&&c.push(this.pageService.pdfPages[this.currentPageIndex]);for(let M=this.currentPageIndex-1;0<M&&g(M);M--)c.unshift(this.pageService.pdfPages[M]);for(let M=this.currentPageIndex+1;M<this.pageService.pdfPages.length&&g(M);M++)c.push(this.pageService.pdfPages[M]);let v=[];if(this.lastIndex!==void 0&&c.length)if(this.lastScrollTop-n<0)for(let k=this.lastIndex;k<c[c.length-1].i;k++)v.push(k);else for(let k=this.lastIndex;k>c[c.length-1].i;k--)v.push(k);this.lastIndex=c[c.length-1]?.i,this.lastScrollTop=n;let y=c.concat(v.map(M=>this.pageService.pdfPages[M]).filter(M=>!!M)).filter((M,k,Z)=>Z.indexOf(M)===k).sort((M,k)=>M.i-k.i);y.forEach(M=>M.read=!0),this.apiEventBridgeService.currentReadingPageChangeSrc.next({ok:!0,data:{pageInfos:y.map(({i:M})=>({pageIndex:M}))}})}else if(this.viewMode===4){let e=ee.getEbookPageNo(this.currentPageNo);if(e===1){let n=this.pageService.pdfPages.find(({i:r})=>e-1===r);n.read=!0,this.apiEventBridgeService.currentReadingPageChangeSrc.next({ok:!0,data:{pageInfos:[{pageIndex:0}]}})}else{let n=[{pageIndex:e-1}];e<this.pageCount&&n.push({pageIndex:e}),n.forEach(({pageIndex:r})=>this.pageService.pdfPages.find(({i:c})=>r===c).read=!0),this.apiEventBridgeService.currentReadingPageChangeSrc.next({ok:!0,data:{pageInfos:n}})}}else{let e=[this.currentPageIndex];ee.isTwoPageMode(this.viewMode)&&this.currentPageIndex<this.pageCount-1&&e.push(this.currentPageIndex+(this.currentPageIndex%2===0?1:-1));let n=e.filter((r,c,g)=>g.indexOf(r)===c).sort((r,c)=>r-c);n.forEach(r=>this.pageService.pdfPages.find(({i:c})=>r===c).read=!0),this.apiEventBridgeService.currentReadingPageChangeSrc.next({ok:!0,data:{pageInfos:n.map(r=>({pageIndex:r}))}})}}subscribeEvents(){this.subscribeMouseWheel(),this.subscribeScroll(),this.subscribeWindowKeyDown(),this.subscribeOverscroll(),this.subs.push(this.sdContextMenuService.contextMenuStatus$.subscribe({next:e=>this.isContextMenuOpened=e}),this.jumpingSrc.pipe(ni(100)).subscribe({next:()=>this.jumping=!1}),ut(this.calcViewRectSrc,G.windowResize$,this.store$.pipe($("sideViewVisible")),this.store$.pipe($("sideViewSize")),this.store$.pipe($("rightSideViewVisible")),this.store$.pipe($("rightSideViewSize"))).pipe(Sl(25)).subscribe({next:e=>{e&&this.calculateViewRect()}}),lr(1e3).subscribe({next:()=>{this.updateReadStatus()}}))}subscribeOverscroll(){if(!w.isDefined(this.wheel$)||!w.isDefined(this.scroll$)||!w.isDefined(this.touchStart$)||!w.isDefined(this.touchMove$)||!w.isDefined(this.touchEnd$)){this.loggingService.common("debug",Le.NOT_EXIST,"Event handlers","Call start() first.");return}this.subs.push((()=>{let e=Ze.scrollPositionDetectionSensitivity,n=[],r;return this.wheel$.pipe(this.scrollDetectableStatusFilter(),F(()=>this.viewMode!==4)).subscribe({next:c=>{this.isContextMenuOpened&&this.sdContextMenuService.publishContextMenuStatus(!1),this.isTop()&&c.deltaY<0?n.push("top"):this.isBottom()&&c.deltaY>0&&n.push("bottom"),clearTimeout(r),r=G.nativeWindow.setTimeout(()=>{n.length<3||(this.isTop()&&n.every(g=>g==="top")?this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"topover"}}):this.isBottom()&&n.every(g=>g==="bottom")&&this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"bottomover"}}),n.splice(0))},e)}})})(),G.windowKeyDown$.pipe(this.scrollDetectableStatusFilter(),F(()=>this.viewMode!==4)).subscribe({next:e=>{this.isTop()&&e.key==="PageUp"?this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"topover"}}):this.isBottom()&&e.key==="PageDown"&&this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"bottomover"}})}}),...(()=>{let n=0,r=0,c=0,g=0,v=0,y=0,M=0,k=0;return[this.touchStart$.pipe(F(()=>this.viewMode!==4)).subscribe({next:Z=>{if(!w.isDefined(this.rootElement)){this.loggingService.common("debug",Le.NOT_EXIST,"rootElement","Call start() first.");return}n=this.rootElement.scrollTop,r=this.rootElement.scrollLeft;let le=Z.touches[0];c=le.clientY,g=le.clientX,M=this.scale}}),this.touchMove$.pipe(F(()=>this.viewMode!==4)).subscribe({next:Z=>{let le=Z.touches[0];v=c-le.clientY,y=g-le.clientX,k=M-this.scale}}),this.touchEnd$.pipe(F(()=>this.viewMode!==4),F(()=>!this.stateHolder?.isSlideshow)).subscribe({next:()=>{if(!w.isDefined(this.stateHolder)){this.loggingService.common("debug",Le.NOT_EXIST,"stateHolder","Call start() first.");return}if(!w.isDefined(this.rootElement)){this.loggingService.common("debug",Le.NOT_EXIST,"rootElement","Call start() first.");return}if(!(Math.abs(k)>0)){if(Math.abs(y)>Math.abs(v)){if(ee.isContinuousMode(this.viewMode))return;if(r+y/4<=0){if(this.currentPageNo>1){let Z=this.rootElement.scrollTop;this.moveToPrevPage(),this.rootElement.scrollLeft=this.rootElement.scrollWidth,this.rootElement.scrollTop=Z}}else if(r+this.rootElement.offsetWidth+y/4>=this.rootElement.scrollWidth&&this.currentPageNo<this.stateHolder.pdfPages.length){let Z=this.rootElement.scrollTop;this.moveToNextPage(),this.rootElement.scrollTop=Z}}else if(n+v/4<=0){if(this.currentPageNo===1)this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"topover"}});else if(!ee.isContinuousMode(this.viewMode)){let Z=this.rootElement.scrollLeft;this.moveToPrevPage(),this.rootElement.scrollTop=this.rootElement.scrollHeight,this.rootElement.scrollLeft=Z}}else if(n+this.rootElement.offsetHeight+v/4>=this.rootElement.scrollHeight){if(this.currentPageNo>=this.stateHolder.pdfPages.length)this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"bottomover"}});else if(!ee.isContinuousMode(this.viewMode)){let Z=this.rootElement.scrollLeft;this.moveToNextPage(),this.rootElement.scrollLeft=Z}}}}})]})())}subscribeScroll(){if(!w.isDefined(this.scroll$)){this.loggingService.common("debug",Le.NOT_EXIST,"scroll$","Call start() first.");return}w.isDefined(this.scrollEdgeSub)&&Xi.unsubscribe(this.scrollEdgeSub),this.scrollEdgeSub=dt(this.scroll$.pipe(rt(()=>{this.stateHolder&&this.updateReadStatus()})),this.store$.pipe($("scale"))).pipe(F(()=>this.viewMode!==4),vl(),ni(10),this.scrollDetectableStatusFilter(),Ue(()=>this.isBottom()?"bottom":this.isTop()?"top":"reset"),Yn(),F(e=>e!=="reset")).subscribe({next:e=>this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:e}})})}scrollDetectableStatusFilter(){return e=>e.pipe(F(()=>{let n=this.currentPageNo===this.pageCount,r=this.currentPageNo===1&&this.currentPageNo<this.pageCount,c=this.currentPageNo===this.pageCount&&this.pageCount>1;return!(!ee.isContinuousMode(this.viewMode)&&(!r&&!c&&!n||r&&this.isBottom()||c&&this.isTop()))}))}subscribeMouseWheel(){if(!w.isDefined(this.wheel$)){this.loggingService.common("debug",Le.NOT_EXIST,"wheel$","Call start() first.");return}w.isDefined(this.mouseWheelSub)&&Xi.unsubscribe(this.mouseWheelSub),this.mouseWheelSub=this.wheel$.pipe(ni(50),F(e=>!e.ctrlKey&&!e.metaKey),F(()=>!this.jumping&&!ee.isContinuousMode(this.viewMode))).subscribe({next:e=>this.wheelControl.discontinuousOnScroll(e)})}subscribeWindowKeyDown(){w.isDefined(this.windowKeyDownSub)&&Xi.unsubscribe(this.windowKeyDownSub),this.windowKeyDownSub=G.windowKeyDown$.pipe(F(()=>!this.stateHolder?.isSlideshow),F(()=>!ee.isContinuousMode(this.viewMode))).subscribe({next:e=>this.keyDownControl.discontinuousOnScroll(e)})}lockScrollEvent(){this.jumping=!0}releaseScrollEvent(){this.jumpingSrc.next(!1)}calculateViewRect(){if(this.viewMode===4)return;let e=this.currentPageIndex,n=ee.getPageMovement(this.viewMode)-1,r=this.stateHolder,c=ee.normalizeScale(this.scale),g=y=>{if(!w.isDefined(this.rootElement)){this.loggingService.common("debug",Le.NOT_EXIST,"rootElement","Call start() first.");return}if(!w.isDefined(r?.pdfPages[y]))return;let M=r.getPageFrameOffset(this.viewMode,y),{width:k,height:Z}=r.getPageSize(y),le=Math.round(M.offsetX),pe=Math.round(M.offsetY),he=Math.round(le+k),Te=Math.round(pe+Z),p=Math.round(this.rootElement.scrollLeft/c),ht=Math.round(p+this.rootElement.clientWidth/c),_t=Math.round(this.rootElement.scrollTop/c),gt=Math.round(_t+this.rootElement.clientHeight/c);return{x:Math.max(p-le,0),y:Math.max(_t-pe,0),w:Math.max(Math.min(ht,he)-Math.max(p,le),0),h:Math.max(Math.min(gt,Te)-Math.max(_t,pe),0)}},v={idx:e,rect:g(e)};if(v.rect){if(n===1){let y=e+(e%2===0?1:-1),M=g(y);M&&M.w*M.h>v.rect.w*v.rect.h&&(v.rect=M,v.idx=y,this.currentPageNo!==v.idx+1&&this.contentService.requestViewChange({pageNo:v.idx+1}))}this.currentViewRectSrc.next(v)}}isTop(){return w.isDefined(this.rootElement)&&this.rootElement.scrollTop<=0}isBottom(){return w.isDefined(this.rootElement)&&Math.ceil(this.rootElement.scrollTop)+this.rootElement.offsetHeight>=this.rootElement.scrollHeight}};D(t,"\u0275fac",function(n){return new(n||t)(ke(at),ke(Ee),ke(ct),ke(qo),ke(Zt),ke(Yt),ke(li),ke(Ai))}),D(t,"\u0275prov",oi({token:t,factory:t.\u0275fac}));let s=t;return s})();var Kr=(()=>{let t=class t{logoWidth=100;logoHeight=24;logoDataURLSrc=new Vt(null);logoDataURL$=this.logoDataURLSrc.asObservable();getExportableFunctions(){return[{name:"setLogo",function:e=>new Et(n=>{let r=new Image;r.onload=()=>{let c=document.createElement("canvas"),g=c.getContext("2d"),v=Math.min(this.logoWidth/r.naturalWidth,this.logoHeight/r.naturalHeight),y=r.naturalWidth*v,M=r.naturalHeight*v;if(c.width=y,c.height=M,!w.isDefined(g)){this.logoDataURLSrc.next(null),n.error(new St("Failed to get CanvasRenderingContext2D"));return}g.drawImage(r,0,0,y,M),this.logoDataURLSrc.next(c.toDataURL("image/png")),n.next(void 0)},r.onerror=c=>{this.logoDataURLSrc.next(null),n.error(c)},r.src=e.url}).pipe(ml(1e3),dr(n=>{throw n instanceof fl?new Hl("Something was wrong :("):new St(n)}))}]}get isLogoVisible(){return this.logoDataURLSrc.value!==null}};D(t,"\u0275fac",function(n){return new(n||t)}),D(t,"\u0275prov",oi({token:t,factory:t.\u0275fac}));let s=t;return s})();var mr=class mr{documentService;productService;quickActionService;store$;translatePipe;viewerService;isPanelOpened=!1;selectedPanel=null;panelMenuSrc=new Vt([]);panelMenu$=this.panelMenuSrc.asObservable();hiddenPanel={};customPanelMenus=null;viewMode=void 0;subToolbar=null;constructor(t,i,e,n,r,c){this.documentService=t,this.productService=i,this.quickActionService=e,this.store$=n,this.translatePipe=r,this.viewerService=c,this.panelMenuSrc.next(this.buildPanel()),this.initRegisterQuickActions(),this.store$.pipe($("sideViewMode")).subscribe({next:g=>{this.selectedPanel=g,this.isRedactionPanel(this.selectedPanel)&&this.subToolbar!==lt.REDACT&&this.viewerService.openSubToolbar(lt.REDACT),!this.isRedactionPanel(this.selectedPanel)&&this.subToolbar===lt.REDACT&&this.viewerService.closeSubToolbar()}}),this.store$.pipe($("sideViewVisible")).subscribe({next:g=>{this.isPanelOpened=g,!this.isPanelOpened&&this.isRedactionPanel(this.selectedPanel)&&this.subToolbar===lt.REDACT&&this.viewerService.closeSubToolbar()}}),this.store$.pipe(fi([B.SIDE_VIEW,B.SIDE_VIEW_THUMBNAIL,B.SIDE_VIEW_BOOKMARK,B.SIDE_VIEW_ANNOTATION,B.SIDE_VIEW_REDACTION,B.SIDE_VIEW_EMBEDDED_FILE,B.SIDE_VIEW_EMBEDDED_FILE,B.SIDE_VIEW_SIGNATURE])).subscribe({next:g=>{Object.assign(this.hiddenPanel,g),this.panelMenuSrc.next(this.buildPanel()),this.isPanelOpened&&ee.isOpenedHiddenView(this.hiddenPanel,this.selectedPanel)&&this.store$.dispatch(ue.set({key:"sideViewVisible",value:!1}))}}),this.store$.pipe($("viewMode")).subscribe({next:g=>this.viewMode=g}),this.viewerService.subToolbar$.pipe(F(g=>this.subToolbar!==g)).subscribe({next:g=>{g===lt.REDACT?(this.subToolbar=g,this.isRedactionPanel(this.selectedPanel)||this.store$.dispatch(ue.set({key:"sideViewMode",value:De.Redaction})),this.isPanelOpened||this.store$.dispatch(ue.set({key:"sideViewVisible",value:!0}))):this.subToolbar===lt.REDACT&&this.isRedactionPanel(this.selectedPanel)?(this.subToolbar=g,this.store$.dispatch(ue.set({key:"sideViewVisible",value:!1}))):this.subToolbar=g}})}getExportableFunctions(){return[{name:"defineDocumentPanel",noNeedDocumentLoaded:!0,hasCallback:!0,function:t=>{let i=t.items.map(e=>({label:e.label,icon:e.icon,command:e.onclick}));return this.customPanelMenus=[{items:i}],this.panelMenuSrc.next(this.buildPanel()),dt(void 0)}}]}buildPanel(){let t={items:[]};return this.hiddenPanel[B.SIDE_VIEW]?[t]:this.customPanelMenus?this.customPanelMenus:(K.get(ie.THUMBNAIL_VIEW_BUTTON)&&!this.hiddenPanel[B.SIDE_VIEW_THUMBNAIL]&&t.items.push({label:this.translatePipe.transform("THUMBNAIL"),icon:Ln.THUMBNAIL,command:()=>this.onPanelSelectForStatistics(fe.THUMBNAIL_VIEW,De.Thumbnail),data:De.Thumbnail}),K.get(ie.OUTLINE_VIEW_BUTTON)&&!this.isDAP&&!this.hiddenPanel[B.SIDE_VIEW_BOOKMARK]&&t.items.push({label:this.translatePipe.transform("OUTLINE"),icon:Ln.OUTLINE,command:()=>this.onPanelSelectForStatistics(fe.OUTLINE_VIEW,De.Outline),data:De.Outline}),this.productService.isStreamDocs&&!this.isDAP&&!this.isEbookMode&&K.get(ie.ANNOTATION_VIEW_BUTTON)&&this.documentService.checkAuthority(Ne.ANNOTATION)&&!this.hiddenPanel[B.SIDE_VIEW_ANNOTATION]&&t.items.push({label:this.translatePipe.transform("ANNOTATION_LIST"),icon:Ln.ANNOTATION,command:()=>this.onPanelSelectForStatistics(fe.ANNOTATION_VIEW,De.Annotation),data:De.Annotation}),this.isStreamDocs&&!this.isDAP&&!this.isEbookMode&&K.get(ie.REDACTION_VIEW_BUTTON)&&this.documentService.checkAuthority(Ne.ANNOTATION)&&!this.hiddenPanel[B.SIDE_VIEW_REDACTION]&&t.items.push({label:this.translatePipe.transform("REDACT"),icon:Ln.REDACTION,command:()=>this.onPanelSelectForStatistics(fe.REDACTION_VIEW,De.Redaction),data:De.Redaction}),K.get(ie.EMBEDDED_FILE_VIEW_BUTTON)&&this.isStreamDocs&&!this.isDAP&&!this.hiddenPanel[B.SIDE_VIEW_EMBEDDED_FILE]&&t.items.push({label:this.translatePipe.transform("EMBEDDED_FILE"),icon:Ln.EMBEDDED_FILE,command:()=>this.onPanelSelectForStatistics(fe.EMBEDDEDFILE_VIEW,De.EmbeddedFile),data:De.EmbeddedFile}),!this.isDAP&&!this.isEbookMode&&K.get(ie.FORM_VIEW_BUTTON)&&this.documentService.checkAuthority(Ne.FORM)&&!this.hiddenPanel[B.SIDE_VIEW_FORM]&&t.items.push({label:this.translatePipe.transform("FORM_TOOL"),icon:Ln.FORM,command:()=>this.onPanelSelectForStatistics(fe.FORM_VIEW,De.Form),data:De.Form}),K.get(ie.SIGNATURE_VIEW_BUTTON)&&!this.isDAP&&!this.isEbookMode&&!this.hiddenPanel[B.SIDE_VIEW_SIGNATURE]&&t.items.push({label:this.translatePipe.transform("SIGNATURE_LIST"),icon:Ln.SIGNATURE,command:()=>this.onPanelSelectForStatistics(fe.SIGNATURE_VIEW,De.Signature),data:De.Signature}),[t])}isOpened(t){return this.selectedPanel===t&&this.isPanelOpened}onPanelSelectForStatistics(t,i){this.onPanelSelect(i)}onPanelSelect(t){this.selectedPanel===t?this.store$.dispatch(ue.set({key:"sideViewVisible",value:!this.isPanelOpened})):(this.store$.dispatch(ue.set({key:"sideViewMode",value:t})),this.store$.dispatch(ue.set({key:"sideViewVisible",value:!0})))}get isDAP(){return this.documentService.isDAP}get isStreamDocs(){return this.productService.isStreamDocs}get isEbookMode(){return this.viewMode===4}isRedactionPanel(t){return t?[De.Redaction,De.SearchingRedaction].includes(t):!1}initRegisterQuickActions(){this.quickActionService.registerActions([{id:Se.THUMBNAIL,actionFn:()=>this.onPanelSelectForStatistics(fe.OPEN_THUMBNAIL_BY_QUICK_SEARCH,De.Thumbnail)},{id:Se.OUTLINE,actionFn:()=>this.onPanelSelectForStatistics(fe.OPEN_OUTLINE_BY_QUICK_SEARCH,De.Outline)},{id:Se.ANNOTATION_LIST,actionFn:()=>this.onPanelSelectForStatistics(fe.OPEN_ANNOTBYION_LIST_BY_QUICK_SEARCH,De.Annotation)},{id:Se.REDACT,actionFn:()=>this.onPanelSelectForStatistics(fe.OPEN_REDACT_BY_QUICK_SEARCH,De.Redaction)},{id:Se.EMBEDDED_FILE,actionFn:()=>this.onPanelSelectForStatistics(fe.OPEN_EMBEDDED_FILE_BY_QUICK_SEARCH,De.EmbeddedFile)},{id:Se.FORM_TOOL,actionFn:()=>this.onPanelSelectForStatistics(fe.OPEN_FORM_TOOL_BY_QUICK_SEARCH,De.Form)},{id:Se.SIGNATURE_LIST,actionFn:()=>this.onPanelSelectForStatistics(fe.OPEN_SIGNATURE_LIST_BY_QUICK_SEARCH,De.Signature)}])}};D(mr,"\u0275fac",function(i){return new(i||mr)(ke(ct),ke(Lr),ke(ln),ke(Ee),ke(He),ke(Jt))}),D(mr,"\u0275prov",oi({token:mr,factory:mr.\u0275fac}));var Po=mr;ze([ot(it.mainToolbarComp.onSideViewMenuSelectForStatistics)],Po.prototype,"onPanelSelectForStatistics",null);var Ia=(()=>{let t=class t{getExportableEvents(){return[{type:"keydown",subject:G.windowKeyDown$.pipe(Ue(e=>{let n={};return Oo.getAllPropertyNames(e).forEach(r=>{Jn.hasKey(e,r)&&(e[r]===G.nativeWindow||e[r]instanceof Node||r==="path"||(n[r]=e[r]))}),{event:JSON.parse(JSON.stringify(n))}}))},{type:"keyup",subject:G.windowKeyUp$.pipe(Ue(e=>{let n={};return Oo.getAllPropertyNames(e).forEach(r=>{Jn.hasKey(e,r)&&(e[r]===G.nativeWindow||e[r]instanceof Node||r==="path"||(n[r]=e[r]))}),{event:JSON.parse(JSON.stringify(n))}}))},{type:"mousedown",subject:G.windowMousedown$.pipe(Ue(e=>({event:Zn.simplifyMouseEvent(e)})))},{type:"mouseup",subject:G.windowMouseUp$.pipe(Ue(e=>({event:Zn.simplifyMouseEvent(e)})))},{type:"pointerdown",subject:G.windowPointerDown$.pipe(Ue(e=>({event:Zn.simplifyPointerEvent(e)})))},{type:"pointerup",subject:G.windowPointerUp$.pipe(Ue(e=>({event:Zn.simplifyPointerEvent(e)})))}]}};D(t,"\u0275fac",function(n){return new(n||t)}),D(t,"\u0275prov",oi({token:t,factory:t.\u0275fac}));let s=t;return s})();var s_=(()=>{let t=class t{static forRoot(){return{ngModule:t,providers:[Ia]}}};D(t,"\u0275fac",function(n){return new(n||t)}),D(t,"\u0275mod",ai({type:t})),D(t,"\u0275inj",ri({}));let s=t;return s})();var qr=(()=>{let t=class t{portalService;selectTextService;menusSrc=new Vt([]);menus$=this.menusSrc.asObservable();_outlet;portalRef;constructor(e,n){this.portalService=e,this.selectTextService=n,this.selectTextService.publishSelectedText$.subscribe({next:r=>{w.isDefined(r)?this.open():this.close()}})}getExportableFunctions(){return[{name:"defineTextSelectionMenu",hasCallback:!0,function:e=>(this.menusSrc.next(e.menus),dt(void 0))}]}set outlet(e){this._outlet=e}open(){if(!this._outlet)throw new Xt("Text Selection Menu outlet is not set.");this.portalRef||(this.portalRef=this.portalService.create(this._outlet,ad))}close(){this.portalRef&&(this.portalRef.dispose(),this.portalRef=void 0)}};D(t,"\u0275fac",function(n){return new(n||t)(ke(ra),ke(cn))}),D(t,"\u0275prov",oi({token:t,factory:t.\u0275fac}));let s=t;return s})();var qh=(s,t)=>t.label,Qh=s=>({content:s});function Zh(s,t){if(s&1){let i=ve();I(0,"div",3),ae("click",function(){j(i);let n=E().$implicit;return W(n.onclick==null?null:n.onclick())}),I(1,"div",4),q(2,"i"),N(),I(3,"span",5),_e(4),N()()}if(s&2){let i=E().$implicit;T("tooltip",vt(4,Qh,i.label)),x(2),Kn(i.icon),x(2),we(i.label)}}function Jh(s,t){if(s&1){let i=ve();I(0,"div",6),ae("click",function(){j(i);let n=E().$implicit;return W(n.onclick==null?null:n.onclick())}),I(1,"div",4),q(2,"i"),N(),I(3,"span",5),_e(4),N()()}if(s&2){let i=E().$implicit;x(2),Kn(i.icon),x(2),we(i.label)}}function eu(s,t){if(s&1&&se(0,Zh,5,6,"div",1)(1,Jh,5,3,"div",2),s&2){let i=E(2);Ut(i.menus.length>1?0:1)}}function tu(s,t){if(s&1&&(I(0,"div",0),Al(1,eu,2,1,null,null,qh),N()),s&2){let i=E();T("ngStyle",i.menuContainerStyle),x(),Dl(i.menus)}}var ad=(()=>{let t=class t{changeDetectorRef;selectTextService;subscriptionService;textSelectionMenuService;menus=[];menuContainerStyle={};MENU_ITEM_HEIGHT=42;MENU_GAP=12;constructor(e,n,r,c){this.changeDetectorRef=e,this.selectTextService=n,this.subscriptionService=r,this.textSelectionMenuService=c}ngOnInit(){this.subscriptionService.push(this.textSelectionMenuService.menus$.subscribe(e=>{this.menus=e,this.changeDetectorRef.markForCheck()}),this.selectTextService.publishSelectedText$.pipe(F(w.isDefined)).subscribe({next:e=>{let n=e.comp.selectedPathElementRef?.nativeElement.getBoundingClientRect();if(!n)throw new Xt("Selected Path Element is not defined.");this.menuContainerStyle={left:`${n.left+n.width/2}px`,top:`${n.top-this.MENU_ITEM_HEIGHT-this.MENU_GAP}px`,transform:"translateX(-50%)"}}}))}};D(t,"\u0275fac",function(n){return new(n||t)(_(Me),_(cn),_(J),_(qr))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-text-selection-menu"]],standalone:!1,features:[xe([J])],decls:1,vars:1,consts:[[1,"text-selection-menu",3,"ngStyle"],[1,"menu-item",3,"tooltip"],[1,"menu-item"],[1,"menu-item",3,"click","tooltip"],[1,"icon-box"],[1,"text"],[1,"menu-item",3,"click"]],template:function(n,r){n&1&&se(0,tu,3,1,"div",0),n&2&&Ut(r.menus.length>0?0:-1)},dependencies:[Wt,Dn],styles:["[_nghost-%COMP%]{position:absolute;top:0;left:0}.text-selection-menu[_ngcontent-%COMP%]{display:flex;position:absolute;padding:4px;gap:4px;z-index:2;border:1px solid var(--mono-30);box-shadow:0 4px 8px color-mix(in srgb,var(--mono-70) 12%,transparent);border-radius:8px;background-color:var(--mono-00)}.text-selection-menu[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]{display:flex;gap:2px;align-items:center;cursor:pointer;font-size:13px;line-height:22px;font-family:NotoSans-Medium,sans-serif;line-height:1}.text-selection-menu[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]   .icon-box[_ngcontent-%COMP%]{padding:4px;border-radius:6px;color:var(--mono-90)}.text-selection-menu[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{margin-right:7px;white-space:nowrap;color:var(--mono-99)}.text-selection-menu[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]:hover   .icon-box[_ngcontent-%COMP%], .text-selection-menu[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]:hover   .text[_ngcontent-%COMP%]{color:#828282}.text-selection-menu[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]:not(:only-child)   .text[_ngcontent-%COMP%]{display:none}"],changeDetection:0}));let s=t;return s})();var M_=(()=>{let t=class t{static forRoot(){return{ngModule:t,providers:[qr]}}};D(t,"\u0275fac",function(n){return new(n||t)}),D(t,"\u0275mod",ai({type:t})),D(t,"\u0275inj",ri({providers:[ra],imports:[$i,da]}));let s=t;return s})();var ld=gl(Nh());function iu(s,t){if(s&1&&(I(0,"div",9)(1,"div",10),_e(2),Y(3,"translate"),N(),I(4,"div",11),_e(5),N()()),s&2){let i=E(2);x(2),we(X(3,2,"ERROR_CODE")),x(3),we(i.errorCode)}}function nu(s,t){if(s&1&&(I(0,"div",9)(1,"div",10),_e(2),Y(3,"translate"),N(),I(4,"div",11),_e(5),N()()),s&2){let i=E(2);x(2),we(X(3,2,"DOCUMENT_ID")),x(3),we(i.streamdocsId)}}function ou(s,t){if(s&1&&(q(0,"img",7),Y(1,"translate"),I(2,"span",8),_e(3),Y(4,"translate"),N(),I(5,"div",9)(6,"div",10),_e(7),Y(8,"translate"),N(),I(9,"div",11),_e(10),N()(),se(11,iu,6,4,"div",12)(12,nu,6,4,"div",12)),s&2){let i=E();ge("src",i.illustImageSrc,Sn)("alt",X(1,7,"ERROR_PAGE_ILLUST")),x(3),we(X(4,9,"APOLOGY_FOR_INCONVENIENCE")),x(4),we(X(8,11,"OCCURRED_DATE")),x(3),we(i.occurredDate),x(),T("ngIf",i.errorCode),x(),T("ngIf",i.streamdocsId)}}function ru(s,t){if(s&1&&(q(0,"img",13),Y(1,"translate"),q(2,"img",14),Y(3,"translate"),I(4,"div",9)(5,"div",10),_e(6),Y(7,"translate"),N(),I(8,"div",11),_e(9),Y(10,"translate"),N()()),s&2){let i=E();ge("src",i.messageImageSrc,Sn)("alt",X(1,6,"ERROR_STATUS_ILLUST")),x(2),ge("src",i.illustImageSrc,Sn)("alt",X(3,8,"ERROR_PAGE_ILLUST")),x(4),we(X(7,10,"INFO")),x(3),we(X(10,12,"ERROR_PAGES_"+(i.errorCode||i.statusCode)))}}function su(s,t){if(s&1&&(I(0,"div",15)(1,"a",16),q(2,"img"),Y(3,"translate"),I(4,"span"),_e(5),N()()()),s&2){let i=E();x(),T("href","tel:"+i.environment.errorPage.telephone,Sn),x(),ge("src",i.callImageSrc,Sn)("alt",X(3,4,"SUPPORT_TELEPHONE")),x(3),we(i.environment.errorPage.telephone)}}function au(s,t){if(s&1&&(I(0,"div",17)(1,"a",18),q(2,"i",19),I(3,"span"),_e(4),N()()()),s&2){let i=E();x(),T("href",i.environment.errorPage.link,Sn),x(3),we(i.environment.errorPage.linkLabel||i.environment.errorPage.link)}}var U_=(()=>{let t=class t{activatedRoute;changeDetectorRef;contentService;subscriptionService;documentService;viewerService;productService;get environment(){return Ze}assetDir="assets/images/error-pages";statusCode=Yr.NOT_FOUND;errorCode;get logoImageSrc(){return`${this.assetDir}/logo.svg`}get messageImageSrc(){return`${this.assetDir}/${this.statusCode}_message.svg`}get illustImageSrc(){return this.isErrorCode?`${this.assetDir}/error_code_illust.svg`:`${this.assetDir}/${this.statusCode}_illust.svg`}get callImageSrc(){return`${this.assetDir}/call.svg`}get isErrorCode(){return w.isDefined(this.statusCode)&&!Object.values(Yr).includes(this.statusCode)||this.statusCode===Yr.INTERNAL_SERVER_ERROR&&w.isDefined(this.errorCode)}get occurredDate(){return(0,ld.default)(new Date).format("YYYY. MM. DD. HH:mm:ss")}get streamdocsId(){return this.documentService.openedDocument?.streamdocsId}get isStreamdocs(){return this.productService.isStreamDocs}constructor(e,n,r,c,g,v,y){this.activatedRoute=e,this.changeDetectorRef=n,this.contentService=r,this.subscriptionService=c,this.documentService=g,this.viewerService=v,this.productService=y}ngOnInit(){this.initSubscriptions(),this.viewerService.loadComplete(),this.contentService.togglePageLoader(!1)}initSubscriptions(){this.subscriptionService.push(this.activatedRoute.paramMap.pipe(Ue(e=>({statusCode:parseInt(String(e.get("statusCode"))),errorCode:e.get("errorCode")})),F(e=>w.isDefined(e.statusCode))).subscribe({next:e=>{this.statusCode=Number.isNaN(e.statusCode)?null:e.statusCode,this.errorCode=e.errorCode,this.changeDetectorRef.markForCheck()}}))}};D(t,"\u0275fac",function(n){return new(n||t)(_(Ul),_(Me),_(at),_(J),_(ct),_(Jt),_(Lr))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-error-pages"]],standalone:!1,features:[xe([J])],decls:11,vars:11,consts:[["statusRef",""],[1,"logo-image"],[3,"ngIf","ngIfElse"],[1,"enquiry-box"],[1,"call-box-header"],["class","call-box",4,"ngIf"],["class","link-box",4,"ngIf"],[1,"illust-image","margin"],[1,"message-text"],[1,"info-box"],[1,"info-box-header"],[1,"info-box-body"],["class","info-box",4,"ngIf"],[1,"message-image"],[1,"illust-image"],[1,"call-box"],[1,"call-box-body",3,"href"],[1,"link-box"],[3,"href"],[1,"papycon","papycon-link"]],template:function(n,r){if(n&1&&(q(0,"img",1),Y(1,"translate"),se(2,ou,13,13,"ng-template",2)(3,ru,11,14,"ng-template",null,0,Vi),I(5,"div",3)(6,"div",4),_e(7),Y(8,"translate"),N(),se(9,su,6,6,"div",5)(10,au,5,2,"div",6),N()),n&2){let c=yi(4);ge("src",r.logoImageSrc,Sn)("alt",X(1,7,r.isStreamdocs?"STREAMDOCS_LOGO":"STREAMDOCS_VU_LOGO")),x(2),T("ngIf",r.isErrorCode)("ngIfElse",c),x(5),we(X(8,9,"FAILURE_PERSISTS_MESSAGE")),x(2),T("ngIf",r.environment.errorPage.telephone),x(),T("ngIf",r.environment.errorPage.link)}},dependencies:[bt,He],styles:["[_nghost-%COMP%]{font-size:16px;line-height:26px;font-family:NotoSans-Medium,sans-serif;color:#1e1e1e;display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%;background-color:var(--mono-00);overflow-y:auto}[_nghost-%COMP%] > *[_ngcontent-%COMP%]{max-width:80%}a[_ngcontent-%COMP%]{text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}.logo-image[_ngcontent-%COMP%]{height:24px}.message-image[_ngcontent-%COMP%]{height:184px;margin-top:70px;margin-bottom:40px}.illust-image[_ngcontent-%COMP%]{height:144px;margin-bottom:40px}.message-text[_ngcontent-%COMP%]{font-weight:700;font-size:32px;margin-bottom:40px}.info-box[_ngcontent-%COMP%]{width:400px;height:100px;border:1px solid var(--mono-99);box-sizing:border-box;text-align:center}.info-box-header[_ngcontent-%COMP%]{border-bottom:1px solid var(--mono-99);background-color:var(--mono-50)}.info-box-body[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:74px;white-space:pre-wrap}.info-box[_ngcontent-%COMP%] + .info-box[_ngcontent-%COMP%]{margin-top:20px}.enquiry-box[_ngcontent-%COMP%]{margin-top:28px;text-align:center}.call-box[_ngcontent-%COMP%]{text-align:center}.call-box-header[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Regular,sans-serif;color:#6c6c6c}.call-box-body[_ngcontent-%COMP%]{font-family:NotoSans-Medium,sans-serif;font-size:16px;line-height:26px;color:#6c6c6c;display:flex;align-items:center;justify-content:center;margin-top:9px;-webkit-user-select:none;user-select:none}.call-box-body[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin-left:4px}.link-box[_ngcontent-%COMP%]{margin-top:8px;-webkit-user-select:none;user-select:none}.link-box[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration-color:#3884d0}.link-box[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{margin-right:4px;font-size:20px;color:var(--mono-90)}.link-box[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#3884d0}.margin[_ngcontent-%COMP%]{margin-top:50px}"],changeDetection:0}));let s=t;return s})();var pd=class{router;constructor(t){this.router=t.get(Ir)}canActivate(t){let i=Jn.keys(vc).map(y=>vc[y].toString()),e=Object.values(Oa),n=t.paramMap.get("errorCode"),r=t.paramMap.get("statusCode"),c=w.isDefined(n)&&e.includes(n),g=w.isDefined(r)&&i.includes(r),v=Ze.errorPage.redirection;if(Object.keys(v).length>1||v.fallback.length>0){let y=`fallback${r}`;if(Jn.hasKey(v,y)&&v[y].length>0)return location.href=v[y],!1;if(v.fallback.length>0)return location.href=v.fallback,!1}return c||g?!0:this.router.createUrlTree([...t.url.slice(0,t.url.length-1).map(y=>y.path),Yr.NOT_FOUND])}canDeactivate(){return!0}};pd=ze([Zp()],pd);var cu=(s,t,i,e)=>{let n={version:2,authKey:e,id:t===null?void 0:t||hp(),messageType:s,args:i};return Object.freeze(n)},dd=[eo,Jt,En,ct,Bp,yn,at,zi,li,ya,Ia,Ep,to,Zo,Uo,Gr,Yt,Xo,Wr,zr,qo,Ip,sn,ba,Di,Hr,Kr,Po,Cp,cn,Wi,qr],_r=class _r{injector;documentService;router;viewerService;exportedFunctions={};acknowledged=!1;message$=G.windowMessage$.pipe(F(w.isDefined),F(t=>t.type==="message"),Ue(t=>this.documentService.viewingMode&&this.documentService.openedDocument!==null?(console.error("The MuPDF WebViewer API is not available in Free License"),null):t.data),F(w.isDefined),F(t=>!!t.messageType&&t.version===2));subscriptions=[];functionStatus={};_authKey;get authKey(){return this._authKey}set authKey(t){if(this._authKey){console.warn("authKey can't not be assigned more than twice");return}this._authKey=t}constructor(t,i,e,n){this.injector=t,this.documentService=i,this.router=e,this.viewerService=n,window.parent!==window&&(K.get(ie.USE_STREAMDOCS_API)&&(this.registerFunctions(),this.registerEvents()),this.subscribeMessageEvent(),this.connectWithParent())}emitEvent(t,i){this.dispatchEvent("EVENT",void 0,{type:t,data:i},this.authKey)}registerFunctions(){dd.forEach(t=>{let i=this.injector.get(t);if(!i||!i.getExportableFunctions)return;i.getExportableFunctions().forEach(n=>{this.exportedFunctions[n.name]=n,this.functionStatus[n.name]={running:!1,queue:[]}})})}registerEvents(){dd.forEach(t=>{let i=this.injector.get(t);if(!i||!i.getExportableEvents)return;i.getExportableEvents().forEach(n=>{this.subscriptions.push(n.subject.subscribe({next:r=>this.emitEvent(n.type,r)}))})})}connectWithParent(){this.acknowledged=!1,this.notifyToParent()}notifyToParent(t=100){if(this.acknowledged)return;if(t>100*Math.pow(2,8)){this.destroy();return}let i=K.get(ie.USE_STREAMDOCS_API)?"INITIATED":"REJECTED";this.dispatchEvent(i),setTimeout(()=>this.notifyToParent(t*2),t)}dispatchEvent(t,i,e,n){let r=cu(t,i,e,n);G.nativeWindow.parent!==G.nativeWindow&&window.parent.postMessage(r,"*")}subscribeMessageEvent(){this.subscriptions.push(this.message$.subscribe({next:t=>this.listenMessageEvent(t)}))}listenMessageEvent(t){switch(t.messageType){case"ACKNOWLEDGED":this.acknowledged=!0;break;case"CALL_FUNCTION":this.handleFunctionCall(t);break;case"REQUEST_CHALLENGE":this.responseChallenge(t);break;case"REJECTED":this.router.navigateByUrl(`view/error-pages;errorCode=${Oa.FSD000003}`);break;case"ADD_EVENT":break;default:console.warn(`Unhandled message received: ${t.messageType}`);break}}handleFunctionCall(t){if(t.authKey!==this.authKey){console.error("Calling function failed (authentication error)");return}if(!t.args){this.dispatchEvent("MESSAGE_ERROR",t.id,this.wrapError(new Xt("Argument is empty")));return}if(!t.args.functionName){this.dispatchEvent("MESSAGE_ERROR",t.id,this.wrapError(new Xt("Function name is empty")));return}let i=this.exportedFunctions[t.args.functionName];if(i===void 0){this.dispatchEvent("MESSAGE_ERROR",t.id,this.wrapError(new Xt("Can't find function")));return}if(!i.noNeedDocumentLoaded&&this.documentService.openedDocument===null){this.dispatchEvent("MESSAGE_ERROR",t.id,this.wrapError(new Xt("Document is not loaded. This function cannot be executed before document is loaded")));return}i.hasCallback&&this.replaceCallbackFunction(t.args.functionParams||{});let e={name:i.name,boundFunction:i.function.bind(null,...t.args.functionParams||[]),replyId:t.id},n=this.functionStatus[i.name];!i.parallelizable&&w.isDefined(n)&&n.running?n.queue.push(e):this.executeFunction(e)}wrapError(t){return{__sd_symbol__object_type__:"error",name:t.name,message:t.message,stack:t.stack}}executeFunction(t){let i=this.functionStatus[t.name];if(!w.isDefined(i))throw new Kl(`Cannot find "${t.name}" in FunctionStatus.`);let e;i.running=!0;try{e=t.boundFunction()}catch(n){i.running=!1,e=Gn(n)}e.pipe(en(1),Xn(()=>{i.running=!1;let n=i.queue;n.length>0&&this.executeFunction(n.shift())})).subscribe({next:n=>this.dispatchEvent("FUNCTION_SUCCESS",t.replyId,n),error:n=>this.dispatchEvent("FUNCTION_ERROR",t.replyId,n instanceof Error?this.wrapError(n):n)})}responseChallenge(t){if(!t?.authKey){console.error("Challenge message didn't have authKey");return}this.authKey&&this.authKey!==t.authKey?console.warn(`StreamDocs already has been connected with another adapter. (current iframe src: ${location.href})`):(this.authKey||(this.authKey=t.authKey),this.dispatchEvent("RESPONSE_CHALLENGE",void 0,null,this.authKey),this.viewerService.loadComplete(t.args))}replaceCallbackFunction(t){Object.keys(t).forEach(i=>{if(typeof t[i]=="object")if(t[i].__sd_symbol__object_type__==="callbackFunction"){let e=t[i].__sd_symbol__callback_id__;t[i]=(...n)=>{this.dispatchEvent("CALLBACK_FUNCTION",void 0,{functionArgs:n,functionId:e},this.authKey)}}else this.replaceCallbackFunction(t[i])})}destroy(){this.subscriptions.forEach(t=>t.unsubscribe());for(let t of Jn.keys(this.exportedFunctions))delete this.exportedFunctions[t]}};D(_r,"\u0275fac",function(i){return new(i||_r)(ke(El),ke(ct),ke(Ir),ke(Jt))}),D(_r,"\u0275prov",oi({token:_r,factory:_r.\u0275fac}));var Sr=_r;ze([Tp()],Sr.prototype,"listenMessageEvent",null);var pu=s=>({content:s,gap:14}),Aa=s=>({content:s});function du(s,t){s&1&&Co(0)}function hu(s,t){if(s&1&&(I(0,"section",1),se(1,du,1,0,"ng-container",7),q(2,"div",8),N()),s&2){E();let i=yi(8);x(),T("ngTemplateOutlet",i)}}function uu(s,t){s&1&&Co(0)}function gu(s,t){if(s&1&&(I(0,"section",9),se(1,uu,1,0,"ng-container",7),N(),q(2,"div",5)),s&2){E();let i=yi(8);x(),T("ngTemplateOutlet",i)}}function fu(s,t){if(s&1){let i=ve();I(0,"button",16),Y(1,"translate"),ae("click",function(){j(i);let n=E(2).$implicit,r=E(2);return W(r.expanderClicked(n))}),q(2,"i",17),N()}if(s&2){let i=E(4);$e("dark",i.isDarkMode),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(1,4,"EXPAND"))}}function mu(s,t){if(s&1){let i=ve();Ht(0),I(1,"button",19),ae("click",function(){j(i);let n=E(),r=n.$implicit,c=n.index,g=E(3).$implicit,v=E(2);return g.lastUsed=c,W(v.activateTool(r.tool))}),q(2,"i",13),N(),$t()}if(s&2){let i=E().$implicit,e=E(5);x(),$e("dark",e.isDarkMode)("active",e.isActivated(i.tool)),T("title",e.isMobile?"":i.alt)("tooltip",vt(9,Aa,i.alt)),ge("color",e.isDarkMode?"white":e.styleOfMenuTool(i))("aria-label",i.alt),x(),T("ngClass",i.iconClass)}}function vu(s,t){if(s&1&&(Ht(0),se(1,mu,3,11,"ng-container",4),$t()),s&2){let i=t.$implicit;x(),T("ngIf",i.use)}}function _u(s,t){if(s&1&&(I(0,"div",18),se(1,vu,2,1,"ng-container",10),N()),s&2){let i=E(2).$implicit;T("@menuState",i.menuState),x(),T("ngForOf",i.subtools)}}function Su(s,t){if(s&1){let i=ve();Ht(0),I(1,"div",11)(2,"button",12),ae("click",function(){j(i);let n=E().$implicit,r=E(2);return W(r.activateTool(r.isNestedMenuItem(n)?n.lastTool:n))}),q(3,"i",13),_e(4),N(),se(5,fu,3,6,"button",14)(6,_u,2,2,"div",15),N(),$t()}if(s&2){let i=E().$implicit,e=E(2);x(),$e("expandable",e.isExpandable(i)),x(),$e("dark",e.isDarkMode)("ep-text-button",!i.text)("ep-button",i.text)("active",e.isActivated(i))("expandable",e.isExpandable(i)),T("title",e.isMobile?"":i.alt)("tooltip",vt(21,pu,i.alt)),ge("color",e.isDarkMode||i.text?"white":"dark")("size",i.text?"tiny":null)("aria-label",i.alt),x(),T("ngClass",i.iconClass),x(),qn(" ",i.text||""," "),x(),T("ngIf",e.isExpandable(i)),x(),T("ngIf",e.isExpandable(i)&&e.breakPointOfMobile<=e.windowWidth)}}function bu(s,t){if(s&1&&(Ht(0),se(1,Su,7,23,"ng-container",4),$t()),s&2){let i=t.$implicit;x(),T("ngIf",i.use)}}function Cu(s,t){if(s&1&&(Ht(0),se(1,bu,2,1,"ng-container",10),$t()),s&2){let i=E();x(),T("ngForOf",i.getToolMenus())}}function xu(s,t){s&1&&q(0,"div",5)}function Tu(s,t){if(s&1){let i=ve();I(0,"section",20)(1,"button",21),Y(2,"translate"),Y(3,"translate"),Y(4,"translate"),ae("click",function(){j(i);let n=E();return W(n.toggleRightSideView())}),q(5,"i",22),N()()}if(s&2){let i=E();x(),$e("dark",i.isDarkMode)("active",i.isAnnotPropertyViewActive()),T("title",i.isMobile?"":X(2,8,"PROPERTIES_PANEL"))("tooltip",vt(14,Aa,X(3,10,"PROPERTIES_PANEL"))),ge("color",i.isDarkMode&&!i.isAnnotPropertyViewActive()?"white":i.isAnnotPropertyViewActive()?"primary":"dark")("aria-label",X(4,12,"PROPERTIES_PANEL"))}}function Ou(s,t){if(s&1){let i=ve();I(0,"div",23)(1,"button",24),Y(2,"translate"),ae("click",function(){j(i);let n=E();return W(n.onClickUndo())}),q(3,"i",25),N(),I(4,"button",24),Y(5,"translate"),ae("click",function(){j(i);let n=E();return W(n.onClickRedo())}),q(6,"i",26),N()()}if(s&2){let i=E();x(),$e("disabled",i.isDarkMode&&!i.canUndo),T("disabled",!i.canUndo)("tooltip",vt(16,Aa,i.undoTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(2,12,"UNDO")),x(3),$e("disabled",i.isDarkMode&&!i.canRedo),T("disabled",!i.canRedo)("tooltip",vt(18,Aa,i.redoTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(5,14,"REDO"))}}var Qr=class Qr{annotService;autoSaveService;contentService;dialogService;changeDetectorRef;defaultAnnot;pageService;toastService;annotSelectedService;documentService;subscriptionService;preferenceService;actionHistoryService;store$;translatePipe;signatureService;selectTextService;apiEventBridgeService;quickActionService;viewerService;get RuntimeEnvKey(){return ie}get runtimeEnv(){return K}get DocumentAction(){return Ne}get undoTooltipWithShortcut(){return`${this.translatePipe.transform("UNDO")} (${ti.getShortcutString(Fi[Re.UNDO_ACTION])})`}get redoTooltipWithShortcut(){return`${this.translatePipe.transform("REDO")} (${ti.getShortcutString(Fi[Re.REDO_ACTION])})`}rightSideViewMode;menuItems=[];visibleRightSideView;formFieldHighlighted=!0;rulerActive;viewMode;annotContext;sideViewMode=null;sideViewVisible=!1;canUndo=!1;canRedo=!1;hidableMenus={};screenTheme;get windowWidth(){return G.width}get breakPointOfMobile(){return G.breakpoints.mobile.width}get showUndoRedoBtn(){return!this.viewerService.isSubToolbarType(lt.REDACT)&&K.get(ie.ANNOT_TOOLBAR_UNDO_REDO_BUTTONS)&&!this.hidableMenus[B.ANNOTATION_UNDO_REDO]}get isVisiblePropertyButton(){return this.viewerService.isSubToolbarType(lt.ANNOTATE)&&this.runtimeEnv.get(ie.ANNOT_TOOLBAR_ANNOT_PROPERTY_BUTTON)&&!this.hidableMenus[B.ANNOTATION_PROPERTY_PANEL]||this.viewerService.isSubToolbarType(lt.FORM)&&this.runtimeEnv.get(ie.FORM_TOOLBAR_ANNOT_PROPERTY_BUTTON)&&!this.hidableMenus[B.FORM_PROPERTY_PANEL]||this.viewerService.isSubToolbarType(lt.INSERT)||this.viewerService.isSubToolbarType(lt.REDACT)||this.viewerService.isSubToolbarType(lt.SIGN)}get HidableView(){return B}get isFormHighlightAvailable(){return K.get(ie.WIDGET_HIGHLIGHT_BUTTON)&&this.documentService.checkAuthority(Ne.FORM)}get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}get isMobile(){return G.isMobile()}annotateMenus=[];insertMenus=[];redactMenus=[];signMenus=[];currentTool=null;dragMode;isDeepCopy=!1;selectedSubtools=[];constructor(t,i,e,n,r,c,g,v,y,M,k,Z,le,pe,he,Te,p,ht,_t,gt){this.annotService=t,this.autoSaveService=i,this.contentService=e,this.dialogService=n,this.changeDetectorRef=r,this.defaultAnnot=c,this.pageService=g,this.toastService=v,this.annotSelectedService=y,this.documentService=M,this.subscriptionService=k,this.preferenceService=Z,this.actionHistoryService=le,this.store$=pe,this.translatePipe=he,this.signatureService=Te,this.selectTextService=p,this.apiEventBridgeService=ht,this.quickActionService=_t,this.viewerService=gt,this.annotateMenus=this.initAnnotateMenus(),this.insertMenus=this.initInsertMenus(),this.redactMenus=this.initRedactMenus(),this.signMenus=this.initSignMenus()}initAnnotateMenus(){return[{tool:Qe.HIGHLIGHT,type:Li.ANNOT,alt:this.translatePipe.transform("HIGHLIGHT"),iconClass:"papycon-text-highlight",use:K.get(ie.HIGHLIGHT_ANNOTATION_BUTTON)},{tool:Qe.STRIKE,type:Li.ANNOT,alt:this.translatePipe.transform("STRIKEOUT"),iconClass:"papycon-text-strikeout",use:K.get(ie.STRIKEOUT_ANNOTATION_BUTTON)},{tool:Qe.UNDERLINE,type:Li.ANNOT,alt:this.translatePipe.transform("UNDERLINE"),iconClass:"papycon-text-underline",use:K.get(ie.UNDERLINE_ANNOTATION_BUTTON)},{tool:Qe.TEXT_POPUP,type:Li.ANNOT,alt:this.translatePipe.transform("TEXT_TOOL"),iconClass:"papycon-memo3",use:K.get(ie.MEMO_ANNOTATION_BUTTON)},{tool:Qe.STAMP,type:Li.ANNOT,alt:this.translatePipe.transform("STAMP_TOOL"),iconClass:"papycon-stamp2",use:K.get(ie.STAMP_ANNOTATION_BUTTON)}]}initInsertMenus(){return[{tool:Qe.TEXT_FREE,type:Li.ANNOT,alt:this.translatePipe.transform("FREE_TEXT_TOOL"),iconClass:"papycon-add-text",use:K.get(ie.FREE_TEXT_ANNOTATION_BUTTON)},{tool:Qe.STAMP,type:Li.ANNOT,alt:this.translatePipe.transform("STAMP_TOOL"),iconClass:"papycon-image",use:K.get(ie.STAMP_ANNOTATION_BUTTON)}]}initRedactMenus(){return[{tool:Qe.REDACTION,type:Li.ANNOT,alt:this.translatePipe.transform("MARK_FOR_REDACTION"),iconClass:"papycon-redaction-partial2",use:this.documentService.checkAuthority(Ne.DRAW_REDACTION)},{tool:De.SearchingRedaction,type:Li.SIDE_VIEW,alt:this.translatePipe.transform("SEARCH"),iconClass:"papycon-text-search",use:this.documentService.checkAuthority(Ne.DRAW_REDACTION)}]}initSignMenus(){return[{tool:Qe.SIGNATURE,type:Li.ANNOT,alt:this.translatePipe.transform("SIGN"),iconClass:"papycon-signature",use:K.get(ie.SIGNATURE_WIDGET_BUTTON)}]}ngOnInit(){this.initSubscriptions(),this.resize(),this.subscribeSubtoolMenuCloser(),this.initRegisterQuickActions()}onClickUndo(){if(this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:Gt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}this.annotSelectedService.unselectAll(),this.actionHistoryService.undo()}onClickRedo(){if(this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:Gt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}this.annotSelectedService.unselectAll(),this.actionHistoryService.redo()}activateTool(t){if(this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:Gt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}switch(t.type){case Li.ANNOT:this.activateAnnotTool(t.tool);return;case Li.DRAG:this.activateDragModeTool(t.tool);return;case Li.SIDE_VIEW:this.activateSideView(t.tool);return}}activateAnnotTool(t,i){if(!this.documentService.checkAuthority(Ne.DRAW_ANNOTATION))return;this.menuItems.forEach(n=>{n.menuState="off"}),this.initAnnotationState();let e=this.currentTool;if(Qe.STAMP===t){this.dialogService.toggleDialogVisibility(ji.STAMP_CREATION,!0);return}if(Qe.INSTANT_SIGNATURE===t){this.signatureService.prepareSignature().subscribe({next:()=>{this.signatureService.toggleOverlay(!1),this.signatureService.toggleSignatureModuleLoadingDialog(!1),this.store$.dispatch(Ki.selectTool({payload:t})),this.changeDetectorRef.markForCheck()}});return}else if(Qe.INVISIBLE_SIGNATURE===t){this.store$.dispatch(Ki.selectTool({payload:null})),this.signatureService.prepareSignature().pipe(Ue(()=>this.signatureService.createEmptySignatureAnnot(0)),st(n=>this.signatureService.injectSignature(n,"create")),F(n=>!!n)).subscribe();return}t===Qe.REDACTION&&this.sideViewMode===De.SearchingRedaction&&this.store$.dispatch(ue.set({key:"sideViewMode",value:De.Redaction})),t!==e?(this.store$.dispatch(Ki.selectTool({payload:t})),this.changeDetectorRef.markForCheck()):this.store$.dispatch(Ki.unselectTool()),this.windowWidth<this.breakPointOfMobile&&(this.selectedSubtools=[]),t===Qe.ERASER&&this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1})),this.annotService.closeEditor()}activateDragModeTool(t){this.store$.dispatch(ue.set({key:"dragMode",value:t})),this.store$.dispatch(Ki.unselectTool()),this.selectTextService.publishSelectedText(null),this.annotService.closeEditor()}activateSideView(t){switch(t){case De.SearchingRedaction:this.sideViewVisible||this.store$.dispatch(ue.set({key:"sideViewVisible",value:!0})),this.currentTool===Qe.REDACTION&&this.store$.dispatch(Ki.unselectTool());let i=this.sideViewMode===De.SearchingRedaction?De.Redaction:De.SearchingRedaction;this.store$.dispatch(ue.set({key:"sideViewMode",value:i}));return}}activateAnnotToolForStatistics(t,i){this.activateAnnotTool(i)}getToolMenus(){return this.viewerService.isSubToolbarType(lt.ANNOTATE)?this.annotateMenus:this.viewerService.isSubToolbarType(lt.INSERT)?this.insertMenus:this.viewerService.isSubToolbarType(lt.REDACT)?this.redactMenus:this.viewerService.isSubToolbarType(lt.SIGN)?this.signMenus:[]}expanderClicked(t){t.menuState=t.menuState==="off"?"on":"off",this.menuItems.forEach(i=>{!i.hasOwnProperty("subtools")||i===t||(i.menuState="off")}),t.hasOwnProperty("subtools")&&(this.selectedSubtools=t.menuState==="off"?[]:[...t.subtools])}isEbookMode(){return this.viewMode===4&&this.documentService.eBookStatus}isActivated(t){switch(t.type){case Li.ANNOT:return this.currentTool===t.tool;case Li.DRAG:return this.dragMode===t.tool&&this.currentTool===null;case Li.SIDE_VIEW:return this.sideViewMode===t.tool;default:return console.error("Unknown tool menu type:",t.type),!1}}styleOfMenuTool(t){return this.isActivated(t)||!w.isDefined(t.tool)?"white":"dark"}toggleRightSideView(){this.rightSideViewMode!==Rt.AnnotProperty&&this.store$.dispatch(ue.set({key:"rightSideViewMode",value:Rt.AnnotProperty})),this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!this.visibleRightSideView}))}toggleFormFieldHighlight(t){this.preferenceService.updatePreferences(["formFieldHighlighted"],!this.formFieldHighlighted)}toggleFormFieldHighlightForStatistics(t){this.toggleFormFieldHighlight()}toggleRuler(t){this.store$.dispatch(ue.set({key:"rulerActive",value:!this.rulerActive}))}toggleRulerForStatistics(t){this.toggleRuler()}isAnnotPropertyViewActive(){return this.visibleRightSideView&&this.rightSideViewMode===Rt.AnnotProperty}createMenus(){let t=[...this.annotateMenus];if(!G.isMobile())return t;let i=[Qe.HIGHLIGHT,Qe.STRIKE,Qe.UNDERLINE];return t.filter(e=>!i.includes(e.tool))}subscribeAnnotContext(){this.subscriptionService.push(this.store$.pipe(Wo()).subscribe({next:t=>{if(this.currentTool=t,t===Qe.ERASER){this.annotSelectedService.unselectAll();return}if(t!==null){this.isDeepCopy=!1;let i=this.defaultAnnot.getAnnot(t,this.isDeepCopy);if(!i)return;this.annotSelectedService.unselectAll(),this.annotSelectedService.add({data:i,elementRef:void 0})}else this.annotSelectedService.unselectAll();this.changeDetectorRef.markForCheck()}}))}initSubscriptions(){this.subscribeAnnotContext(),this.subscriptionService.push(this.store$.pipe(ci("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("rightSideViewMode")).subscribe({next:t=>{this.rightSideViewMode=t,this.changeDetectorRef.detectChanges()}}),this.store$.pipe($("sideViewMode")).subscribe({next:t=>this.sideViewMode=t}),this.store$.pipe($("sideViewVisible")).subscribe({next:t=>this.sideViewVisible=t}),this.store$.pipe(fi([B.TOOLBAR_DRAG_MODE_SELECT_ANNOTATION,B.ANNOTATION_INK,B.ANNOTATION_LINE,B.ANNOTATION_SQUARE,B.ANNOTATION_CIRCLE,B.ANNOTATION_POLYLINE,B.ANNOTATION_POLYGON,B.ANNOTATION_CLOUD,B.ANNOTATION_TEXT_FREE,B.ANNOTATION_TEXT_CALLOUT,B.ANNOTATION_TEXT_POPUP,B.ANNOTATION_LINE_DIMENSION,B.ANNOTATION_POLYLINE_DIMENSION,B.ANNOTATION_POLYGON_DIMENSION,B.ANNOTATION_STAMP,B.ANNOTATION_HIGHLIGHT,B.ANNOTATION_STRIKE,B.ANNOTATION_UNDERLINE,B.ANNOTATION_LINK,B.ANNOTATION_SIGNATURE,B.ANNOTATION_TEXT_FIELD,B.ANNOTATION_COMBO_BOX,B.ANNOTATION_LIST_BOX,B.ANNOTATION_CHECK_BUTTON,B.ANNOTATION_RADIO_BUTTON,B.ANNOTATION_BUTTON,B.ANNOTATION_ERASER,B.ANNOTATION_PROPERTY_PANEL,B.ANNOTATION_UNDO_REDO,B.TOOLBAR_DRAG_MODE_SELECT_FORM,B.FORM_SIGNATURE,B.FORM_TEXT_FIELD,B.FORM_COMBO_BOX,B.FORM_LIST_BOX,B.FORM_CHECK_BUTTON,B.FORM_RADIO_BUTTON,B.FORM_BUTTON,B.FORM_PROPERTY_PANEL,B.FORM_UNDO_REDO,B.FORM_RULER,B.FORM_HIGHLIGHT])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),this.annotateMenus=this.initAnnotateMenus(),Object.keys(this.hidableMenus).forEach(i=>{if(!this.hidableMenus[i])return;let[e,n]=i.split(".");this.hideAnnotTool(e,n)}),this.changeDetectorRef.markForCheck()}}),G.windowResize$.subscribe({next:t=>this.resize(t)}),this.documentService.authorityUpdate$.subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.contentService.annotEvent$.pipe(F(t=>t!==null)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.contentService.annotListEvent$.pipe(F(t=>t!==null)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.annotSelectedService.selectionInfoChange$.subscribe({next:()=>{this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("rightSideViewVisible")).subscribe({next:t=>{this.visibleRightSideView=t,this.selectedSubtools=[],this.changeDetectorRef.markForCheck()}}),this.store$.pipe(ci("formFieldHighlighted")).subscribe({next:t=>{this.formFieldHighlighted=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("rulerActive")).subscribe({next:t=>{this.rulerActive=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("dragMode")).subscribe({next:t=>{this.dragMode=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("viewMode")).subscribe({next:t=>this.viewMode=t}),this.actionHistoryService.availableUndoCount$.subscribe({next:t=>{this.canUndo=t>0,this.changeDetectorRef.detectChanges()}}),this.actionHistoryService.availableRedoCount$.subscribe({next:t=>{this.canRedo=t>0,this.changeDetectorRef.detectChanges()}}),this.store$.pipe(Sp()).subscribe({next:t=>this.annotContext=t}),this.apiEventBridgeService.handleResultObservable(this.apiEventBridgeService.annotToolChangeAppliedSrc).subscribe({next:()=>{this.getToolMenus().forEach(t=>{if(!this.isNestedMenuItem(t)||!w.isDefined(this.annotService.annotTool)||!t.subtools.map(e=>e.tool).includes(this.annotService.annotTool))return;let i=t.subtools.findIndex(e=>e.tool===this.annotService.annotTool);i<0||(t.lastUsed=i)})}}),this.viewerService.subToolbar$.subscribe({next:()=>this.changeDetectorRef.markForCheck()}))}isNestedMenuItem(t){return"subtools"in t}isExpandable(t){return this.isNestedMenuItem(t)&&t.subtools.filter(i=>i.use).length>1}hideAnnotTool(t,i){let e=[];t==="ANNOTATION"&&(e=this.annotateMenus);let n=-1,r=e.findIndex(g=>this.isNestedMenuItem(g)?(n=g.subtools.findIndex(v=>v.tool===i),n!==-1):g.tool===i),c=e[r];if(w.isDefined(c))if(this.isNestedMenuItem(c)){if(c.subtools[n].use=!1,n===c.lastUsed){let g=c.subtools.findIndex(v=>v.use);g===-1&&(c.use=!1),c.lastUsed=g,this.store$.dispatch(Ki.unselectTool())}}else c.use=!1}resize(t){this.menuItems=this.buildMenu(),t&&this.changeDetectorRef.markForCheck()}buildMenu(){return this.menuItems?this.menuItems:this.createMenus()}subscribeSubtoolMenuCloser(){this.subscriptionService.push()}closeAnnotationToolbar(){this.viewerService.closeSubToolbar(),this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1}))}activateLastTool(t,i){this.menuItems.forEach(e=>{if(!this.isNestedMenuItem(e))return;let n=e.subtools.find(r=>r.tool===t.tool);w.isDefined(n)&&(e.lastUsed=i)})}initAnnotationState(){this.store$.dispatch(Ki.setAttributes({payload:null})),this.store$.dispatch(Ki.updateStampContext({payload:{width:null,height:null,dataURL:this.annotContext.stamp?.dataURL??null,name:null}})),this.annotService.initGesture()}initRegisterQuickActions(){this.quickActionService.registerActions([{id:Se.INK_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_INK_BY_QUICK_SEARCH,Qe.INK)},{id:Se.LINE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_LINE_BY_QUICK_SEARCH,Qe.LINE)},{id:Se.SQUARE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_SQUARE_BY_QUICK_SEARCH,Qe.SQUARE)},{id:Se.CIRCLE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_CIRCLE_BY_QUICK_SEARCH,Qe.CIRCLE)},{id:Se.POLYGON_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_POLYGON_BY_QUICK_SEARCH,Qe.POLYGON)},{id:Se.POLYLINE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_POLYLINE_BY_QUICK_SEARCH,Qe.POLYLINE)},{id:Se.POLYGON_CLOUD_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_POLYGON_CLOUD_BY_QUICK_SEARCH,Qe.CLOUD)},{id:Se.FREE_TEXT_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_FREE_TEXT_BY_QUICK_SEARCH,Qe.TEXT_FREE)},{id:Se.FREE_TEXT_CALLOUT_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_FREE_TEXT_CALLOUT_BY_QUICK_SEARCH,Qe.TEXT_CALLOUT)},{id:Se.TEXT_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_TEXT_BY_QUICK_SEARCH,Qe.TEXT_POPUP)},{id:Se.DISTANCE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_DISTANCE_BY_QUICK_SEARCH,Qe.LINE_DIMENSION)},{id:Se.PERIMETER_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_DISTANCE_BY_QUICK_SEARCH,Qe.POLYLINE_DIMENSION)},{id:Se.AREA_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_AREA_BY_QUICK_SEARCH,Qe.POLYGON_DIMENSION)},{id:Se.STAMP_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_STAMP_BY_QUICK_SEARCH,Qe.STAMP)},{id:Se.HIGHLIGHT,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_HIGHLIGHT_BY_QUICK_SEARCH,Qe.HIGHLIGHT)},{id:Se.STRIKEOUT,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_STRIKEOUT_BY_QUICK_SEARCH,Qe.STRIKE)},{id:Se.UNDERLINE,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_UNDERLINE_BY_QUICK_SEARCH,Qe.UNDERLINE)},{id:Se.CREATE_LINK,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_CREATE_LINK_BY_QUICK_SEARCH,Qe.LINK)},{id:Se.ERASER,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_ERASER_BY_QUICK_SEARCH,Qe.ERASER)},{id:Se.SIGN,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_SIGN_BY_QUICK_SEARCH,Qe.SIGNATURE)},{id:Se.TEXT_FIELD,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_TEXT_FIELD_BY_QUICK_SEARCH,Qe.TEXT_FIELD)},{id:Se.COMBO_BOX,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_COMBO_BOX_BY_QUICK_SEARCH,Qe.COMBO_BOX)},{id:Se.LIST_BOX,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_LIST_BOX_BY_QUICK_SEARCH,Qe.LIST_BOX)},{id:Se.CHECK_BUTTON,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_LIST_BOX_BY_QUICK_SEARCH,Qe.CHECK_BUTTON)},{id:Se.RADIO_BUTTON,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_RADIO_BUTTON_BY_QUICK_SEARCH,Qe.RADIO_BUTTON)},{id:Se.BUTTON,actionFn:()=>this.activateAnnotToolForStatistics(fe.CHANGE_TOOL_TO_BUTTON_BY_QUICK_SEARCH,Qe.BUTTON)},{id:Se.RULER,actionFn:()=>this.toggleRulerForStatistics(fe.CHANGE_RULER_BY_QUICK_SEARCH)},{id:Se.FORMFIELD_HIGHLIGHTED,actionFn:()=>this.toggleFormFieldHighlightForStatistics(fe.CHANGE_FORMFIELD_HIGHLIGHTED_BY_QUICK_SEARCH)}])}};D(Qr,"\u0275fac",function(i){return new(i||Qr)(_(li),_(jr),_(at),_(En),_(Me),_(gp),_(Yt),_(sn),_(Di),_(ct),_(J),_(Uo),_(eo),_(Ee),_(He),_(Gr),_(cn),_(Zt),_(ln),_(Jt))}),D(Qr,"\u0275cmp",Ce({type:Qr,selectors:[["sd-annot-toolbar"]],standalone:!1,features:[xe([J,{provide:Qn,useValue:new Vt(300)}])],decls:9,vars:5,consts:[["redoUndo",""],[1,"left"],[1,"right"],[1,"annotation"],[4,"ngIf"],[1,"full","divider"],["class","panel",4,"ngIf"],[4,"ngTemplateOutlet"],[1,"divider"],[1,"redo-undo-container"],[4,"ngFor","ngForOf"],[1,"tool-container"],[1,"tool-button",3,"click","title","tooltip"],[1,"papycon",3,"ngClass"],["class","ep-text-button expand-button",3,"dark","click",4,"ngIf"],["class","subtool-menu",4,"ngIf"],[1,"ep-text-button","expand-button",3,"click"],[1,"papycon","papycon-chevron3-down"],[1,"subtool-menu"],[1,"ep-text-button",3,"click","title","tooltip"],[1,"panel"],[1,"ep-text-button","annot-property-toggle",3,"click","title","tooltip"],[1,"papycon","papycon-palette"],[1,"redo-undo"],["size","tiny",1,"ep-text-button",3,"click","disabled","tooltip"],[1,"papycon","papycon-undo"],[1,"papycon","papycon-redo"]],template:function(i,e){i&1&&(se(0,hu,3,1,"section",1),I(1,"section",2),se(2,gu,3,1),I(3,"section",3),se(4,Cu,2,1,"ng-container",4),N(),se(5,xu,1,0,"div",5)(6,Tu,6,16,"section",6),N(),se(7,Ou,7,20,"ng-template",null,0,Vi)),i&2&&(Ut(e.showUndoRedoBtn?0:-1),x(2),Ut(e.showUndoRedoBtn&&e.windowWidth<e.breakPointOfMobile?2:-1),x(2),T("ngIf",e.documentService.checkAuthority(e.DocumentAction.DRAW_ANNOTATION)),x(),Ut(e.windowWidth<e.breakPointOfMobile?5:-1),x(),T("ngIf",e.isVisiblePropertyButton))},dependencies:[xo,Ei,bt,ia,Dn,He],styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}[_nghost-%COMP%]{position:relative;display:flex;box-sizing:border-box;background-color:var(--mono-00);border-bottom:1px solid var(--mono-30);z-index:2}.ep-text-button[_ngcontent-%COMP%]:has(i.papycon){border-width:0;outline-offset:-2px;padding:2px}section[_ngcontent-%COMP%]{display:flex}section[_ngcontent-%COMP%] > .divider[_ngcontent-%COMP%]{align-self:center;height:24px;width:1px;background-color:var(--mono-30)}section[_ngcontent-%COMP%] > .divider.full[_ngcontent-%COMP%]{height:100%}section.right[_ngcontent-%COMP%]{width:100%}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]{align-items:center;padding:0 16px 0 24px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]{position:relative}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark.active[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark.active[_ngcontent-%COMP%]{color:var(--mono-00)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled,.active):hover, section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled,.active):hover{color:#d7d7d7}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   i.papycon.bold[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   i.papycon.bold[_ngcontent-%COMP%]{font-weight:500}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .ep-button[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .ep-button[_ngcontent-%COMP%]{background-color:var(--mono-00);border-color:var(--mono-50)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button[_ngcontent-%COMP%]{border-radius:4px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button.active[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button.active[_ngcontent-%COMP%]{background-color:#f166251a;color:var(--primary-50)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .active-indicator[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .active-indicator[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 3px);width:100%;height:3px;background-color:var(--primary-50);border-radius:2px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button[_ngcontent-%COMP%] + .expand-button[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button[_ngcontent-%COMP%] + .expand-button[_ngcontent-%COMP%]{margin-left:2px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%] + div.tool-container[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%] + div.tool-container[_ngcontent-%COMP%]{margin-left:20px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container.expandable[_ngcontent-%COMP%] + div.tool-container[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container.expandable[_ngcontent-%COMP%] + div.tool-container[_ngcontent-%COMP%]{margin-left:12px}section.right[_ngcontent-%COMP%]   section.panel[_ngcontent-%COMP%]{margin-left:auto}section.right[_ngcontent-%COMP%]   section.panel[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin:auto 12px}section.right[_ngcontent-%COMP%]   section.panel[_ngcontent-%COMP%] > button.dark[_ngcontent-%COMP%]:not(.active):hover{color:#d7d7d7}section.right[_ngcontent-%COMP%]   .subtool-menu[_ngcontent-%COMP%]{box-shadow:0 4px 32px #6c6c6c1f;position:absolute;top:calc(100% + 9px);column-gap:12px;box-sizing:border-box;padding:6px 8px;margin-top:5px;border:1px solid var(--mono-30);border-radius:2px;background-color:var(--mono-00);white-space:nowrap;z-index:3}section.right[_ngcontent-%COMP%]   .subtool-menu[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{color:var(--mono-00);background-color:var(--primary-50)}section.right[_ngcontent-%COMP%]   .subtool-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   .subtool-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:4px}.redo-undo[_ngcontent-%COMP%]{padding:0 24px 0 16px;display:flex;gap:24px;align-items:center}.redo-undo[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0}.redo-undo[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:22px}@media screen and (max-width: 811px){[_nghost-%COMP%]{justify-content:flex-end}}@media screen and (max-width: 575px){section.left[_ngcontent-%COMP%]{display:none}section.right[_ngcontent-%COMP%]{width:100%;position:relative}section.right[_ngcontent-%COMP%]   section.subtool-container[_ngcontent-%COMP%]{align-items:center;position:absolute;top:43px;width:100%;height:43px;padding:0 12px;gap:12px;background-color:var(--mono-10);box-shadow:0 2px 1px rgba(var(--mono-70),.12);border-bottom:1px solid var(--mono-30)}section.right[_ngcontent-%COMP%]   section.subtool-container[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{color:var(--mono-00);background-color:var(--primary-50)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]{padding:0 14px;flex:1;white-space:nowrap;overflow-x:scroll;overflow-y:hidden;-ms-overflow-style:none;scrollbar-width:none}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]{display:inline-block}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{vertical-align:middle}.redo-undo[_ngcontent-%COMP%]{padding:0 16px;display:flex;gap:10px;align-items:center}.redo-undo[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0}.redo-undo[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:22px}}"],data:{animation:[Ts.expandSubTool()]},changeDetection:0}));var Mo=Qr;ze([ot(it.annotToolbarComp.onClickRedo)],Mo.prototype,"onClickUndo",null);ze([ot(it.annotToolbarComp.onClickUndo)],Mo.prototype,"onClickRedo",null);ze([ot(it.annotToolbarComp.activateAnnotToolForStatistics)],Mo.prototype,"activateAnnotToolForStatistics",null);ze([ot(it.annotToolbarComp.toggleFormFieldHighlightForStatistics)],Mo.prototype,"toggleFormFieldHighlightForStatistics",null);ze([ot(it.annotToolbarComp.toggleRulerForStatistics)],Mo.prototype,"toggleRulerForStatistics",null);var gd=(()=>{let t=class t{};D(t,"\u0275fac",function(n){return new(n||t)}),D(t,"\u0275mod",ai({type:t})),D(t,"\u0275inj",ri({imports:[$i,wn]}));let s=t;return s})();var Ui=(()=>{class s{bufferedPages=[];_pdfPages=[];get pdfPages(){return this._pdfPages}set pdfPages(i){this._pdfPages=i,this.resolver=new Un(this._pdfPages)}degree=0;isR2L=!1;isSlideshow=!1;resolver=new Un([]);getPageSize(i){return this.resolver.getPageSize(this.degree,i)}getPageFrameOffset(i,e){return this.resolver.getPageFrameOffset(i,this.degree,this.isR2L,e,this.isSlideshow)}getPageContainerSize(i,e){return this.resolver.getPageContainerSize(i,this.degree,e,this.isSlideshow)}}return D(s,"MARGIN",5),D(s,"OPTIONAL_VISIBLE_PAGE",2),s})();var Na=(()=>{let t=class t{elementRef;renderer;page;constructor(e,n){this.elementRef=e,this.renderer=n}update(e){let{w:n,h:r}=this.page.bbox,c=this.page.r+e,g=Math.abs(Math.sin(c*Math.PI/180)),v=g*(n-r)/2,y=g*(r-n)/2,M=this.elementRef.nativeElement,k=M.querySelector(".loader");w.isDefined(k)&&this.renderer.setStyle(k,"display","flex"),this.renderer.setStyle(M,"marginTop",ee.pixelOf(v)),this.renderer.setStyle(M,"marginLeft",ee.pixelOf(y)),this.renderer.setStyle(M,"width",ee.pixelOf(n)),this.renderer.setStyle(M,"height",ee.pixelOf(r)),this.renderer.setStyle(M,"transform",ee.rotationNote(c))}};D(t,"\u0275fac",function(n){return new(n||t)(_(si),_(jt))}),D(t,"\u0275dir",bn({type:t,selectors:[["","sdPageContentLayout",""]],inputs:{page:"page"},standalone:!1}));let s=t;return s})();var ka=(()=>{let t=class t{elementRef;renderer;margin=`${ee.pixelOf(Ui.MARGIN)} ${ee.pixelOf(Ui.MARGIN)}`;childLayout;page;constructor(e,n){this.elementRef=e,this.renderer=n}update(e,n,r,c){let g=this.elementRef.nativeElement;if(!ee.isVisible(this.page.i,n-1,r)){this.renderer.setStyle(g,"visibility","hidden");return}let{height:v,width:y}=e.getPageSize(this.page.i),{offsetX:M,offsetY:k}=e.getPageFrameOffset(r,this.page.i);this.renderer.setStyle(g,"visibility",""),this.renderer.setStyle(g,"height",ee.pixelOf(v)),this.renderer.setStyle(g,"width",ee.pixelOf(y)),this.renderer.setStyle(g,"margin",e.isSlideshow?ee.pixelOf(0):this.margin),this.renderer.setStyle(g,"top",ee.pixelOf(k,3)),this.renderer.setStyle(g,"left",ee.pixelOf(M,3)),this.childLayout?.update(c)}};D(t,"\u0275fac",function(n){return new(n||t)(_(si),_(jt))}),D(t,"\u0275dir",bn({type:t,selectors:[["","sdPageFrameLayout",""]],contentQueries:function(n,r,c){if(n&1&&Fo(c,Na,5),n&2){let g;Ie(g=Ae())&&(r.childLayout=g.first)}},inputs:{page:"page"},standalone:!1}));let s=t;return s})();var Va=(()=>{let t=class t{elementRef;renderer;childLayout;constructor(e,n){this.elementRef=e,this.renderer=n}update(e,n,r,c,g){this.renderer.setStyle(this.elementRef.nativeElement,"transform",`scale(${ee.normalizeScale(n)})`),this.childLayout.forEach(v=>v.update(e,r,c,g))}};D(t,"\u0275fac",function(n){return new(n||t)(_(si),_(jt))}),D(t,"\u0275dir",bn({type:t,selectors:[["","sdScrollExpanderLayout",""]],contentQueries:function(n,r,c){if(n&1&&Fo(c,ka,4),n&2){let g;Ie(g=Ae())&&(r.childLayout=g)}},standalone:!1}));let s=t;return s})();var oo=(()=>{let t=class t{elementRef;renderer;static getOffset(e,n,r,c,g){let v=ee.normalizeScale(r),y=e.getPageContainerSize(c,g-1),M=y.width*v,k=y.height*v,Z=n.offsetWidth-G.scrollbarSize.vertical,le=n.offsetHeight-G.scrollbarSize.horizontal;return{offsetX:Math.max((Z-M)/2,0),offsetY:Math.max((le-k)/2,0)}}childLayout;constructor(e,n){this.elementRef=e,this.renderer=n}update(e,n,r,c,g,v){let y=ee.normalizeScale(r),M=e.getPageContainerSize(c,g-1),k=M.width*y,Z=M.height*y,le=t.getOffset(e,n,r,c,g),pe=this.elementRef.nativeElement;this.renderer.setStyle(pe,"paddingLeft",ee.pixelOf(le.offsetX,3)),this.renderer.setStyle(pe,"paddingRight",ee.pixelOf(le.offsetX,3)),this.renderer.setStyle(pe,"marginTop",ee.pixelOf(le.offsetY,3)),this.renderer.setStyle(pe,"width",ee.pixelOf(k,3)),this.renderer.setStyle(pe,"height",ee.pixelOf(Z,3)),this.renderer.setStyle(pe,"overflow","hidden"),this.childLayout?.update(e,r,g,c,v)}};D(t,"\u0275fac",function(n){return new(n||t)(_(si),_(jt))}),D(t,"\u0275dir",bn({type:t,selectors:[["","sdScaleWrapperLayout",""]],contentQueries:function(n,r,c){if(n&1&&Fo(c,Va,5),n&2){let g;Ie(g=Ae())&&(r.childLayout=g.first)}},standalone:!1}));let s=t;return s})();var La=(()=>{let t=class t{elementRef;childLayout;constructor(e){this.elementRef=e}update(e,n,r,c,g){this.childLayout?.update(e,this.elementRef.nativeElement,n,r,c,g)}};D(t,"\u0275fac",function(n){return new(n||t)(_(si))}),D(t,"\u0275dir",bn({type:t,selectors:[["","sdContentViewLayout",""]],contentQueries:function(n,r,c){if(n&1&&Fo(c,oo,5),n&2){let g;Ie(g=Ae())&&(r.childLayout=g.first)}},standalone:!1}));let s=t;return s})();var vd=gl(md());var yu=["containerWrapperRef"],Eu=()=>({"object-fit":"contain"});function Pu(s,t){s&1&&q(0,"sd-loader")}function Mu(s,t){if(s&1){let i=ve();I(0,"sd-image",8),ae("rendered",function(){j(i);let n=E().$implicit,r=E(2);return W(r.onImageRendered(n))}),N()}if(s&2){let i=E().$implicit,e=E(2);T("pdfPage",i)("documentId",e.documentId)("ngStyle",e.rotateImage(i.r))("imgStyle",ta(4,Eu))}}function Ru(s,t){if(s&1&&(I(0,"div",5),se(1,Pu,1,0,"sd-loader",6)(2,Mu,1,5,"sd-image",7),N()),s&2){let i=t.$implicit,e=E(2);x(),T("ngIf",!e.isLoadedPage(i)),x(),T("ngIf",e.isVisiblePage(i))}}function Iu(s,t){if(s&1&&(I(0,"div",3),se(1,Ru,3,2,"div",4),N()),s&2){let i=E();nn("visibility",i.eBookReady?"visible":"hidden"),T("ngStyle",i.eBookContainerStyle()),x(),T("ngForOf",i.pdfPages)}}var br=function(s){return s.SINGLE="single",s.DOUBLE="double",s}(br||{}),Fa=function(s){return s.TL_TR="tl,tr",s.BL_BR="bl,br",s}(Fa||{}),Tc=(()=>{let t=class t{contentService;documentService;elementRef;changeDetectorRef;shortcutService;subscriptionService;renderer;scrollController;store$;pageService;documentId;containerWrapperRef;eBookReady=!1;containerWrapperStyle={};WIDTH_MARGIN=64;HEIGHT_MARGIN=64;currentPageNo;pageCount;eBook;bookPageRatio;isR2L=!1;bookSize={width:0,height:0};bookDisplayMode;containerStyle={};loadedPageNoArr=[];prevPageNoRange=[];scale=100;dragListeners=[];prevDragEvent;pdfPages=[];get isDragging(){return this.dragListeners.length>0}get scrollContainer(){if(!w.isDefined(this.elementRef.nativeElement.parentElement))throw new Cn("Parent element is not defined.");return this.elementRef.nativeElement.parentElement}constructor(e,n,r,c,g,v,y,M,k,Z){this.contentService=e,this.documentService=n,this.elementRef=r,this.changeDetectorRef=c,this.shortcutService=g,this.subscriptionService=v,this.renderer=y,this.scrollController=M,this.store$=k,this.pageService=Z}ngOnInit(){this.initSubscriptions()}ngOnChanges(){this.eBookReady=!1,this.calcBookPageRatio(),this.eBook&&(this.eBook.turn("destroy"),this.eBook=void 0),setTimeout(()=>{this.bindEbook()})}onWrapperMousedown(e){this.prevDragEvent=e,this.dragListeners.push(this.renderer.listen(this.containerWrapperRef.nativeElement,"mousemove",n=>this.onMoveEvent(n)),this.renderer.listen(this.containerWrapperRef.nativeElement,"mouseup",()=>this.onEndDragEvent()),this.renderer.listen(this.containerWrapperRef.nativeElement,"mouseleave",()=>this.onEndDragEvent()))}eBookContainerStyle(){return this.containerStyle}isLoadedPage(e){return!!this.loadedPageNoArr[e.i+1]}isVisiblePage(e){return this.prevPageNoRange.includes(e.i+1)}onImageRendered(e){this.loadedPageNoArr[e.i+1]=!0,this.contentService.publishSomePageLoaded(!0),this.changeDetectorRef.markForCheck()}hasPageNo(e){return e.referencePoint===void 0}initSubscriptions(){this.subscriptionService.push(this.store$.pipe($("currentPageNo")).subscribe({next:e=>this.currentPageNo=e}),this.store$.pipe($("pageCount")).subscribe({next:e=>this.pageCount=e}),this.shortcutService.getShortcutEvent(Re.EBOOK_PREVIOUS_PAGE).pipe(hr(100),F(()=>this.eBook)).subscribe({next:()=>this.eBook.turn("previous")}),this.shortcutService.getShortcutEvent(Re.EBOOK_NEXT_PAGE).pipe(hr(100),F(()=>this.eBook)).subscribe({next:()=>this.eBook.turn("next")}),this.contentService.viewChangeRequest$.pipe(F(()=>this.eBook),F(this.hasPageNo),Ue(e=>e.pageNo),F(w.isDefined),Ue(e=>Math.min(Math.max(1,e),this.pageCount)),Yn()).subscribe({next:e=>this.eBook.turn("page",e)}),ut(G.windowResize$,this.store$.pipe($("sideViewVisible")),this.store$.pipe($("sideViewSize")),this.store$.pipe($("rightSideViewVisible")),this.store$.pipe($("rightSideViewSize"))).subscribe({next:()=>{this.eBook&&this.safeCallTurnJS(()=>{this.decideDisplayMode(),this.calcBookSize(),this.eBook.turn("size",this.bookSize.width,this.bookSize.height)})}}),this.documentService.pdfInfo$.pipe(Tl(this.store$.pipe(ci("viewerDirection")))).subscribe({next:([e,n])=>this.decideR2L(e,n)}),this.store$.pipe($("scale")).subscribe({next:e=>{if(this.scale=e,this.eBook){let n=1,r=this.bookSize.width;this.safeCallTurnJS(()=>{this.decideDisplayMode(),this.calcBookSize(),n=this.bookSize.width/r,this.eBook.turn("size",this.bookSize.width,this.bookSize.height)});let c=this.scrollController.jumpingOrigin;c.x>0&&(this.scrollContainer.scrollLeft=(this.scrollContainer.scrollLeft+c.x)*n-c.x),c.y>0&&(this.scrollContainer.scrollTop=(this.scrollContainer.scrollTop+c.y)*n-c.y)}}}),this.pageService.pdfPages$.subscribe({next:e=>this.pdfPages=e}))}calcBookPageRatio(){if(!this.pdfPages)return;let e={},n=0,r=0;this.pdfPages.forEach(c=>{let g=(c.bbox.h/c.bbox.w).toFixed(5);e[g]?e[g]++:e[g]=1});for(let c in e)e[c]>n&&(n=e[c],r=Number(c));this.bookPageRatio=r}decideDisplayMode(){let e=this.bookDisplayMode||null;this.bookDisplayMode=G.isMobile()?br.SINGLE:br.DOUBLE,e&&e!==this.bookDisplayMode&&this.eBook.turn("display",this.bookDisplayMode)}calcBookSize(){this.bookPageRatio||this.calcBookPageRatio();let e=this.scrollContainer.clientWidth-(G.isMobile()?0:this.WIDTH_MARGIN*2),n=this.scrollContainer.clientHeight-(G.isMobile()?0:this.HEIGHT_MARGIN*2),r=n/e,c=this.bookDisplayMode===br.SINGLE?this.bookPageRatio:this.bookPageRatio/2,g,v;c>r?(v=n,g=v/c):(g=e,v=g*c),this.pdfPages.some(k=>k.r===90||k.r===270)&&(v=this.bookDisplayMode===br.SINGLE?g:g/2),this.bookSize.width=g*(this.scale/100),this.bookSize.height=v*(this.scale/100),this.containerWrapperStyle.width=`${this.bookSize.width}px`,this.containerWrapperStyle.height=`${this.bookSize.height}px`;let y="0",M="0";return this.bookSize.width<this.scrollContainer.clientWidth&&(y=`${((this.scrollContainer.clientWidth-this.bookSize.width)/2).toFixed(2)}px`),this.bookSize.height<this.scrollContainer.clientHeight&&(M=`${((this.scrollContainer.clientHeight-this.bookSize.height)/2).toFixed(2)}px`),this.containerWrapperStyle.transform=`translate(${y}, ${M})`,this.bookSize}bindEbook(){this.decideDisplayMode(),this.calcBookSize(),this.updateEbookStyle(),this.eBook=(0,vd.default)("#ebook"),this.eBook.turn({display:this.bookDisplayMode,elevation:50,gradients:!0,autoCenter:!1,acceleration:!0,pages:this.pdfPages.length,duration:500,page:this.currentPageNo,width:this.bookSize.width,height:this.bookSize.height,direction:this.isR2L?"rtl":"ltr",when:{start:(r,c,g)=>{let v=Fa.TL_TR.includes(g)?Fa.TL_TR:Fa.BL_BR;this.eBook.turn("options",{turnCorners:v})},turning:(r,c)=>{let g=ee.getEbookPageNo(c);this.updateEbookStyle(g),this.store$.dispatch(ue.set({key:"currentPageNo",value:this.bookDisplayMode===br.SINGLE?c:g})),this.scrollController.updateReadStatus(),this.changeDetectorRef.markForCheck()},end:()=>{let[r,c]=this.eBook.turn("range"),g=Array.from(new Array(c-r+1),(v,y)=>y+r);this.prevPageNoRange&&this.prevPageNoRange.forEach(v=>{g.includes(v)||(this.loadedPageNoArr[v]=!1)}),this.prevPageNoRange=g,this.changeDetectorRef.markForCheck()}}});let[e,n]=this.eBook.turn("range");this.prevPageNoRange=Array.from(new Array(n-e+1),(r,c)=>c+e),this.eBookReady=!0,this.changeDetectorRef.markForCheck()}updateEbookStyle(e){if(this.bookDisplayMode===br.SINGLE)return;let n=e;if(w.isDefined(n)||(n=this.currentPageNo),!w.isDefined(this.containerWrapperStyle.width))throw new Cn("Container wrapper style width is not defined.");let r=parseInt(this.containerWrapperStyle.width,10),c=Math.min(r-this.bookSize.width,this.bookSize.width/2)+(r-this.bookSize.width<this.bookSize.width/2?(this.bookSize.width/2-(r-this.bookSize.width))/2:0);n===1||n===this.pageCount?this.containerStyle["margin-left"]=`${this.isR2L!==(n===1)?"-":""}${c.toFixed(3)}px`:this.containerStyle["margin-left"]=null}decideR2L(e,n){let r=n===0?e?.ViewerPreferences?.Direction==="R2L":n===2;this.store$.dispatch(ue.set({key:"isR2L",value:r})),this.changeDirection(this.isR2L?"rtl":"ltr")}changeDirection(e){if(!this.eBook)return;this.eBook.turn("direction")!==e&&this.safeCallTurnJS(()=>{this.eBook.turn("direction",e)})}safeCallTurnJS(e){this.containerStyle.transition="none",this.containerStyle["margin-left"]=null,this.changeDetectorRef.markForCheck(),this.changeDetectorRef.detectChanges(),e(),this.updateEbookStyle(),this.changeDetectorRef.markForCheck(),this.changeDetectorRef.detectChanges(),this.containerStyle.transition=null}onMoveEvent(e){if(!w.isDefined(this.prevDragEvent))throw new Xt("prevDragEvent is not initialized. Call onWrapperMousedown() first.");let n=e.clientX-this.prevDragEvent.clientX,r=e.clientY-this.prevDragEvent.clientY;n&&(this.scrollContainer.scrollLeft-=n),r&&(this.scrollContainer.scrollTop-=r),!(!r&&!n)&&(this.prevDragEvent=e)}onEndDragEvent(){this.dragListeners.forEach(e=>e()),this.dragListeners.splice(0),this.changeDetectorRef.markForCheck()}rotateImage(e){return{transform:`rotate(${e}deg)`}}};D(t,"\u0275fac",function(n){return new(n||t)(_(at),_(ct),_(si),_(Me),_(rn),_(J),_(jt),_(zi),_(Ee),_(Yt))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-ebook-view"]],viewQuery:function(n,r){if(n&1&&Ye(yu,7),n&2){let c;Ie(c=Ae())&&(r.containerWrapperRef=c.first)}},inputs:{documentId:"documentId"},standalone:!1,features:[xe([J]),tn],decls:3,vars:4,consts:[["containerWrapperRef",""],[1,"container-wrapper",3,"mousedown","ngStyle"],["id","ebook","class","animated",3,"visibility","ngStyle",4,"ngIf"],["id","ebook",1,"animated",3,"ngStyle"],["class","pdf-page",4,"ngFor","ngForOf"],[1,"pdf-page"],[4,"ngIf"],[3,"pdfPage","documentId","ngStyle","imgStyle","rendered",4,"ngIf"],[3,"rendered","pdfPage","documentId","ngStyle","imgStyle"]],template:function(n,r){if(n&1){let c=ve();I(0,"div",1,0),ae("mousedown",function(v){return j(c),W(r.onWrapperMousedown(v))}),se(2,Iu,2,4,"div",2),N()}n&2&&($e("dragging",r.isDragging),T("ngStyle",r.containerWrapperStyle),x(2),T("ngIf",(r.pdfPages==null?null:r.pdfPages.length)>0))},styles:[".container-wrapper[_ngcontent-%COMP%]{cursor:grab;overflow:hidden}.container-wrapper.dragging[_ngcontent-%COMP%]{cursor:grabbing}#ebook[_ngcontent-%COMP%]{width:100%;height:100%;z-index:0;overflow:initial!important}.animated[_ngcontent-%COMP%]{transition:margin-left .2s ease-in-out}.pdf-page[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;width:100%;height:100%;background-color:#fff}.pdf-page[_ngcontent-%COMP%]   sd-image[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}[_nghost-%COMP%]  .page.p-temporal{background-color:#fff}"],changeDetection:0}));let s=t;return s})();function Au(s,t){s&1&&q(0,"sd-bottom-right-indicator")}function Du(s,t){s&1&&q(0,"sd-scale-indicator")}var Ba=(()=>{let t=class t{changeDetectorRef;subscriptionService;store$;hidableMenus={};get RuntimeEnvKey(){return ie}get runtimeEnv(){return K}viewMode;get isEbookMode(){return this.viewMode===4}get HidableView(){return B}constructor(e,n,r){this.changeDetectorRef=e,this.subscriptionService=n,this.store$=r}ngOnInit(){this.subscriptionService.push(this.store$.pipe($("viewMode")).subscribe({next:e=>{this.viewMode=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(fi([B.INDICATOR,B.INDICATOR_SCALE,B.INDICATOR_MEASURE,B.INDICATOR_PAGE])).subscribe({next:e=>{Object.assign(this.hidableMenus,e),this.changeDetectorRef.markForCheck()}}))}};D(t,"\u0275fac",function(n){return new(n||t)(_(Me),_(J),_(Ee))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-indicator"]],standalone:!1,features:[xe([J])],decls:2,vars:2,consts:[[4,"ngIf"]],template:function(n,r){n&1&&se(0,Au,1,0,"sd-bottom-right-indicator",0)(1,Du,1,0,"sd-scale-indicator",0),n&2&&(T("ngIf",!r.isEbookMode&&(!r.hidableMenus[r.HidableView.INDICATOR_MEASURE]||!r.hidableMenus[r.HidableView.INDICATOR_PAGE])),x(),T("ngIf",r.runtimeEnv.get(r.RuntimeEnvKey.SCALE_INDICATOR)&&!r.hidableMenus[r.HidableView.INDICATOR_SCALE]))},styles:["[_nghost-%COMP%]{pointer-events:none}"],changeDetection:0}));let s=t;return s})();var ku=["viewComp"];function Vu(s,t){if(s&1&&q(0,"sd-measure-body",3,0),s&2){let i=E();T("model",i.model)}}var Ua=(()=>{let t=class t{contentService;annotSelectedService;changeDetectorRef;subscriptionService;indicatorState="off";indicatorStyle={};model=null;viewComp;constructor(e,n,r,c){this.contentService=e,this.annotSelectedService=n,this.changeDetectorRef=r,this.subscriptionService=c}ngOnInit(){this.subscriptionService.push(ut(ut(this.contentService.annotListEvent$,this.contentService.annotEvent$).pipe(F(w.isDefined),F(e=>e?.sdEventType===an.SELECTED)),this.contentService.measureIndicatorEvent$.pipe(F(w.isDefined),F(e=>e.action==="create"))).subscribe({next:e=>this.toggleIndicator(e)}),this.annotSelectedService.selectionInfoChange$.subscribe({next:()=>this.toggleIndicator()}),this.contentService.measureIndicatorEvent$.pipe(F(e=>e?.action==="edit")).subscribe({next:()=>this.detectChanges()}))}detectChanges(){this.changeDetectorRef.destroyed||(this.changeDetectorRef.markForCheck(),this.viewComp?.detectChanges&&this.viewComp.detectChanges())}indicatorChanged(e,n){w.animDisplayChange(e,n,"block",null,()=>{this.indicatorState==="off"&&(this.model=null)})}turnOnIndicator(){this.indicatorState="on"}turnOffIndicator(){this.indicatorState="off"}toggleIndicator(e){let n=e;if(this.annotSelectedService.selectedComponents.length===0){this.turnOffIndicator(),this.detectChanges();return}w.isDefined(n)||(n={annot:this.annotSelectedService.selectedComponents[0].data}),Oo.hasDefinedProp(n,"annot")&&(Lt.isLineDimension(n.annot)||Lt.isPolyLineDimension(n.annot)||Lt.isPolygonDimension(n.annot))?(this.model=n.annot,this.turnOnIndicator()):this.turnOffIndicator(),this.detectChanges()}};D(t,"\u0275fac",function(n){return new(n||t)(_(at),_(Di),_(Me),_(J))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-measure-indicator"]],viewQuery:function(n,r){if(n&1&&Ye(ku,5),n&2){let c;Ie(c=Ae())&&(r.viewComp=c.first)}},standalone:!1,features:[xe([J])],decls:2,vars:3,consts:[["viewComp",""],[1,"container",3,"ngStyle"],[3,"model",4,"ngIf"],[3,"model"]],template:function(n,r){n&1&&(I(0,"div",1),ae("@indicatorState.done",function(g){return r.indicatorChanged(g,r.indicatorStyle)})("@indicatorState.start",function(g){return r.indicatorChanged(g,r.indicatorStyle)}),se(1,Vu,2,1,"sd-measure-body",2),N()),n&2&&(T("@indicatorState",r.indicatorState)("ngStyle",r.indicatorStyle),x(),T("ngIf",r.model))},styles:[".container[_ngcontent-%COMP%]{box-shadow:0 4px 32px #6c6c6c1f;box-sizing:border-box;min-width:192px;min-height:144px;position:relative;float:right;border:1px solid var(--mono-30);border-radius:2px;background-color:var(--mono-10);opacity:0;display:none;margin-right:35px;padding:16px;pointer-events:none}"],data:{animation:[Bo("indicatorState",[Tn("off",xn({opacity:0})),Tn("on",xn({opacity:1})),yo("off <=> on",wo("250ms linear"))])]},changeDetection:0}));let s=t;return s})();function Fu(s,t){s&1&&(I(0,"div"),_e(1),Y(2,"translate"),N()),s&2&&(x(),we(X(2,1,"RATIO")))}function Bu(s,t){s&1&&(I(0,"div"),_e(1),Y(2,"translate"),N()),s&2&&(x(),we(X(2,1,"PRECISION")))}function Uu(s,t){s&1&&(I(0,"div"),_e(1),Y(2,"translate"),N()),s&2&&(x(),we(X(2,1,"ROTATION")))}function Hu(s,t){if(s&1&&(I(0,"div"),_e(1),N()),s&2){let i=E();x(),we(i.model.attributes.Measure.R)}}function $u(s,t){if(s&1&&(I(0,"div"),_e(1),N()),s&2){let i=E();x(),we(1/i.precision)}}function ju(s,t){if(s&1&&(I(0,"div"),_e(1),N()),s&2){let i=E();x(),we(i.lineDegree)}}var Oc=(()=>{let t=class t{changeDetectorRef;translatePipe;model;get precision(){return!w.isDefined(this.model.attributes.Measure)||!w.isDefined(this.model.attributes.Measure.X)?2:this.model.attributes.Measure.X[0].D}get lineDegree(){if(!this.isLineDimension())return null;let{sp:e,ep:n}=this.model.attributes.coordinates;return sa.getTheta2(e.x,e.y,n.x,n.y).toFixed(Math.log10(this.precision))}get toolName(){return this.isLineDimension()?this.translatePipe.transform("DISTANCE"):this.isPolyLineDimension()?this.translatePipe.transform("PERIMETER"):this.isPolygonDimension()?this.translatePipe.transform("AREA"):this.translatePipe.transform("UNKNOWN")}get toolValue(){let e=ql.calcMeasurement(this.model);return e.length===0?"0":(Lt.isPolygonDimension(this.model)&&(e+=this.translatePipe.transform("SQUARE_OF")),e)}constructor(e,n){this.changeDetectorRef=e,this.translatePipe=n}isLineDimension(){return Lt.isLineDimension(this.model)}isPolyLineDimension(){return Lt.isPolyLineDimension(this.model)}isPolygonDimension(){return Lt.isPolygonDimension(this.model)}detectChanges(){this.changeDetectorRef.markForCheck()}};D(t,"\u0275fac",function(n){return new(n||t)(_(Me),_(He))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-measure-body"]],inputs:{model:"model"},standalone:!1,features:[xe([J])],decls:16,vars:12,consts:[[1,"title"],[1,"property"],[1,"keys"],[4,"ngIf"],[1,"values"]],template:function(n,r){n&1&&(I(0,"div",0),_e(1),Y(2,"translate"),N(),I(3,"div",1)(4,"div",2)(5,"div"),_e(6),N(),se(7,Fu,3,3,"div",3)(8,Bu,3,3,"div",3)(9,Uu,3,3,"div",3),N(),I(10,"div",4)(11,"div"),_e(12),N(),se(13,Hu,2,1,"div",3)(14,$u,2,1,"div",3)(15,ju,2,1,"div",3),N()()),n&2&&(x(),ea("",r.toolName," ",X(2,10,"TOOL"),""),x(5),we(r.toolName),x(),T("ngIf",r.model.attributes.Measure),x(),T("ngIf",r.model.attributes.Measure),x(),T("ngIf",r.isLineDimension()),x(3),we(r.toolValue),x(),T("ngIf",r.model.attributes.Measure),x(),T("ngIf",r.model.attributes.Measure),x(),T("ngIf",r.isLineDimension()))},styles:[".title[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin-bottom:14px}.property[_ngcontent-%COMP%]{display:flex}.property[_ngcontent-%COMP%]   div.keys[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin-right:16px}.property[_ngcontent-%COMP%]   div.keys[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(:first-child){margin-top:2px}.property[_ngcontent-%COMP%]   div.values[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70);flex-grow:1}.property[_ngcontent-%COMP%]   div.values[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(:first-child){margin-top:2px}"],changeDetection:0}));let s=t;return s})();var _d=(()=>{let t=class t{};D(t,"\u0275fac",function(n){return new(n||t)}),D(t,"\u0275mod",ai({type:t})),D(t,"\u0275inj",ri({imports:[$i,wn]}));let s=t;return s})();di(Oc,[bt],[He]);di(Ua,[bt,Wt,Oc],[]);function Wu(s,t){s&1&&q(0,"sd-measure-indicator")}function zu(s,t){s&1&&q(0,"sd-page-indicator")}var wc=(()=>{let t=class t{subscriptionService;store$;changeDetectorRef;hidableMenus={};get RuntimeEnvKey(){return ie}get runtimeEnv(){return K}get WindowUtil(){return G}get HidableView(){return B}constructor(e,n,r){this.subscriptionService=e,this.store$=n,this.changeDetectorRef=r}ngOnInit(){this.subscriptionService.push(this.store$.pipe(fi([B.INDICATOR_MEASURE,B.INDICATOR_PAGE])).subscribe({next:e=>{Object.assign(this.hidableMenus,e),this.changeDetectorRef.markForCheck()}}))}};D(t,"\u0275fac",function(n){return new(n||t)(_(J),_(Ee),_(Me))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-bottom-right-indicator"]],standalone:!1,features:[xe([J])],decls:2,vars:2,consts:[[4,"ngIf"]],template:function(n,r){n&1&&se(0,Wu,1,0,"sd-measure-indicator",0)(1,zu,1,0,"sd-page-indicator",0),n&2&&(T("ngIf",r.runtimeEnv.get(r.RuntimeEnvKey.MEASURE_INDICATOR)&&!r.hidableMenus[r.HidableView.INDICATOR_MEASURE]),x(),T("ngIf",!r.WindowUtil.isMobile()&&r.runtimeEnv.get(r.RuntimeEnvKey.PAGE_INDICATOR)&&!r.hidableMenus[r.HidableView.INDICATOR_PAGE]))},styles:["[_nghost-%COMP%]{position:absolute;display:flex;bottom:0;right:0;padding-bottom:40px;flex-direction:column}@media screen and (max-width: 709px){[_nghost-%COMP%]{padding-bottom:82px}}"],changeDetection:0}));let s=t;return s})();var Gu=["img"];function Yu(s,t){s&1&&q(0,"sd-loader")}var Ro=function(s){return s.VISIBLE="visible",s.INVISIBLE="invisible",s}(Ro||{}),yc=(()=>{let t=class t{pageService;changeDetectorRef;scrollController;renderer;documentService;contentService;subscriptionService;renderingService;store$;muPDFService;imgEl;MAX_WIDTH=200;MAX_HEIGHT=200;MARGIN=12;pdfPages=[];containerStyles={};imgStyles={};imgData;imgWidth;imgHeight;doc;changesSrc=new Oi;currentViewRect;currentPageNo;thumbnailRatio;currentRotation=0;cachedImageData=null;renderedPageNo=-1;renderingMode=gi.SERVER;get imgLoaded(){return this.imgEl?.nativeElement.style.visibility==="inherit"}get pageIndicatorVisible(){return this.pdfPages?.length&&this._pageIndicatorVisible||Ro.INVISIBLE}set pageIndicatorVisible(e){this._pageIndicatorVisible=e}_pageIndicatorVisible=Ro.INVISIBLE;constructor(e,n,r,c,g,v,y,M,k,Z){this.pageService=e,this.changeDetectorRef=n,this.scrollController=r,this.renderer=c,this.documentService=g,this.contentService=v,this.subscriptionService=y,this.renderingService=M,this.store$=k,this.muPDFService=Z}ngOnInit(){this.initSubscription()}initSubscription(){this.subscriptionService.push(this.store$.pipe($("currentPageNo")).pipe(Yn(),F(e=>this.currentPageNo!==e)).subscribe({next:e=>{this.currentPageNo=e,this.imgEl&&ee.setVisibility(this.imgEl.nativeElement,!1,this.renderer,!0),this.changesSrc.next()}}),this.pageService.pdfPages$.subscribe({next:e=>{this.pdfPages=e,this.changesSrc.next()}}),this.documentService.openedDocument$.pipe(F(w.isDefined)).subscribe({next:e=>{this.doc=e,this.changesSrc.next()}}),this.store$.pipe($("degree")).subscribe({next:e=>{this.currentRotation=e,this.changesSrc.next()}}),this.pageService.pageArrangeEvt$.pipe(F(e=>this.pageService.arrangeAffectedChecker(this.pageNo-1,e))).subscribe({next:()=>{w.isDefined(this.imgEl)&&ee.setVisibility(this.imgEl.nativeElement,!1,this.renderer,!0),this.renderedPageNo=-1,this.cachedImageData=null,this.changesSrc.next()}}),this.store$.pipe($("renderingMode"),rt(e=>this.renderingMode=e),F(e=>e===gi.HYBRID),st(()=>this.muPDFService.document$.pipe(F(e=>e.status==="OPENED")))).subscribe({next:()=>{this.renderedPageNo=-1,this.cachedImageData=null,this.fetch(),this.updatePage()}}),this.scrollController.currentViewRect$.pipe(F(w.isDefined),rt(e=>{this.currentViewRect=e.rect,this.updatePage()})).subscribe({next:()=>this.changesSrc.next()}),this.changesSrc.pipe(rt(()=>{this.detectChanges(),this.pageIndicatorVisible=Ro.VISIBLE}),ni(50)).subscribe({next:()=>this.fetch()}),this.changesSrc.pipe(ni(2e3)).subscribe({next:()=>{this.pageIndicatorVisible=Ro.INVISIBLE,this.renderedPageNo=-1,this.detectChanges()}}),this.contentService.reload$.pipe(Ue(e=>e.pageInfo),F(w.isDefined),F(e=>e[this.pageNo-1]),st(()=>bo(()=>this.renderingMode!==gi.CLIENT?dt(void 0):this.muPDFService.document$.pipe(F(e=>e.status==="OPENED"))))).subscribe({next:()=>{this.renderedPageNo=-1,this.cachedImageData=null,this.fetch()}}))}get pageNo(){return this.currentPageNo}get highlightRect(){return this.currentViewRect&&this.thumbnailRatio?{x:this.MARGIN+this.currentViewRect.x*this.thumbnailRatio,y:this.MARGIN+this.currentViewRect.y*this.thumbnailRatio,w:this.currentViewRect.w*this.thumbnailRatio,h:this.currentViewRect.h*this.thumbnailRatio}:{x:this.MARGIN,y:this.MARGIN,w:Number(this.imgStyles.width)||0,h:Number(this.imgStyles.height)||0}}updatePage(){if(!this.pageNo||!this.pdfPages||!this.pdfPages.length)return;let{bbox:e,r:n}=this.pdfPages[this.pageNo-1],r=this.MAX_WIDTH-this.MARGIN*2,c=this.MAX_HEIGHT-this.MARGIN*2,g=e.w,v=e.h,y=(n+this.currentRotation)/90%2===1;y&&([g,v]=[v,g]),g<v?(this.thumbnailRatio=c/v,r=g*this.thumbnailRatio):(this.thumbnailRatio=r/g,c=v*this.thumbnailRatio),this.imgWidth=r,this.imgHeight=c,this.imgStyles.display="block",this.imgStyles.width=`${y?c:r}px`,this.imgStyles.height=`${y?r:c}px`,this.imgStyles.transform=`rotate(${n+this.currentRotation}deg)`,this.containerStyles.width=`${r+this.MARGIN*2}px`,this.containerStyles.height=`${c+this.MARGIN*2}px`,this.detectChanges()}fetch(){let e=this.pageNo,n=this.cachedImageData;if(!(!this.doc||this.renderedPageNo===e||!this.pdfPages?.length)){if(n&&n.pageNo===e){if(!this.pageIndicatorVisible)return;setTimeout(()=>{this.renderedPageNo=e,this.imgData=pi({},n.imageData),w.isDefined(this.imgEl)&&ee.setVisibility(this.imgEl.nativeElement,!0,this.renderer,!0),this.detectChanges()});return}this.subscriptionService.set("httpSubscription",Ji([this.renderingService.fetchThumbnail(this.doc.streamdocsId,this.pdfPages[e-1].ref),this.store$.pipe(Yo("ALL"),Ue(r=>kn.filterChanges(r,c=>c.allowView?c.range==="all"?!0:!!Nn.parse(c.range,{min:0,max:this.pageService.pdfPages.length-1})?.includes(e-1):!1)),Ue(r=>kn.flattenWatermarks(r))),this.pageService.pageArrangeEvt$.pipe(F(r=>r.page===this.pdfPages[e-1]&&r.action==="rotate"),Vo(void 0))]).pipe(st(([r,c,g])=>{if(r.data===void 0)return this.fetch(),Ks;if(c.length===0)return dt(r);let v;switch(r.type){case"BLOB":v=URL.createObjectURL(r.data);break;case"BASE64":v=r.data;break;default:throw new St("Cannot handle image data")}return new Ur({imgSrc:v,width:this.pdfPages[e-1].bbox.w,height:this.pdfPages[e-1].bbox.h,rotation:this.pdfPages[e-1].r},c).draw()})).subscribe({next:r=>{this.pageIndicatorVisible&&(this.cachedImageData={pageNo:e,imageData:pi({},r)},this.renderedPageNo=e,this.imgData=r,w.isDefined(this.imgEl)&&ee.setVisibility(this.imgEl.nativeElement,!0,this.renderer,!0),this.detectChanges())}}))}}detectChanges(){this.changeDetectorRef.destroyed||this.changeDetectorRef.markForCheck()}};D(t,"\u0275fac",function(n){return new(n||t)(_(Yt),_(Me),_(zi),_(jt),_(ct),_(at),_(J),_(jo),_(Ee),_($o))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-page-indicator"]],viewQuery:function(n,r){if(n&1&&Ye(Gu,5),n&2){let c;Ie(c=Ae())&&(r.imgEl=c.first)}},standalone:!1,features:[xe([J])],decls:12,vars:22,consts:[["img",""],[3,"ngStyle"],["id","img-container",3,"ngStyle"],[4,"ngIf"],[3,"sdImage"],["id","page-ind-mask"],["fill","white"],["fill","black"],["fill","black","stroke","none","opacity","0.1","mask","url(#page-ind-mask)"],["fill","none","stroke","#ff2635","stroke-width","3"]],template:function(n,r){n&1&&(I(0,"div",1)(1,"div",2),se(2,Yu,1,0,"sd-loader",3),q(3,"img",4,0),N(),wi(),I(5,"svg",1)(6,"defs")(7,"mask",5),q(8,"rect",6)(9,"rect",7),N()(),q(10,"rect",8)(11,"rect",9),N()()),n&2&&(T("@showState",r.pageIndicatorVisible)("ngStyle",r.containerStyles),x(),T("ngStyle",r.imgStyles),x(),T("ngIf",!r.imgLoaded),x(),T("sdImage",r.imgData),x(2),T("ngStyle",r.containerStyles),x(3),ge("x",r.MARGIN)("y",r.MARGIN)("width",r.imgWidth)("height",r.imgHeight),x(),ge("x",r.highlightRect.x)("y",r.highlightRect.y)("width",r.highlightRect.w)("height",r.highlightRect.h),x(),ge("x",r.MARGIN)("y",r.MARGIN)("width",r.imgWidth)("height",r.imgHeight),x(),ge("x",r.highlightRect.x)("y",r.highlightRect.y)("width",r.highlightRect.w)("height",r.highlightRect.h))},styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}*[_ngcontent-%COMP%]{pointer-events:none}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{position:relative;background:var(--mono-50);border-radius:2px;display:flex;float:right;align-items:center;justify-content:center;flex-direction:column;margin:12px 35px 0 0;z-index:5}div#img-container[_ngcontent-%COMP%]{display:none;background:#fff;position:relative}div#img-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:relative;top:0;left:0;z-index:2}img[_ngcontent-%COMP%]{width:100%;height:auto;visibility:hidden}svg[_ngcontent-%COMP%]{position:absolute;left:0;top:0}"],data:{animation:[Bo("showState",[Tn(Ro.INVISIBLE,xn({opacity:0,display:"none"})),Tn(Ro.VISIBLE,xn({opacity:1,display:"flex"})),yo(`${Ro.VISIBLE} => ${Ro.INVISIBLE}`,wo("400ms linear"))])]},changeDetection:0}));let s=t;return s})();var Hn=function(s){return s.VISIBLE="visible",s.INVISIBLE="invisible",s}(Hn||{}),Sd=(()=>{let t=class t{changeDetectorRef;subscriptionService;translatePipe;store$;labelMap={};showScale=Hn.INVISIBLE;showLayout=Hn.INVISIBLE;scale;viewMode;visibilitySrc=new Oi;constructor(e,n,r,c){this.changeDetectorRef=e,this.subscriptionService=n,this.translatePipe=r,this.store$=c,this.labelMap={0:{icon:"papycon papycon-one-page3",label:this.translatePipe.transform("SINGLE_PAGE_VIEW")},1:{icon:"papycon papycon-one-page-continuous3",label:this.translatePipe.transform("SINGLE_PAGE_CONTINUOUS")},2:{icon:"papycon papycon-two-page3",label:this.translatePipe.transform("TWO_PAGE_VIEW")},3:{icon:"papycon papycon-two-page-continuous3",label:this.translatePipe.transform("TWO_PAGE_CONTINUOUS")},4:{icon:"papycon papycon-one-page",label:this.translatePipe.transform("LAYOUT_INDICATOR_EBOOK")}}}ngOnInit(){this.subscriptionService.push(this.visibilitySrc.pipe(ni(800)).subscribe({next:e=>{this.showScale=e,this.showLayout=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("scale"),Yn()).subscribe({next:e=>{this.scale=Number(e.toFixed(0)),this.showScale=Hn.VISIBLE,this.changeDetectorRef.markForCheck(),this.visibilitySrc.next(Hn.INVISIBLE)}}),this.store$.pipe($("viewMode")).subscribe({next:e=>{this.viewMode=e,this.showLayout=Hn.VISIBLE,this.changeDetectorRef.markForCheck(),this.visibilitySrc.next(Hn.INVISIBLE)}}))}};D(t,"\u0275fac",function(n){return new(n||t)(_(Me),_(J),_(He),_(Ee))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-scale-indicator"]],standalone:!1,features:[xe([J])],decls:7,vars:6,consts:[[1,"page-layout"],[1,"page-scale"]],template:function(n,r){n&1&&(I(0,"div",0),q(1,"i"),I(2,"span"),_e(3),N()(),I(4,"div",1)(5,"span"),_e(6),N()()),n&2&&(T("@showState",r.showLayout),x(),Kn(r.labelMap[r.viewMode]==null?null:r.labelMap[r.viewMode].icon),x(2),we(r.labelMap[r.viewMode]==null?null:r.labelMap[r.viewMode].label),x(),T("@showState",r.showScale),x(2),qn("",r.scale,"%"))},styles:["[_nghost-%COMP%]{position:absolute;display:flex;left:50%;top:50%;flex-direction:column;align-items:center;transform:translate(-50%,-50%);pointer-events:none}div[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;box-shadow:0 4px 8px #6c6c6c1f;color:var(--mono-99);display:flex;box-sizing:border-box;align-items:center;justify-content:center;background:var(--mono-10);border:1px solid var(--mono-30);border-radius:4px;text-align:center;cursor:default;z-index:1}div.page-layout[_ngcontent-%COMP%]{width:168px;height:168px;flex-direction:column;margin-bottom:20px}div.page-layout[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{width:80px;height:80px;font-size:80px;margin-bottom:19px}div.page-scale[_ngcontent-%COMP%]{width:100px;height:50px}"],data:{animation:[Bo("showState",[Tn(Hn.INVISIBLE,xn({opacity:0,display:"none"})),Tn(Hn.VISIBLE,xn({opacity:1,display:"flex"})),yo(`${Hn.VISIBLE} => ${Hn.INVISIBLE}`,wo("400ms linear"))])]},changeDetection:0}));let s=t;return s})();var bd=(()=>{let t=class t{};D(t,"\u0275fac",function(n){return new(n||t)}),D(t,"\u0275mod",ai({type:t})),D(t,"\u0275inj",ri({imports:[$i,xa,_d,fa]}));let s=t;return s})();di(wc,[bt,Ua,yc],[]);di(Ba,[bt,wc,Sd],[]);di(yc,[bt,Wt,ys,ga],[]);var qu=["searchComp"],Ha=s=>({content:s});function Qu(s,t){s&1&&q(0,"div",19)}function Zu(s,t){if(s&1){let i=ve();I(0,"button",21),Y(1,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.useRegex=!n.useRegex)}),q(2,"i",22),I(3,"label"),_e(4),Y(5,"translate"),N()()}if(s&2){let i=E(2);$e("dark",i.isDarkMode),ge("aria-label",X(1,11,"REGULAR_EXPRESSION"))("aria-checked",i.useRegex),x(2),$e("papycon-rounded-square",!i.useRegex)("papycon-check-mark4-filled",i.useRegex)("active",i.useRegex),x(2),we(X(5,13,"REGULAR_EXPRESSION"))}}function Ju(s,t){if(s&1){let i=ve();I(0,"button",25),Y(1,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.onClickDetail())}),q(2,"i",3),I(3,"span"),_e(4),Y(5,"translate"),N()()}if(s&2){let i=E(2);$e("dark",i.isDarkMode),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(1,5,"TEXT_SEARCH_VIEW_TITLE")),x(4),we(X(5,7,"ADVANCED_SEARCH"))}}function eg(s,t){if(s&1){let i=ve();I(0,"div",16,1)(2,"div",20)(3,"button",21),Y(4,"translate"),ae("click",function(){j(i);let n=E();return W(n.searchCaseSensitive=!n.searchCaseSensitive)}),q(5,"i",22),I(6,"label"),_e(7),Y(8,"translate"),N()(),se(9,Zu,6,15,"button",23),N(),se(10,Ju,6,9,"button",24),N()}if(s&2){let i=E();x(3),$e("dark",i.isDarkMode),ge("aria-label",X(4,13,"SEARCH_CASE_SENSITIVE"))("aria-checked",i.searchCaseSensitive),x(2),$e("papycon-rounded-square",!i.searchCaseSensitive)("papycon-check-mark4-filled",i.searchCaseSensitive)("active",i.searchCaseSensitive),x(2),we(X(8,15,"SEARCH_CASE_SENSITIVE")),x(2),Ut(i.runtimeEnv.get(i.RuntimeEnvKey.TEXT_SEARCH_VIEW_REGEX)?9:-1),x(),Ut(i.runtimeEnv.get(i.RuntimeEnvKey.FULL_SEARCH_BUTTON)?10:-1)}}var Jr=class Jr{pageService;searchService;modalService;changeDetectorRef;subscriptionService;store$;apiEventBridgeService;translatePipe;selectTextService;redactionService;get RuntimeEnvKey(){return ie}get runtimeEnv(){return K}pdfDoc;searchComp;get environment(){return Ze}searchedPage=new Set;pageCount;currentPageNo;searchCaseSensitive=!1;useRegex=!1;keyword=w.EMPTY_STRING;currentSelectedWord=0;totalSearchedWord=0;indicatorVisibility=!1;isMoreMenusVisible=!1;isSearching=!1;searchResult=[];bundleState={bundle:[],activeIndex:0};pagesLength;pages=[];isDestroying=!1;isAfterInit=!1;findSearchWordSrc=new Oi;countTotalSearchWordSrc=new Oi;keepSearchState=!1;checkWordCounting=!1;screenTheme;get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}get isMobile(){return G.isMobile()}get searchIndicatorText(){return this.indicatorVisibility&&this.currentSelectedWord>0?`${this.currentSelectedWord} / ${this.totalSearchedWord}`:"0 / 0"}get isLessThanMobileWidth(){return G.width<G.breakpoints.mobile.width}constructor(t,i,e,n,r,c,g,v,y,M){this.pageService=t,this.searchService=i,this.modalService=e,this.changeDetectorRef=n,this.subscriptionService=r,this.store$=c,this.apiEventBridgeService=g,this.translatePipe=v,this.selectTextService=y,this.redactionService=M}ngOnInit(){this.subscriptionService.push(this.store$.pipe(ci("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("pageCount")).subscribe({next:t=>this.pageCount=t}),this.store$.pipe($("currentPageNo")).subscribe({next:t=>this.currentPageNo=t}),this.pageService.pdfPages$.subscribe({next:t=>{this.pages=t,this.pagesLength=t?.length??0}}),this.findSearchWordSrc.pipe(ni(10)).subscribe({next:t=>this.initSearch(t)}),this.selectTextService.publishSelectedText$.pipe(F(()=>!this.isAfterInit),F(w.isDefined),en(1)).subscribe({next:t=>this.keyword=t.text}),this.redactionService.redactionReloadTextSearchResult$.subscribe({next:()=>{this.resubscribeSearchEvent(),this.searchStart(!0)}})),this.searchService.searchState.keyword&&(this.keyword=this.searchService.searchState.keyword,this.searchCaseSensitive=this.searchService.searchState.searchCaseSensitive,this.useRegex=this.searchService.searchState.useRegex,this.searchService.searchState.startPageIndex===-1&&(this.searchService.searchState.startPageIndex=this.searchService.searchState.pageIndex),(this.searchService.searchState.wordIndex===-1||this.searchService.searchState.pageIndex!==this.currentPageNo-1)&&(this.searchService.initSearchState(),this.searchService.bundle?.bundle.splice(0))),this.apiEventBridgeService.searchToolVisibilityChangedSrc.next({ok:!0,data:void 0})}resubscribeSearchEvent(){let t=5,i=10,e=Math.max(Math.min(Math.ceil(this.pagesLength/10),100),10),n=0;this.subscriptionService.set("searchSub",this.countTotalSearchWordSrc.pipe(Vo({keyword:w.EMPTY_STRING,caseSensitive:this.searchCaseSensitive,regex:this.useRegex,streamdocsId:this.pdfDoc.streamdocsId,isForwardSearch:!0}),ni(100),Yn((r,c)=>r.keyword===c.keyword&&r.caseSensitive===c.caseSensitive&&r.regex===c.regex&&r.streamdocsId===c.streamdocsId?(this.bundleState.bundle[0].numOfItem&&this.findSearchWordSrc.next(c.isForwardSearch),!0):(t=5,n=0,!1)),F(r=>r.keyword!==w.EMPTY_STRING),rt(r=>{this.bundleState||(this.bundleState={bundle:[],activeIndex:0},this.searchService.bundle=this.bundleState),this.searchService.searchState.keyword!==r.keyword&&(this.searchService.clearSearchHighlight(),this.searchService.initSearchState(),this.searchService.searchState.keyword=r.keyword),this.indicatorVisibility=!0,this.checkWordCounting=!1,this.totalSearchedWord=0,this.currentSelectedWord=0,this.searchService.searchState.streamdocsId=r.streamdocsId,this.searchService.searchState.searchCaseSensitive=r.caseSensitive,this.searchService.searchState.useRegex=r.regex,this.bundleState.bundle=[],this.bundleState.activeIndex=0,this.pushNewBundle(),this.changeDetectorRef.markForCheck()}),st(r=>this.searchService.getSearchResult(r.streamdocsId,r.keyword,r.caseSensitive,r.regex,this.getPageIndexes(0,i)).pipe(Ol((c,g)=>{let v=--t>0?i:e,y=t>0?(g+1)*v:n;return y>=this.pagesLength?dt(null):(this.isSearching=!0,n=y+v,this.searchService.getSearchResult(r.streamdocsId,r.keyword,r.caseSensitive,r.regex,this.getPageIndexes(y,v)))}),rt(c=>{c===null&&(this.checkWordCounting=!0)}),wl(w.isDefined),Xn(()=>{!this.totalSearchedWord&&this.checkWordCounting&&(this.indicatorVisibility=!0),this.isSearching=!1,this.searchComp?.nativeElement.focus(),this.changeDetectorRef.markForCheck()})))).subscribe({next:r=>{let c=this.bundleState.bundle[this.bundleState.bundle.length-1],g=r.length;for(let v=0;v<g;v++)c.numOfItem>100&&(c=this.pushNewBundle()),c.results.push(r[v]),c.numOfItem+=r[v].words.length,this.currentSelectedWord===0&&(this.currentSelectedWord=1,this.indicatorVisibility=!0),this.totalSearchedWord+=r[v].words.length;this.bundleState.bundle[this.bundleState.bundle.length-1]=pi({},c),this.changeDetectorRef.markForCheck()},error:()=>{this.clear(),this.modalService.createCommonModal({type:zt.ERROR,title:this.translatePipe.transform("SERVER_ERROR_TITLE"),content:this.translatePipe.transform("SERVER_ERROR_MESSAGE"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")})}}))}onKeyDown(t){if(t.key==="Enter"&&t.shiftKey){this.searchStart(!1);return}t.key==="Enter"&&this.searchStart(!0)}clear(){this.resubscribeSearchEvent(),this.bundleState&&(this.bundleState.bundle=[],this.bundleState.activeIndex=0),this.keyword=w.EMPTY_STRING,this.searchService.clearSearchHighlight()}getPageIndexes(t,i){let e=[],n=Math.min(t+i,this.pages.length);for(let r=t;r<n;++r)e.push(r);return e}pushNewBundle(){return this.bundleState.bundle[this.bundleState.bundle.push({numOfItem:0,results:[]})-1]}ngOnDestroy(){this.isDestroying=!0,this.keepSearchState||(this.searchService.clearSearchHighlight(),this.searchService.initSearchState()),this.searchResult.splice(0),this.apiEventBridgeService.searchToolVisibilityChangedSrc.next({ok:!0,data:void 0})}ngAfterViewInit(){this.isAfterInit=!0,this.resubscribeSearchEvent(),this.keyword!==w.EMPTY_STRING&&this.searchStart(!0),this.searchComp?.nativeElement.focus()}searchStart(t){(!this.searchService.searchState.keyword||this.searchService.searchState.keyword!==this.keyword)&&this.findSearchWordSrc.next(t),this.publishCountTotalSearchWord(this.pdfDoc.streamdocsId,this.keyword,this.searchCaseSensitive,this.useRegex,t)}onClearWord(){this.indicatorVisibility=!1,this.isSearching=!1,this.currentSelectedWord=0,this.totalSearchedWord=0,this.searchService.searchState.keyword="",this.searchComp?.nativeElement.focus(),this.clear()}onClickMoreMenu(){this.isMoreMenusVisible=!this.isMoreMenusVisible,this.changeDetectorRef.markForCheck()}onClickDetail(){this.keyword===""&&(this.searchService.bundle=null),this.keepSearchState=!0,this.close(),this.store$.dispatch(ue.set({key:"rightSideViewMode",value:Rt.TextSearch})),this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!0}))}initSearch(t){if(this.pdfDoc){if(this.changeDetectorRef.markForCheck(),this.keyword.length===0){this.isSearching=!1,this.changeDetectorRef.markForCheck();return}else if(this.keyword===this.searchService.searchState.keyword&&this.searchCaseSensitive===this.searchService.searchState.searchCaseSensitive&&this.useRegex===this.searchService.searchState.useRegex&&this.pdfDoc.streamdocsId===this.searchService.searchState.streamdocsId&&w.isDefined(this.searchService.searchState.pageIndex)&&this.searchResult[this.searchService.searchState.pageIndex]){this.gotoNextWord(t);return}this.searchResult.splice(0),this.searchService.searchState.searchCaseSensitive=this.searchCaseSensitive,this.searchService.searchState.useRegex=this.useRegex,this.searchService.searchState.keyword=this.keyword,this.searchService.searchState.pageIndex=this.currentPageNo-1,this.searchService.searchState.wordIndex=-1,this.searchService.searchState.streamdocsId=this.pdfDoc.streamdocsId,this.searchService.searchState.startPageIndex=this.searchService.searchState.pageIndex,this.findWord(t)}}close(){this.store$.dispatch(ue.set({key:"searchToolActive",value:!1}))}gotoNextWord(t){let i=this.searchResult[this.searchService.safePageIndex].length;if(t){if(this.currentSelectedWord++,this.currentSelectedWord>this.totalSearchedWord&&(this.currentSelectedWord=1),w.isDefined(this.searchService.searchState.wordIndex)&&this.searchService.searchState.wordIndex+1===i){this.gotoNextPage(t);return}this.searchService.safeWordIndex++}else{if(this.currentSelectedWord--,this.currentSelectedWord===0&&(this.currentSelectedWord=this.totalSearchedWord),this.searchService.safeWordIndex-1<0){this.gotoNextPage(t);return}this.searchService.safeWordIndex--}this.activateWord()}gotoNextPage(t){if(this.searchedPage.add(this.searchService.safePageIndex),t?(this.searchService.safePageIndex++,this.searchService.safePageIndex%=this.pageCount):(this.searchService.safePageIndex--,this.searchService.searchState.pageIndex===-1&&(this.searchService.searchState.pageIndex=this.pageCount-1)),this.searchedPage.size===this.pageCount){this.isSearching=!1,this.searchService.searchState.wordIndex=-1,this.searchService.searchState.startPageIndex!==this.searchService.safePageIndex-1&&this.findWord(t),this.searchedPage.clear(),this.changeDetectorRef.markForCheck();return}this.searchService.searchState.wordIndex=-1,this.findWord(t)}findWord(t){if(!this.isDestroying){if(this.searchResult[this.searchService.safePageIndex]){if(this.searchResult.every(i=>i.length===0))return;this.validateWord(t);return}this.subscriptionService.set("dataSub",this.searchService.getSearchResult(this.pdfDoc.streamdocsId,this.searchService.searchState.keyword,this.searchService.searchState.searchCaseSensitive,this.searchService.searchState.useRegex,[this.searchService.safePageIndex]).subscribe({next:i=>{this.isDestroying||(this.searchResult[this.searchService.safePageIndex]=i.length?i[0].words:[],this.validateWord(t))},error:()=>{this.searchService.searchState.keyword=w.EMPTY_STRING,this.isSearching=!1,this.modalService.createCommonModal({type:zt.ERROR,title:this.translatePipe.transform("SERVER_ERROR_TITLE"),content:this.translatePipe.transform("SERVER_ERROR_MESSAGE"),confirmButton:!0})}}))}}validateWord(t){if(this.searchResult[this.searchService.safePageIndex].length>0){if(this.searchService.searchState.wordIndex===-1)this.searchService.searchState.wordIndex=t?0:this.searchResult[this.searchService.safePageIndex].length-1;else{this.gotoNextWord(t);return}this.activateWord()}else this.gotoNextPage(t)}activateWord(){let t=this.searchService.safePageIndex;this.searchService.activateWord(this.searchResult[t][this.searchService.safeWordIndex],this.pages[t]),this.changeDetectorRef.markForCheck()}publishCountTotalSearchWord(t,i,e,n,r){this.countTotalSearchWordSrc.next({keyword:i,caseSensitive:e,regex:n,streamdocsId:t,isForwardSearch:r})}};D(Jr,"\u0275fac",function(i){return new(i||Jr)(_(Yt),_(to),_(on),_(Me),_(J),_(Ee),_(Zt),_(He),_(cn),_($r))}),D(Jr,"\u0275cmp",Ce({type:Jr,selectors:[["sd-search-tool"]],viewQuery:function(i,e){if(i&1&&Ye(qu,7),i&2){let n;Ie(n=Ae())&&(e.searchComp=n.first)}},inputs:{pdfDoc:"pdfDoc"},standalone:!1,features:[xe([J,{provide:Qn,useValue:new Vt(300)}])],decls:29,vars:55,consts:[["searchComp",""],["moreMenusRef",""],[1,"input"],[1,"papycon","papycon-search"],["type","text",3,"ngModelChange","keydown","clear","size","placeholder","maxLength","ngModel"],["class","spin-loader",4,"ngIf"],[1,"page-navigation"],["size","tiny","color","grey",1,"prev","ep-text-button",3,"click","title","tooltip","disabled"],[1,"papycon","papycon-previous-symbol2"],[1,"page-number"],["size","tiny","color","grey",1,"next","ep-text-button",3,"click","title","tooltip","disabled"],[1,"papycon","papycon-next-symbol2"],[1,"divider"],[1,"more-menu-container"],[1,"more-button","ep-text-button",3,"click","tooltip"],[1,"papycon","papycon-more-symbol3"],[1,"more-menus"],[1,"close","ep-text-button",3,"click","tooltip"],[1,"papycon","papycon-cross"],[1,"spin-loader"],[1,"options"],["role","switch","size","tiny","color","white",1,"ep-text-button",3,"click"],[1,"papycon"],["role","switch","size","tiny","color","white",1,"ep-text-button",3,"dark"],[1,"ep-text-button",3,"dark"],[1,"ep-text-button",3,"click"]],template:function(i,e){if(i&1){let n=ve();I(0,"div",2),q(1,"i",3),I(2,"input",4,0),Y(4,"translate"),Ii("ngModelChange",function(c){return j(n),Ri(e.keyword,c)||(e.keyword=c),W(c)}),ae("keydown",function(c){return j(n),W(e.onKeyDown(c))})("clear",function(){return j(n),W(e.onClearWord())}),N(),se(5,Qu,1,0,"div",5),N(),I(6,"nav",6)(7,"button",7),Y(8,"translate"),Y(9,"translate"),Y(10,"translate"),ae("click",function(){return j(n),W(e.searchStart(!1))}),q(11,"i",8),N(),I(12,"div",9),_e(13),N(),I(14,"button",10),Y(15,"translate"),Y(16,"translate"),Y(17,"translate"),ae("click",function(){return j(n),W(e.searchStart(!0))}),q(18,"i",11),N()(),q(19,"div",12),I(20,"div",13)(21,"button",14),Y(22,"translate"),ae("click",function(){return j(n),W(e.onClickMoreMenu())}),q(23,"i",15),N(),se(24,eg,11,17,"div",16),N(),I(25,"button",17),Y(26,"translate"),Y(27,"translate"),ae("click",function(){return j(n),W(e.close())}),q(28,"i",18),N()}i&2&&(x(2),T("size",e.isLessThanMobileWidth?14:28)("placeholder",X(4,27,e.isLessThanMobileWidth?"SEARCH":"SEARCH_DOCUMENT"))("maxLength",e.environment.textSearchLengthLimit),Mi("ngModel",e.keyword),x(3),T("ngIf",e.isSearching),x(2),$e("disabled",!e.totalSearchedWord||!e.keyword),T("title",e.isMobile?"":X(8,29,"BACKWARD_SEARCH"))("tooltip",vt(47,Ha,X(9,31,"BACKWARD_SEARCH")))("disabled",!e.totalSearchedWord||!e.keyword),ge("aria-label",X(10,33,"BACKWARD_SEARCH")),x(6),qn(" ",e.searchIndicatorText," "),x(),$e("disabled",!e.totalSearchedWord||!e.keyword),T("title",e.isMobile?"":X(15,35,"FORWARD_SEARCH"))("tooltip",vt(49,Ha,X(16,37,"FORWARD_SEARCH")))("disabled",!e.totalSearchedWord||!e.keyword),ge("aria-label",X(17,39,"FORWARD_SEARCH")),x(7),$e("active",e.isMoreMenusVisible),T("tooltip",vt(51,Ha,X(22,41,"MORE_MENU"))),x(3),Ut(e.isMoreMenusVisible?24:-1),x(),$e("dark",e.isDarkMode),T("tooltip",vt(53,Ha,X(26,43,"CLOSE"))),ge("color",e.isDarkMode?"white":"dark")("aria-label",X(27,45,"CLOSE")))},styles:["[_nghost-%COMP%]{box-shadow:0 4px 8px #6c6c6c1f;position:absolute;top:8px;right:8px;padding:12px;display:flex;align-items:center;column-gap:12px;justify-content:flex-end;border:1px solid var(--mono-30);border-radius:8px;background-color:var(--mono-00)}div.input[_ngcontent-%COMP%]{display:flex;margin-right:auto;padding:12px;background-color:var(--input-background);border:1px solid var(--mono-30);border-radius:4px}div.input[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{margin-right:4px;font-size:20px}div.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:0;border:0;font-size:14px;-webkit-appearance:none;appearance:none;caret-color:var(--primary-50);background-color:var(--input-background);color:var(--mono-99)}div.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:0}div.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--mono-70);opacity:1}div.input[_ngcontent-%COMP%]:has(input:focus){border-color:var(--primary-50)}.spin-loader[_ngcontent-%COMP%]{width:20px;height:20px;pointer-events:none}nav.page-navigation[_ngcontent-%COMP%]{display:flex;align-items:center;column-gap:12px}nav.page-navigation[_ngcontent-%COMP%]   .page-number[_ngcontent-%COMP%]{font-family:NotoSans-Regular,sans-serif;font-size:14px}nav.page-navigation[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:16px;color:var(--mono-90)}nav.page-navigation[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:disabled > i.papycon[_ngcontent-%COMP%]{color:var(--mono-50)}div.divider[_ngcontent-%COMP%]{width:1px;margin:10px 0;background-color:var(--mono-30)}div.more-menu-container[_ngcontent-%COMP%]{position:relative}button.more-button[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:20px;color:var(--mono-90)}button.more-button.active[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{color:var(--primary-50)}div.more-menus[_ngcontent-%COMP%]{box-shadow:0 4px 32px #6c6c6c1f;position:absolute;top:calc(100% + 4px);right:0;background-color:var(--mono-00);border:1px solid var(--mono-30);border-radius:4px}div.more-menus[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]{padding:0;display:flex;flex-direction:column;border:1px solid var(--mono-30)}div.more-menus[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;column-gap:8px;cursor:pointer}div.more-menus[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:20px;color:var(--mono-50)}div.more-menus[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i.papycon.active[_ngcontent-%COMP%]{color:var(--primary-50)}div.more-menus[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-family:NotoSans-Medium,sans-serif;font-size:13px;color:var(--mono-99);cursor:pointer}div.more-menus[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover   i.papycon[_ngcontent-%COMP%]{color:var(--primary-50)}div.more-menus[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{padding:8px}div.more-menus[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:20px;color:var(--mono-90);margin-right:8px}div.more-menus[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:hover   i.papycon[_ngcontent-%COMP%]{color:var(--mono-90-hover)}button.close[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:20px}@media screen and (max-width: 991px){[_nghost-%COMP%]{top:0;left:0;right:0;border-radius:0}}"],changeDetection:0}));var es=Jr;ze([ot(it.searchToolComp.search),ot(it.searchToolComp.searchWithRegex),ot(it.searchToolComp.searchWithCaseSensitive)],es.prototype,"publishCountTotalSearchWord",null);function tg(s,t){if(s&1&&(wi(),q(0,"path")),s&2){let i=t.$implicit;ge("d",i.path)("fill",i.color)}}var xd=(()=>{let t=class t{apiHighlightService;changeDetectorRef;subscriptionService;pdfPage;renderingInfo=[];constructor(e,n,r){this.apiHighlightService=e,this.changeDetectorRef=n,this.subscriptionService=r}ngOnInit(){this.subscriptionService.push(this.apiHighlightService.highlightInfoMapChange$.pipe(F(e=>e.pageIndex===this.pdfPage.i)).subscribe({next:e=>this.updatePath()})),this.updatePath()}updatePath(){let e=this.apiHighlightService.highlightInfoMap[this.pdfPage.i];if(!e)return;let n={};e.forEach(r=>{n[r.color]?n[r.color]+=` ${r.path}`:n[r.color]=r.path}),this.renderingInfo.splice(0),Object.keys(n).forEach(r=>{this.renderingInfo.push({color:r,path:n[r]})}),this.changeDetectorRef.markForCheck()}};D(t,"\u0275fac",function(n){return new(n||t)(_(Zo),_(Me),_(J))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-api-highlight"]],inputs:{pdfPage:"pdfPage"},standalone:!1,features:[xe([J])],decls:2,vars:1,consts:[[4,"ngFor","ngForOf"]],template:function(n,r){n&1&&(wi(),I(0,"svg"),se(1,tg,1,2,"path",0),N()),n&2&&(x(),T("ngForOf",r.renderingInfo))},dependencies:[Ei],styles:["svg[_ngcontent-%COMP%]{mix-blend-mode:multiply;position:absolute;width:100%;height:100%;top:0;left:0}"],changeDetection:0}));let s=t;return s})();var $a=class{triggerEvents=[];mainEvents=[];terminatorEvents=[];_isTriggered=!1;get isTriggered(){return this._isTriggered}listen(){this.triggerEvents.forEach(t=>{t.listening||(t.target.addEventListener(t.type,t.listener),t.listening=!0)})}unlisten(){[...this.triggerEvents,...this.mainEvents,...this.terminatorEvents].forEach(t=>{t.target.removeEventListener(t.type,t.listener),t.listening=!1}),this._isTriggered=!1}addTriggerEvent(t,i,e){this.triggerEvents.push({target:t,type:i,listener:n=>{let r=e?e(n):!0;!r&&r!==void 0||(this._isTriggered=!0,[...this.mainEvents,...this.terminatorEvents].forEach(c=>{c.listening||(c.target.addEventListener(c.type,c.listener),c.listening=!0)}))},listening:!1})}addMainEvent(t,i,e){this.mainEvents.push({target:t,type:i,listener:e,listening:!1})}addTerminatorEvent(t,i,e){this.terminatorEvents.push({target:t,type:i,listener:n=>{let r=e?e(n):!0;!r&&r!==void 0||(this._isTriggered=!1,[...this.mainEvents,...this.terminatorEvents].forEach(c=>{c.target.removeEventListener(c.type,c.listener),c.listening=!1}))},listening:!1})}};var is=class is{link;portalRef;elementRef;annotService;contentService;modalService;subscriptionService;translatePipe;store$;pageIdx="";url="";radioOption="GoTo";pageCount;constructor(t,i,e,n,r,c,g,v,y){this.link=t,this.portalRef=i,this.elementRef=e,this.annotService=n,this.contentService=r,this.modalService=c,this.subscriptionService=g,this.translatePipe=v,this.store$=y}ngOnInit(){this.subscriptionService.push(this.store$.pipe($("pageCount")).subscribe({next:t=>this.pageCount=t}),Ge(window,"keydown",{capture:!0}).pipe(F(t=>t.key==="Escape"),F(()=>this.modalService.lastModal===this.portalRef)).subscribe({next:()=>this.close()})),this.elementRef.nativeElement.parentElement.style.minWidth="375px"}close(){this.portalRef.dispose()}createLink(){if(this.link.attributes.type=this.radioOption,this.radioOption==="GoTo"){if(this.pageIdx.length===0||isNaN(Number(this.pageIdx))){this.modalService.createCommonModal({type:zt.WARN,title:this.translatePipe.transform("CREATE_LINK"),content:this.translatePipe.transform("ONLY_NUMBER_CAN_BE_PAGE_INDEX"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")});return}if(parseInt(this.pageIdx,10)>this.pageCount||parseInt(this.pageIdx,10)<1){this.modalService.createCommonModal({type:zt.WARN,title:this.translatePipe.transform("CREATE_LINK"),content:this.translatePipe.transform("INVALID_PAGE_INDEX"),confirmButton:!0});return}this.link.attributes.dest=`${parseInt(this.pageIdx,10)-1}`,this.link.attributes.contents=this.translatePipe.transform("GO_TO_PAGE").replace("%s",`${parseInt(this.pageIdx,10)}`)}else{if(this.url.length===0){this.modalService.createCommonModal({type:zt.WARN,title:this.translatePipe.transform("CREATE_LINK"),content:this.translatePipe.transform("URL_CANNOT_BE_BLANK"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")});return}this.link.attributes.dest=this.url,this.link.attributes.contents=this.translatePipe.transform("GO_TO_SITE").replace("%s",this.link.attributes.dest)}this.annotService.putModel(this.link),this.contentService.fireAnnotEvent({sdEventType:an.CREATE,annot:this.link}),this.contentService.fireAnnotListEvent({from:"AnnotComponent",sdEventType:an.CREATE,annot:this.link}),this.close()}};D(is,"\u0275fac",function(i){return new(i||is)(_(na),_(oa),_(si),_(li),_(at),_(on),_(J),_(He),_(Ee))}),D(is,"\u0275cmp",Ce({type:is,selectors:[["sd-link-creation-dialog"]],standalone:!1,features:[xe([J])],decls:23,vars:40,consts:[["tabindex","0"],["value","GoTo",3,"ngModelChange","label","ngModel"],["size","tiny","type","text",3,"ngModelChange","disabled","placeholder","autofocus","ariaLabel","ngModel"],["value","URI",3,"ngModelChange","label","ngModel"],["size","tiny","type","text",3,"ngModelChange","disabled","placeholder","ariaLabel","ngModel"],["color","white","size","small",1,"ep-button",3,"click"],["color","primary","size","small",1,"ep-button","create",3,"click"]],template:function(i,e){i&1&&(I(0,"h3",0),_e(1),Y(2,"translate"),N(),I(3,"main")(4,"pu-radio-button",1),Y(5,"translate"),Ii("ngModelChange",function(r){return Ri(e.radioOption,r)||(e.radioOption=r),r}),N(),I(6,"pu-input",2),Y(7,"translate"),Y(8,"translate"),Ii("ngModelChange",function(r){return Ri(e.pageIdx,r)||(e.pageIdx=r),r}),N(),I(9,"pu-radio-button",3),Y(10,"translate"),Ii("ngModelChange",function(r){return Ri(e.radioOption,r)||(e.radioOption=r),r}),N(),I(11,"pu-input",4),Y(12,"translate"),Y(13,"translate"),Ii("ngModelChange",function(r){return Ri(e.url,r)||(e.url=r),r}),N()(),I(14,"footer")(15,"button",5),Y(16,"translate"),ae("click",function(){return e.close()}),_e(17),Y(18,"translate"),N(),I(19,"button",6),Y(20,"translate"),ae("click",function(){return e.createLink()}),_e(21),Y(22,"translate"),N()()),i&2&&(x(),we(X(2,18,"CREATE_LINK")),x(3),T("label",X(5,20,"GO_TO_SPECIFIC_PAGE")),Mi("ngModel",e.radioOption),x(2),T("disabled",e.radioOption!=="GoTo")("placeholder",X(7,22,"PLEASE_ENTER_PAGE_NUMBER"))("autofocus",!0)("ariaLabel",X(8,24,"PLEASE_ENTER_PAGE_NUMBER")),Mi("ngModel",e.pageIdx),x(3),T("label",X(10,26,"OPEN_WEB_PAGE")),Mi("ngModel",e.radioOption),x(2),T("disabled",e.radioOption!=="URI")("placeholder",X(12,28,"PLEASE_ENTER_URL"))("ariaLabel",X(13,30,"PLEASE_ENTER_URL")),Mi("ngModel",e.url),x(4),ge("aria-label",X(16,32,"CANCEL")),x(2),we(X(18,34,"CANCEL")),x(2),ge("aria-label",X(20,36,"CREATE")),x(2),we(X(22,38,"CREATE")))},styles:["h3[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin:8px 0}main[_ngcontent-%COMP%]{font-size:13px;line-height:22px;color:var(--mono-70);white-space:pre-wrap;display:flex;flex-direction:column}main[_ngcontent-%COMP%]   pu-radio-button[_ngcontent-%COMP%], main[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{margin:8px 0}footer[_ngcontent-%COMP%]{text-align:right;margin-top:32px}footer[_ngcontent-%COMP%]   button.create[_ngcontent-%COMP%]{color:var(--mono-00)}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0}));var Cr=is;ze([ot(it.linkCreationDialogComp.createLink)],Cr.prototype,"createLink",null);var og=["scrollContainerRef"],rg=["scaleWrapper"],sg=["slideshowOverlay"];function ag(s,t){s&1&&Co(0)}function cg(s,t){if(s&1&&q(0,"sd-popups",15),s&2){E(2);let i=yi(2);T("contentViewRoot",i)}}function lg(s,t){s&1&&q(0,"sd-capture-backdrop")}function pg(s,t){if(s&1){let i=ve();I(0,"div",16)(1,"sd-page",17),ae("mousedown",function(){let n=j(i).$implicit,r=E(2);return W(r.onPageMouseDown(n))}),N()()}if(s&2){let i=t.$implicit,e=E(2);T("page",i),x(),$e("hide-outline",e.isSlideshow||e.isCaptureMode)("hide-background",e.isCaptureMode),T("priority",e.renderPriorityOf(i))("page",i)("documentId",e.documentId)}}function dg(s,t){if(s&1&&q(0,"sd-contextmenu",18),s&2){let i=E(2);T("isClickOnGrayArea",i.isClickOnGrayArea)}}function hg(s,t){if(s&1&&(Ht(0),se(1,cg,1,1,"sd-popups",10)(2,lg,1,0,"sd-capture-backdrop",6),I(3,"div",11,2)(5,"div",12),se(6,pg,2,8,"div",13),N(),se(7,dg,1,1,"sd-contextmenu",14),N(),$t()),s&2){let i=E();x(),T("ngIf",i.pdfPages.length),x(),T("ngIf",i.isCaptureMode),x(),$e("capture-mode",i.isCaptureMode),x(3),T("ngForOf",i.pdfPages)("ngForTrackBy",i.trackByPage),x(),T("ngIf",i.shouldShowContextMenu)}}function ug(s,t){if(s&1&&q(0,"sd-ebook-view",19),s&2){let i=E();T("documentId",i.documentId)}}function gg(s,t){s&1&&q(0,"div",20,3)}function fg(s,t){s&1&&Co(0)}function mg(s,t){s&1&&q(0,"sd-quick-action")}function vg(s,t){if(s&1&&q(0,"sd-search-tool",21),s&2){let i=E();T("pdfDoc",i.pdfDoc)}}function _g(s,t){s&1&&q(0,"sd-indicator")}function Sg(s,t){if(s&1&&q(0,"sd-floating-nav",23),s&2){let i=E(2);T("pdfDoc",i.pdfDoc)}}function bg(s,t){if(s&1&&se(0,Sg,1,1,"sd-floating-nav",22),s&2){let i=E();T("ngIf",i.runtimeEnv.get(i.MergedRuntimeEnvKey.FLOATING_NAVIGATION)&&!i.hidableMenus[i.HidableView.FLOATING_NAV]&&!1)}}var ns=function(s){return s[s.UP=1]="UP",s[s.DOWN=2]="DOWN",s[s.UNKNOWN=3]="UNKNOWN",s}(ns||{}),os=class os{acroFormService;annotService;changeDetectorRef;documentService;pageService;annotSelectedService;contentService;scrollController;store$;viewerService;subscriptionService;apiEventBridgeService;guideLineService;modalService;sdContextMenuService;selectTextService;renderer;toastService;translatePipe;dapService;shortcutService;loggingService;captureService;localStorageService;popupService;get RuntimeEnvKey(){return ie}get MergedRuntimeEnvKey(){return Tt}get runtimeEnv(){return K}get HidableView(){return B}get shouldShowContextMenu(){return this.isContextMenuOpened&&!this.hidableMenus[B.CONTEXT_MENU]}pdfDoc;overWrittenZoom;centerPoint=null;scrollContainerRef;scaleWrapper;contentView;slideshowOverlay;scale;prevScale=null;degree;viewMode;dragMode;currentPageNo;pageCount;searchToolActive;isR2L;isContextMenuOpened=!1;clickedPage=null;isClickOnGrayArea=!1;isCaptureMode=!1;pdfPages=[];preferences=null;selectedText=null;hidableMenus={};originalViewMode;originalScale;originalPageNo;renderingMode;rulerActive;draggingListener=new $a;bufferSize=null;get documentId(){return this.pdfDoc?this.pdfDoc.streamdocsId:null}stateHolder;get contentViewStyle(){return this.dragMode!==Mt.MOVE?null:{cursor:`grab${this.draggingListener.isTriggered?"bing":w.EMPTY_STRING}`}}get isSlideshow(){return this.stateHolder?.isSlideshow}get contentViewElement(){return this.scrollContainerRef.nativeElement}get lastViewScale(){return Number(this.localStorageService.get("SD_Scale","100"))}set lastViewScale(t){this.localStorageService.set("SD_Scale",t.toString())}mobileZoomer=null;pdfInfo=null;constructor(t,i,e,n,r,c,g,v,y,M,k,Z,le,pe,he,Te,p,ht,_t,gt,Pi,At,hi,vi,Oe){this.acroFormService=t,this.annotService=i,this.changeDetectorRef=e,this.documentService=n,this.pageService=r,this.annotSelectedService=c,this.contentService=g,this.scrollController=v,this.store$=y,this.viewerService=M,this.subscriptionService=k,this.apiEventBridgeService=Z,this.guideLineService=le,this.modalService=pe,this.sdContextMenuService=he,this.selectTextService=Te,this.renderer=p,this.toastService=ht,this.translatePipe=_t,this.dapService=gt,this.shortcutService=Pi,this.loggingService=At,this.captureService=hi,this.localStorageService=vi,this.popupService=Oe}ngOnChanges(){this.clearAllCache(),this.contentService.publishTSAValidation(null)}ngOnInit(){this.initDraggingListener(),this.initSubscribers(),G.isTouchableDevice()&&this.buildMobileZoomer()}ngOnDestroy(){this.draggingListener.unlisten(),this.dapService.resetCheckbox(),this.destroyMobileZoomer(),this.finalizeSubscribers(),this.scrollController.stop(),this.clearAllCache(),this.contentService.publishTSAValidation(null),Xi.destroy(this)}onRightMouseUp(t){t.button!==2||this.dragMode===Mt.MAGNIFY||this.annotSelectedService.selectedComponents.length||this.isSlideshow||K.get(ie.CONTEXT_MENU_TOOLS_IN_USE).length===0||(this.sdContextMenuService.rightClickAction?.(),this.sdContextMenuService.mouseEvent=t)}onPdfDocumentReady(t,i=null){this.pdfInfo=i,this.store$.dispatch(ue.set({key:"pageCount",value:t.length}));let e=this.preferences&&this.preferences.viewerDirection===0?this.pdfInfo?.ViewerPreferences?.Direction==="R2L":this.preferences?.viewerDirection===2;this.store$.dispatch(ue.set({key:"isR2L",value:e})),this.stateHolder=new Ui,this.stateHolder.pdfPages=t,this.stateHolder.degree=this.degree,this.stateHolder.isR2L=!!this.isR2L,this.scrollController.start(this.stateHolder,this.contentViewElement),this.subscribePageArrange(),this.subscribeMainViewResized(),this.subscribeViewChange(),this.subscribeWheelZoom(),this.subscriptionService.set("contextmenuPositionSub",G.windowMouseMoveEvent$.pipe(hr(50,cc,{trailing:!0})).subscribe({next:c=>this.sdContextMenuService.mouseEvent=c.srcEvent}));let n={fitWidth:0,fitHeight:1,fitPage:3,actualSize:4,maintain:7},r=w.isDefined(this.overWrittenZoom)&&this.overWrittenZoom.length>0&&!Number.isNaN(Number(this.overWrittenZoom))?{scale:Number(this.overWrittenZoom)}:{fitMode:w.isDefined(this.overWrittenZoom)?n[this.overWrittenZoom]:this.preferences?.pageFitMode};this.centerPoint?this.contentService.requestViewChange(Rr(pi({},r),{center:this.centerPoint,pageNo:this.currentPageNo})):"scale"in r?this.contentService.requestViewChange(Rr(pi({},r),{pageNo:this.currentPageNo})):this.contentService.requestViewChange(r),Xi.runAsync(()=>this.apiEventBridgeService.documentReadySrc.next({ok:!0,data:void 0}))}trackByPage(t,i){return`${i.i}/${i.ref}`}renderPriorityOf(t){return this.currentPageNo-t.i-1}onPageMouseDown(t){return this.pageService.publishPage(t),this.annotSelectedService.unselectAll(),!0}isEbookMode(){return this.viewMode===4&&this.documentService.eBookStatus}canTextSearch(){return this.documentService.checkAuthority(Ne.SEARCH_TEXT)}destroyMobileZoomer(){this.mobileZoomer&&this.mobileZoomer.destroy(),this.mobileZoomer=null}buildMobileZoomer(){this.destroyMobileZoomer(),this.mobileZoomer=new yp(this,this.contentViewElement,this.scrollController)}clearAllCache(){this.annotService.clearActionLogs(),this.acroFormService.clearActionLogs(),this.pageService.clearPageArrangeLogs()}isViewChangeRequestPosition(t){return t.position!==void 0}isViewChangeRequestViewport(t){return t.viewport!==void 0}isViewChangeRequestCenter(t){return t.center!==void 0}isViewChangeRequestReferencePoint(t){return t.referencePoint!==void 0}isPageOffsetReferencePoint(t){return t instanceof Object&&t.hasOwnProperty("pageNo")&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")}subscribeViewChange(){this.subscriptionService.get("viewChange")===void 0&&this.subscriptionService.set("viewChange",this.contentService.viewChangeRequest$.subscribe({next:t=>{let i=this.currentPageNo,e,n,r,c;this.isViewChangeRequestReferencePoint(t)||(t.pageNo!==void 0&&(i=Math.min(Math.max(1,t.pageNo<0?this.pageCount-t.pageNo+1:t.pageNo),this.pageCount+1)),t.viewMode!==void 0&&(e=t.viewMode),t.degree!==void 0&&(n=ee.normalizeDegree(t.degree)),this.isViewChangeRequestViewport(t)||(r=t.fitMode)),!this.isViewChangeRequestViewport(t)&&t.scale!==void 0&&(c=t.scale);let g=this.getCurrentRenderingInfo();if(this.isSlideshow?c=this.calculateScaleForFit(i,6,e??this.viewMode,n??this.degree):this.isViewChangeRequestViewport(t)?c=this.calculateScaleForRect(i,t.viewport):w.isDefined(r)?(c=this.calculateScaleForFit(i,r,e??this.viewMode,n??this.degree),this.store$.dispatch(ue.set({key:"fitMode",value:r}))):w.isDefined(c)&&this.store$.dispatch(ue.set({key:"fitMode",value:null})),c!==void 0){let y=this.renderingMode===gi.SERVER?Ze.maxScale:K.get(ie.CLIENT_RENDERING_MAXIMUM_SCALE).value;t.checkScale&&(c=this.checkScaleForFit(this.scale,c,i,e??this.viewMode,n??this.degree)),this.store$.dispatch(ue.set({key:"scale",value:Math.min(Math.max(c,Ze.minScale),y)}))}e!==void 0&&this.store$.dispatch(ue.set({key:"viewMode",value:e})),n!==void 0&&(this.stateHolder.degree=n,this.store$.dispatch(ue.set({key:"degree",value:n}))),i!==this.currentPageNo&&this.store$.dispatch(ue.set({key:"currentPageNo",value:i})),this.bufferPages();let v=this.stateHolder.pdfPages[i-1];if(this.isViewChangeRequestPosition(t))this.scroll(v,{position:t.position});else if(this.isViewChangeRequestViewport(t)){let y=t.viewport;this.scroll(v,{x:(y.right+y.left)/2,y:(y.top+y.bottom)/2})}else if(this.isViewChangeRequestCenter(t))this.scroll(v,t.center);else if(this.isViewChangeRequestReferencePoint(t)){let y=this.isPageOffsetReferencePoint(t.referencePoint)?this.convertPageOffset2ViewOffset(g,t.referencePoint.pageNo,t.referencePoint.x,t.referencePoint.y):t.referencePoint,M=this.calculateScrollOnRescale(g,y);this.scroll(v,M)}else if(t.fitMode===void 0&&t.scale===void 0&&t.degree===void 0&&t.pageNo===void 0&&t.top===void 0&&t.left===void 0&&t.viewMode!==void 0){let y=this.calculateScrollOnViewModeChange(g);this.scroll(v,y)}else if(t.fitMode===void 0&&t.degree===void 0&&t.pageNo===void 0&&t.top===void 0&&t.left===void 0&&t.viewMode===void 0&&t.scale!==void 0){let y=this.calculateScrollOnRescale(g,{clientX:0,clientY:0});this.scroll(v,y)}else if(t.top===void 0&&t.left===void 0){let y=this.calculateScaleForFit(i,0,t.viewMode??this.viewMode,t.degree??this.degree);this.scroll(v,{position:this.scale>y?mi.TOP_LEFT:mi.TOP_CENTER})}else this.scroll(v,{x:t.left,y:t.top,placeInTopLeft:!0});if(!w.isDefined(this.scaleWrapper)){this.loggingService.common("error",Le.NOT_EXIST,"scaleWrapper");return}this.updateOffsetForGuideline(),this.scrollController.calcViewRectSrc.next(!0),this.apiEventBridgeService.viewModeChangeAppliedSrc.next({ok:!0,data:void 0}),this.apiEventBridgeService.scaleChangeAppliedSrc.next({ok:!0,data:void 0}),this.apiEventBridgeService.rotateChangeAppliedSrc.next({ok:!0,data:void 0}),this.apiEventBridgeService.fitModeAppliedSrc.next({ok:!0,data:void 0}),this.apiEventBridgeService.viewerSizeSrc.next({ok:!0,data:{width:this.scaleWrapper.nativeElement.offsetWidth,height:this.scaleWrapper.nativeElement.offsetHeight}})}}))}checkScaleForFit(t,i,e,n,r){let c=this.calculateScaleForFit(e,1,n,r),g=this.calculateScaleForFit(e,0,n,r),v=i;return t<i?t<g&&g<i&&t<c&&c<i?(v=Math.min(g,c),this.prevScale=i):t<g&&g<i?(v=g,this.prevScale=i):t<c&&c<i?(v=c,this.prevScale=i):typeof this.prevScale=="number"&&t<this.prevScale&&this.prevScale<i&&(v=this.prevScale,this.prevScale=null):t>i&&(t>g&&g>i&&t>c&&c>i?(v=Math.max(g,c),this.prevScale=i):t>g&&g>i?(v=g,this.prevScale=i):t>c&&c>i?(v=c,this.prevScale=i):typeof this.prevScale=="number"&&t>this.prevScale&&this.prevScale>i&&(v=this.prevScale,this.prevScale=null)),v}subscribeWheelZoom(){if(this.subscriptionService.get("wheelZoom")!==void 0)return;let t={x:0,y:0},i,e=G.windowScrollEvent$.pipe(F(()=>!this.scrollController.stateHolder?.isSlideshow),F(n=>n!==void 0&&(n.ctrlKey||n.metaKey||n.altKey)));this.subscriptionService.push(G.windowMouseMoveEvent$.pipe(hr(100,cc,{trailing:!0})).subscribe({next:n=>{t.x=n.x,t.y=n.y}}),e.pipe(hr(500)).subscribe({next:()=>{i=this.scrollContainerRef.nativeElement.getBoundingClientRect()}})),this.subscriptionService.set("wheelZoom",e.subscribe({next:n=>{n.preventDefault(),this.changeZoomByWheel(t,i,n.deltaY)}}))}subscribePageArrange(){this.subscriptionService.get("pageArrange")===void 0&&this.subscriptionService.set("pageArrange",this.pageService.pageArrangeEvt$.pipe(F(w.isDefined),rt(t=>{this.store$.dispatch(ue.set({key:"pageCount",value:this.stateHolder.pdfPages.length})),this.stateHolder.pdfPages=this.pageService.pdfPages,this.pdfPages.splice(0);let i=this.detectPageNo();if(this.bufferPages(),(t.action==="copy"||t.action==="delete")&&i>0){let e=this.stateHolder.pdfPages[i-1];this.scroll(e,{position:mi.TOP_CENTER})}}),F(t=>!t.isTemporary),F(t=>t.action!=="rotate")).subscribe({next:t=>this.annotService.processPageArrangeEvt(t)}))}subscribeMainViewResized(){if(this.subscriptionService.get("mainViewResized")!==void 0)return;let t=()=>{this.viewMode!==4&&this.contentView.update(this.stateHolder,this.scale,this.viewMode,this.currentPageNo,this.degree),this.changeDetectorRef.markForCheck()};this.subscriptionService.set("mainViewResized",ut(G.windowResize$,this.store$.pipe($("sideViewVisible")),this.store$.pipe($("sideViewSize")),this.store$.pipe($("rightSideViewVisible")),this.store$.pipe($("rightSideViewSize")),this.store$.pipe(fi([B.SIDE_VIEW,B.SIDE_VIEW_THUMBNAIL,B.SIDE_VIEW_BOOKMARK,B.SIDE_VIEW_ANNOTATION,B.SIDE_VIEW_REDACTION,B.SIDE_VIEW_EMBEDDED_FILE,B.SIDE_VIEW_FORM,B.SIDE_VIEW_SIGNATURE,B.CONTEXT_MENU,B.FLOATING_NAV,B.INDICATOR]))).subscribe({next:i=>{Object.assign(this.hidableMenus,i),t(),this.subscriptionService.push(Xi.runAsync(()=>t()))}}))}initSubscribers(){this.subscriptionService.push(this.store$.pipe(ci("screenTheme")).subscribe({next:t=>this.setColorTheme(t)}),this.store$.pipe($("scale")).subscribe({next:t=>this.scale=t}),this.store$.pipe($("scale"),Js(1),ni(100)).subscribe({next:t=>this.lastViewScale=t}),this.store$.pipe($("degree")).subscribe({next:t=>this.degree=t}),this.store$.pipe($("viewMode")).subscribe({next:t=>this.viewMode=t}),this.store$.pipe($("renderingMode")).subscribe({next:t=>this.renderingMode=t}),this.store$.pipe($("rulerActive")).subscribe({next:t=>{this.rulerActive=t,this.rulerActive&&this.updateOffsetForGuideline()}}),this.store$.pipe($("dragMode")).subscribe({next:t=>{this.dragMode=t,this.dragMode===Mt.MOVE?this.draggingListener.listen():this.draggingListener.unlisten()}}),this.store$.pipe($("pageCount")).subscribe({next:t=>this.pageCount=t}),this.store$.pipe($("isR2L")).subscribe({next:t=>this.isR2L=t}),this.store$.pipe($("currentPageNo")).subscribe({next:t=>{this.currentPageNo=t,this.updateOffsetForGuideline()}}),this.store$.pipe($("searchToolActive")).subscribe({next:t=>{if(!this.canTextSearch()){this.apiEventBridgeService.searchToolVisibilityChangedSrc.next({ok:!1,error:new To("Unauthorized")});return}this.searchToolActive=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(ci()).subscribe({next:t=>{this.preferences=t;let i=this.preferences&&this.preferences.viewerDirection===0?this.pdfInfo?.ViewerPreferences?.Direction==="R2L":this.preferences.viewerDirection===2;if(this.isR2L!==i){if(this.store$.dispatch(ue.set({key:"isR2L",value:i})),this.pdfPages.splice(0),!this.scrollController||!this.stateHolder)return;this.stateHolder.isR2L=i,this.bufferPages()}this.changeDetectorRef.detectChanges()}}),this.store$.pipe($("isCaptureMode")).subscribe({next:t=>{t&&(this.store$.dispatch(Ki.unselectTool()),this.annotSelectedService.unselectAll(),this.popupService.closeAllPopup()),this.isCaptureMode=t,this.changeDetectorRef.markForCheck()}}),Ji([this.contentService.bufferSizeChange$.pipe(F(w.isDefined)),this.store$.pipe($("pageCount"),F(t=>t>0))]).subscribe({next:([t,i])=>{if(t>=i||t===0){this.bufferSize=i;return}this.bufferSize=t}}),Ji([this.pageService.pdfPages$,this.documentService.pdfInfo$]).pipe(F(([t,i])=>t.length>0&&this.pdfInfo!==i)).subscribe({next:([t,i])=>this.onPdfDocumentReady(t,i)}),this.contentService.enableLinkCreationDialog$.subscribe({next:t=>this.modalService.createModal(Cr,t)}),this.contentService.rebufferPages$.subscribe({next:()=>{this.stateHolder.pdfPages=this.pageService.pdfPages,this.stateHolder.degree=this.degree,this.stateHolder.isR2L=!!this.isR2L,this.bufferPages()}}),this.sdContextMenuService.contextMenuStatus$.subscribe({next:t=>{this.isContextMenuOpened=t,this.changeDetectorRef.markForCheck()}}),G.windowMousedown$.pipe(F(t=>w.isDefined(this.selectedText?.textBox)&&t.button===2)).subscribe({next:t=>{let i=this.selectedText.page.i,e=this.clickedPage?.i;(i!==e||t.target===this.scaleWrapper?.nativeElement)&&this.selectTextService.publishSelectedText(null)}}),G.windowMousedown$.pipe(F(()=>!this.isEbookMode())).subscribe({next:t=>this.isClickOnGrayArea=t.target===this.scaleWrapper.nativeElement}),this.pageService.clickedPage$.subscribe({next:t=>this.clickedPage=t}),this.selectTextService.publishSelectedText$.subscribe({next:t=>{t&&(G.isMobile()||G.isTablet()||G.isTouchableDevice())&&this.sdContextMenuService.publishContextMenuStatus(!0),this.selectedText=t}}),this.shortcutService.getShortcutEvent(Re.COPY_TEXT).pipe(F(()=>K.get(ie.SHORTCUT_COPY_TEXT)),F(()=>this.documentService.checkAuthority(Ne.COPY_TEXT)),F(()=>w.isDefined(this.selectedText)&&this.selectedText.text.length>0),F(()=>!this.annotSelectedService.selectedComponents.length)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.copyToClipboard(this.selectedText.text)}}),this.store$.pipe($("isSlideshow"),F(t=>t),st(t=>{if(!w.getFullscreenMethod(this.contentViewElement))return this.store$.dispatch(ue.set({key:"isSlideshow",value:!1})),this.toastService.create({toastStyle:Gt.NOTIFICATION,content:this.translatePipe.transform("NOT_SUPPORTED_BROWSER_SLIDESHOW")}),dt();this.stateHolder.isSlideshow=t,this.originalViewMode=this.viewMode,this.originalScale=this.scale,this.originalPageNo=this.currentPageNo;let i=w.getFullscreenMethod(this.contentViewElement),e=this.contentViewElement;return i!=="requestFullscreen"?typeof e[i]=="function"?dt(e[i].call(this.contentViewElement)):Gn(()=>new Cn("Fullscreen is not supported in this browser or element.")):this.contentViewElement.requestFullscreen()})).subscribe(),So(w.getFullscreenEventNames()).pipe(Ys(t=>Ge(G.nativeWindow,t)),F(t=>t.target===this.contentViewElement),bl(0),F(t=>t.length>0)).subscribe({next:()=>{if(w.isFullscreenMode()){this.renderer.setStyle(this.contentViewElement,"background-color","black"),this.renderer.setStyle(this.slideshowOverlay.nativeElement,"background-color","transparent"),this.subscribeSlideshowEvent(),this.contentService.requestViewChange({viewMode:0,fitMode:6,pageNo:1});return}this.unsubscribeSlideshowEvent(),this.stateHolder.isSlideshow=!1,this.scrollController.moveToPage(this.originalPageNo),this.renderer.setStyle(this.contentViewElement,"background-color",""),this.store$.dispatch(ue.set({key:"isSlideshow",value:!1})),this.contentService.requestViewChange({viewMode:this.originalViewMode,scale:this.originalScale})}}),this.viewerService.backgroundColor$.subscribe({next:t=>{this.renderer.setStyle(this.contentViewElement,"background-color",`${t}`)}}),(()=>{let t=()=>this.scrollContainerRef.nativeElement.scrollTop/ee.normalizeScale(this.scale),i=t();return Ge(this.scrollContainerRef.nativeElement,"scroll",{passive:!1}).pipe(F(()=>!this.isEbookMode())).subscribe({next:e=>{if(this.scrollController.publishScrollEvent(e),this.scrollController.calcViewRectSrc.next(!0),!ee.isContinuousMode(this.viewMode))return;let n=t();this.publishScrollPosition();let r=this.detectPageNo(i<n?ns.DOWN:ns.UP),c=this.pageCount>0?this.pageCount:this.stateHolder.pdfPages.length;i=n,r!==this.currentPageNo&&(this.store$.dispatch(ue.set({key:"currentPageNo",value:Math.min(Math.max(1,r),c)})),this.bufferPages())}})})())}setColorTheme(t){switch(t){case"light":this.renderer.setAttribute(document.body,"theme","light");break;case"dark":this.renderer.setAttribute(document.body,"theme","dark");break;default:let i=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";this.renderer.setAttribute(document.body,"theme",i)}}publishScrollPosition(){this.guideLineService.publishScrollOffset({offsetX:this.scrollContainerRef.nativeElement.scrollLeft,offsetY:this.scrollContainerRef.nativeElement.scrollTop})}convertPageOffset2ViewOffset(t,i,e,n){let r=t.pageOffsets.find(M=>M.index===i-1),c=ee.normalizeScale(t.scale),g=this.stateHolder.pdfPages[i-1],{scrollLeft:v,scrollTop:y}=this.convertPDFCoord2DOMCoord(g,{x:e,y:n});return{clientX:r.left*c+v-this.scrollContainerRef.nativeElement.scrollLeft,clientY:r.top*c+y-this.scrollContainerRef.nativeElement.scrollTop}}detectPageNo(t=ns.UNKNOWN){if(this.stateHolder.pdfPages.length<=1)return this.stateHolder.pdfPages.length;let i=ee.normalizeScale(this.scale),e=this.scrollContainerRef.nativeElement,n=this.currentPageNo>0?this.currentPageNo:1,r=Math.min(n,this.stateHolder.pdfPages.length),c=ee.getPageMovement(this.viewMode),g=this.stateHolder.pdfPages[r-1],v=this.stateHolder.getPageFrameOffset(this.viewMode,g.i).offsetY*i;if(t===ns.UP)v>e.scrollTop+e.clientHeight*2/3?(g=this.stateHolder.pdfPages.slice(0,g.i+1).reverse().find(y=>this.stateHolder.getPageFrameOffset(this.viewMode,y.i).offsetY*i<=e.scrollTop+e.clientHeight*2/3),g&&(r=g.i-g.i%c+1)):r=g.i+1;else if(t===ns.DOWN)v+this.stateHolder.getPageSize(g.i).height*i<e.scrollTop+Number(e.clientHeight)/3?(g=this.stateHolder.pdfPages.slice(g.i).find(M=>i*(this.stateHolder.getPageFrameOffset(this.viewMode,M.i).offsetY+this.stateHolder.getPageSize(M.i).height)>e.scrollTop+Number(e.clientHeight)/3),g&&(r=g.i-g.i%c+1)):r=g.i+1;else{let y=e.clientHeight/2,M=this.stateHolder.pdfPages.find(k=>this.stateHolder.getPageFrameOffset(this.viewMode,k.i).offsetY*ee.normalizeScale(this.scale)>e.scrollTop+y);r=M?Math.max(1,M.i):this.stateHolder.pdfPages.length}return r}bufferPages(){if(this.viewMode===4)return;let t=ee.getPageMovement(this.viewMode),i=(ee.isContinuousMode(this.viewMode)?Math.ceil(1/ee.normalizeScale(this.scale)*t):t)+Ui.OPTIONAL_VISIBLE_PAGE,[e,n]=sa.truncateRange(0,this.pageCount,this.currentPageNo,w.isDefined(this.bufferSize)?this.bufferSize/2:i);this.stateHolder.bufferedPages.splice(0);for(let r=e;r<n;r++)this.stateHolder.bufferedPages.push(this.stateHolder.pdfPages[r]);this.pdfPages.splice(0),this.pdfPages.push(...this.stateHolder.bufferedPages),this.changeDetectorRef.detectChanges(),this.contentView.update(this.stateHolder,this.scale,this.viewMode,this.currentPageNo,this.degree),this.contentService.bufferPage(this.stateHolder.bufferedPages)}isPDFCoordDestination(t){return t instanceof Object&&(t.hasOwnProperty("x")||t.hasOwnProperty("y"))}isDOMCoordDestination(t){return t instanceof Object&&(t.hasOwnProperty("scrollLeft")||t.hasOwnProperty("scrollTop"))}isPositionDestination(t){return t instanceof Object&&t.hasOwnProperty("position")}scroll(t,i){if(this.viewMode===4){console.warn("Scroll request was ignored during eBook mode.");return}let e=this.stateHolder.getPageFrameOffset(this.viewMode,t.i),n=ee.normalizeScale(this.scale),r={};if(this.isPDFCoordDestination(i)){let{scrollLeft:c,scrollTop:g}=this.convertPDFCoord2DOMCoord(t,{x:i.x??0,y:i.y??0});i.x!==void 0&&(r.scrollLeft=e.offsetX*n+c,i.placeInTopLeft||(r.scrollLeft-=this.scrollContainerRef.nativeElement.clientWidth/2)),i.y!==void 0&&(r.scrollTop=e.offsetY*n+g,i.placeInTopLeft||(r.scrollTop-=this.scrollContainerRef.nativeElement.clientHeight/2))}else this.isDOMCoordDestination(i)?r=i:this.isPositionDestination(i)&&(r=this.convertPosition2DOMCoord(t,{clientX:e.offsetX*n,clientY:e.offsetY*n},i));r.scrollLeft!==void 0&&(this.scrollContainerRef.nativeElement.scrollLeft=r.scrollLeft),r.scrollTop!==void 0&&(this.scrollContainerRef.nativeElement.scrollTop=r.scrollTop)}convertPDFCoord2DOMCoord(t,i){let e=t.bbox,n=ee.normalizeScale(this.scale),r=ee.normalizeDegree(this.degree+t.r);(i.x===void 0||i.y===void 0)&&this.loggingService.common("warn",Le.NOT_EXIST,"scrollDestination");let c=0,g=0,v=i.x,y=i.y;switch(r){case 0:c=v-e.x,g=e.h-(y-e.y);break;case 90:c=y-e.y,g=v-e.x;break;case 180:c=e.w-(v-e.x),g=y-e.y;break;case 270:c=e.h-(y-e.y),g=e.w-(v-e.x);break;default:throw Error("Rotate must be a multiple of 90")}return{scrollLeft:c*n,scrollTop:g*n}}convertPosition2DOMCoord(t,i,e){let n=t.bbox,r=ee.normalizeScale(this.scale),g=ee.normalizeDegree(this.degree+t.r)/90%2!==0,v,y;switch(e.position){case mi.TOP_ONLY:case mi.BOTTOM_ONLY:break;case mi.TOP_LEFT:case mi.LEFT_ONLY:case mi.BOTTOM_LEFT:v=i.clientX;break;case mi.TOP_CENTER:case mi.BOTTOM_CENTER:v=i.clientX+(g?n.h:n.w)*r/2-this.scrollContainerRef.nativeElement.clientWidth/2+Ui.MARGIN*r;break;case mi.RIGHT_ONLY:v=i.clientX+(g?n.h:n.w)*r-this.scrollContainerRef.nativeElement.clientWidth+Ui.MARGIN*r;break}switch(e.position){case mi.LEFT_ONLY:case mi.RIGHT_ONLY:break;case mi.TOP_ONLY:case mi.TOP_LEFT:case mi.TOP_CENTER:y=i.clientY;break;case mi.BOTTOM_ONLY:case mi.BOTTOM_LEFT:case mi.BOTTOM_CENTER:y=(g?n.w:n.h)*r-this.scrollContainerRef.nativeElement.clientHeight+Ui.MARGIN*r;break}return{scrollLeft:v,scrollTop:y}}getCurrentRenderingInfo(){let t=this.scrollContainerRef.nativeElement,i={degree:this.degree,scale:this.scale,scrollLeft:t.scrollLeft,scrollTop:t.scrollTop,pageOffsets:[]},e=ee.normalizeScale(this.scale);if(ee.isContinuousMode(this.viewMode))this.pdfPages.forEach(n=>{let r=this.stateHolder.getPageFrameOffset(this.viewMode,n.i);i.pageOffsets.push({left:r.offsetX,top:r.offsetY,index:n.i})});else{let n=oo.getOffset(this.stateHolder,this.scrollContainerRef.nativeElement,this.scale,this.viewMode,this.currentPageNo);i.pageOffsets.push({left:n.offsetX/e,top:n.offsetY/e,index:this.currentPageNo-1})}return i}calculateScrollOnRescale(t,i){let e=ee.normalizeScale(t.scale),n=ee.normalizeScale(this.scale);return{scrollLeft:(t.scrollLeft+i.clientX)/e*n-i.clientX,scrollTop:(t.scrollTop+i.clientY)/e*n-i.clientY}}calculateScrollOnViewModeChange(t){let i=ee.normalizeScale(t.scale),e=t.pageOffsets.find(y=>y.index===this.currentPageNo-1),n=e?e.left*i-t.scrollLeft:0,r=e?e.top*i-t.scrollTop:0,c,g,v=ee.normalizeScale(this.scale);if(ee.isContinuousMode(this.viewMode)){let y=this.stateHolder.getPageFrameOffset(this.viewMode,this.currentPageNo-1);c=y.offsetX*v,g=y.offsetY*v}else{let y=oo.getOffset(this.stateHolder,this.scrollContainerRef.nativeElement,this.scale,this.viewMode,this.currentPageNo);c=y.offsetX,g=y.offsetY}return{scrollLeft:c-n,scrollTop:g-r}}calculateScaleForRect(t,i){let e=this.scrollContainerRef.nativeElement,n=e.clientWidth/e.clientHeight,c=ee.normalizeDegree(this.stateHolder.pdfPages[t-1].r+this.degree)/90%2!==0,g=Math.abs(i.right-i.left),v=Math.abs(i.top-i.bottom),y=g/v;return n>y?e.clientHeight/(c?g:v)*100/ee.SCALE_CORRECTION_CONST:e.clientWidth/(c?v:g)*100/ee.SCALE_CORRECTION_CONST}calculateScaleForFit(t,i,e,n){let{pdfPages:r}=this.stateHolder,c=ee.isTwoPageMode(e)?2:1,g=t-1,v=g-g%c,[y,M]=r.slice(v,v+2),[k,Z]=gc.calculateMaxArea(y,n),[le,pe]=M?gc.calculateMaxArea(M,n):[0,0],he=this.contentViewElement.offsetWidth,Te=this.contentViewElement.offsetHeight,p=this.selectFitMode(i,k,Z,he,Te),ht=ee.isTwoPageMode(e)&&(r.length%2!==1||t!==r.length),_t,gt=0,Pi=he/Te,At=this.stateHolder.getPageContainerSize(e,g),hi=At.width/At.height;if(p===0)gt=he,Pi>hi&&(gt-=G.scrollbarSize.vertical),_t=k+Ui.MARGIN*2+(ht?le+Ui.MARGIN*2:0);else if(p===1)gt=Te,Pi<hi&&(gt-=G.scrollbarSize.horizontal),_t=(ht?Math.max(Z,pe):Z)+Ui.MARGIN*2;else{if(p===4)return 100;if(p===6){let Oe=this.selectFitMode(3,k,Z,he,Te);_t=Oe===0?k:Z,G.isLandscape()&&G.screenSize.height>G.screenSize.width?gt=Oe===0?G.screenSize.height:G.screenSize.width:gt=Oe===0?G.screenSize.width:G.screenSize.height}else{if(p===7)return this.lastViewScale;this.loggingService.common("warn",Le.INVALID,"fitMode",p)}}let vi=gt/_t*100;return(this.isSlideshow?vi:Math.floor(vi))/ee.SCALE_CORRECTION_CONST}selectFitMode(t,i,e,n,r){switch(t){case 2:return G.isSmallDevice()||i>e?0:1;case 3:return i/e>n/r?0:1;case 5:return i*ee.SCALE_CORRECTION_CONST>n?0:4;default:return t}}subscribeSlideshowEvent(){if(!this.slideshowOverlay){this.loggingService.common("error",Le.NOT_EXIST,"slideshowOverlay");return}this.subscriptionService.set("slideshowOrientationChange",bo(()=>G.nativeWindow.screen.orientation?Ge(G.nativeWindow.screen.orientation,"change"):dt(void 0)).subscribe({next:()=>{this.contentService.requestViewChange({fitMode:6})}})),this.subscriptionService.set("slideshowResizeEvent",Ge(G.nativeWindow,"resize").pipe(F(()=>{let t=w.getFullscreenElement();return!!document[t]&&this.stateHolder.isSlideshow})).subscribe({next:()=>{this.contentService.requestViewChange({fitMode:6})}})),this.subscriptionService.set("slideshowKeyboardEvent",Ge(G.nativeWindow,"keydown").subscribe({next:t=>{t.key!=="Tab"&&(t.preventDefault(),t.stopPropagation());let i=this.slideshowOverlay?.nativeElement;if(i?.style.backgroundColor!=="transparent"){this.renderer.setStyle(i,"background-color","transparent");return}if(t.key==="."||t.key==="B"||t.key==="b"){this.renderer.setStyle(i,"background-color","#000000");return}if(t.key===","||t.key==="W"||t.key==="w"){this.renderer.setStyle(i,"background-color","#FFFFFF");return}this.currentPageNo!==1&&(t.key==="ArrowLeft"||t.key==="ArrowUp"||t.key==="PageUp"||t.key==="Backspace")&&this.scrollController.moveToPrevPage(),this.currentPageNo!==this.pageCount&&(t.key==="ArrowRight"||t.key==="ArrowDown"||t.key==="PageDown"||t.key===" ")&&this.scrollController.moveToNextPage(),this.currentPageNo!==1&&t.key==="Home"&&this.scrollController.moveToPage(1),this.currentPageNo!==this.pageCount&&t.key==="End"&&this.scrollController.moveToPage(this.pageCount)}})),this.subscriptionService.set("slideshowMouseEvent",Ge(this.slideshowOverlay.nativeElement,"pointerdown").pipe(F(t=>t.pointerType==="mouse"&&t.button===0)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation();let i=this.slideshowOverlay?.nativeElement;if(i?.style.backgroundColor!=="transparent"){this.renderer.setStyle(i,"background-color","transparent");return}this.scrollController.moveToNextPage()}})),this.subscriptionService.set("slideshowTouchEvent",ut(Ge(this.slideshowOverlay.nativeElement,"touchstart"),Ge(this.slideshowOverlay.nativeElement,"touchmove"),Ge(this.slideshowOverlay.nativeElement,"touchend")).pipe(F(t=>t.touches.length>1)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation()}})),this.subscriptionService.set("slideshowToucheventEvent",Ge(this.slideshowOverlay.nativeElement,"touchend").pipe(F(t=>t.touches.length<1)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.scrollController.moveToNextPage()}}))}unsubscribeSlideshowEvent(){this.subscriptionService.get("slideshowOrientationChange")?.unsubscribe(),this.subscriptionService.get("slideshowResizeEvent")?.unsubscribe(),this.subscriptionService.get("slideshowKeyboardEvent")?.unsubscribe(),this.subscriptionService.get("slideshowMouseEvent")?.unsubscribe(),this.subscriptionService.get("slideshowTouchEvent")?.unsubscribe(),this.subscriptionService.get("slideshowToucheventEvent")?.unsubscribe()}updateOffsetForGuideline(){if(!this.rulerActive)return;let t=ee.normalizeScale(this.scale),i=oo.getOffset(this.stateHolder,this.contentViewElement,this.scale,this.viewMode,this.currentPageNo),e=pi({},this.stateHolder.getPageFrameOffset(this.viewMode,this.currentPageNo-1));e.offsetX=(e.offsetX+Ui.MARGIN)*t,e.offsetY=(e.offsetY+Ui.MARGIN)*t,this.guideLineService.publishContentViewOffset({offsetX:i.offsetX+e.offsetX,offsetY:i.offsetY+e.offsetY,width:this.contentViewElement.offsetWidth,height:this.contentViewElement.offsetHeight}),this.guideLineService.publishScrollOffset({offsetX:this.contentViewElement.scrollLeft,offsetY:this.contentViewElement.scrollTop})}initDraggingListener(){this.draggingListener.addTriggerEvent(this.contentViewElement,"mousedown",t=>{if(t.target instanceof Element&&t.target.classList.contains("no-scroller"))return!1;let i=document.activeElement;return!(i instanceof HTMLBodyElement)&&i instanceof HTMLElement&&i.blur(),t.preventDefault(),!0}),this.draggingListener.addMainEvent(window,"mousemove",t=>this.moveScrollByDragging(t)),this.draggingListener.addTerminatorEvent(window,"mouseup",()=>this.changeDetectorRef.markForCheck()),this.draggingListener.addTerminatorEvent(window,"blur",()=>this.changeDetectorRef.markForCheck())}moveScrollByDragging(t){this.contentViewElement.scrollLeft-=t.movementX,this.contentViewElement.scrollTop-=t.movementY}finalizeSubscribers(){this.pageService.publishPages([]),this.documentService.closeEBook()}copyToClipboard(t){G.copyToClipboard(t)}changeZoomByWheel(t,i,e){this.contentService.requestViewChange({scale:ee.calculateNextScale(this.scale,e<0),checkScale:!0,referencePoint:{clientX:t.x-i.x,clientY:t.y-i.y}})}};D(os,"\u0275fac",function(i){return new(i||os)(_(yn),_(li),_(Me),_(ct),_(Yt),_(Di),_(at),_(zi),_(Ee),_(Jt),_(J),_(Zt),_(Yp),_(on),_(qo),_(cn),_(jt),_(sn),_(He),_(Sa),_(rn),_(Ai),_(Wi),_(Fr),_(va))}),D(os,"\u0275cmp",Ce({type:os,selectors:[["sd-content-view"]],viewQuery:function(i,e){if(i&1&&(Ye(og,7),Ye(rg,5),Ye(La,7),Ye(sg,5)),i&2){let n;Ie(n=Ae())&&(e.scrollContainerRef=n.first),Ie(n=Ae())&&(e.scaleWrapper=n.first),Ie(n=Ae())&&(e.contentView=n.first),Ie(n=Ae())&&(e.slideshowOverlay=n.first)}},inputs:{pdfDoc:"pdfDoc",overWrittenZoom:"overWrittenZoom",centerPoint:"centerPoint"},standalone:!1,features:[xe([J]),tn],decls:12,vars:9,consts:[["scrollContainerRef",""],["floatingNav",""],["scaleWrapper",""],["slideshowOverlay",""],[4,"ngTemplateOutlet"],["sdContentViewLayout","",1,"pre-scrollable",3,"mouseup","ngStyle"],[4,"ngIf"],[3,"documentId",4,"ngIf"],["id","slideshow-overlay",4,"ngIf"],["id","search-tool",3,"pdfDoc",4,"ngIf"],[3,"contentViewRoot",4,"ngIf"],["id","scale-wrapper","sdScaleWrapperLayout",""],["id","scroll-expander","sdScrollExpanderLayout",""],["class","page-frame","sdPageFrameLayout","",3,"page",4,"ngFor","ngForOf","ngForTrackBy"],[3,"isClickOnGrayArea",4,"ngIf"],[3,"contentViewRoot"],["sdPageFrameLayout","",1,"page-frame",3,"page"],["sdCopyPaste","","sdPageContentLayout","",3,"mousedown","priority","page","documentId"],[3,"isClickOnGrayArea"],[3,"documentId"],["id","slideshow-overlay"],["id","search-tool",3,"pdfDoc"],[3,"pdfDoc",4,"ngIf"],[3,"pdfDoc"]],template:function(i,e){if(i&1){let n=ve();se(0,ag,1,0,"ng-container",4),I(1,"div",5,0),ae("mouseup",function(c){return j(n),W(e.onRightMouseUp(c))}),se(3,hg,8,7,"ng-container",6)(4,ug,1,1,"sd-ebook-view",7)(5,gg,2,0,"div",8)(6,fg,1,0,"ng-container",4)(7,mg,1,0,"sd-quick-action",6),N(),se(8,vg,1,1,"sd-search-tool",9)(9,_g,1,0,"sd-indicator",6)(10,bg,1,1,"ng-template",null,1,Vi)}if(i&2){let n=yi(11);T("ngTemplateOutlet",!e.isSlideshow&&n),x(),T("ngStyle",e.contentViewStyle),x(2),T("ngIf",!e.isEbookMode()),x(),T("ngIf",e.isEbookMode()),x(),T("ngIf",e.isSlideshow),x(),T("ngTemplateOutlet",e.isSlideshow&&n),x(),T("ngIf",!e.isSlideshow),x(),T("ngIf",e.canTextSearch()&&e.searchToolActive),x(),T("ngIf",e.runtimeEnv.get(e.MergedRuntimeEnvKey.INDICATOR)&&!e.isSlideshow&&!e.hidableMenus[e.HidableView.INDICATOR])}},styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}#scale-wrapper[_ngcontent-%COMP%]{position:absolute;top:0}#scale-wrapper.capture-mode[_ngcontent-%COMP%]{z-index:4}#scroll-expander[_ngcontent-%COMP%]{display:table;transform-origin:0 0}.pre-scrollable[_ngcontent-%COMP%]{overflow:auto;position:relative;width:100%;height:100%}.page-frame[_ngcontent-%COMP%]{position:absolute;display:table-cell}.hide-outline[_ngcontent-%COMP%]{box-shadow:none}.hide-background[_ngcontent-%COMP%]{background-color:transparent}#slideshow-overlay[_ngcontent-%COMP%]{width:100%;height:100%;position:fixed;top:0;left:0;cursor:default}"],changeDetection:0}));var Io=os;ze([ot(it.contentViewComp.moveScrollByDragging,1e3)],Io.prototype,"moveScrollByDragging",null);ze([ot(it.contentViewComp.copyToClipboard,1e3)],Io.prototype,"copyToClipboard",null);ze([ot(it.contentViewComp.changeZoomByWheel,1e3)],Io.prototype,"changeZoomByWheel",null);var Od=(()=>{let t=class t{elementRef;subscriptionService;objectClipboardService;annotSelectedService;shortcutService;store$;page;degree;currentPageNo;constructor(e,n,r,c,g,v){this.elementRef=e,this.subscriptionService=n,this.objectClipboardService=r,this.annotSelectedService=c,this.shortcutService=g,this.store$=v}ngOnInit(){this.subscriptionService.push(this.store$.pipe($("degree")).subscribe({next:e=>this.degree=e}),this.store$.pipe($("currentPageNo")).subscribe({next:e=>this.currentPageNo=e}),Ge(this.elementRef.nativeElement,"mouseenter").pipe(F(()=>this.page.i!==this.objectClipboardService.lastestEnteredPageIndex)).subscribe({next:()=>this.objectClipboardService.publishLastestEnteredPageIndex(this.page.i)}),ut(Ge(window,"copy"),this.shortcutService.getShortcutEvent(Re.COPY_ANNOTS).pipe(F(e=>this.isFakeEvent(e)))).pipe(F(()=>K.get(ie.SHORTCUT_COPY_PASTE)),F(()=>this.annotSelectedService.pageIndex===this.page.i),F(e=>!(e.target instanceof HTMLInputElement)&&!(e.target instanceof HTMLTextAreaElement))).subscribe({next:e=>{e.preventDefault(),this.objectClipboardService.copy(this.annotSelectedService.selectedComponents.map(n=>w.deepClone(n.data)),this.page.i,!(e instanceof KeyboardEvent)&&G.nativeWindow.isSecureContext)}}),ut(Ge(G.nativeWindow,"paste").pipe(F(()=>this.page.i===this.objectClipboardService.lastestEnteredPageIndex),yl(Ge(this.elementRef.nativeElement,"mousemove",{capture:!0}))),this.shortcutService.getShortcutEvent(Re.PASTE_ANNOTS).pipe(F(()=>this.currentPageNo-1===this.page.i),F(e=>this.isFakeEvent(e)),Ue(e=>[e]))).pipe(F(()=>K.get(ie.SHORTCUT_COPY_PASTE)),F(([e])=>!(e.target instanceof HTMLInputElement)&&!(e.target instanceof HTMLTextAreaElement))).subscribe({next:([e,n])=>{let r,c,g;!(e instanceof KeyboardEvent)&&w.isDefined(e.clipboardData)&&(r=e.clipboardData.getData("text/plain"),c=e.clipboardData.getData("text/html"),g=e.clipboardData.files.item(0)??void 0),this.objectClipboardService.paste({text:r,html:c,image:g},n?this.convertMouseToPagePoints(n,(this.page.r+this.degree)/90%4):null,this.page)}}))}convertMouseToPagePoints(e,n){let c=this.elementRef.nativeElement.getBoundingClientRect();switch(n){case 0:return{x:(e.clientX-c.left)*(this.page.bbox.w/c.width),y:this.page.bbox.h-(e.clientY-c.top)*(this.page.bbox.h/c.height)};case 1:return{x:(e.clientY-c.top)*(this.page.bbox.w/c.height),y:(e.clientX-c.left)*(this.page.bbox.h/c.width)};case 2:return{x:this.page.bbox.w-(e.clientX-c.left)*(this.page.bbox.w/c.width),y:(e.clientY-c.top)*(this.page.bbox.h/c.height)};case 3:return{x:this.page.bbox.w-(e.clientY-c.top)*(this.page.bbox.w/c.height),y:this.page.bbox.h-(e.clientX-c.left)*(this.page.bbox.h/c.width)};default:throw new St(`Unsupported rotate: ${n}`)}}isFakeEvent(e){return!e.isTrusted}};D(t,"\u0275fac",function(n){return new(n||t)(_(si),_(J),_(Ca),_(Di),_(rn),_(Ee))}),D(t,"\u0275dir",bn({type:t,selectors:[["","sdCopyPaste",""]],inputs:{page:"page"},standalone:!1,features:[xe([J])]}));let s=t;return s})();var xg=["floatingNav"],Ns=s=>({content:s});function Tg(s,t){if(s&1){let i=ve();Ht(0),I(1,"div",6)(2,"pu-input",7),Y(3,"translate"),ae("keydown.enter",function(){j(i);let n=E(2);return W(n.goToPage(n.pageNoFormControl.value))})("focus",function(){j(i);let n=E(2);return W(n.onNavInputFocus())})("blur",function(){j(i);let n=E(2);return W(n.onNavInputBlur())}),N(),I(4,"div",8),_e(5),N()(),$t()}if(s&2){let i=E(2);x(2),T("readonly",i.isSlideshow)("autoResize",!0)("maxLength",i.pageCount.toString().length)("formControl",i.pageNoFormControl)("ariaLabel",X(3,7,"MOVE_SPECIFYING_PAGE")),x(2),T("ngStyle",i.pdfDoc?null:i.viewerService.disableStyle),x(),qn(" /\xA0",i.pageCount,"")}}function Og(s,t){if(s&1){let i=ve();Ht(0),I(1,"div",9)(2,"button",10),Y(3,"translate"),Y(4,"translate"),Y(5,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.goPreviousPageForStatistics(n.ViewerStatisticData.CHANGE_PAGE_BY_FLOATING_NAV_BUTTON))})("focus",function(){j(i);let n=E(2);return W(n.onNavInputFocus())})("blur",function(){j(i);let n=E(2);return W(n.onNavInputBlur())}),q(6,"i",11),N(),I(7,"button",12),Y(8,"translate"),Y(9,"translate"),Y(10,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.goNextPageForStatistics(n.ViewerStatisticData.CHANGE_PAGE_BY_FLOATING_NAV_BUTTON))})("focus",function(){j(i);let n=E(2);return W(n.onNavInputFocus())})("blur",function(){j(i);let n=E(2);return W(n.onNavInputBlur())}),q(11,"i",13),N()(),$t()}if(s&2){let i=E(2);x(2),$e("dark",i.isDarkMode)("disabled",i.prevButtonDisabled),T("disabled",i.prevButtonDisabled)("title",i.isMobile?"":X(3,18,"PREVIOUS_PAGE"))("tooltip",vt(30,Ns,X(4,20,"PREVIOUS_PAGE"))),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(5,22,"PREVIOUS_PAGE")),x(5),$e("dark",i.isDarkMode)("disabled",i.nextButtonDisabled),T("disabled",i.nextButtonDisabled)("title",i.isMobile?"":X(8,24,"NEXT_PAGE"))("tooltip",vt(32,Ns,X(9,26,"NEXT_PAGE"))),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(10,28,"NEXT_PAGE"))}}function wg(s,t){if(s&1){let i=ve();Ht(0),I(1,"div",14)(2,"button",15),Y(3,"translate"),Y(4,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.zoomOut(n.ViewerStatisticData.CHANGE_ZOOM_BY_FLOATING_NAV))})("focus",function(){j(i);let n=E(2);return W(n.onNavInputFocus())})("blur",function(){j(i);let n=E(2);return W(n.onNavInputBlur())}),q(5,"i",16),N(),I(6,"button",17),Y(7,"translate"),Y(8,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.zoomIn(n.ViewerStatisticData.CHANGE_ZOOM_BY_FLOATING_NAV))})("focus",function(){j(i);let n=E(2);return W(n.onNavInputFocus())})("blur",function(){j(i);let n=E(2);return W(n.onNavInputBlur())}),q(9,"i",18),N()(),$t()}if(s&2){let i=E(2);x(2),$e("dark",i.isDarkMode)("disabled",!i.pdfDoc),T("disabled",!i.pdfDoc)("title",i.isMobile?"":X(3,18,"ZOOM_OUT"))("tooltip",vt(26,Ns,i.zoomOutTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(4,20,"ZOOM_OUT")),x(4),$e("dark",i.isDarkMode)("disabled",!i.pdfDoc),T("disabled",!i.pdfDoc)("title",i.isMobile?"":X(7,22,"ZOOM_IN"))("tooltip",vt(28,Ns,i.zoomInTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(8,24,"ZOOM_IN"))}}function yg(s,t){s&1&&q(0,"div",4)}function Eg(s,t){if(s&1){let i=ve();Ht(0),I(1,"div",19)(2,"button",20),Y(3,"translate"),Y(4,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.toggleSearchTool())})("focus",function(){j(i);let n=E(2);return W(n.onNavInputFocus())})("blur",function(){j(i);let n=E(2);return W(n.onNavInputBlur())}),q(5,"i",21),N()(),$t()}if(s&2){let i=E(2);x(2),$e("dark",i.isDarkMode)("disabled",!i.pdfDoc),T("disabled",!i.pdfDoc)("title",i.isMobile?"":X(3,10,"SEARCH"))("tooltip",vt(14,Ns,i.searchTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(4,12,"SEARCH"))("aria-expanded",i.searchToolActive)}}function Pg(s,t){if(s&1){let i=ve();Ht(0),I(1,"div",22)(2,"button",23),Y(3,"translate"),Y(4,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.closeSlideshow())})("focus",function(){j(i);let n=E(2);return W(n.onNavInputFocus())})("blur",function(){j(i);let n=E(2);return W(n.onNavInputBlur())}),q(5,"i",24),N()(),$t()}if(s&2){let i=E(2);x(2),$e("dark",i.isDarkMode)("disabled",!i.pdfDoc),T("disabled",!i.pdfDoc)("title",i.isMobile?"":X(3,8,"CLOSE")),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(4,10,"CLOSE"))}}function Mg(s,t){if(s&1){let i=ve();I(0,"div",2,0),ae("mouseenter",function(){j(i);let n=E();return W(n.onMouseEnterNav())})("mouseleave",function(){j(i);let n=E();return W(n.onMouseLeaveNav())}),se(2,Tg,6,9,"ng-container",3)(3,Og,12,34,"ng-container",3),q(4,"div",4),se(5,wg,10,30,"ng-container",3)(6,yg,1,0,"div",5)(7,Eg,6,16,"ng-container",3)(8,Pg,6,12,"ng-container",3),N()}if(s&2){let i=E();nn("bottom",i.floatingPosition,"px"),T("@navFadeOut",i.shouldBeTransparent?"out":"in"),x(2),T("ngIf",i.runtimeEnv.get(i.RuntimeEnvKey.PAGE_NAVIGATION)),x(),T("ngIf",i.runtimeEnv.get(i.RuntimeEnvKey.MOVE_TO_ADJACENT_PAGE_BUTTON)),x(2),T("ngIf",!i.isSlideshow&&i.runtimeEnv.get(i.RuntimeEnvKey.ZOOM_BUTTON)),x(),T("ngIf",!i.isSlideshow&&i.runtimeEnv.get(i.MergedRuntimeEnvKey.SEARCH_BUTTON)&&!i.hidableMenus[i.HidableView.FLOATING_NAV_SEARCH]),x(),T("ngIf",!i.isSlideshow&&i.runtimeEnv.get(i.MergedRuntimeEnvKey.SEARCH_BUTTON)&&!i.hidableMenus[i.HidableView.FLOATING_NAV_SEARCH]),x(),T("ngIf",i.isSlideshow)}}var ro=function(s){return s.TRANSPARENT="transparent",s.OPAQUE="opaque",s}(ro||{}),Rg=24,Ig=73,rs=class rs{changeDetectorRef;translatePipe;documentService;contentService;scrollController;store$;viewerService;subscriptionService;apiEventBridgeService;shortcutService;redactionService;quickActionService;get RuntimeEnvKey(){return ie}get MergedRuntimeEnvKey(){return Tt}get runtimeEnv(){return K}get HidableView(){return B}get zoomInTooltipWithShortcut(){return`${this.translatePipe.transform("ZOOM_IN")} (${ti.getShortcutString(Fi[Re.INCREASE_ZOOM_NUMPAD])})`}get zoomOutTooltipWithShortcut(){return`${this.translatePipe.transform("ZOOM_OUT")} (${ti.getShortcutString(Fi[Re.DECREASE_ZOOM_NUMPAD])})`}get searchTooltipWithShortcut(){return`${this.translatePipe.transform("SEARCH")} (${ti.getShortcutString(Fi[Re.SEARCH])})`}get prevButtonDisabled(){return this.currentPageNo<=1}get nextButtonDisabled(){return this.viewMode===4?ee.getEbookPageNo(this.pageCount)<=this.currentPageNo:this.pageCount<=this.currentPageNo}get shouldDisplayNav(){return!this.isToolSelected}get shouldBeTransparent(){return!this._isMouseOnNav&&!this._isNavInputOnFocus&&!this.searchToolActive&&this._navTransparency===ro.TRANSPARENT&&K.get(ie.FLOATING_NAVIGATION_AUTO_HIDE)}pdfDoc;floatingNavElement;scale;viewMode;currentPageNo;pageCount;isSlideshow;isToolSelected;searchToolActive;_isMouseOnNav=!1;_isNavInputOnFocus=!1;_navTransparency=ro.OPAQUE;rightSideViewMode;rightSideViewVisible;hidableMenus={};pageNoFormControl=new fr(1);navVisibilityChanges=new Vt(ro.OPAQUE);screenTheme;NAV_AREA_WIDTH_PC=G.breakpoints.mobile.width;NAV_AREA_HEIGHT_PC=166;NAV_VISIBLE_DURATION_MS=3e3;get ViewerStatisticData(){return fe}get floatingPosition(){return this.redactionService.isRedactingOnMobile()?Ig:Rg}get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}get isMobile(){return G.isMobile()}constructor(t,i,e,n,r,c,g,v,y,M,k,Z){this.changeDetectorRef=t,this.translatePipe=i,this.documentService=e,this.contentService=n,this.scrollController=r,this.store$=c,this.viewerService=g,this.subscriptionService=v,this.apiEventBridgeService=y,this.shortcutService=M,this.redactionService=k,this.quickActionService=Z}ngOnInit(){this.initSubscriptions(),this.subscribeVisibilityChange(),this.initRegisterQuickActions()}initSubscriptions(){this.subscriptionService.push(this.store$.pipe(fi([B.FLOATING_NAV_SEARCH])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),this.changeDetectorRef.markForCheck()}}),this.store$.pipe(ci("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("scale")).subscribe({next:t=>this.scale=t}),this.store$.pipe($("pageCount")).subscribe({next:t=>{this.pageCount=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("viewMode")).subscribe({next:t=>this.viewMode=t}),this.store$.pipe($("rightSideViewMode")).subscribe({next:t=>{this.rightSideViewMode=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("rightSideViewVisible")).subscribe({next:t=>{this.rightSideViewVisible=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("currentPageNo")).subscribe({next:t=>{this.currentPageNo=t,this.pageNoFormControl.setValue(this.currentPageNo)}}),this.store$.pipe($("searchToolActive")).subscribe({next:t=>{if(!this.documentService.checkAuthority(Ne.SEARCH_TEXT)){this.apiEventBridgeService.searchToolVisibilityChangedSrc.next({ok:!1,error:new To("Unauthorized")});return}this.searchToolActive=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("isSlideshow")).subscribe({next:t=>this.isSlideshow=t}),this.shortcutService.getShortcutEvent(Re.SEARCH).subscribe({next:()=>{this.documentService.checkAuthority(Ne.SEARCH_TEXT)&&(K.get(ie.QUICK_SEARCH_BUTTON)||K.get(ie.FULL_SEARCH_BUTTON))&&!this.isEbookMode()&&this.pdfDoc&&this.toggleSearchTool()}}))}subscribeVisibilityChange(){this.subscriptionService.push(this.navVisibilityChanges.pipe(st(()=>(this._navTransparency=ro.OPAQUE,this.changeDetectorRef.markForCheck(),lr(this.NAV_VISIBLE_DURATION_MS)))).subscribe({next:()=>{this._navTransparency=ro.TRANSPARENT,this.changeDetectorRef.markForCheck()}}),G.windowResize$.subscribe({next:()=>this.navVisibilityChanges.next(ro.OPAQUE)}),this.scrollController.viewScroll$.subscribe({next:()=>this.navVisibilityChanges.next(ro.OPAQUE)}),G.windowMouseMoveEvent$.pipe(ni(10)).subscribe({next:t=>{this.floatingNavElement&&this.isMouseInsideActiveNavArea(t)&&this.navVisibilityChanges.next(ro.OPAQUE)}}),this.store$.pipe(Wo()).subscribe({next:t=>{this.isToolSelected=t!==null,this.changeDetectorRef.markForCheck()}}),G.windowPointerUp$.pipe(F(()=>this.isSlideshow)).subscribe({next:()=>this.navVisibilityChanges.next(ro.OPAQUE)}))}initRegisterQuickActions(){this.quickActionService.registerActions([{id:Se.PREVIOUS_PAGE,actionFn:()=>this.goPreviousPageForStatistics(fe.CHANGE_PAGE_BY_QUICK_SEARCH)},{id:Se.NEXT_PAGE,actionFn:()=>this.goNextPageForStatistics(fe.CHANGE_PAGE_BY_QUICK_SEARCH)},{id:Se.ZOOM_OUT,actionFn:()=>this.zoomOut(fe.CHANGE_ZOOM_BY_QUICK_SEARCH)},{id:Se.ZOOM_IN,actionFn:()=>this.zoomIn(fe.CHANGE_ZOOM_BY_QUICK_SEARCH)}])}getResponsiveActiveNavArea(t){if(G.width<=this.NAV_AREA_WIDTH_PC)return{left:0,right:G.width,top:G.height-this.NAV_AREA_HEIGHT_PC,bottom:G.height};let i=t.left+t.width/2;return{left:i-this.NAV_AREA_WIDTH_PC/2,right:i+this.NAV_AREA_WIDTH_PC/2,top:G.height-this.NAV_AREA_HEIGHT_PC,bottom:G.height}}isMouseInsideActiveNavArea(t){let i=this.floatingNavElement?.nativeElement.getBoundingClientRect(),e=this.getResponsiveActiveNavArea(i);return t.x>=e.left&&t.x<=e.right&&t.y>=e.top&&t.y<=e.bottom}onNavInputFocus(){this._isNavInputOnFocus=!0}onNavInputBlur(){this.pageNoFormControl.value||this.pageNoFormControl.setValue(this.currentPageNo),this.pageNoFormControl.value!==this.currentPageNo&&this.goToPage(this.pageNoFormControl.value),this._isNavInputOnFocus=!1}onMouseEnterNav(){this._isMouseOnNav=!0}onMouseLeaveNav(){this._isMouseOnNav=!1}forceMouseLeaveNavInSlideShow(){this.isSlideshow&&this.onMouseLeaveNav()}isEbookMode(){return this.viewMode===4&&this.documentService.eBookStatus}goToPage(t){let i=Number(t);isNaN(i)||this.scrollController.moveToPage(i)}goPreviousPage(){this.forceMouseLeaveNavInSlideShow(),this.scrollController.moveToPrevPage()}goPreviousPageForStatistics(t){this.goPreviousPage()}goNextPage(){this.forceMouseLeaveNavInSlideShow(),this.scrollController.moveToNextPage()}goNextPageForStatistics(t){this.goNextPage()}publishScale(t,i){this.contentService.requestViewChange({scale:t,checkScale:i})}zoomIn(t){this.setScale(ee.calculateNextScale(this.scale,!0),!0)}zoomOut(t){this.setScale(ee.calculateNextScale(this.scale,!1),!0)}setScale(t,i=!1){typeof t!="number"||!isFinite(t)||isNaN(t)||this.publishScale(t,i)}toggleSearchTool(){if(!(!this.documentService.checkAuthority(Ne.SEARCH_TEXT)||!this.pdfDoc)){if(K.get(ie.QUICK_SEARCH_BUTTON)){this.store$.dispatch(ue.set({key:"searchToolActive",value:!this.searchToolActive}));return}this.rightSideViewVisible&&this.rightSideViewMode===Rt.TextSearch?this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1})):(this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!0})),this.store$.dispatch(ue.set({key:"rightSideViewMode",value:Rt.TextSearch})))}}closeSlideshow(){G.exitFullScreen()}};D(rs,"\u0275fac",function(i){return new(i||rs)(_(Me),_(He),_(ct),_(at),_(zi),_(Ee),_(Jt),_(J),_(Zt),_(rn),_($r),_(ln))}),D(rs,"\u0275cmp",Ce({type:rs,selectors:[["sd-floating-nav"]],viewQuery:function(i,e){if(i&1&&Ye(xg,5),i&2){let n;Ie(n=Ae())&&(e.floatingNavElement=n.first)}},inputs:{pdfDoc:"pdfDoc"},standalone:!1,features:[xe([J,{provide:Qn,useValue:new Vt(300)}])],decls:1,vars:1,consts:[["floatingNav",""],["class","floating-page-nav",3,"bottom","mouseenter","mouseleave",4,"ngIf"],[1,"floating-page-nav",3,"mouseenter","mouseleave"],[4,"ngIf"],[1,"divider"],["class","divider",4,"ngIf"],[1,"page-input"],["size","tiny","align","left",1,"current-page-index","left-child",3,"keydown.enter","focus","blur","readonly","autoResize","maxLength","formControl","ariaLabel"],[1,"page-label",3,"ngStyle"],[1,"page-move"],[1,"ep-text-button","previous-page","left-child",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-previous-symbol2"],[1,"ep-text-button","next-page",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-next-symbol2"],[1,"zoom"],[1,"ep-text-button","zoom-out","left-child",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-minus"],[1,"ep-text-button","zoom-in",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-plus"],[1,"search"],["aria-controls","search-tool",1,"ep-text-button","search-button",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-search"],[1,"close"],[1,"ep-text-button","close-button",3,"click","focus","blur","disabled","title"],[1,"papycon","papycon-cross"]],template:function(i,e){i&1&&se(0,Mg,9,9,"div",1),i&2&&T("ngIf",e.shouldDisplayNav)},styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}.floating-page-nav[_ngcontent-%COMP%]{box-shadow:0 4px 32px #6c6c6c1f;z-index:5;background-color:var(--mono-00);display:flex;align-items:center;position:absolute;left:50%;transform:translate(-50%);border:1px solid var(--mono-30);border-radius:90px;height:42px}.floating-page-nav[_ngcontent-%COMP%]   button.disabled[_ngcontent-%COMP%]{opacity:.4}.floating-page-nav[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.divider){flex:1 1 auto;display:flex;justify-content:center;align-items:center;margin:0 12px}.floating-page-nav[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .left-child[_ngcontent-%COMP%]{margin-right:12px}.floating-page-nav[_ngcontent-%COMP%]   div.page-input[_ngcontent-%COMP%]{margin-left:20px;margin-right:0}.floating-page-nav[_ngcontent-%COMP%]   div.page-input[_ngcontent-%COMP%]   .left-child[_ngcontent-%COMP%]{margin-right:4px}.floating-page-nav[_ngcontent-%COMP%]   pu-input.current-page-index[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--input);border-radius:2px;box-sizing:content-box}.floating-page-nav[_ngcontent-%COMP%]   div.page-label[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);white-space:pre}.floating-page-nav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;border-width:0;outline-offset:-2px}.floating-page-nav[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}.floating-page-nav[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled):hover{color:#d7d7d7}.floating-page-nav[_ngcontent-%COMP%]   div.divider[_ngcontent-%COMP%]{height:24px;width:1px;background-color:var(--mono-30)}.floating-page-nav[_ngcontent-%COMP%]   div.search[_ngcontent-%COMP%]{margin-right:16px}.floating-page-nav[_ngcontent-%COMP%]   div.close[_ngcontent-%COMP%]{margin-right:16px;width:24px;height:24px}"],data:{animation:[Bo("navFadeOut",[Tn("in",xn({opacity:1})),Tn("out",xn({opacity:0})),yo("in => out",[wo("400ms linear")]),yo("out => in",[wo("0s")])])]},changeDetection:0}));var so=rs;ze([ot(it.floatingNavComp.goToPage)],so.prototype,"goToPage",null);ze([ot(it.floatingNavComp.changePage)],so.prototype,"goPreviousPageForStatistics",null);ze([ot(it.floatingNavComp.changePage)],so.prototype,"goNextPageForStatistics",null);ze([ot(it.floatingNavComp.changeZoom,1e3)],so.prototype,"zoomIn",null);ze([ot(it.floatingNavComp.changeZoom,1e3)],so.prototype,"zoomOut",null);var Ag=["imgEl"],wd=function(s){return s.Pixelated="pixelated",s}(wd||{}),ja=(()=>{let t=class t{contentService;pageService;changeDetectorRef;renderer;apiEventBridgeService;subscriptionService;renderingService;store$;muPDFService;pdfPage;documentId;imgStyle={};resetted=new Lo;rendered=new Lo;failed=new Lo;imgElementRef;imgData;quality;normalizedScale;fetchFailCount=0;retryHandler=null;renderingMode=gi.SERVER;ngOnChange$=new Vt(!1);isRendered=!1;renderedDevicePixelRatio=devicePixelRatio;constructor(e,n,r,c,g,v,y,M,k){this.contentService=e,this.pageService=n,this.changeDetectorRef=r,this.renderer=c,this.apiEventBridgeService=g,this.subscriptionService=v,this.renderingService=y,this.store$=M,this.muPDFService=k}ngOnInit(){this.subscriptionService.push(ut(Ji([this.store$.pipe(ci("renderingOption")),this.store$.pipe(ci("hidpiRendering")),this.store$.pipe($("scale"),F(w.isDefined),ni(200),Ue(e=>_p(e,this.renderingService.renderingMode!==gi.SERVER)),F(e=>e!==this.normalizedScale),rt(e=>this.normalizedScale=e)),this.ngOnChange$.pipe(F(e=>e))]),this.contentService.reload$.pipe(F(e=>Go.typeAndPage(e,this.pdfPage.i,zo.Image)),st(()=>this.renderingMode!==gi.CLIENT?dt(void 0):this.muPDFService.document$.pipe(F(e=>e.status==="OPENED")))),Ge(G.nativeWindow,"resize").pipe(F(()=>this.renderedDevicePixelRatio!==devicePixelRatio),rt(()=>this.renderedDevicePixelRatio=devicePixelRatio))).subscribe({next:()=>this.startFetch()}),this.store$.pipe($("quality")).subscribe({next:e=>this.quality=e}),this.store$.pipe($("renderingMode"),rt(e=>this.renderingMode=e),F(e=>e===gi.HYBRID),st(()=>this.muPDFService.document$),F(e=>e.status==="OPENED")).subscribe({next:()=>this.startFetch()})),this.subscribePageArrangeEvent()}ngOnDestroy(){this.imgData=void 0,w.isDefined(this.imgElementRef.nativeElement.parentElement)&&this.imgElementRef.nativeElement.parentElement.removeChild(this.imgElementRef.nativeElement),Xi.destroy(this)}ngOnChanges(){this.renderer.setStyle(this.imgElementRef.nativeElement,ee.SK_Z_INDEX,`${ee.LayoutOrder.Image}${w.EMPTY_STRING}`),this.ngOnChange$.next(!0)}fetch(){if(!this.pdfPage)return;let e=this.renderingService.renderingMode!==gi.SERVER;this.subscriptionService.set("dataSub",this.drawWatermark(this.renderingService.fetchImage(this.documentId,this.pdfPage.ref,{zoom:this.normalizedScale,jpegQuality:this.quality,renderAnnots:!1,increasePrint:!1})).subscribe({next:n=>{e&&G.isChromium()&&K.get(ie.CLIENT_RENDERING_PIXELATED)&&(this.imgStyle.imageRendering=wd.Pixelated),this.render(n),this.apiEventBridgeService.watermarkCreatedSrc.next({ok:!0,data:void 0})},error:n=>this.onFetchFailed(n)}))}preloadFetch(){this.isRendered||!this.pdfPage||this.subscriptionService.set("preloadDataSub",this.drawWatermark(this.renderingService.fetchPreload(this.documentId,this.pdfPage.ref).pipe(F(()=>!this.imgData&&Math.max(this.pdfPage.bbox.w,this.pdfPage.bbox.h)>1e3),F(w.isDefined))).subscribe({next:e=>this.render(e)}))}startFetch(){this.clearRetryHandler(),this.fetchFailCount=0,this.preloadFetch(),this.fetch()}onFetchFailed(e){this.clearRetryHandler(),++this.fetchFailCount>Ze.retryCount?this.failed.emit(e):this.retryHandler=G.nativeWindow.setTimeout(()=>this.fetch(),Ze.retryInterval)}clearRetryHandler(){this.retryHandler!==null&&(clearTimeout(this.retryHandler),this.retryHandler=null)}render(e){e&&(this.imgData=e,this.isRendered=!0),ee.setVisibility(this.imgElementRef.nativeElement,!0,this.renderer,!0),this.changeDetectorRef.markForCheck(),this.rendered.emit()}reset(){ee.setVisibility(this.imgElementRef.nativeElement,!1,this.renderer),this.resetted.emit()}subscribePageArrangeEvent(){this.subscriptionService.push(this.pageService.pageArrangeEvt$.pipe(F(e=>this.pageService.arrangeAffectedChecker(this.pdfPage.originalIndex,e))).subscribe({next:()=>{this.reset(),this.ngOnChanges()}}))}drawWatermark(e){return Ji([e,this.store$.pipe(Yo("ALL"),Ue(n=>kn.filterChanges(n,r=>r.allowView?r.range==="all"?!0:!!Nn.parse(r.range,{min:0,max:this.pageService.pdfPages.length-1})?.includes(this.pdfPage.i):!1)),Ue(n=>kn.flattenWatermarks(n))),this.pageService.pageArrangeEvt$.pipe(F(n=>n.page===this.pdfPage&&n.action==="rotate"),rt(()=>this.reset()),Vo(void 0))]).pipe(st(([n,r,c])=>{if(n.data===void 0)return this.startFetch(),Ks;if(r.length===0)return dt(n);let g;switch(n.type){case"BLOB":g=URL.createObjectURL(n.data);break;case"BASE64":g=n.data;break;default:throw new St("Cannot handle image data")}return new Ur({imgSrc:g,width:this.pdfPage.bbox.w,height:this.pdfPage.bbox.h,rotation:this.pdfPage.r},r).draw()}))}};D(t,"\u0275fac",function(n){return new(n||t)(_(at),_(Yt),_(Me),_(jt),_(Zt),_(J),_(jo),_(Ee),_($o))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-image"]],viewQuery:function(n,r){if(n&1&&Ye(Ag,7),n&2){let c;Ie(c=Ae())&&(r.imgElementRef=c.first)}},inputs:{pdfPage:"pdfPage",documentId:"documentId",imgStyle:"imgStyle"},outputs:{resetted:"resetted",rendered:"rendered",failed:"failed"},standalone:!1,features:[xe([J]),tn],decls:2,vars:2,consts:[["imgEl",""],[1,"image",3,"sdImage","ngStyle"]],template:function(n,r){n&1&&q(0,"img",1,0),n&2&&T("sdImage",r.imgData)("ngStyle",r.imgStyle)},styles:["img.image[_ngcontent-%COMP%]{width:100%;height:100%;visibility:hidden;-webkit-user-select:none;user-select:none;pointer-events:none}"],changeDetection:0}));let s=t;return s})();var yd=(()=>{let t=class t{store$;subscriptionService;changeDetectorRef;invisibleTracerService;styles={};rendered=new Lo;constructor(e,n,r,c){this.store$=e,this.subscriptionService=n,this.changeDetectorRef=r,this.invisibleTracerService=c}ngOnInit(){this.subscriptionService.push(Ji([this.store$.pipe($("scale")),G.windowResize$.pipe(Vo({}))]).subscribe({next:([e,n])=>{let r=window.devicePixelRatio,g=(G.isMobile()?4:screen.width*screen.height*Math.pow(r,2)<1920*1080?1:2)/r,v=(Ze.viewInvisibleTracerSize/ee.normalizeScale(e)).toFixed(1);this.styles["background-size"]=`${v}px ${v}px`,this.styles.transform=`scale(${g.toFixed(8)})`,this.styles.width=`${(1/g*100).toFixed(6)}%`,this.styles.height=`${(1/g*100).toFixed(6)}%`,this.changeDetectorRef.markForCheck()}}),this.invisibleTracerService.viewBinary$.subscribe(e=>{this.styles["background-image"]=`url(${e.url})`,this.styles.opacity=this.invisibleTracerService.getOpacity().toString(),this.rendered.emit(),this.changeDetectorRef.markForCheck()}))}};D(t,"\u0275fac",function(n){return new(n||t)(_(Ee),_(J),_(Me),_(_a))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-invisible-tracer-view"]],outputs:{rendered:"rendered"},standalone:!1,features:[xe([J])],decls:1,vars:1,consts:[[3,"ngStyle"]],template:function(n,r){n&1&&q(0,"div",0),n&2&&T("ngStyle",r.styles)},dependencies:[Wt],styles:["[_nghost-%COMP%]{position:absolute;display:block;width:100%;height:100%;top:0;left:0;overflow:hidden}div[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0;image-rendering:pixelated;transform-origin:top left}"],changeDetection:0}));let s=t;return s})();var Ng=["magnifySvg"];function kg(s,t){if(s&1&&(wi(),q(0,"rect",3)),s&2){let i=E();ge("height",i.rectRender.h)("width",i.rectRender.w)("x",i.rectRender.x)("y",i.rectRender.y)}}var ss=class ss{changeDetectorRef;contentService;renderer;subscriptionService;store$;pdfPage;magnifySvgElementRef;scale;created=!1;startPoint={x:0,y:0};rectRender={x:0,y:0,w:0,h:0};prevEvent;onMouseMoveListener=null;onMouseUpListener=null;constructor(t,i,e,n,r){this.changeDetectorRef=t,this.contentService=i,this.renderer=e,this.subscriptionService=n,this.store$=r}ngOnInit(){this.subscriptionService.push(this.store$.pipe($("scale")).subscribe({next:t=>this.scale=t}))}ngOnDestroy(){this.destroyMouseListeners()}onDown(t){return this.rectRender.x=t.offsetX,this.startPoint.x=this.rectRender.x,this.rectRender.y=t.offsetY,this.startPoint.y=this.rectRender.y,this.rectRender.h=0,this.rectRender.w=this.rectRender.h,this.onMouseUpListener=this.renderer.listen(this.magnifySvgElementRef.nativeElement,"mouseup",i=>this.onUp(i)),t.button!==0?!0:(t.preventDefault(),t.stopPropagation(),this.prevEvent=t,this.changeDetectorRef.markForCheck(),this.created=!0,this.onMouseMoveListener=this.renderer.listen(this.magnifySvgElementRef.nativeElement,"mousemove",i=>this.onMove(i)),!1)}onMove(t){return this.created?(t.preventDefault(),t.stopPropagation(),this.prevEvent?.offsetX===t.offsetX&&this.prevEvent?.offsetY===t.offsetY||(this.rectRender.x=Math.min(this.startPoint.x,t.offsetX),this.rectRender.y=Math.min(this.startPoint.y,t.offsetY),this.rectRender.w=Math.abs(t.offsetX-this.startPoint.x),this.rectRender.h=Math.abs(t.offsetY-this.startPoint.y),this.prevEvent=t,this.changeDetectorRef.markForCheck()),!1):!0}onUp(t){t.preventDefault(),t.stopPropagation(),this.destroyMouseListeners(),this.created=!1,this.changeDetectorRef.markForCheck();let i=this.pdfPage.bbox,e=i.y+i.h-this.rectRender.y,n={left:this.rectRender.x,top:e,right:this.rectRender.x+this.rectRender.w,bottom:e-this.rectRender.h};if(this.rectRender.w<10&&this.rectRender.h<10){if(t.button!==0&&t.button!==2)return!1;this.contentService.requestViewChange({scale:this.scale+(t.button===0?10:-10),checkScale:!1,referencePoint:{pageNo:this.pdfPage.i+1,x:(n.left+n.right)/2,y:(n.top+n.bottom)/2}})}else this.contentService.requestViewChange({pageNo:this.pdfPage.i+1,checkScale:!1,viewport:n});return!1}onMouseleave(){this.destroyMouseListeners(),this.created=!1,this.changeDetectorRef.markForCheck()}destroyMouseListeners(){w.isDefined(this.onMouseMoveListener)&&this.onMouseMoveListener(),this.onMouseMoveListener=null,w.isDefined(this.onMouseUpListener)&&this.onMouseUpListener(),this.onMouseUpListener=null}};D(ss,"\u0275fac",function(i){return new(i||ss)(_(Me),_(at),_(jt),_(J),_(Ee))}),D(ss,"\u0275cmp",Ce({type:ss,selectors:[["sd-magnify-tool"]],viewQuery:function(i,e){if(i&1&&Ye(Ng,7),i&2){let n;Ie(n=Ae())&&(e.magnifySvgElementRef=n.first)}},inputs:{pdfPage:"pdfPage"},standalone:!1,features:[xe([J])],decls:3,vars:1,consts:[["magnifySvg",""],["id","magnify-svg",3,"mousedown","mouseleave"],["fill","transparent","stroke-dasharray","8 8","stroke-width","1",4,"ngIf"],["fill","transparent","stroke-dasharray","8 8","stroke-width","1"]],template:function(i,e){if(i&1){let n=ve();wi(),I(0,"svg",1,0),ae("mousedown",function(c){return j(n),W(e.onDown(c))})("mouseleave",function(){return j(n),W(e.onMouseleave())}),se(2,kg,1,4,"rect",2),N()}i&2&&(x(2),T("ngIf",e.created))},dependencies:[bt],styles:["#magnify-svg[_ngcontent-%COMP%]{z-index:999;position:absolute;right:0;top:0;-webkit-user-select:none;user-select:none;cursor:crosshair;width:100%;height:100%;background-color:#fff0;stroke:var(--primary-50)}"],changeDetection:0}));var ks=ss;ze([ot(it.magnifyToolComp.onUp)],ks.prototype,"onUp",null);function Lg(s,t){if(s&1&&(Ht(0),I(1,"p",1),_e(2),N(),$t()),s&2){let i=t.$implicit,e=E();x(),T("ngStyle",e.setPositionOfScript(i)),x(),we(e.getFilteredScript(i.text))}}var Ed=function(s){return s.FULL="full",s.LINE="line",s}(Ed||{}),Pd=(()=>{let t=class t{page;fetchedText;scripts=[];get isMergedScript(){return Ze.pageScriptInsertionType===Ed.FULL}ngOnInit(){if(this.fetchedText=this.fetchedText.filter(e=>e.text.trim().length>0),!this.isMergedScript){this.scripts=this.fetchedText;return}this.scripts[0]={text:this.fetchedText.filter(e=>e.text.trim().length>0).map(e=>e.text).join(`
`),rect:[{top:this.page.bbox.h,bottom:0,left:0,right:this.page.bbox.w}],rotate:0,isVertical:!1}}setPositionOfScript(e){let n=e.rect.length;return{top:`${this.page.bbox.h-e.rect[0].top-4}px`,left:`${e.rect[0].left}px`,width:`${e.rect[n-1].right-e.rect[0].left}px`,height:`${Math.abs(e.rect[0].top-e.rect[0].bottom)+6}px`}}getFilteredScript(e){return e.trim().replace(/[^-a-zA-Z0-9\u4E00-\u9FFF\u3400-\u4DBF~!@#$%^&*()\-_=+\[{\]};:'".<,>\/? ]/gu,"")}};D(t,"\u0275fac",function(n){return new(n||t)}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-page-script"]],inputs:{page:"page",fetchedText:"fetchedText"},standalone:!1,decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["tabindex","0",1,"script",3,"ngStyle"]],template:function(n,r){n&1&&se(0,Lg,3,2,"ng-container",0),n&2&&T("ngForOf",r.scripts)},dependencies:[Ei,Wt],styles:[".script[_ngcontent-%COMP%]{position:absolute;pointer-events:none}"]}));let s=t;return s})();var Bg=["normal"],Ug=["redactionMarks"],Hg=["redactionResults"],Md=(()=>{let t=class t{contentService;subscriptionService;pdfPage;result;redactionMarks;redactionResults;normalElementRef;redactionMarksElementRef;redactionResultsElementRef;isViewInit=!1;normalPainter=null;redactionMarksPainter=null;redactionResultsPainter=null;constructor(e,n){this.contentService=e,this.subscriptionService=n}ngOnInit(){this.normalPainter=new Vs(this.normalElementRef,this.pdfPage.bbox),this.redactionMarksPainter=new Vs(this.redactionMarksElementRef,this.pdfPage.bbox),this.redactionResultsPainter=new Vs(this.redactionResultsElementRef,this.pdfPage.bbox),this.subscriptionService.push(this.contentService.reload$.pipe(F(e=>Go.typeAndPage(e,this.pdfPage.i,zo.TextSearch))).subscribe({next:()=>this.clearRect()}))}ngOnChanges(){this.mark(this.isViewInit)}ngAfterViewInit(){this.mark(this.isViewInit=!0)}ngOnDestroy(){this.normalElementRef=null,this.redactionMarksElementRef=null,this.redactionResultsElementRef=null,this.normalPainter=null,this.redactionMarksPainter=null,this.redactionResultsPainter=null,Xi.destroy(this)}clearRect(){this.normalPainter?.clear(),this.redactionMarksPainter?.clear(),this.redactionResultsPainter?.clear()}mark(e){e&&(this.clearRect(),this.result&&this.normalPainter?.render(this.result.words.map(n=>n.rects)),this.redactionMarks&&this.redactionMarksPainter?.render(this.redactionMarks.words.map(n=>n.rects)),this.redactionResults&&this.redactionResultsPainter?.render(this.redactionResults.words.map(n=>n.rects)))}};D(t,"\u0275fac",function(n){return new(n||t)(_(at),_(J))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-search-highlight"]],viewQuery:function(n,r){if(n&1&&(Ye(Bg,7),Ye(Ug,7),Ye(Hg,7)),n&2){let c;Ie(c=Ae())&&(r.normalElementRef=c.first),Ie(c=Ae())&&(r.redactionMarksElementRef=c.first),Ie(c=Ae())&&(r.redactionResultsElementRef=c.first)}},inputs:{pdfPage:"pdfPage",result:"result",redactionMarks:"redactionMarks",redactionResults:"redactionResults"},standalone:!1,features:[xe([J]),tn],decls:7,vars:2,consts:[["normal",""],["redactionMarks",""],["redactionResults",""],[1,"normal"],[1,"redaction-marks"],[1,"redaction-results"]],template:function(n,r){n&1&&(wi(),I(0,"svg"),q(1,"path",3,0)(3,"path",4,1)(5,"path",5,2),N()),n&2&&ge("width",r.pdfPage.bbox.w+r.pdfPage.bbox.x)("height",r.pdfPage.bbox.h+r.pdfPage.bbox.y)},styles:["svg[_ngcontent-%COMP%]{mix-blend-mode:multiply;position:absolute;right:0;top:0;-webkit-user-select:none;user-select:none}path.normal[_ngcontent-%COMP%]{fill:#00af0080}path.redaction-marks[_ngcontent-%COMP%]{fill:#00000080}path.redaction-results[_ngcontent-%COMP%]{fill:#fffb00}"],changeDetection:0}));let s=t;return s})(),Vs=class{elementRef;bbox;d=[];constructor(t,i){this.elementRef=t,this.bbox=i}clear(){this.d.splice(0),this.bindPath()}render(t){for(let i of t){let e=i[0],n=i[0];i.forEach((r,c)=>{e=r,n.top!==e.top&&(this.d[this.d.length]=this.mergeRects(n,i[c-1]),n=e)}),this.d[this.d.length]=this.mergeRects(n,e)}this.bindPath()}bindPath(){this.elementRef.nativeElement.setAttribute("d",this.generatePath())}generatePath(){return this.d.reduce((t,i)=>`${t}M ${i.x} ${i.y} L ${i.x+i.w} ${i.y} L ${i.x+i.w} ${i.y+i.h} L ${i.x} ${i.y+i.h} Z `,w.EMPTY_STRING)}mergeRects(t,i){return{x:t.left,y:this.bbox.h+this.bbox.y-t.top,w:i.right-t.left,h:t.top-t.bottom}}};var Rd=(()=>{let t=class t{sanitizer;contentService;changeDetectorRef;textService;documentId;pdfPage;get innerHTML(){let e=this.sanitizer.sanitize(Pl.HTML,this._innerHTML);if(!w.isDefined(e))throw new St("Possible unsafe HTML content");return e}get pageHeight(){return`${this.pdfPage.bbox.h}px`}_innerHTML=null;constructor(e,n,r,c){this.sanitizer=e,this.contentService=n,this.changeDetectorRef=r,this.textService=c}ngOnInit(){this.contentService.publishSomePageLoaded(!0),this.textService.fetchPdfPageScript(this.documentId,this.pdfPage.i).subscribe({next:e=>{this._innerHTML=e.scriptText,this.changeDetectorRef.markForCheck()}})}};D(t,"\u0275fac",function(n){return new(n||t)(_(Bl),_(at),_(Me),_(Hr))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-tts-script"]],hostVars:3,hostBindings:function(n,r){n&2&&(Nl("innerHTML",r.innerHTML,Ml),nn("height",r.pageHeight))},inputs:{documentId:"documentId",pdfPage:"pdfPage"},standalone:!1,features:[xe([J])],decls:0,vars:0,template:function(n,r){},styles:["[_nghost-%COMP%]{padding-top:30px;margin-left:50px;display:block;overflow:auto;font-size:8px}"],changeDetection:0}));let s=t;return s})();var Wg=["selectText"],zg=["annot"],Gg=()=>[zp,Ea,bt,Gp,Kp,xd,ks,Pd,Md,Rd];function Yg(s,t){if(s&1&&(I(0,"div",6),q(1,"sd-loader"),N()),s&2){let i=E();T("ngStyle",i.getIndicatorStyle(!0))}}function Xg(s,t){if(s&1&&(I(0,"div",7),q(1,"div",8),I(2,"span"),_e(3),Y(4,"translate"),N()()),s&2){let i=E();T("ngStyle",i.getIndicatorStyle(!1)),x(3),we(X(4,2,"FAILED_TO_LOAD_PAGE"))}}function Kg(s,t){if(s&1){let i=ve();I(0,"sd-image",9),ae("resetted",function(){j(i);let n=E();return W(n.imgResetted())})("rendered",function(){j(i);let n=E();return W(n.imgRenderDone())})("failed",function(n){j(i);let r=E();return W(r.imgFetchFailed(n))}),N()}if(s&2){let i=E();T("pdfPage",i.page)("documentId",i.documentId),ge("aria-hidden",!0)}}function qg(s,t){if(s&1){let i=ve();I(0,"sd-invisible-tracer-view",10),ae("rendered",function(){j(i);let n=E();return W(n.invisibleTracerRendered())}),N()}}function Qg(s,t){if(s&1&&q(0,"sd-annot",19,0),s&2){let i=E(2);T("pdfPage",i.page)("documentId",i.documentId)("selectText",i.selectText)}}function Zg(s,t){if(s&1&&q(0,"sd-api-highlight",20),s&2){let i=E(2);T("pdfPage",i.page)}}function Jg(s,t){if(s&1&&q(0,"sd-search-highlight",21),s&2){let i=E(2);T("pdfPage",i.page)("result",i.searchResult)("redactionMarks",i.redactionMarks)("redactionResults",i.redactionResults)}}function ef(s,t){if(s&1){let i=ve();I(0,"sd-select-text",22,1),ae("textFetched",function(n){j(i);let r=E(2);return W(r.fetchedText=n)}),N()}if(s&2){let i=E(2);T("pdfPage",i.page)("documentId",i.documentId)("isScreenReaderActive",i.isScreenReaderActive)}}function tf(s,t){if(s&1&&q(0,"sd-page-script",23),s&2){let i=E(2);T("page",i.page)("fetchedText",i.fetchedText)}}function nf(s,t){if(s&1&&q(0,"sd-magnify-tool",20),s&2){let i=E(2);T("pdfPage",i.page)}}function of(s,t){if(s&1&&q(0,"sd-capture-tool",24),s&2){let i=E(2);T("pdfPage",i.page)("annot",i.annot)}}function rf(s,t){if(s&1&&q(0,"sd-tts-script",25),s&2){let i=E(2);T("documentId",i.documentId)("pdfPage",i.page)}}function sf(s,t){if(s&1&&q(0,"sd-guide-line",26),s&2){let i=E(2);T("pdfPage",i.page)}}function af(s,t){if(s&1&&se(0,Qg,2,3,"sd-annot",11)(1,Zg,1,1,"sd-api-highlight",12)(2,Jg,1,4,"sd-search-highlight",13)(3,ef,2,3,"sd-select-text",14)(4,tf,1,2,"sd-page-script",15)(5,nf,1,1,"sd-magnify-tool",12)(6,of,1,2,"sd-capture-tool",16)(7,rf,1,2,"sd-tts-script",17)(8,sf,1,1,"sd-guide-line",18),s&2){let i=E();T("ngIf",!i.supportTTS&&i.isEnabledAnnotation),x(),T("ngIf",i.apiHighlighted),x(),T("ngIf",(i.searchResult||i.redactionMarks||i.redactionResults)&&!i.supportTTS),x(),T("ngIf",i.isVisibleSelectText()&&!i.supportTTS),x(),T("ngIf",i.isScreenReaderActive&&i.fetchedText.length>0),x(),T("ngIf",i.isVisibleMagnifyTool()&&!i.supportTTS),x(),T("ngIf",i.isVisibleCaptureTool()&&!i.supportTTS),x(),T("ngIf",i.supportTTS),x(),T("ngIf",i.rulerActive)}}var Ec=(()=>{let t=class t{elementRef;changeDetectorRef;contentService;accessibilityService;subscriptionService;apiEventBridgeService;apiHighlightService;textService;translatePipe;documentService;store$;viewerService;renderer;searchService;priority;page;documentId;selectText;annot;supportTTS;scale;degree;dragMode;rulerActive;annotTool=null;isCaptureMode=!1;isReady=!1;isImgLoaded=!1;isImgFailed=!1;isInvisibleTracerRendered=!1;searchResult=null;redactionMarks=null;redactionResults=null;apiHighlighted=!1;fetchedText=[];isScreenReaderActive=!1;pageScript="";pageAriaLabels=[];get isEnabledAnnotation(){return this.documentService.checkAuthority(Ne.ANNOTATION)||this.documentService.checkAuthority(Ne.FORM)}get invisibleTracerEnabled(){return Ze.activateInvisibleTracer&&K.get(ie.INVISIBLE_TRACER).enable}changesSrc=new Vt(null);constructor(e,n,r,c,g,v,y,M,k,Z,le,pe,he,Te){this.elementRef=e,this.changeDetectorRef=n,this.contentService=r,this.accessibilityService=c,this.subscriptionService=g,this.apiEventBridgeService=v,this.apiHighlightService=y,this.textService=M,this.translatePipe=k,this.documentService=Z,this.store$=le,this.viewerService=pe,this.renderer=he,this.searchService=Te}ngOnChanges(e){this.changesSrc.next(e)}ngOnInit(){this.priority===0&&(this.isReady=!0),this.subscriptionService.push(this.store$.pipe($("isScreenReaderActive")).subscribe({next:e=>this.isScreenReaderActive=e}),this.store$.pipe($("isCaptureMode")).subscribe({next:e=>{this.isCaptureMode=e,this.changeDetectorRef.markForCheck()}}),ut(this.store$.pipe($("supportTTS")).pipe(rt(e=>this.supportTTS=e))).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.store$.pipe($("dragMode")).pipe(rt(e=>this.dragMode=e),Js(1)).subscribe({next:()=>{this.changeDetectorRef.markForCheck(),this.apiEventBridgeService.dragToolChangeAppliedSrc.next({ok:!0,data:void 0})}}),ut(this.store$.pipe($("degree")).pipe(rt(e=>this.degree=e)),this.store$.pipe($("scale")).pipe(rt(e=>this.scale=e))).subscribe({next:()=>{this.changeDetectorRef.destroyed||this.changeDetectorRef.detectChanges()}}),Ji([this.searchService.searchResult$.pipe(Zs(0)),this.searchService.searchRedactionMark$,this.searchService.searchRedactionResult$]).subscribe({next:([e,n,r])=>{this.bindSearchResult(e),this.bindRedactionMarks(n),this.bindRedactionResultsWithoutMarks(r,n,e)}}),this.changesSrc.pipe(F(w.isDefined),F(e=>!!e.page||!!e.documentId)).subscribe({next:()=>{this.render(),this.isScreenReaderActive&&this.dragMode!==Mt.SELECT_TEXT&&this.delayFetchTextData()}}),this.store$.pipe($("rulerActive")).subscribe({next:e=>{this.rulerActive=e,this.changeDetectorRef.markForCheck()}}),ut(dt(null),this.apiHighlightService.highlightInfoMapChange$).subscribe({next:()=>{this.apiHighlighted=this.apiHighlightService.highlightInfoMap[this.page.i]&&this.apiHighlightService.highlightInfoMap[this.page.i].length>0,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(Wo()).subscribe({next:e=>{this.annotTool=e,this.changeDetectorRef.markForCheck()}}),this.accessibilityService.pageAriaLabel$.subscribe({next:e=>{this.pageAriaLabels=e,this.changeDetectorRef.markForCheck()}}),this.viewerService.pageBorderColor$.subscribe({next:e=>{this.renderer.setStyle(this.elementRef.nativeElement,"outline-color",`${e}`)}}))}ngAfterViewInit(){this.subscriptionService.push(Ge(this.elementRef.nativeElement,"mousemove").subscribe({next:e=>this.selectText?.publishIsTextHover(e)}))}ngOnDestroy(){w.removeElement(this.elementRef.nativeElement),Xi.destroy(this)}onClick(e){e.target.nodeName==="SD-PAGE"&&e.stopPropagation()}get hostTabIndex(){return this.isVisibleSelectText()&&!this.supportTTS?null:this.pageAriaLabels[this.page.i]?this.pageAriaLabels[this.page.i]:this.isScreenReaderActive&&this.pageScript.trim().length===0?this.translatePipe.transform("NO_CONTENT"):`${this.page.i+1} ${this.translatePipe.transform("PAGE")}`}delayFetchTextData(){this.subscriptionService.set("delayedTextDataFetchSub",lr(ee.TaskPriority.TEXT).subscribe({next:()=>this.fetchTextData()}))}fetchTextData(){this.subscriptionService.set("textDataSub",this.textService.fetchPdfPageText(this.documentId,this.page.ref).subscribe({next:e=>{this.extractPageScript(e),this.fetchedText=e}}))}extractPageScript(e){e.forEach(n=>{this.pageScript+=n.text})}imgResetted(){this.isImgFailed=!1,this.isImgLoaded=this.isImgFailed}imgRenderDone(){this.isImgLoaded=!0,this.contentService.publishSomePageLoaded(!0)}imgFetchFailed(e){this.isImgFailed=!0,w.isDefined(e)&&(console.warn(e.message),this.apiEventBridgeService.watermarkCreatedSrc.next({ok:!1,error:e}))}invisibleTracerRendered(){this.isInvisibleTracerRendered=!0,this.changeDetectorRef.markForCheck()}isVisibleSelectText(){return this.isReady&&(this.dragMode===Mt.SELECT_TEXT||this.dragMode===Mt.AUTO||G.isMobile())&&!w.isDefined(this.annotTool)}isVisibleMagnifyTool(){return this.isReady&&this.dragMode===Mt.MAGNIFY&&!w.isDefined(this.annotTool)}isVisibleCaptureTool(){return this.isReady&&this.isCaptureMode&&!w.isDefined(this.annotTool)}getIndicatorStyle(e){let n={transform:ee.rotationNote(-(this.page.r+this.degree))};return e&&(n.transform+=` scale(${100/this.scale})`),n}render(){if(this.isReady)return;let e=Math.abs(this.priority)*100+this.priority*10;this.subscriptionService.set("delayedFetchSub",lr(e).subscribe({next:()=>{this.isReady=!0,this.changeDetectorRef.markForCheck()}}))}bindSearchResult(e){this.searchResult=e?.pageIdx===this.page.i?e:null,this.changeDetectorRef.markForCheck()}bindRedactionMarks(e){let n=e&&e[this.page.i];n?.length>0?this.redactionMarks={words:[...n]}:this.redactionMarks=null,this.changeDetectorRef.markForCheck()}bindRedactionResultsWithoutMarks(e,n,r){let c=e&&e[this.page.i],g=n&&n[this.page.i]?n[this.page.i]:[],v=r&&r.pageIdx===this.page.i?r.words:[];if(c?.length>0){let y=[...g,...v];this.redactionResults=y.length>0?{words:[...c.filter(M=>!w.isDefined(y.find(k=>Object.keys(w.diff(M,k)).length===0)))],pageIdx:this.page.i}:{words:[...c],pageIdx:this.page.i}}else this.redactionResults=null;this.changeDetectorRef.markForCheck()}};D(t,"\u0275fac",function(n){return new(n||t)(_(si),_(Me),_(at),_(ba),_(J),_(Zt),_(Zo),_(Hr),_(He),_(ct),_(Ee),_(Jt),_(jt),_(to))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-page"]],viewQuery:function(n,r){if(n&1&&(Ye(Wg,5),Ye(zg,5)),n&2){let c;Ie(c=Ae())&&(r.selectText=c.first),Ie(c=Ae())&&(r.annot=c.first)}},hostVars:1,hostBindings:function(n,r){n&1&&ae("click",function(g){return r.onClick(g)}),n&2&&ge("aria-label",r.hostTabIndex)},inputs:{priority:"priority",page:"page",documentId:"documentId"},standalone:!1,features:[xe([J]),tn],decls:7,vars:4,consts:[["annot",""],["selectText",""],["class","indicator loader",3,"ngStyle",4,"ngIf"],["class","indicator fail",3,"ngStyle",4,"ngIf"],["role","img",3,"pdfPage","documentId","resetted","rendered","failed",4,"ngIf"],["aria-hidden","true",3,"rendered",4,"ngIf"],[1,"indicator","loader",3,"ngStyle"],[1,"indicator","fail",3,"ngStyle"],[1,"image"],["role","img",3,"resetted","rendered","failed","pdfPage","documentId"],["aria-hidden","true",3,"rendered"],["aria-hidden","true",3,"pdfPage","documentId","selectText",4,"ngIf"],["aria-hidden","true",3,"pdfPage",4,"ngIf"],["aria-hidden","true",3,"pdfPage","result","redactionMarks","redactionResults",4,"ngIf"],["aria-hidden","true",3,"pdfPage","documentId","isScreenReaderActive","textFetched",4,"ngIf"],[3,"page","fetchedText",4,"ngIf"],["aria-hidden","true",3,"pdfPage","annot",4,"ngIf"],["aria-hidden","true",3,"documentId","pdfPage",4,"ngIf"],[3,"pdfPage",4,"ngIf"],["aria-hidden","true",3,"pdfPage","documentId","selectText"],["aria-hidden","true",3,"pdfPage"],["aria-hidden","true",3,"pdfPage","result","redactionMarks","redactionResults"],["aria-hidden","true",3,"textFetched","pdfPage","documentId","isScreenReaderActive"],[3,"page","fetchedText"],["aria-hidden","true",3,"pdfPage","annot"],["aria-hidden","true",3,"documentId","pdfPage"],[3,"pdfPage"]],template:function(n,r){n&1&&(se(0,Yg,2,1,"div",2)(1,Xg,5,4,"div",3)(2,Kg,1,3,"sd-image",4)(3,qg,1,0,"sd-invisible-tracer-view",5)(4,af,9,9),Rl(5,4,Gg),Il(10)),n&2&&(T("ngIf",!r.isImgLoaded&&!r.isImgFailed&&!r.supportTTS),x(),T("ngIf",!r.isImgLoaded&&r.isImgFailed),x(),T("ngIf",r.isReady&&(!r.invisibleTracerEnabled||r.isInvisibleTracerRendered)&&!r.supportTTS),x(),T("ngIf",r.invisibleTracerEnabled))},styles:['[_nghost-%COMP%]{display:block;background-color:#fff;box-shadow:0 0 20px 2px #6c6c6c29}.indicator[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;z-index:-1}.indicator.fail[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.indicator.fail[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:163px;height:140px;background-image:url("./media/invalid-page-3SXNTMZY.svg");background-size:contain;background-repeat:no-repeat}.indicator.fail[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin-top:32px}.indicator.loader[_ngcontent-%COMP%]{display:none;align-items:center;justify-content:center}.indicator.loader[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:56px;height:56px}sd-watermark[_ngcontent-%COMP%]{position:absolute;top:0;left:0;overflow:hidden}'],changeDetection:0}));let s=t;return s})();var cf=["svg"],lf=["popup"],Id=s=>({content:s});function pf(s,t){if(s&1&&(I(0,"div",18),_e(1),N()),s&2){let i=E();x(),we(i.title)}}function df(s,t){if(s&1){let i=ve();I(0,"pu-input",19),Y(1,"translate"),Y(2,"translate"),ae("blur",function(){j(i);let n=E();return W(n.finishEditTitle())})("keydown.enter",function(){j(i);let n=E();return W(n.finishEditTitle())}),N()}if(s&2){let i=E();T("placeholder",X(1,4,"ENTER_THE_AUTHOR_NAME"))("autofocus",!0)("formControl",i.titleFormControl)("ariaLabel",X(2,6,"ENTER_THE_AUTHOR_NAME"))}}function hf(s,t){if(s&1){let i=ve();I(0,"div",20)(1,"div",21),ae("click",function(){j(i);let n=E();return W(n.onColorPaletteClick())}),N()()}if(s&2){let i=E();$e("disabled",i.isLockedAnnot())("selected",i.isColorTabClicked),x(),nn("background",i.textAnnotColor)}}function uf(s,t){if(s&1){let i=ve();I(0,"pu-color-palette",22),Y(1,"translate"),Y(2,"translate"),Ii("ngModelChange",function(n){j(i);let r=E();return Ri(r.textAnnotColor,n)||(r.textAnnotColor=n),W(n)}),N()}if(s&2){let i=E();T("nullable",!1)("customColorLabel",X(1,5,"CUSTOM_COLOR"))("defaultColorLabel",X(2,7,"DEFAULT_COLOR"))("defaultColorPanelExpandedd",!0),Mi("ngModel",i.textAnnotColor)}}function gf(s,t){if(s&1&&q(0,"sd-popup-resizer",23),s&2){let i=t.$implicit;T("anchor",i)}}var Pc=s=>({process:(...t)=>{if(w.isDefined(t[s]))return t[s]()}}),ff=s=>{if(!s)return s;let t=s.substring(1);return t.length!==3?t:t[0]+t[0]+t[1]+t[1]+t[2]+t[2]},ao=class ao{annotService;contentService;documentService;renderer;changeDetectorRef;scrollController;elementRef;subscriptionService;store$;loggingService;translatePipe;get environment(){return Ze}popupInfo;popupOrder;contentViewRoot;svgElementRef;popupElementRef;get zoom(){return ee.normalizeScale(this.scale)}popupSize={width:0,height:0};preferences={};isEditingTitle=!1;titleFormControl=new fr;degree;scale;currentPageNo;viewMode;_popupStyles={};linkStyles={};_containerStyle={};drag_startCursorPos={x:0,y:0};drag_startPopupPos={top:0,left:0,right:0,bottom:0};boundingTranslate={x:0,y:0};memoColor=null;popupViewCoords={x:0,y:0};onMouseMoveListener=null;onMouseUpListener=null;onTouchMoveListener=null;onTouchEndListener=null;txtTotalDelta={x:0,y:0};_containerPos;isColorTabClicked=!1;get anchorList(){return ao.AnchorList}get data(){if(!w.isDefined(this.popupInfo.src))throw new Xt("popupInfo.src is undefined.");return this.popupInfo.src}get isTextAnnot(){return w.isDefined(this.data)&&Lt.isText(this.data)}get popupOid(){return this.data?.Popup??Number.MAX_SAFE_INTEGER}get textAnnotColor(){return w.isDefined(this.data)&&Lt.isText(this.data)?this.data.attributes.color:(this.loggingService.common("warn",Le.INVALID,`${this.translatePipe.transform("ANNOTATION")} type`),null)}set textAnnotColor(t){if(w.isDefined(this.data)&&!Lt.isText(this.data)){this.loggingService.common("warn",Le.INVALID,`${this.translatePipe.transform("ANNOTATION")} type`);return}this.data.attributes.color=t,this.annotService.putModel(this.data,"modify"),this.contentService.fireAnnotEvent({from:"PopupComponent",sdEventType:an.UPDATE,pageIdx:this.data.attributes.pageIdx,annot:this.data})}get popup(){return this.popupInfo.popup}get pdfPage(){if(!w.isDefined(this.popupInfo.pdfPage))throw new Xt("popupInfo.pdfPage is undefined.");return this.popupInfo.pdfPage}get direction(){return ee.rotate2Direction(this.pdfPage.r+this.degree)}get points(){return this.svg.firstElementChild.points}get svg(){return this.svgElementRef.nativeElement}get textCoords(){return this.data.attributes.rect}get popupCoords(){return this.popup.attributes.rect}get popupLinkBoxStyles(){return ao.linkBoxStyle}get contents(){return this.data?.attributes?.contents||w.EMPTY_STRING}set contents(t){this.data.attributes.contents=t,this.contentService.publishAnnotContentsChange({annotOid:this.data.oid})}get title(){let t=this.data?.attributes?.T;return!w.isDefined(t)||t===""?this.translatePipe.transform("ENTER_THE_AUTHOR_NAME"):t}get popupStyles(){Object.assign(this.popupViewCoords,this.convertPDFCoord(this.popup.attributes.rect.left,this.popup.attributes.rect.top)),this.drawPopupLink(this.txtTotalDelta);let t=Ar.elementStyleOf(this.popup);t.bottom=null,t.right=t.bottom,t.top=t.right,t.left=t.top,t.transform=`translate(${this.popupViewCoords.x+this.boundingTranslate.x}px,${this.popupViewCoords.y+this.boundingTranslate.y}px)`;let i=null,e=ff(this.data.attributes.color);return e&&(this.memoColor={r:parseInt(`0x${e.substring(0,2)}`,16),g:parseInt(`0x${e.substring(2,4)}`,16),b:parseInt(`0x${e.substring(4,6)}`,16)},i={r:230+Math.floor(this.memoColor.r/10),g:230+Math.floor(this.memoColor.g/10),b:230+Math.floor(this.memoColor.b/10)}),t.background=i?`rgb(${i.r}, ${i.g}, ${i.b})`:"#ffeb98",this._popupStyles=pi(pi({},this._popupStyles||{color:null,background:null}),ee.bindLayoutOrder(t,ee.LayoutOrder.Popup+this.popupOrder.indexOf(this.popupOid)))}get popupLinkStyles(){return this.memoColor?(this.linkStyles.stroke=`rgb(${this.memoColor.r}, ${this.memoColor.g}, ${this.memoColor.b})`,this.linkStyles.fill=`rgba(${this.memoColor.r}, ${this.memoColor.g}, ${this.memoColor.b}, 0.1)`):(this.linkStyles.stroke="transparent",this.linkStyles.fill="transparent"),this.linkStyles}get popupContainerStyles(){let t=this.direction,i=ee.isVisible(this.pdfPage.i,this.currentPageNo-1,this.viewMode);return this._containerStyle.visibility=i?null:"hidden",this._containerPos&&(this._containerStyle.left=`${this._containerPos.left[t]*this.zoom}px`,this._containerStyle.top=`${this._containerPos.top[t]*this.zoom}px`),this._containerStyle}constructor(t,i,e,n,r,c,g,v,y,M,k){this.annotService=t,this.contentService=i,this.documentService=e,this.renderer=n,this.changeDetectorRef=r,this.scrollController=c,this.elementRef=g,this.subscriptionService=v,this.store$=y,this.loggingService=M,this.translatePipe=k}ngOnChanges(t){t.popupInfo&&(this._containerPos={left:[-this.pdfPage.bbox.x,-this.pdfPage.bbox.y,this.pdfPage.bbox.x,this.pdfPage.bbox.y],top:[this.pdfPage.bbox.y,-this.pdfPage.bbox.x,-this.pdfPage.bbox.y,this.pdfPage.bbox.x]})}ngOnInit(){this.subscriptionService.push(this.store$.pipe(ci("popupFontSize")).subscribe({next:i=>{this.preferences.popupFontSize=i,setTimeout(()=>this.changeDetectorRef.markForCheck())}}),this.store$.pipe(ci("language")).subscribe({next:i=>{this.preferences.language=i,setTimeout(()=>this.changeDetectorRef.markForCheck())}}),this.annotService.text$.pipe(F(i=>this.data?.oid===i.model.oid)).subscribe({next:i=>{this.txtTotalDelta=i.totalDelta,this.changeDetectorRef.markForCheck()}}),this.contentService.annotEvent$.pipe(F(w.isDefined),F(i=>i.sdEventType===an.SELECTED&&i.to==="popups"&&i.annot.oid!==this.popup.oid||i.sdEventType===an.UPDATE&&i.annot.Popup===this.popup.oid)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),ut(this.store$.pipe($("currentPageNo")),this.store$.pipe($("viewMode")).pipe(rt(i=>this.viewMode=i)),this.store$.pipe($("scale")).pipe(rt(i=>this.scale=i),Zs(0)),this.store$.pipe($("degree")).pipe(rt(i=>this.degree=i))).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.contentService.postAnnotEdit$.pipe(F(i=>i.annotOid===this.data?.oid)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.store$.pipe($("currentPageNo")).subscribe({next:i=>this.currentPageNo=i}),this.annotService.annotVisibleEvent$.subscribe({next:i=>{w.isDefined(this.data)&&!i.includes(this.data.oid)&&this.togglePopup()}})),this.subscribeMainViewResized();let t=this.svg;!t||!t.firstElementChild||this.fixPoints(t,this.points,3)}ngOnDestroy(){this.destroyMouseListeners()}ngAfterViewInit(){let{width:t,height:i}=Ar.elementStyleOf(this.popup);if(w.isDefined(t)&&w.isDefined(i))this.popupSize.width=parseFloat(t),this.popupSize.height=parseFloat(i);else throw new Xt("Cannot read popup annotation style.");let e=this.popupElementRef.nativeElement;this.locate(e),(this.data?.attributes.contents||w.EMPTY_STRING).length||setTimeout(()=>{let n=e.getElementsByTagName("textarea")[0];w.isDefined(n)&&n.focus()})}isReadonly(){return!this.documentService.checkAuthority(Ne.EDIT_ANNOTATION)||gr.get(this.data?.attributes.F??-1,7)}isLockedAnnot(){return gr.get(this.data?.attributes.F??-1,7)}onMouseDown(t){if(t.target!==t.currentTarget)return;t.stopPropagation(),t.preventDefault();let i=this.popupOrder.indexOf(this.popupOid);i>-1&&(this.popupOrder.splice(i,1),this.popupOrder.push(this.popupOid)),this.contentService.fireAnnotEvent({sdEventType:an.SELECTED,annot:this.popup,to:"popups"}),this.applyTranslateToReal(),this.drag_startCursorPos.x=t.clientX,this.drag_startCursorPos.y=t.clientY,Object.assign(this.drag_startPopupPos,this.popupCoords),this.destroyMouseListeners(),this.onMouseMoveListener=this.renderer.listen("document","mousemove",e=>this.onMouseMove(e)),this.onMouseUpListener=this.renderer.listen("document","mouseup",e=>this.onMouseUp(e)),this.onTouchMoveListener=this.renderer.listen("document","touchmove",e=>this.onMouseMove(this.touchToMouse(e))),this.onTouchEndListener=this.renderer.listen("document","touchend",e=>this.onMouseUp(this.touchToMouse(e)))}touchToMouse(t){return w.touchToMouseEvt(t,this.degree,this.scale,this.pdfPage)}startEditTitle(){this.isLockedAnnot()||(this.titleFormControl.setValue(this.data?.attributes?.T??""),this.isEditingTitle=!0)}finishEditTitle(){this.data.attributes.T=this.titleFormControl.value,this.onPopupValueChanged(),this.isEditingTitle=!1}applyTranslateToReal(){let t=this.direction;if(this.boundingTranslate.x){let i=this.boundingTranslate.x/this.zoom;(t===2||t===3)&&(i*=-1),t===1||t===3?(this.popupCoords.top+=i,this.popupCoords.bottom+=i):(this.popupCoords.left+=i,this.popupCoords.right+=i),this.boundingTranslate.x=0}if(this.boundingTranslate.y){let i=this.boundingTranslate.y/this.zoom;(t===0||t===3)&&(i*=-1),t===1||t===3?(this.popupCoords.left+=i,this.popupCoords.right+=i):(this.popupCoords.top+=i,this.popupCoords.bottom+=i),this.boundingTranslate.y=0}}togglePopup(){this.annotService.togglePopup(this.data)}onMouseClickDelete(){this.contents="";let t={from:"PopupComponent",sdEventType:an.DELETE,annot:Lt.isText(this.data)?this.data:this.popup};this.contentService.fireAnnotEvent(t),this.contentService.fireAnnotListEvent(t)}onColorPaletteClick(){this.isColorTabClicked=!this.isColorTabClicked}onPopupValueChanged(){this.annotService.putModel(this.data,"modify"),this.contentService.fireAnnotListEvent({from:"PopupComponent",sdEventType:an.UPDATE,annot:this.data})}onMouseMove(t){t.stopPropagation(),t.preventDefault();let i=this.direction,e={x:t.clientX-this.drag_startCursorPos.x,y:this.drag_startCursorPos.y-t.clientY};return(i===1||i===3)&&([e.x,e.y]=[e.y,e.x]),Pc(i).process(null,()=>{e.x*=-1},()=>{e.x*=-1,e.y*=-1},()=>{e.y*=-1}),e.x/=this.zoom,e.y/=this.zoom,this.popupCoords.top=this.drag_startPopupPos.top+e.y,this.popupCoords.left=this.drag_startPopupPos.left+e.x,this.popupCoords.right=this.drag_startPopupPos.right+e.x,this.popupCoords.bottom=this.drag_startPopupPos.bottom+e.y,this.changeDetectorRef.markForCheck(),!1}onMouseUp(t){let i=this.elementRef.nativeElement.parentElement.getBoundingClientRect(),e=this.popupElementRef.nativeElement.getBoundingClientRect(),n=Math.max(i.left-e.left,0)/this.zoom,r=Math.min(e.top-i.top,0)/this.zoom;this.popupCoords.top+=r,this.popupCoords.left+=n,this.popupCoords.bottom+=r,this.popupCoords.right+=n,t.stopPropagation(),t.preventDefault(),this.destroyMouseListeners(),this.annotService.putModel(this.popup,"modify"),this.changeDetectorRef.markForCheck()}destroyMouseListeners(){w.isDefined(this.onMouseMoveListener)&&this.onMouseMoveListener(),this.onMouseMoveListener=null,w.isDefined(this.onMouseUpListener)&&this.onMouseUpListener(),this.onMouseUpListener=null,w.isDefined(this.onTouchMoveListener)&&this.onTouchMoveListener(),this.onTouchMoveListener=null,w.isDefined(this.onTouchEndListener)&&this.onTouchEndListener(),this.onTouchEndListener=null}convertPDFCoord(t,i){if(!w.isDefined(this.scrollController.stateHolder))throw new Xt("stateHolder is undefined.");let e=this.scrollController.stateHolder.getPageSize(this.pdfPage.i),n=this.scrollController.stateHolder.getPageFrameOffset(this.viewMode,this.pdfPage.i),r={x:0,y:0},c=oo.getOffset(this.scrollController.stateHolder,this.contentViewRoot,this.scale,this.viewMode,this.currentPageNo),g=this.direction,v=t,y=i;return(g===1||g===3)&&([v,y]=[y,v]),Pc(g).process(()=>{r.x=n.offsetX,r.y=n.offsetY+e.height},()=>{r.x=n.offsetX,r.y=n.offsetY,y*=-1},()=>{r.x=n.offsetX+e.width,r.y=n.offsetY,v*=-1,y*=-1},()=>{r.x=n.offsetX+e.width,r.y=n.offsetY+e.height,v*=-1}),{x:(r.x+Ui.MARGIN+v)*this.zoom+c.offsetX,y:(r.y+Ui.MARGIN-y)*this.zoom+c.offsetY}}locate(t){if(!t)return;let i=this.contentViewRoot.getBoundingClientRect(),e=t.getBoundingClientRect();e.top<i.top?this.boundingTranslate.y=i.top-e.top:i.bottom<e.bottom&&(this.boundingTranslate.y=i.bottom-e.bottom),e.left<i.left?this.boundingTranslate.x=i.left-e.left:i.right<e.right&&(this.boundingTranslate.x=i.right-e.right)}fixPoints(t,i,e){let n=e-i.numberOfItems;for(let r=0;r<n;r++)i.appendItem(t.createSVGPoint());for(let r=n-1;r>=e;r++)i.removeItem(r);return i}centerPointOfPopup(){return{x:this.popupViewCoords.x+(this.popupCoords.right-this.popupCoords.left)/2+this.boundingTranslate.x,y:this.popupViewCoords.y+(this.popupCoords.top-this.popupCoords.bottom)/2+this.boundingTranslate.y}}drawPopupLink(t={x:0,y:0}){let i=Ar.centerPointOf(this.textCoords);i=this.convertPDFCoord(i.x,i.y);let e=pi({},t),n=this.direction;(n===1||n===3)&&([e.x,e.y]=[e.y,e.x]),Pc(n).process(null,()=>{e.x*=-1},()=>{e.x*=-1,e.y*=-1},()=>{e.y*=-1}),i.x+=e.x*this.zoom,i.y+=e.y*this.zoom;let r=this.centerPointOfPopup(),c=[i,{x:r.x-10,y:r.y-10},{x:r.x+10,y:r.y+10}],g=this.points;c.length===g.numberOfItems&&c.forEach((v,y)=>Object.assign(g.getItem(y),v))}subscribeMainViewResized(){this.subscriptionService.push(ut(G.windowResize$,this.store$.pipe($("sideViewVisible")),this.store$.pipe($("sideViewSize")),this.store$.pipe($("rightSideViewVisible")),this.store$.pipe($("rightSideViewSize"))).pipe(ni(0)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}))}};D(ao,"linkBoxStyle",ee.bindLayoutOrder({width:"initial",height:"initial","pointer-events":"none"},ee.LayoutOrder.PopupLinker)),D(ao,"AnchorList",["nw","ne","sw","se","n","s","w","e"]),D(ao,"\u0275fac",function(i){return new(i||ao)(_(li),_(at),_(ct),_(jt),_(Me),_(zi),_(si),_(J),_(Ee),_(Ai),_(He))}),D(ao,"\u0275cmp",Ce({type:ao,selectors:[["sd-popup"]],viewQuery:function(i,e){if(i&1&&(Ye(cf,7),Ye(lf,7)),i&2){let n;Ie(n=Ae())&&(e.svgElementRef=n.first),Ie(n=Ae())&&(e.popupElementRef=n.first)}},inputs:{popupInfo:"popupInfo",popupOrder:"popupOrder",contentViewRoot:"contentViewRoot"},standalone:!1,features:[xe([J,{provide:Qn,useValue:new Vt(300)}]),tn],decls:27,vars:42,consts:[["popup",""],["inputTitleRef",""],["svg",""],[1,"popup-container",3,"ngStyle"],[1,"popup","no-scroller",3,"mousedown","touchstart","pointerdown","pointermove","pointerup","ngStyle"],[1,"nav"],[1,"label",3,"click"],["class","title",4,"ngIf","ngIfElse"],[1,"btns"],["class","color-picker-container",3,"disabled","selected",4,"ngIf"],["size","tiny",3,"nullable","customColorLabel","defaultColorLabel","defaultColorPanelExpandedd","ngModel","ngModelChange",4,"ngIf"],["color","dark",1,"ep-text-button",3,"click","title","tooltip"],[1,"papycon","papycon-exit-fullscreen"],["color","dark",1,"ep-text-button",3,"click","title","tooltip","disabled"],[1,"papycon","papycon-trash-can"],[3,"anchor",4,"ngFor","ngForOf"],[1,"no-scroller",3,"ngModelChange","change","keyup.esc","keydown","touchstart","pointerdown","pointermove","pointerup","placeholder","maxlength","readonly","ngModel"],[3,"ngStyle"],[1,"title"],[3,"blur","keydown.enter","placeholder","autofocus","formControl","ariaLabel"],[1,"color-picker-container"],[1,"color-rect",3,"click"],["size","tiny",3,"ngModelChange","nullable","customColorLabel","defaultColorLabel","defaultColorPanelExpandedd","ngModel"],[3,"anchor"]],template:function(i,e){if(i&1){let n=ve();I(0,"div",3)(1,"div",4,0),ae("mousedown",function(c){return j(n),W(e.onMouseDown(c))})("touchstart",function(c){return j(n),W(e.onMouseDown(e.touchToMouse(c)))})("pointerdown",function(c){return j(n),W(c.stopPropagation())})("pointermove",function(c){return j(n),W(c.stopPropagation())})("pointerup",function(c){return j(n),W(c.stopPropagation())}),I(3,"div",5)(4,"div",6),ae("click",function(){return j(n),W(e.startEditTitle())}),se(5,pf,2,1,"div",7)(6,df,3,8,"ng-template",null,1,Vi),N(),I(8,"div",8),se(9,hf,2,6,"div",9)(10,uf,3,9,"pu-color-palette",10),I(11,"button",11),Y(12,"translate"),Y(13,"translate"),Y(14,"translate"),ae("click",function(){return j(n),W(e.togglePopup())}),q(15,"i",12),N(),I(16,"button",13),Y(17,"translate"),Y(18,"translate"),Y(19,"translate"),ae("click",function(){return j(n),W(e.onMouseClickDelete())}),q(20,"i",14),N()()(),se(21,gf,1,1,"sd-popup-resizer",15),I(22,"textarea",16),Y(23,"translate"),Ii("ngModelChange",function(c){return j(n),Ri(e.contents,c)||(e.contents=c),W(c)}),ae("change",function(){return j(n),W(e.onPopupValueChanged())})("keyup.esc",function(){return j(n),W(e.togglePopup())})("keydown",function(c){return j(n),W(c.stopPropagation())})("touchstart",function(c){return j(n),W(c.stopPropagation())})("pointerdown",function(c){return j(n),W(c.stopPropagation())})("pointermove",function(c){return j(n),W(c.stopPropagation())})("pointerup",function(c){return j(n),W(c.stopPropagation())}),N()(),wi(),I(24,"svg",17,2),q(26,"polygon",17),N()()}if(i&2){let n=yi(7);T("ngStyle",e.popupContainerStyles),x(),T("ngStyle",e.popupStyles),x(4),T("ngIf",!e.isEditingTitle)("ngIfElse",n),x(4),T("ngIf",e.isTextAnnot),x(),T("ngIf",e.isColorTabClicked),x(),T("title",X(12,24,"CLOSE"))("tooltip",vt(38,Id,X(13,26,"CLOSE"))),ge("aria-label",X(14,28,"CLOSE")),x(5),T("title",X(17,30,"DELETE"))("tooltip",vt(40,Id,X(18,32,"DELETE")))("disabled",e.isLockedAnnot()),ge("aria-label",X(19,34,"DELETE")),x(5),T("ngForOf",e.anchorList),x(),nn("font-size",e.preferences.popupFontSize+"px")("background",e.popupStyles.background),T("placeholder",X(23,36,"COMMENTS"))("maxlength",e.environment.annotation.contentsLengthLimit)("readonly",e.isReadonly()),Mi("ngModel",e.contents),x(2),T("ngStyle",e.popupLinkBoxStyles),x(2),T("ngStyle",e.popupLinkStyles)}},styles:["[_nghost-%COMP%]{display:block;height:100%}.popup[_ngcontent-%COMP%]{position:absolute;top:0;left:0;box-shadow:0 4px 9px #0000003d}.nav[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;height:40px;box-sizing:border-box;padding:0 16px;-webkit-user-select:none;user-select:none;pointer-events:none;white-space:nowrap}.nav[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{overflow:hidden;cursor:text;pointer-events:auto;margin-right:8px}.nav[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Medium,sans-serif;color:#6c6c6c;overflow:hidden;text-overflow:ellipsis}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]{display:flex}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   .color-picker-container[_ngcontent-%COMP%]{border:1px solid #DADADA;border-radius:2px;box-sizing:border-box;padding:3px;width:24px;height:24px;pointer-events:initial;cursor:pointer}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   .color-picker-container.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none;-webkit-user-select:none;user-select:none}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   .color-picker-container.selected[_ngcontent-%COMP%]{background-color:rgba(var(--primary-50),.08);border:1px solid var(--primary-50);box-shadow:0 0 6px 0 var(--primary-50)}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   .color-picker-container[_ngcontent-%COMP%]   .color-rect[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:2px;background-size:cover}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   pu-color-palette[_ngcontent-%COMP%]{background:var(--mono-00);border:1.2px solid var(--mono-30);border-radius:2px;box-sizing:border-box;position:absolute;margin-top:33.2px;pointer-events:initial;padding:10px;width:216px;overflow:hidden;z-index:10000}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-width:0;outline-offset:-2px;width:24px;height:24px;margin-left:8px;opacity:.8;pointer-events:initial}.popup-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0}textarea[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Regular,sans-serif;color:#1e1e1e;box-sizing:border-box;width:100%;max-width:100%;height:calc(100% - 40px);max-height:calc(100% - 20px);padding:16px;background-color:inherit;border:none;overflow:auto;resize:none}textarea[_ngcontent-%COMP%]:focus{outline:none}svg[_ngcontent-%COMP%]{position:absolute;left:0;cursor:auto;overflow:visible}polygon[_ngcontent-%COMP%]{stroke-width:1}"],changeDetection:0}));var er=ao;ze([Op(it.popupComp.contents,1e3)],er.prototype,"contents",null);var Ad=(()=>{let t=class t{annotService;renderer;changeDetectorRef;popup;anchor;MIN_WIDTH=95;MIN_HEIGHT=50;_resizerStyles={};onMouseMoveListener=null;onMouseUpListener=null;onTouchMoveListener=null;onTouchEndListener=null;drag_startCursorPos={x:0,y:0};drag_startPopupPos={top:0,left:0,right:0,bottom:0};popup_prevSize={width:0,height:0};constructor(e,n,r,c){this.annotService=e,this.renderer=n,this.changeDetectorRef=r,this.popup=c}ngAfterViewInit(){Object.assign(this._resizerStyles,this.positionCalc(this.anchor,4)),Object.assign(this._resizerStyles,this.sizeCalc(this.anchor,10)),this._resizerStyles.cursor=`${this.anchor}-resize`,this._resizerStyles.position="absolute",this.detectChange()}ngOnDestroy(){this.destroyMouseListeners()}onMouseDown(e){e.target===e.currentTarget&&(e.stopPropagation(),e.preventDefault(),this.popup.applyTranslateToReal(),this.popup_prevSize.width=this.popup.popupSize.width,this.popup_prevSize.height=this.popup.popupSize.height,this.drag_startCursorPos.x=e.clientX,this.drag_startCursorPos.y=e.clientY,Object.assign(this.drag_startPopupPos,this.popup.popupCoords),this.onMouseMoveListener=this.renderer.listen("document","mousemove",n=>this.onMouseMove(n)),this.onMouseUpListener=this.renderer.listen("document","mouseup",n=>this.onMouseUp(n)),this.onTouchMoveListener=this.renderer.listen("document","touchmove",n=>this.onMouseMove(this.touchToMouse(n))),this.onTouchEndListener=this.renderer.listen("document","touchend",n=>this.onMouseUp(this.touchToMouse(n))))}onMouseMove(e){let n=this.popup.direction,r={left:0,top:0,right:0,bottom:0};return e.stopPropagation(),e.preventDefault(),this.anchor.includes("n")&&(r.top=this.drag_startCursorPos.y-e.clientY,this.popup_prevSize.height+r.top<this.MIN_HEIGHT&&(r.top=this.MIN_HEIGHT-Math.floor(this.popup_prevSize.height)),this.popup.popupSize.height=this.popup_prevSize.height+r.top,(n===1||n===2)&&(r.top*=-1),n===1||n===3?this.popup.popupCoords.left=this.drag_startPopupPos.left+r.top/this.popup.zoom:this.popup.popupCoords.top=this.drag_startPopupPos.top+r.top/this.popup.zoom),this.anchor.includes("w")&&(r.left=e.clientX-this.drag_startCursorPos.x,this.popup_prevSize.width-r.left<this.MIN_WIDTH&&(r.left=Math.floor(this.popup_prevSize.width)-this.MIN_WIDTH),this.popup.popupSize.width=this.popup_prevSize.width-r.left,(n===2||n===3)&&(r.left*=-1),n===1||n===3?this.popup.popupCoords.top=this.drag_startPopupPos.top+r.left/this.popup.zoom:this.popup.popupCoords.left=this.drag_startPopupPos.left+r.left/this.popup.zoom),this.anchor.includes("e")&&(r.right=e.clientX-this.drag_startCursorPos.x,this.popup_prevSize.width+r.right<this.MIN_WIDTH&&(r.right=this.MIN_WIDTH-Math.floor(this.popup_prevSize.width)),this.popup.popupSize.width=this.popup_prevSize.width+r.right,this.popup.popupCoords.right=this.drag_startPopupPos.right+r.right/this.popup.zoom),this.anchor.includes("s")&&(r.bottom=this.drag_startCursorPos.y-e.clientY,this.popup_prevSize.height-r.bottom<this.MIN_HEIGHT&&(r.bottom=Math.floor(this.popup_prevSize.height)-this.MIN_HEIGHT),this.popup.popupSize.height=this.popup_prevSize.height-r.bottom,this.popup.popupCoords.bottom=this.drag_startPopupPos.bottom+r.bottom/this.popup.zoom),this.popup.popupCoords.right=this.popup.popupCoords.left+this.popup.popupSize.width,this.popup.popupCoords.bottom=this.popup.popupCoords.top-this.popup.popupSize.height,this.detectChange(),!1}onMouseUp(e){e.stopPropagation(),e.preventDefault(),this.destroyMouseListeners(),this.annotService.putModel(this.popup.popup,"modify"),this.detectChange()}destroyMouseListeners(){w.isDefined(this.onMouseMoveListener)&&this.onMouseMoveListener(),this.onMouseMoveListener=null,w.isDefined(this.onMouseUpListener)&&this.onMouseUpListener(),this.onMouseUpListener=null,w.isDefined(this.onTouchMoveListener)&&this.onTouchMoveListener(),this.onTouchMoveListener=null,w.isDefined(this.onTouchEndListener)&&this.onTouchEndListener(),this.onTouchEndListener=null}get resizerStyles(){return this._resizerStyles}positionCalc(e,n){let r={};switch(e.includes("n")&&(r.top=`${-n}px`),e.includes("w")&&(r.left=`${-n}px`),e.includes("e")&&(r.right=`${-n}px`),e.includes("s")&&(r.bottom=`${-n}px`),e){case"n":case"s":r.left=`${n}px`;break;case"w":case"e":r.top=`${n}px`;break}return r}sizeCalc(e,n){let r={};if(e.length===2)return r.height=`${n}px`,r.width=r.height,r;switch(e){case"n":case"s":r.width=`calc(100% - ${n}px)`,r.height=`${n}px`;break;case"w":case"e":r.height=`calc(100% - ${n}px)`,r.width=`${n}px`;break}return r}touchToMouse(e){return this.popup.touchToMouse(e)}detectChange(){this.changeDetectorRef.destroyed||(this.changeDetectorRef.markForCheck(),this.changeDetectorRef.detectChanges())}};D(t,"\u0275fac",function(n){return new(n||t)(_(li),_(jt),_(Me),_(er,1))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-popup-resizer"]],inputs:{anchor:"anchor"},standalone:!1,features:[xe([J])],decls:1,vars:1,consts:[[1,"no-scroller",3,"mousedown","pointerdown","pointermove","pointerup","touchstart","ngStyle"]],template:function(n,r){n&1&&(I(0,"div",0),ae("mousedown",function(g){return r.onMouseDown(g)})("pointerdown",function(g){return g.stopPropagation()})("pointermove",function(g){return g.stopPropagation()})("pointerup",function(g){return g.stopPropagation()})("touchstart",function(g){return r.onMouseDown(r.touchToMouse(g))}),N()),n&2&&T("ngStyle",r.resizerStyles)},dependencies:[Wt],encapsulation:2,changeDetection:0}));let s=t;return s})();function vf(s,t){if(s&1&&q(0,"sd-popup",1),s&2){let i=t.$implicit,e=E();T("contentViewRoot",e.contentViewRoot)("popupInfo",i)("popupOrder",e.popupOrder)}}var Mc=(()=>{let t=class t{contentService;popupService;changeDetectorRef;subscriptionService;store$;contentViewRoot;popups=[];popupOrder=[];isSelectedInAnnotView=!1;annotTool=null;constructor(e,n,r,c,g){this.contentService=e,this.popupService=n,this.changeDetectorRef=r,this.subscriptionService=c,this.store$=g}ngOnInit(){this.subscriptionService.push(this.store$.pipe(Wo()).subscribe({next:e=>this.annotTool=e}),this.contentService.annotEvent$.subscribe({next:e=>this.isSelectedInAnnotView=e?.from==="AnnotationViewComponent"}),this.popupService.popupHolder$.subscribe({next:e=>{this.toggle(e),this.popupService.publishOpenedPopupNumber(this.popups.length)}}),ut(this.contentService.reload$.pipe(F(e=>Go.type(e,zo.Annot))),this.popupService.closeAllPopup$).subscribe({next:()=>{this.clearPopups(),this.popupService.publishOpenedPopupNumber(0),this.changeDetectorRef.markForCheck()}}))}ngOnDestroy(){this.clearPopups()}clearPopups(){this.popups.splice(0),this.popupOrder.splice(0)}toggle({src:e,popup:n,pdfPage:r,open:c}){let g=this.popups.findIndex(v=>n.oid===v.popup.oid);if(g>=0&&(c===void 0||!c)){this.popups.splice(g,1),g=this.popupOrder.indexOf(n.oid),g>-1&&this.popupOrder.splice(g,1),this.changeDetectorRef.markForCheck();return}this.annotTool!==Qe.ERASER&&(c===void 0||c)&&(this.popupOrder.push(n.oid),this.isSelectedInAnnotView||this.popups.push({src:e,popup:n,pdfPage:r}),this.changeDetectorRef.markForCheck())}};D(t,"\u0275fac",function(n){return new(n||t)(_(at),_(va),_(Me),_(J),_(Ee))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-popups"]],inputs:{contentViewRoot:"contentViewRoot"},standalone:!1,features:[xe([J])],decls:1,vars:1,consts:[[3,"contentViewRoot","popupInfo","popupOrder",4,"ngFor","ngForOf"],[3,"contentViewRoot","popupInfo","popupOrder"]],template:function(n,r){n&1&&se(0,vf,1,3,"sd-popup",0),n&2&&T("ngForOf",r.popups)},encapsulation:2,changeDetection:0}));let s=t;return s})();var _f=["quickActionRef"],Sf=["actionsContainerRef"],bf=["actionItemRef"],Cf=()=>({"background-color":"var(--mono-10)","padding-left":"30px"}),Dd=(s,t)=>({focused:s,disabled:t});function xf(s,t){if(s&1){let i=ve();Ht(0),I(1,"button",14,2),Y(3,"translate"),ae("click",function(){let n=j(i).$implicit,r=E(3);return W(r.onActionClick(n))})("mouseenter",function(){let n=j(i).index,r=E(3);return W(r.onMouseEnterAction(n))}),I(4,"div",15)(5,"div",16),q(6,"i"),N(),I(7,"span"),_e(8),Y(9,"translate"),N()()(),$t()}if(s&2){let i=t.$implicit,e=t.index,n=E(3);x(),T("ngClass",dc(9,Dd,e===n.focusedActionIndex,n.shouldDisableAction(i))),ge("aria-label",X(3,5,i.name)),x(5),Kn(i.icon),x(2),we(X(9,7,i.name))}}function Tf(s,t){if(s&1&&(I(0,"div")(1,"h4"),_e(2),Y(3,"translate"),N(),se(4,xf,10,12,"ng-container",13),N()),s&2){let i=E(2);x(2),we(X(3,3,"RECENT_ACTION")),x(2),T("ngForOf",i.recentActions)("ngForTrackBy",i.trackByAction)}}function Of(s,t){s&1&&(I(0,"h4"),_e(1),Y(2,"translate"),N()),s&2&&(x(),we(X(2,1,"SHORTCUT")))}function wf(s,t){if(s&1){let i=ve();Ht(0),I(1,"button",14,2),Y(3,"translate"),ae("click",function(){let n=j(i).$implicit,r=E(2);return W(r.onActionClick(n))})("mouseenter",function(){let n=j(i).index,r=E(2);return W(r.onMouseEnterAction(n+r.recentActions.length))}),I(4,"div",15)(5,"div",16),q(6,"i"),N(),I(7,"span"),_e(8),Y(9,"translate"),N()(),I(10,"span",17),_e(11),N()(),$t()}if(s&2){let i=t.$implicit,e=t.index,n=E(2);x(),T("ngClass",dc(10,Dd,e+n.recentActions.length===n.focusedActionIndex,n.shouldDisableAction(i))),ge("aria-label",X(3,6,i.name)),x(5),Kn(i.icon),x(2),we(X(9,8,i.name)),x(3),we(i.shortcut)}}function yf(s,t){if(s&1){let i=ve();I(0,"nav",4,0),ae("mousedown",function(n){return j(i),W(n.stopPropagation())}),I(2,"div",5)(3,"div",6),q(4,"i",7),I(5,"pu-input",8),Y(6,"translate"),Ii("ngModelChange",function(n){j(i);let r=E();return Ri(r.actionKeyword,n)||(r.actionKeyword=n),W(n)}),ae("ngModelChange",function(n){j(i);let r=E();return W(r.onSearchChange(n))}),N()(),I(7,"button",9),ae("click",function(){j(i);let n=E();return W(n.onCloseClick())}),q(8,"i",10),N()(),I(9,"div",11,1),ae("wheel",function(n){return j(i),W(n.stopPropagation())}),se(11,Tf,5,5,"div",12),I(12,"div"),se(13,Of,3,3,"h4",12)(14,wf,12,13,"ng-container",13),N()()()}if(s&2){let i=E();x(5),T("placeholder",X(6,8,"SEARCH_FEATURE"))("autofocus",!0)("inputStyle",ta(10,Cf)),Mi("ngModel",i.actionKeyword),x(6),T("ngIf",i.recentActions.length>0),x(2),T("ngIf",i.actionKeyword.length===0),x(),T("ngForOf",i.displayedActions)("ngForTrackBy",i.trackByAction)}}var Rc=(()=>{let t=class t{changeDetectorRef;store$;viewerService;subscriptionService;shortcutService;localstorageService;quickActionService;actionHistoryService;annotSelectedService;pageService;documentService;objectClipboardService;DEFAULT_FOCUSED_ACTION_INDEX=0;actionKeyword=w.EMPTY_STRING;focusedActionIndex=this.DEFAULT_FOCUSED_ACTION_INDEX;shouldDisplayPalette=!1;viewMode;currentPageNo;pageCount;canUndo=!1;canRedo=!1;isNavigatingByKeyboard=!1;quickActionRef;actionsContainerRef;actionItemRefs;constructor(e,n,r,c,g,v,y,M,k,Z,le,pe){this.changeDetectorRef=e,this.store$=n,this.viewerService=r,this.subscriptionService=c,this.shortcutService=g,this.localstorageService=v,this.quickActionService=y,this.actionHistoryService=M,this.annotSelectedService=k,this.pageService=Z,this.documentService=le,this.objectClipboardService=pe}get displayedActions(){return this.actionKeyword.length>0?this.quickActionService.filterActionsByKeyword(this.actionKeyword.trim()):this.quickActionService.getActionsByIds(kp)}get recentActions(){let e=this.getRecentActionsFromLocalStorage();return e.length===0||this.actionKeyword.length>0?[]:e}get combinedActions(){return this.actionKeyword.length>0?this.displayedActions:[...this.recentActions,...this.displayedActions]}ngOnInit(){this.initSubscriptions()}initSubscriptions(){this.subscriptionService.push(G.windowMousedown$.pipe(F(()=>this.shouldDisplayPalette&&w.isDefined(this.quickActionRef))).subscribe({next:e=>{let n=e.clientX,r=e.clientY,c=this.quickActionRef.nativeElement.getBoundingClientRect();n>=c.left&&n<=c.right&&r>=c.top&&r<=c.bottom||(this.quickActionService.setPaletteVisibility(!1),this.changeDetectorRef.markForCheck())}}),this.quickActionService.paletteVisibility$.subscribe({next:e=>{this.shouldDisplayPalette=e,this.focusedActionIndex=this.DEFAULT_FOCUSED_ACTION_INDEX,this.actionKeyword=w.EMPTY_STRING,this.changeDetectorRef.markForCheck()}}),this.shortcutService.getShortcutEvent(Re.QUICK_ACTION).pipe(F(()=>K.get(ie.SHORTCUT_QUICK_ACTION)),F(()=>!G.isSmallWidth())).subscribe({next:()=>{this.quickActionService.togglePaletteVisibility(),this.changeDetectorRef.markForCheck()}}),this.shortcutService.getShortcutEvent(Re.ESCAPE).pipe(F(()=>this.shouldDisplayPalette)).subscribe({next:()=>{this.quickActionService.setPaletteVisibility(!1),this.changeDetectorRef.markForCheck()}}),this.shortcutService.getShortcutEvent(Re.MOVE_BOTTOM).pipe(F(()=>this.shouldDisplayPalette)).subscribe({next:e=>this.navigateToActionByKeyboard(Re.MOVE_BOTTOM,e)}),this.shortcutService.getShortcutEvent(Re.MOVE_TOP).pipe(F(()=>this.shouldDisplayPalette)).subscribe({next:e=>this.navigateToActionByKeyboard(Re.MOVE_TOP,e)}),this.shortcutService.getShortcutEvent(Re.ENTER).pipe(F(()=>this.shouldDisplayPalette)).subscribe({next:()=>{let e=this.combinedActions[this.focusedActionIndex];this.onActionClick(e)}}),this.store$.pipe($("viewMode")).subscribe({next:e=>this.viewMode=e}),this.store$.pipe($("currentPageNo")).subscribe({next:e=>this.currentPageNo=e}),this.store$.pipe($("pageCount")).subscribe({next:e=>this.pageCount=e}),this.actionHistoryService.availableUndoCount$.subscribe({next:e=>this.canUndo=e>0}),this.actionHistoryService.availableRedoCount$.subscribe({next:e=>this.canRedo=e>0}))}shouldDisableAction(e){let n=this.pageService.pdfPages[this.currentPageNo-1];switch(e.id){case Se.UNDO:return!this.canUndo;case Se.REDO:return!this.canRedo;case Se.COPY:return this.annotSelectedService.pageIndex!==n.ref&&(this.annotSelectedService.selectedComponents.length===0||!this.annotSelectedService.selectedComponents.every(g=>g.data.oid!==null));case Se.PASTE:return!this.objectClipboardService.hasAnnotsInLegacyClipboard;case Se.CHANGE_TO_EBOOK_MODE:return this.quickActionService.isEbookMode;case Se.CHANGE_TO_THE_READING_MODE:return!this.quickActionService.isEbookMode;case Se.ROTATE_CCW:return this.quickActionService.isEbookMode;case Se.ROTATE_CW:return this.quickActionService.isEbookMode;case Se.REDACT_AREA:return!this.documentService.checkAuthority(Ne.DRAW_REDACTION);case Se.REDACT_PAGE:return!this.documentService.checkAuthority(Ne.DRAW_REDACTION);case Se.REDACT_SEARCH:return!this.documentService.checkAuthority(Ne.SEARCH_TEXT);case Se.PREVIOUS_PAGE:return this.currentPageNo<=1;case Se.NEXT_PAGE:return this.viewMode===4?ee.getEbookPageNo(this.pageCount)<=this.currentPageNo:this.pageCount<=this.currentPageNo;case Se.DELETE:let r=this.annotSelectedService.selectedComponents.every(g=>Lt.isWidget(g.data)&&K.get(ie.DELETE_FORM)||!Lt.isWidget(g.data)&&K.get(ie.DELETE_ANNOTATION)),c=this.annotSelectedService.selectedComponents.every(g=>!gr.get(g.data.attributes.F??-1,7));return!(r&&c&&this.annotSelectedService.selectedComponents.every(g=>g.data.oid!==null)&&this.annotSelectedService.selectedComponents.length>0);default:return!1}}trackByAction(e,n){return`${n.id}/${n.name}`}onSearchChange(e){this.actionKeyword=e,this.focusedActionIndex=this.DEFAULT_FOCUSED_ACTION_INDEX}onCloseClick(){this.quickActionService.setPaletteVisibility(!1)}navigateToActionByKeyboard(e,n){n.preventDefault(),n.stopPropagation(),this.isNavigatingByKeyboard=!0,e===Re.MOVE_BOTTOM?this.focusedActionIndex=Math.min(this.combinedActions.length-1,this.focusedActionIndex+1):this.focusedActionIndex=Math.max(0,this.focusedActionIndex-1),this.scrollToFocusedAction(),this.changeDetectorRef.markForCheck()}scrollToFocusedAction(){let n=this.actionItemRefs.toArray()[this.focusedActionIndex];if(!n)return;let c=this.actionsContainerRef.nativeElement.getBoundingClientRect(),g=n.nativeElement.getBoundingClientRect(),v=g.top<c.top,y=g.bottom>c.bottom;(v||y)&&n.nativeElement.scrollIntoView({behavior:"instant",block:"nearest",inline:"nearest"})}onMouseEnterAction(e){if(this.isNavigatingByKeyboard){this.isNavigatingByKeyboard=!1;return}this.focusedActionIndex=e,this.changeDetectorRef.markForCheck()}onActionClick(e){this.shouldDisableAction(e)||(this.saveRecentAction(e),e.actionFn(),this.quickActionService.setPaletteVisibility(!1),this.changeDetectorRef.markForCheck())}getRecentActionsFromLocalStorage(){if(!this.localstorageService?.isEnabledLocalStorage)return[];let e=JSON.parse(this.localstorageService.get("SD_RecentActions","[]"));return this.quickActionService.getActionsByIds(e)}saveRecentAction(e){if(!this.localstorageService?.isEnabledLocalStorage)return;let n=JSON.parse(this.localstorageService.get("SD_RecentActions","[]"));n=n.filter(r=>r!==e.id),n.unshift(e.id),n=n.slice(0,2),this.localstorageService.set("SD_RecentActions",JSON.stringify(n))}};D(t,"\u0275fac",function(n){return new(n||t)(_(Me),_(Ee),_(Jt),_(J),_(rn),_(Fr),_(ln),_(eo),_(Di),_(Yt),_(ct),_(Ca))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-quick-action"]],viewQuery:function(n,r){if(n&1&&(Ye(_f,5),Ye(Sf,5),Ye(bf,5)),n&2){let c;Ie(c=Ae())&&(r.quickActionRef=c.first),Ie(c=Ae())&&(r.actionsContainerRef=c.first),Ie(c=Ae())&&(r.actionItemRefs=c)}},standalone:!1,features:[xe([J])],decls:1,vars:1,consts:[["quickActionRef",""],["actionsContainerRef",""],["actionItemRef",""],["aria-label","Quick actions","class","quick-action-palette",3,"mousedown",4,"ngIf"],["aria-label","Quick actions",1,"quick-action-palette",3,"mousedown"],[1,"navigation"],["role","search",1,"search-bar"],[1,"papycon","papycon-search"],["size","small",3,"ngModelChange","placeholder","autofocus","inputStyle","ngModel"],["aria-label","Close quick action palette",1,"ep-button","close",3,"click"],["aria-hidden","true",1,"papycon","papycon-cross"],["role","menu","aria-label","Available actions",1,"actions-container",3,"wheel"],[4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"action",3,"click","mouseenter","ngClass"],[1,"action-info"],[1,"icon-container"],[1,"shortcut"]],template:function(n,r){n&1&&se(0,yf,15,11,"nav",3),n&2&&T("ngIf",r.shouldDisplayPalette)},styles:[".quick-action-palette[_ngcontent-%COMP%]{font-size:13px;line-height:22px;color:#1e1e1e;font-family:NotoSans-Regular,sans-serif;display:flex;flex-direction:column;row-gap:8px;box-sizing:border-box;width:344px;height:322px;border-radius:8px;z-index:5;position:fixed;left:50%;transform:translate(-50%);top:212px;background-color:var(--mono-00);box-shadow:0 4px 8px #6c6c6c1f;border:1px solid var(--mono-30);padding:12px;cursor:default}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]{display:flex;flex-direction:row;column-gap:12px;align-items:center;width:100%;flex-shrink:0}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .search-bar[_ngcontent-%COMP%]{box-sizing:border-box;width:100%;height:40px;display:flex;flex-direction:row;column-gap:8px;align-items:center;border-radius:4px;background-color:var(--mono-10)}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .search-bar[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{position:relative;flex:1}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .search-bar[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;z-index:1;left:20px;font-size:24px;color:var(--mono-50)}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .ep-button.close[_ngcontent-%COMP%]{display:none;height:30px;background-color:var(--mono-00);border:1px solid var(--mono-30)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]{overflow:auto;width:100%;flex:1;display:flex;flex-direction:column;row-gap:8px}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:12px;line-height:20px;color:#6c6c6c;font-family:NotoSans-Regular,sans-serif;margin:0}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]{box-sizing:border-box;width:calc(100% - 4px);height:38px;padding:8px;border-radius:4px;display:flex;align-items:center;justify-content:space-between;flex-direction:row;background:none;border:none}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row;column-gap:8px}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]{width:22px;height:22px}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:22px;color:var(--mono-90)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]   i.reverse[_ngcontent-%COMP%]{transform:scaleX(-1)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--mono-99)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .shortcut[_ngcontent-%COMP%]{font-size:12px;line-height:20px;color:var(--mono-70)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action.focused[_ngcontent-%COMP%]{background-color:var(--mono-10)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--button-pressed)}@media screen and (max-width: 577px){.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .ep-button.close[_ngcontent-%COMP%]{display:flex}}@media screen and (max-width: 397px){.quick-action-palette[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:0;top:0}}"],changeDetection:0}));let s=t;return s})();var Nd=(()=>{let t=class t{};D(t,"\u0275fac",function(n){return new(n||t)}),D(t,"\u0275mod",ai({type:t})),D(t,"\u0275inj",ri({providers:[zi],imports:[Qp,Pa,$i,Wp,Nr,wa,wn,bd,Dp,xa,ip,pa,Vr,ua,kr,fa,qp,Pp]}));let s=t;return s})();di(Io,[ed,Ei,bt,ia,Wt,jp,Ba,La,Od,Tc,so,Ec,Na,ka,Mc,Rc,oo,Va,es],[]);di(Tc,[Ei,bt,Wt,ys,ja],[]);di(so,[bt,Wt,On,Vn,ws,Dn],[He]);di(ja,[Wt,ga],[]);di(Cr,[On,Eo,Vn,ha],[He]);di(Ec,[bt,Wt,ys,ja,yd],[He]);di(er,[Ei,bt,Wt,Os,On,ca,Eo,tp,Vn,ws,Dn,Ad],[He]);di(Mc,[Ei,er],[]);di(Rc,[xo,Ei,bt,On,Eo,Vn],[He]);di(es,[bt,Os,On,Eo,Dn],[He]);di(Lp,[xo,Ei,bt,Wt,ep,Zl,Jl,Dn],[He]);var xr=class xr{documentService;translatePipe;productService;store$;customUIService;annotSelectedService;actionHistoryService;modalService;dialogService;changeService;downloadService;viewerService;preferencesService;quickActionService;loggingService;hidableMenus={};leftSectionFirstCustomUI=[];leftSectionLastCustomUI=[];isSpreadsheets=!1;constructor(t,i,e,n,r,c,g,v,y,M,k,Z,le,pe,he){this.documentService=t,this.translatePipe=i,this.productService=e,this.store$=n,this.customUIService=r,this.annotSelectedService=c,this.actionHistoryService=g,this.modalService=v,this.dialogService=y,this.changeService=M,this.downloadService=k,this.viewerService=Z,this.preferencesService=le,this.quickActionService=pe,this.loggingService=he,this.store$.pipe(fi([B.TOOLBAR_EBOOK,B.TOOLBAR_PREFERENCES,B.TOOLBAR_DOCUMENT_INFO,B.TOOLBAR_SD_INFO,B.TOOLBAR_SAVE,B.TOOLBAR_PRINT,B.TOOLBAR_DOWNLOAD,B.TOOLBAR_SLIDESHOW,B.TOOLBAR_SCREEN_THEME])).subscribe({next:Te=>{this.hidableMenus=pi(pi({},this.hidableMenus),Te)}}),this.customUIService.customButtonUI$.subscribe({next:Te=>{this.leftSectionFirstCustomUI=Te.filter(p=>p.position==="TOOLBAR.LEFT_SECTION.FIRST"),this.leftSectionLastCustomUI=Te.filter(p=>p.position==="TOOLBAR.LEFT_SECTION.LAST")}}),this.store$.pipe(Br("isSpreadsheets")).subscribe({next:Te=>this.isSpreadsheets=Te}),this.initRegisterQuickActions()}get isLessThanMobileWidth(){return G.width<=G.breakpoints.mobile.width}get isLessThanDesktopWidth(){return G.width<G.breakpoints.desktop.width}get shouldAddSaveButton(){return this.documentService.checkAuthority(Ne.SAVE_DOCUMENT)&&K.get(ie.SAVE_BUTTON)&&!K.get(ie.AUTO_SAVE)&&!this.hidableMenus[B.TOOLBAR_SAVE]&&(K.get(ie.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU)||this.isLessThanMobileWidth)}get shouldAddOriginalDownloadButton(){return this.productService.isStreamDocsVu&&this.documentService.checkAuthority(Ne.DOWNLOAD_DOCUMENT)&&K.get(ie.ORIGINAL_DOWNLOAD_BUTTON)&&!this.hidableMenus[B.TOOLBAR_DOWNLOAD]&&this.documentService.hasOriginalFile&&!this.documentService.isDAP}get shouldAddPdfDownloadButton(){return this.documentService.checkAuthority(Ne.DOWNLOAD_DOCUMENT)&&K.get(ie.PDF_DOWNLOAD_BUTTON)&&!this.hidableMenus[B.TOOLBAR_DOWNLOAD]&&(K.get(ie.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU)||this.isLessThanDesktopWidth)}get shouldAddDocInfoButton(){return K.get(ie.DOCUMENT_INFO_BUTTON)&&K.get(Tt.DOCUMENT_INFO_DIALOG)&&!this.hidableMenus[B.TOOLBAR_DOCUMENT_INFO]}get shouldAddPrintButton(){return this.documentService.checkAuthority(Ne.PRINT_DOCUMENT)&&K.get(ie.PRINT_BUTTON)&&K.get(Tt.PRINT_DIALOG)&&!this.hidableMenus[B.TOOLBAR_PRINT]&&(K.get(ie.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU)||this.isLessThanDesktopWidth)}buildMainMenu(t){let i=[],e={items:[]};if(this.isLessThanMobileWidth){let n=this.buildFirstCustomMenu();n.items.length>0&&i.push(n)}if([this.isLessThanMobileWidth?this.buildActionMenu(t):[],this.buildFileMenu(),this.buildViewMenu(t),this.buildSettingMenu(),this.buildInfoMenu()].forEach(n=>{n.length!==0&&(e.items.length>0&&e.items.push({type:rp.LINE,label:"DIVISION_LINE"}),e.items.push(...n))}),e.items.length>0&&i.push(e),this.isLessThanMobileWidth){let n=this.buildLastCustomMenu();n.items.length>0&&i.push(n)}return i}buildActionMenu(t){if(!t.runtimeEnv.get(Tt.UNDO_REDO_BUTTONS)||this.isSpreadsheets)return[];let i=[];return i.push({label:this.translatePipe.transform("UNDO"),subLabel:ti.getShortcutString(Fi[Re.UNDO_ACTION]),command:()=>{this.annotSelectedService.unselectAll(),this.actionHistoryService.undo()},disabled:!t.canUndo}),i.push({label:this.translatePipe.transform("REDO"),subLabel:ti.getShortcutString(Fi[Re.REDO_ACTION]),command:()=>{this.annotSelectedService.unselectAll(),this.actionHistoryService.redo()},disabled:!t.canRedo}),i}buildFileMenu(){let t=[];return this.shouldAddSaveButton&&t.push({label:this.translatePipe.transform("SAVE"),command:()=>this.changeService.saveDocumentForStatistics(fe.SAVE_DOCUMENT_BY_BUTTON,void 0,void 0,void 0)}),this.shouldAddOriginalDownloadButton&&t.push({label:this.translatePipe.transform("ORIGINAL_DOWNLOAD"),command:()=>this.downloadService.downloadOriginalDocument()}),this.shouldAddPdfDownloadButton&&t.push({label:this.translatePipe.transform(this.productService.isStreamDocsVu?"PDF_DOWNLOAD":"DOWNLOAD_DOC"),command:()=>this.downloadService.downloadDocument()}),this.shouldAddDocInfoButton&&t.push({label:this.translatePipe.transform("DOC_PROPERTY_MENU"),command:()=>this.dialogService.toggleDialogVisibilityForStatistics(fe.DOCUMENT_INFO_BY_BUTTON,ji.DOCUMENT_INFO,!0)}),this.shouldAddPrintButton&&t.push({label:this.translatePipe.transform("PRINT_MENU"),subLabel:ti.getShortcutString(Fi[Re.PRINT]),command:()=>this.dialogService.toggleDialogVisibility(ji.PRINT)}),t}buildViewMenu(t){if(this.isSpreadsheets)return[];let i=[];return K.get(ie.SLIDESHOW_BUTTON)&&!this.hidableMenus[B.TOOLBAR_SLIDESHOW]&&i.push({label:this.translatePipe.transform("SLIDESHOW"),command:()=>this.viewerService.setSlideshow()}),K.get(ie.CAPTURE_MODE_BUTTON)&&!this.hidableMenus[B.TOOLBAR_CAPTURE_MODE]&&G.isSmallWidth()&&i.push({label:this.translatePipe.transform("CAPTURE"),command:()=>this.store$.dispatch(ue.set({key:"isCaptureMode",value:!0}))}),K.get(ie.EBOOK_BUTTON)&&!this.hidableMenus[B.TOOLBAR_EBOOK]&&i.push({label:t.isEbookMode()?this.translatePipe.transform("CHANGE_TO_THE_READING_MODE"):this.translatePipe.transform("CHANGE_TO_EBOOK_MODE"),command:()=>this.viewerService.toggleEbookModeForStatistics(fe.CHANGE_TO_EBOOK)}),i}buildChildrenOfScreenThemeMenu(t){let i=[],e=this.viewerService.screenTheme;i.push({label:this.translatePipe.transform("LIGHT_MODE"),icon:e==="light"?"papycon papycon-check-mark5":"",command:()=>this.changeScreenThemeForStatistics(fe.LIGHT_THEME_BY_BUTTON,"light")}),i.push({label:this.translatePipe.transform("DARK_MODE"),icon:e==="dark"?"papycon papycon-check-mark5":"",command:()=>this.changeScreenThemeForStatistics(fe.DARK_THEME_BY_BUTTON,"dark")}),i.push({label:this.translatePipe.transform("SYSTEM_SYNCHRONIZATION"),icon:e==="System synchronization"?"papycon papycon-check-mark5":"",command:()=>this.changeScreenThemeForStatistics(fe.SYSTEM_THEME_BY_BUTTON,"System synchronization")}),t.push({items:i})}buildSettingMenu(){let t=[],i=[];return K.get(ie.SCREEN_THEME_MENU)&&!this.hidableMenus[B.TOOLBAR_SCREEN_THEME]&&!this.isSpreadsheets&&(this.buildChildrenOfScreenThemeMenu(i),t.push({label:this.translatePipe.transform("SCREEN_THEME"),children:i})),K.get(ie.PREFERENCES_BUTTON)&&K.get(Tt.PREFERENCES_DIALOG)&&!this.hidableMenus[B.TOOLBAR_PREFERENCES]&&t.push({label:this.translatePipe.transform("PREFERENCE_MENU"),command:()=>this.dialogService.toggleDialogVisibility(ji.PREFERENCES,!0)}),t}buildInfoMenu(){let t=[];return K.get(ie.SD_INFO_BUTTON)&&!this.hidableMenus[B.TOOLBAR_SD_INFO]&&t.push({label:this.translatePipe.transform("SD_INFO"),command:()=>this.showProductInfoForStatistics(fe.OPEN_SD_INFO_BY_BUTTON)}),t}showProductInfo(){this.productService.getProductLicenseInfo().subscribe({next:t=>{this.modalService.createCommonModal({type:zt.PRODUCT,logo:this.productService.logo,description:this.productService.copyRight,content:t,accordionTitle:this.translatePipe.transform("OPEN_SOURCE_LICENSE_NOTICE"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")})},error:()=>{this.modalService.createCommonModal({type:zt.PRODUCT,logo:this.productService.logo,description:this.productService.copyRight,content:this.translatePipe.transform("NO_PRODUCT_INFO"),accordionTitle:this.translatePipe.transform("OPEN_SOURCE_LICENSE_NOTICE"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")})}})}showProductInfoForStatistics(t){this.showProductInfo()}buildRightMenu(){let t=[];return this.shouldAddPrintButton&&t.push({label:this.translatePipe.transform("PRINT"),icon:"papycon papycon-print",command:()=>{this.dialogService.toggleDialogVisibility(ji.PRINT)}}),this.shouldAddPdfDownloadButton&&t.push({label:this.translatePipe.transform("DOWNLOAD"),icon:"papycon papycon-download",command:()=>{this.downloadService.downloadDocument()}}),t}buildFirstCustomMenu(){let t={items:[]};return this.leftSectionFirstCustomUI.forEach(i=>{t.items.push({label:i.label,command:e=>{if(!w.isDefined(e)){this.loggingService.common("warn",Le.NOT_EXIST,"event");return}i.onclick(Zn.simplifyMouseEvent(e))}})}),t}buildLastCustomMenu(){let t={items:[]};return this.leftSectionLastCustomUI.forEach(i=>{t.items.push({label:i.label,command:e=>{if(!w.isDefined(e)){this.loggingService.common("warn",Le.NOT_EXIST,"event");return}i.onclick(Zn.simplifyMouseEvent(e))}})}),t}changeScreenThemeForStatistics(t,i){this.preferencesService.updatePreferences(["screenTheme"],i)}initRegisterQuickActions(){this.quickActionService.registerActions([{id:Se.SD_INFO,actionFn:()=>this.showProductInfoForStatistics(fe.OPEN_SD_INFO_BY_QUICK_SEARCH)},{id:Se.LIGHT_THEME,actionFn:()=>this.changeScreenThemeForStatistics(fe.LIGHT_THEME_BY_QUICK_SEARCH,"light")},{id:Se.DARK_THEME,actionFn:()=>this.changeScreenThemeForStatistics(fe.DARK_THEME_BY_QUICK_SEARCH,"dark")},{id:Se.SYSTEM_THEME,actionFn:()=>this.changeScreenThemeForStatistics(fe.SYSTEM_THEME_BY_QUICK_SEARCH,"System synchronization")}])}};D(xr,"\u0275fac",function(i){return new(i||xr)(ke(ct),ke(He),ke(Lr),ke(Ee),ke(Wr),ke(Di),ke(eo),ke(on),ke(En),ke(Xo),ke(Ko),ke(Jt),ke(Uo),ke(ln),ke(Ai))}),D(xr,"\u0275prov",oi({token:xr,factory:xr.\u0275fac}));var tr=xr;ze([ot(it.menuService.showProductInfoForStatistics)],tr.prototype,"showProductInfoForStatistics",null);ze([ot(it.menuService.changeScreenThemeForStatistics)],tr.prototype,"changeScreenThemeForStatistics",null);var Mf=["mainMenuRef"],Rf=["subToolbarRef"],If=["sideViewMenuRef"],Af=["iconMenuRef"],Df=["dragToolMenuRef"],Nf=["rightMenuRef"],kf=["scaleMenuRef"],$n=s=>({content:s});function Vf(s,t){if(s&1&&q(0,"pu-menu",18,0),s&2){let i=E(4);T("size",i.SizeType.SMALL)("menus",i.sideViewMenus)}}function Lf(s,t){if(s&1){let i=ve();Ht(0),I(1,"button",16),ae("click",function(){j(i);let n=E(3);return W(n.leftSideViewButton.onClick())})("mousedown",function(n){j(i);let r=E(3);return W(r.stopPropagation(n))})("touchstart",function(n){j(i);let r=E(3);return W(r.stopPropagation(n))}),q(2,"i"),N(),se(3,Vf,2,2,"pu-menu",17),$t()}if(s&2){let i=E(3);x(),$e("dark",i.isDarkMode&&!i.sideViewVisible),T("tooltip",vt(7,$n,i.leftSideViewButton.label)),ge("aria-label",i.leftSideViewButton.label)("color",i.isDarkMode&&!i.sideViewVisible?"white":i.sideViewVisible?"primary":"dark"),x(),ge("class",i.leftSideViewButton.icon),x(),T("ngIf",i.sideViewMenus.length>0)}}function Ff(s,t){if(s&1&&(I(0,"div",15),se(1,Lf,4,9,"ng-container",8),N()),s&2){let i=E(2);x(),T("ngIf",i.isSideViewButtonVisible)}}function Bf(s,t){s&1&&q(0,"div",19)}function Uf(s,t){s&1&&q(0,"div",19)}function Hf(s,t){if(s&1&&(I(0,"section",20),q(1,"img",21),N(),se(2,Uf,1,0,"div",19)),s&2){let i=E(2);x(),T("src",i.logoDataURL,Sn),x(),Ut(i.isLessThanDesktopWidth?-1:2)}}function $f(s,t){if(s&1){let i=ve();I(0,"button",22),ae("click",function(n){let r=j(i).$implicit,c=E(2);return W(c.onClickCustomUI(r,n))}),q(1,"i",23),N()}if(s&2){let i=t.$implicit,e=E(2);$e("dark",e.isDarkMode),T("title",e.isMobile?"":i.label)("tooltip",vt(7,$n,i.label)),ge("color",e.isDarkMode?"white":"dark")("aria-label",i.label),x(),T("ngClass",i.icon)}}function jf(s,t){if(s&1){let i=ve();I(0,"button",25),ae("click",function(){j(i);let n=E(3);return W(n.onToolbarMenuClick(n.SubToolbar.ANNOTATE))})("mousedown",function(n){j(i);let r=E(3);return W(r.stopPropagation(n))})("touchstart",function(n){j(i);let r=E(3);return W(r.stopPropagation(n))}),_e(1),Y(2,"translate"),N()}if(s&2){let i=E(3);$e("active",i.isSubToolbarType(i.SubToolbar.ANNOTATE)),ge("color",i.isSubToolbarType(i.SubToolbar.ANNOTATE)?"primary-70":i.isDarkMode?"white":"dark"),x(),we(X(2,4,"ANNOTATE"))}}function Wf(s,t){if(s&1){let i=ve();I(0,"button",25),ae("click",function(){j(i);let n=E(3);return W(n.onToolbarMenuClick(n.SubToolbar.REDACT))})("mousedown",function(n){j(i);let r=E(3);return W(r.stopPropagation(n))})("touchstart",function(n){j(i);let r=E(3);return W(r.stopPropagation(n))}),_e(1),Y(2,"translate"),N()}if(s&2){let i=E(3);$e("active",i.isSubToolbarType(i.SubToolbar.REDACT)),ge("color",i.isSubToolbarType(i.SubToolbar.REDACT)?"primary-70":i.isDarkMode?"white":"dark"),x(),we(X(2,4,"TOOLBAR_REDACT"))}}function zf(s,t){if(s&1&&se(0,jf,3,6,"button",24)(1,Wf,3,6,"button",24),s&2){let i=E(2);Ut(i.canShowAnnotToolbar?0:-1),x(),Ut(i.canShowRedactToolbar?1:-1)}}function Gf(s,t){if(s&1){let i=ve();I(0,"div",14)(1,"button",26),ae("click",function(){j(i);let n=E(2);return W(n.onSubToolbarMenuClick())})("mousedown",function(n){j(i);let r=E(2);return W(r.stopPropagation(n))})("touchstart",function(n){j(i);let r=E(2);return W(r.stopPropagation(n))}),I(2,"span"),_e(3),N(),q(4,"i",27),N(),q(5,"pu-menu",28,1),N()}if(s&2){let i=E(2);x(3),we(i.subToolbarMenuTitle),x(2),T("menus",i.subToolbarMenus)}}function Yf(s,t){if(s&1){let i=ve();I(0,"button",22),ae("click",function(n){let r=j(i).$implicit,c=E(2);return W(c.onClickCustomUI(r,n))}),q(1,"i",23),N()}if(s&2){let i=t.$implicit,e=E(2);$e("dark",e.isDarkMode),T("title",e.isMobile?"":i.label)("tooltip",vt(7,$n,i.label)),ge("color",e.isDarkMode?"white":"dark")("aria-label",i.label),x(),T("ngClass",i.icon)}}function Xf(s,t){if(s&1&&(I(0,"section",9),se(1,Ff,2,1,"div",10)(2,Bf,1,0,"div",11)(3,Hf,3,2),I(4,"section",12),se(5,$f,2,9,"button",13)(6,zf,2,2)(7,Gf,7,2,"div",14)(8,Yf,2,9,"button",13),N()()),s&2){let i=E();x(),T("ngIf",i.isSideMenuVisible),x(),T("ngIf",!i.isLessThanMobileWidth),x(),Ut(i.logoDataURL?3:-1),x(2),T("ngForOf",i.leftSectionFirstCustomUI),x(),Ut(i.isLessThanDesktopWidth?7:6),x(2),T("ngForOf",i.leftSectionLastCustomUI)}}function Kf(s,t){if(s&1){let i=ve();I(0,"div",30)(1,"button",34),Y(2,"translate"),Y(3,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.zoomOut(n.ViewerStatisticData.CHANGE_ZOOM_BY_FLOATING_NAV))}),q(4,"i",35),N(),I(5,"div",36)(6,"input",37),Y(7,"translate"),ae("keyup.enter",function(){j(i);let n=E(2);return W(n.onConfirmScaleInput())})("blur",function(){j(i);let n=E(2);return W(n.onConfirmScaleInput())}),N(),I(8,"button",38),Y(9,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.onScaleMenuClick())}),q(10,"i",27),N(),q(11,"pu-menu",28,2),N(),I(13,"button",34),Y(14,"translate"),Y(15,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.zoomIn(n.ViewerStatisticData.CHANGE_ZOOM_BY_FLOATING_NAV))}),q(16,"i",39),N()()}if(s&2){let i=E(2);x(),$e("dark",i.isDarkMode)("disabled",!i.doc),T("disabled",!i.doc)("title",i.isMobile?"":X(2,23,"ZOOM_OUT"))("tooltip",vt(35,$n,i.zoomOutTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(3,25,"ZOOM_OUT")),x(5),T("disabled",!i.doc)("formControl",i.scaleFormControl),ge("aria-label",X(7,27,"EDIT_MAGNIFICATION")),x(2),ge("aria-label",X(9,29,"EXPAND")),x(3),T("menus",i.scaleMenus),x(2),$e("dark",i.isDarkMode)("disabled",!i.doc),T("disabled",!i.doc)("title",i.isMobile?"":X(14,31,"ZOOM_IN"))("tooltip",vt(37,$n,i.zoomInTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(15,33,"ZOOM_IN"))}}function qf(s,t){s&1&&q(0,"div",19)}function Qf(s,t){if(s&1){let i=ve();I(0,"div",31)(1,"pu-input",40),Y(2,"translate"),ae("keydown.enter",function(){j(i);let n=E(2);return W(n.goToPage(n.pageNoFormControl.value))})("blur",function(){j(i);let n=E(2);return W(n.onPageInputBlur())}),N(),I(3,"div",41),_e(4),N()()}if(s&2){let i=E(2);x(),T("autoResize",!0)("maxLength",i.pageCount.toString().length)("formControl",i.pageNoFormControl)("ariaLabel",X(2,5,"MOVE_SPECIFYING_PAGE")),x(3),qn(" /\xA0",i.pageCount,"")}}function Zf(s,t){s&1&&q(0,"div",19)}function Jf(s,t){if(s&1){let i=ve();I(0,"button",42),Y(1,"translate"),Y(2,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.onClickSearchButton())}),q(3,"i",43),N()}if(s&2){let i=E(2);$e("dark",i.isDarkMode&&!i.searchToolActive)("disabled",!i.doc),T("disabled",!i.doc)("title",i.isMobile?"":X(1,10,"SEARCH"))("tooltip",vt(14,$n,i.searchTooltipWithShortcut)),ge("color",i.searchToolActive?"primary-70":i.isDarkMode?"white":"dark")("aria-label",X(2,12,"SEARCH"))("aria-expanded",i.searchToolActive)}}function em(s,t){if(s&1){let i=ve();I(0,"div",33)(1,"button",44),Y(2,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.onMoreMenuButtonClick())})("mousedown",function(n){j(i);let r=E(2);return W(r.stopPropagation(n))})("touchstart",function(n){j(i);let r=E(2);return W(r.stopPropagation(n))}),q(3,"i",23)(4,"i",45),N(),q(5,"pu-icon-menu",46,3),N()}if(s&2){let i=E(2);x(),$e("dark",i.isDarkMode),T("title",i.isMobile?"":i.activeMoreMenu==null?null:i.activeMoreMenu.label)("tooltip",vt(12,$n,i.activeMoreMenu==null?null:i.activeMoreMenu.label)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(2,10,"DEFAULT_VIEW_MODE")),x(2),T("ngClass",i.activeMoreMenu==null?null:i.activeMoreMenu.icon),x(2),T("iconMenus",i.iconMenus)("isMobile",i.isMobile)("isDarkMode",i.isDarkMode)}}function tm(s,t){if(s&1&&(I(0,"section",29),se(1,Kf,17,39,"div",30)(2,qf,1,0,"div",19)(3,Qf,5,7,"div",31)(4,Zf,1,0,"div",19)(5,Jf,4,16,"button",32)(6,em,7,14,"div",33),N()),s&2){let i=E();x(),Ut(i.isScaleMenuVisible?1:-1),x(),Ut(i.isLessThanDesktopWidth?-1:2),x(),Ut(i.isPageMenuVisible?3:-1),x(),Ut(i.isLessThanDesktopWidth?-1:4),x(),Ut(i.isSearchMenuVisible?5:-1),x(),Ut(i.isViewModeVisible?6:-1)}}function im(s,t){if(s&1){let i=ve();I(0,"button",52),Y(1,"translate"),Y(2,"translate"),ae("click",function(){j(i);let n=E(4);return W(n.printDoc())}),q(3,"i",53),N()}if(s&2){let i=E(4);$e("dark",i.isDarkMode),T("disabled",!i.doc)("title",X(1,7,"PRINT"))("tooltip",vt(11,$n,i.printTooltipWithShortcut)),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(2,9,"PRINT"))}}function nm(s,t){if(s&1){let i=ve();I(0,"button",54),Y(1,"translate"),Y(2,"translate"),Y(3,"translate"),ae("click",function(){j(i);let n=E(4);return W(n.downloadDoc())}),q(4,"i",55),N()}if(s&2){let i=E(4);$e("dark",i.isDarkMode),T("disabled",!i.doc)("title",X(1,7,"PDF_DOWNLOAD"))("tooltip",vt(13,$n,X(2,9,"PDF_DOWNLOAD"))),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(3,11,"PDF_DOWNLOAD"))}}function om(s,t){if(s&1&&se(0,im,4,13,"button",50)(1,nm,5,15,"button",51),s&2){let i=E(3);T("ngIf",i.runtimeEnv.get(i.RuntimeEnvKey.PRINT_BUTTON)&&i.runtimeEnv.get(i.MergedRuntimeEnvKey.PRINT_DIALOG)&&i.hasPrintPermission&&!i.hidableMenus[i.HidableView.TOOLBAR_PRINT]),x(),T("ngIf",i.runtimeEnv.get(i.RuntimeEnvKey.PDF_DOWNLOAD_BUTTON)&&i.hasDownloadPermission&&!i.hidableMenus[i.HidableView.TOOLBAR_DOWNLOAD])}}function rm(s,t){if(s&1){let i=ve();I(0,"button",56),Y(1,"translate"),Y(2,"translate"),Y(3,"translate"),ae("click",function(){j(i);let n=E(3);return W(n.onRightMenuClick())})("mousedown",function(n){j(i);let r=E(3);return W(r.stopPropagation(n))})("touchstart",function(n){j(i);let r=E(3);return W(r.stopPropagation(n))}),q(4,"i",57),N(),q(5,"pu-menu",58,4)}if(s&2){let i=E(3);$e("dark",i.isDarkMode),T("title",i.isMobile?"":X(1,8,"MORE_MENU"))("tooltip",vt(14,$n,X(2,10,"MORE_MENU"))),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(3,12,"MORE_MENU")),x(5),T("size",i.SizeType.SMALL)("menus",i.rightMenus)}}function sm(s,t){if(s&1&&(I(0,"div",48),se(1,om,2,2)(2,rm,7,16),N()),s&2){let i=E(2);x(),Ut(i.isLessThanDesktopWidth?2:1)}}function am(s,t){if(s&1){let i=ve();I(0,"button",59),Y(1,"translate"),Y(2,"translate"),ae("click",function(n){j(i);let r=E(2);return W(r.dapMenuItem.command==null?null:r.dapMenuItem.command(n,r.dapMenuItem))})("mousedown",function(n){j(i);let r=E(2);return W(r.stopPropagation(n))})("touchstart",function(n){j(i);let r=E(2);return W(r.stopPropagation(n))}),q(3,"i",60),N()}if(s&2){let i=E(2);$e("dark",i.isDarkMode),T("tooltip",vt(9,$n,X(1,5,"DAP_DOCUMENT"))),ge("color",i.isDarkMode&&!(i.rightSideViewVisible&&i.rightSideViewMode===i.RightSideViewMode.DAP)?"white":i.rightSideViewVisible&&i.rightSideViewMode===i.RightSideViewMode.DAP?"primary":"dark")("aria-label",X(2,7,"DAP_DOCUMENT"))}}function cm(s,t){if(s&1&&(I(0,"section",47),se(1,sm,3,1,"div",48)(2,am,4,11,"button",49),N()),s&2){let i=E();x(),Ut(!i.runtimeEnv.get(i.RuntimeEnvKey.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU)&&(!i.hidableMenus[i.HidableView.TOOLBAR_PRINT]||!i.hidableMenus[i.HidableView.TOOLBAR_DOWNLOAD])?1:-1),x(),T("ngIf",i.isDapButtonVisible)}}function lm(s,t){if(s&1){let i=ve();Ht(0),I(1,"button",67),ae("click",function(){let n=j(i).$implicit;return W(n.command())}),q(2,"i"),N(),$t()}if(s&2){let i=t.$implicit,e=E(3);x(),$e("dark",e.isDarkMode),T("title",e.isMobile?"":i.label)("disabled",!e.doc),ge("color",e.isDarkMode&&!e.isActiveSideView(i.data)?"white":e.isActiveSideView(i.data)?"primary":"dark")("aria-label",i.label),x(),Kn(i.icon)}}function pm(s,t){if(s&1&&(Ht(0),se(1,lm,3,8,"ng-container",66),$t()),s&2){let i=t.$implicit;x(),T("ngForOf",i.items)}}function dm(s,t){if(s&1){let i=ve();Ht(0),I(1,"section",61)(2,"section",62)(3,"button",63),Y(4,"translate"),Y(5,"translate"),ae("click",function(){j(i);let n=E();return W(n.closeSideViewToolbar())}),q(6,"i",64),N()(),q(7,"div",19),I(8,"section",65),se(9,pm,2,1,"ng-container",66),N()(),$t()}if(s&2){let i=E();x(3),$e("dark",i.isDarkMode),T("title",i.isMobile?"":X(4,6,"CLOSE")),ge("color",i.isDarkMode?"white":"dark")("aria-label",X(5,8,"CLOSE")),x(6),T("ngForOf",i.sideViewMenus)}}var as=class as{contentService;annotService;autoSaveService;dialogService;changeDetectorRef;menuService;documentService;downloadService;toastService;shortcutService;subscriptionService;actionHistoryService;annotSelectedService;store$;translatePipe;acroFormService;changeService;customUIService;selectTextService;toolbarService;pageService;viewerService;quickActionService;loggingService;panelService;logoService;scrollController;apiEventBridgeService;subToolbarToTitleMap={[lt.ANNOTATE]:"ANNOTATE",[lt.INSERT]:"INSERT",[lt.REDACT]:"TOOLBAR_REDACT",[lt.SIGN]:"TOOLBAR_SIGN",[lt.FORM]:"FORM"};get RuntimeEnvKey(){return ie}get MergedRuntimeEnvKey(){return Tt}get runtimeEnv(){return K}get SizeType(){return sp}get ViewerStatisticData(){return fe}doc;mainMenuRef;subToolbarRef;sideViewMenuRef;iconMenuRef;dragToolMenuRef;rightMenuRef;scaleMenuRef;logoDataURL=null;scalePreset=[400,200,150,100,75,50].map(t=>this.convertToScalePreset(t));scaleMenus=[];currentPageNo;dragMode;previousDragMode;viewMode;rightSideViewMode;rightSideViewVisible;degree;canUndo=!1;canRedo=!1;quickActionPaletteVisible=!1;isSpreadsheets=!1;subToolbar=null;moreMenuIconArrayMap=[];dragModeTooltipMap=new Map([]);get activeDragModeLabel(){return this.dragModeTooltipMap.get(this.dragMode)??""}mainMenus=[];subToolbarMenus=[];sideViewMenus=[];iconMenus=[];dragToolMenus=[];rightMenus=[];activeFitMode;activeMoreMenu;isOpenedSideView=!1;get leftSideViewButton(){let t=this.sideViewMenus.length>0&&this.sideViewMenus[0].items.length===1,i={icon:Ln.MENU,label:this.translatePipe.transform("DOCUMENT_PANEL"),onClick:()=>this.onSideViewMenuClick()};if(t){let[e]=this.sideViewMenus[0].items;i.icon=typeof e.icon=="string"?e.icon:e.icon?.()??Ln.MENU,i.label=typeof e.label=="string"?e.label:e.label?.()??"unknown",i.onClick=()=>{if(!w.isDefined(e.command)){this.loggingService.common("warn",Le.NOT_EXIST,"Command");return}e.command()}}return i}get isActionMenuVisible(){return this.leftSectionFirstCustomUI.length>0||this.leftSectionLastCustomUI.length>0}get sideViewVisible(){return this.panelService.isPanelOpened}get RightSideViewMode(){return Rt}get SubToolbar(){return lt}get subToolbarMenuTitle(){return w.isDefined(this.subToolbar)?this.translatePipe.transform(this.subToolbarToTitleMap[this.subToolbar]):this.translatePipe.transform("MENU")}hasSignedSignature=!1;pageNoFormControl=new fr(1,{nonNullable:!0});pageCount=0;searchToolActive=!1;scaleFormControl=new fr;mainMenuStyle={left:"0",top:"100%"};get scale(){return this._scale}set scale(t){this._scale=t,this.scaleFormControl.setValue(`${Math.round(this._scale)}%`,{emitEvent:!1})}_scale;dapMenuItem;get hasSavePermission(){return this.documentService.checkAuthority(Ne.SAVE_DOCUMENT)}get hasDownloadPermission(){return this.documentService.checkAuthority(Ne.DOWNLOAD_DOCUMENT)}get hasPrintPermission(){return this.documentService.checkAuthority(Ne.PRINT_DOCUMENT)}get isLessThanMobileWidth(){return G.width<G.breakpoints.mobile.width}get isLessThanTabletWidth(){return G.width<G.breakpoints.tablet.width}get isLessThanDesktopWidth(){return G.width<G.breakpoints.desktop.width}get isMobile(){return G.isMobile()}get hidableDragMode(){return!this.hidableMenus[B.TOOLBAR_DRAG_MODE_SELECT_ANNOTATION]||!this.hidableMenus[B.TOOLBAR_DRAG_MODE_SELECT_TEXT]||!this.hidableMenus[B.TOOLBAR_DRAG_MODE_MOVE]||!this.hidableMenus[B.TOOLBAR_DRAG_MODE_ZOOM]}get HidableView(){return B}hidableMenus={};leftSectionFirstCustomUI=[];leftSectionLastCustomUI=[];screenTheme;get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}get hasDragTools(){return this.dragToolMenus[0]?.menus.length>0}constructor(t,i,e,n,r,c,g,v,y,M,k,Z,le,pe,he,Te,p,ht,_t,gt,Pi,At,hi,vi,Oe,Fe,h,u){this.contentService=t,this.annotService=i,this.autoSaveService=e,this.dialogService=n,this.changeDetectorRef=r,this.menuService=c,this.documentService=g,this.downloadService=v,this.toastService=y,this.shortcutService=M,this.subscriptionService=k,this.actionHistoryService=Z,this.annotSelectedService=le,this.store$=pe,this.translatePipe=he,this.acroFormService=Te,this.changeService=p,this.customUIService=ht,this.selectTextService=_t,this.toolbarService=gt,this.pageService=Pi,this.viewerService=At,this.quickActionService=hi,this.loggingService=vi,this.panelService=Oe,this.logoService=Fe,this.scrollController=h,this.apiEventBridgeService=u,this.moreMenuIconArrayMap=[{label:this.translatePipe.transform("SINGLE_PAGE_VIEW"),icon:"papycon papycon-one-page3"},{label:this.translatePipe.transform("SINGLE_PAGE_CONTINUOUS"),icon:"papycon papycon-one-page-continuous3"},{label:this.translatePipe.transform("TWO_PAGE_VIEW"),icon:"papycon papycon-two-page3"},{label:this.translatePipe.transform("TWO_PAGE_CONTINUOUS"),icon:"papycon papycon-two-page-continuous3"}],this.scaleMenus=[{items:this.scalePreset},{items:[{label:this.translatePipe.transform("FIT_TO_HEIGHT_2"),icon:"fit-height3",command:()=>this.fitToHeightForStatistics(fe.CHANGE_ZOOM_DROPDOWN_FIT)},{label:this.translatePipe.transform("FIT_TO_WIDTH_2"),icon:"papycon papycon-fit-width3",command:()=>this.fitToWidthForStatistics(fe.CHANGE_ZOOM_DROPDOWN_FIT)}]}],this.dragModeTooltipMap=new Map([[Mt.MOVE,this.translatePipe.transform("SCROLL_MODE")],[Mt.SELECT_TEXT,this.translatePipe.transform("SELECT_TEXT")],[Mt.SELECT_ANNOT,this.translatePipe.transform("SELECT_ANNOT_TOOL")],[Mt.MAGNIFY,this.translatePipe.transform("MAGNIFY_TOOL")]]),this.dapMenuItem={label:this.translatePipe.transform("DAP_DOCUMENT"),command:()=>{this.toggleDapView(),this.changeDetectorRef.markForCheck()},icon:"papycon papycon-composite-document"}}ngOnInit(){if(this.subscriptionService.push(this.store$.pipe(ci("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.mainMenus=this.menuService.buildMainMenu(this),this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("currentPageNo")).subscribe({next:t=>{this.currentPageNo=t,this.pageNoFormControl.setValue(this.currentPageNo)}}),this.store$.pipe($("pageCount")).subscribe({next:t=>{this.pageCount=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("searchToolActive")).subscribe({next:t=>{if(!this.documentService.checkAuthority(Ne.SEARCH_TEXT)){this.apiEventBridgeService.searchToolVisibilityChangedSrc.next({ok:!1,error:new To("Unauthorized")});return}this.searchToolActive=t,this.changeDetectorRef.markForCheck()}}),this.logoService.logoDataURL$.subscribe({next:t=>{this.logoDataURL=t,this.changeDetectorRef.markForCheck()}}),this.quickActionService.paletteVisibility$.subscribe({next:t=>{this.quickActionPaletteVisible=t,this.changeDetectorRef.markForCheck()}}),this.panelService.panelMenu$.pipe(Ue(t=>(w.isDefined(this.doc)||t.forEach(i=>i.items.forEach(e=>{e.disabled=!0})),t))).subscribe({next:t=>{this.sideViewMenus=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("rightSideViewMode")).subscribe({next:t=>{this.rightSideViewMode=t,this.changeDetectorRef.detectChanges()}}),this.store$.pipe($("rightSideViewVisible")).subscribe({next:t=>{this.rightSideViewVisible=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("degree")).subscribe({next:t=>{this.degree=t,K.get(ie.VIEW_MODE_BUTTON)||(this.activeMoreMenu={label:this.translatePipe.transform("ROTATE_CW"),icon:"papycon papycon-rotate"})}}),this.store$.pipe($("scale")).subscribe({next:t=>{this.scale=t,this.changeDetectorRef.detectChanges()}}),this.store$.pipe($("dragMode")).subscribe({next:t=>{this.previousDragMode=t,t!==Mt.SELECT_ANNOT&&(this.dragMode=t,this.changeDetectorRef.markForCheck())}}),this.store$.pipe($("viewMode")).subscribe({next:t=>{this.viewMode=t,K.get(ie.VIEW_MODE_BUTTON)&&this.viewMode!==4&&(this.activeMoreMenu=this.moreMenuIconArrayMap[t]),this.iconMenus=this.buildIconMenu(),this.changeDetectorRef.markForCheck()}}),G.windowResize$.subscribe({next:()=>this.resize()}),this.documentService.authorityUpdate$.subscribe({next:()=>{this.render(!0)}}),this.store$.pipe($("rightSideViewVisible")).pipe(F(w.isDefined)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.store$.pipe(Br("isSpreadsheets")).subscribe({next:t=>this.isSpreadsheets=t}),this.acroFormService.hasSignedSignature$.subscribe({next:t=>{this.hasSignedSignature=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(fi([B.TOOLBAR,B.TOOLBAR_LEFT,B.TOOLBAR_CENTER,B.TOOLBAR_RIGHT])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),!Object.keys(t).every(i=>!this.hidableMenus[i])&&(this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck())}}),this.store$.pipe(fi([B.TOOLBAR_EBOOK,B.TOOLBAR_PREFERENCES,B.TOOLBAR_DOCUMENT_INFO,B.TOOLBAR_SAVE,B.TOOLBAR_PRINT,B.TOOLBAR_DOWNLOAD,B.TOOLBAR_SLIDESHOW,B.TOOLBAR_QUICK_ACTION,B.TOOLBAR_CAPTURE_MODE,B.TOOLBAR_VIEW_MODE,B.TOOLBAR_ROTATE,B.TOOLBAR_ZOOM,B.TOOLBAR_DRAG_MODE_SELECT_TEXT,B.TOOLBAR_DRAG_MODE_MOVE,B.TOOLBAR_DRAG_MODE_ZOOM,B.TOOLBAR_ANNOTATION,B.TOOLBAR_FORM,B.TOOLBAR_SLIDESHOW,B.TOOLBAR_SD_INFO,B.TOOLBAR_SCREEN_THEME,B.TOOLBAR_SCREEN_FIT])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),this.buildMenu(),this.hidableMenus[B.TOOLBAR_VIEW_MODE]&&this.hidableMenus[B.TOOLBAR_ROTATE]&&this.hidableMenus[B.TOOLBAR_ZOOM]&&this.iconMenuRef?.closeMenu(),this.changeDetectorRef.markForCheck()}}),this.store$.pipe(fi([B.TOOLBAR_ANNOTATION,B.TOOLBAR_FORM])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),(this.hidableMenus[B.TOOLBAR_ANNOTATION]&&this.viewerService.isSubToolbarType(lt.ANNOTATE)||this.hidableMenus[B.TOOLBAR_FORM]&&this.viewerService.isSubToolbarType(lt.FORM))&&this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck()}}),this.documentService.openedDocument$.subscribe({next:t=>{t?this.enableFormControl():(this.viewerService.closeSubToolbar(),this.disableFormControl())}}),this.toolbarService.toggleMainToolbar$.subscribe({next:t=>{t?this.mainMenuRef?.openMenu():this.mainMenuRef?.closeMenu(),this.changeDetectorRef.markForCheck()}}),this.toolbarService.toggleSideViewToolbar$.subscribe({next:t=>{if(this.isLessThanMobileWidth){this.isOpenedSideView=!0;return}t?this.sideViewMenuRef?.openMenu():this.sideViewMenuRef?.closeMenu(),this.changeDetectorRef.markForCheck()}}),this.toolbarService.toggleAnnotToolbar$.subscribe({next:t=>{t&&!this.viewerService.isSubToolbarType(lt.ANNOTATE)&&(this.viewerService.openSubToolbar(lt.ANNOTATE),this.changeDetectorRef.markForCheck()),!t&&this.viewerService.isSubToolbarType(lt.ANNOTATE)&&(this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck())}}),this.toolbarService.toggleFormToolbar$.subscribe({next:t=>{t&&!this.viewerService.isSubToolbarType(lt.FORM)&&(this.viewerService.openSubToolbar(lt.FORM),this.changeDetectorRef.markForCheck()),!t&&this.viewerService.isSubToolbarType(lt.FORM)&&(this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck())}}),this.toolbarService.toggleSignatureToolbar$.subscribe({next:t=>{t&&!this.viewerService.isSubToolbarType(lt.SIGN)&&(this.viewerService.openSubToolbar(lt.SIGN),this.changeDetectorRef.markForCheck()),!t&&this.viewerService.isSubToolbarType(lt.SIGN)&&(this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck())}}),this.toolbarService.toggleQuickActionPalette$.subscribe({next:t=>this.quickActionService.setPaletteVisibility(t)}),this.customUIService.customButtonUI$.subscribe({next:t=>{this.leftSectionFirstCustomUI=t.filter(i=>i.position==="TOOLBAR.LEFT_SECTION.FIRST"),this.leftSectionLastCustomUI=t.filter(i=>i.position==="TOOLBAR.LEFT_SECTION.LAST"),this.render(!0)}}),this.shortcutService.getShortcutEvent(Re.ESCAPE).subscribe({next:t=>{t.preventDefault(),this.undoDragMode()}}),this.shortcutService.getShortcutEvent(Re.SEARCH).subscribe({next:()=>{this.documentService.checkAuthority(Ne.SEARCH_TEXT)&&(K.get(ie.QUICK_SEARCH_BUTTON)||K.get(ie.FULL_SEARCH_BUTTON))&&!this.isEbookMode()&&this.doc&&this.onClickSearchButton()}}),this.viewerService.subToolbar$.pipe(F(t=>this.subToolbar!==t)).subscribe({next:t=>{this.subToolbar=t,this.changeDetectorRef.markForCheck()}})),this.render(!1),this.subscribeZoomHotkey(),this.subscribeUndoRedo(),this.subscribePrint(),this.pageNoFormControl.reset(this.currentPageNo),K.get(ie.USE_CLIENT_RENDERING)&&K.get(ie.CLIENT_RENDERING_MAXIMUM_SCALE).value!==Ze.maxScale){let t=K.get(ie.CLIENT_RENDERING_MAXIMUM_SCALE);this.scalePreset.unshift(this.convertToScalePreset(t.value))}this.initRegisterQuickActions()}ngOnChanges(){this.render(!0)}stopPropagation(t){w.stopPropagation(t)}isSubToolbarType(t){return this.viewerService.isSubToolbarType(t)}get printTooltipWithShortcut(){return`${this.translatePipe.transform("PRINT")} (${ti.getShortcutString(Fi[Re.PRINT])})`}get quickActionTooltipWithShortcut(){return`${this.translatePipe.transform("QUICK_ACTION")} (${ti.getShortcutString(Fi[Re.QUICK_ACTION])})`}isEbookMode(){return this.viewMode===4}get isDAP(){return this.documentService.isDAP}get isEditable(){return!this.hasSignedSignature||this.documentService.checkAuthority(Ne.EDIT_ANNOTATION)}get canDrawAnnot(){return this.documentService.checkAuthority(Ne.DRAW_ANNOTATION)&&this.documentService.checkAuthority(Ne.ANNOTATION)}get canShowAnnotToolbar(){return this.canDrawAnnot&&K.get(Tt.ANNOT_TOOLBAR)&&!this.isEbookMode()&&!this.hidableMenus[B.TOOLBAR_ANNOTATION]}get canShowRedactToolbar(){return this.documentService.checkAuthority(Ne.DRAW_REDACTION)&&!this.isEbookMode()}onMenuImageClick(){this.mainMenuRef?.toggleMenu()}isActiveSideView(t){return this.panelService.isOpened(t)}onSideViewMenuClick(){if(this.mainMenuRef?.closeMenu(),this.isLessThanMobileWidth){this.isOpenedSideView=!0;return}this.sideViewMenuRef?.toggleMenu()}onQuickActionButtonClick(){this.quickActionService.togglePaletteVisibility()}get searchTooltipWithShortcut(){return`${this.translatePipe.transform("SEARCH")} (${ti.getShortcutString(Fi[Re.SEARCH])})`}goToPage(t){let i=Number(t);if(isNaN(i)){console.debug("goToPage target is not a number",t);return}this.scrollController.moveToPage(i)}onPageInputBlur(){this.pageNoFormControl.value||this.pageNoFormControl.setValue(this.currentPageNo),this.pageNoFormControl.value!==this.currentPageNo&&this.goToPage(this.pageNoFormControl.value)}onClickSearchButton(){this.toggleSearchTool()}toggleSearchTool(){if(!(!this.documentService.checkAuthority(Ne.SEARCH_TEXT)||!this.doc)){if(K.get(ie.QUICK_SEARCH_BUTTON)){this.store$.dispatch(ue.set({key:"searchToolActive",value:!this.searchToolActive}));return}this.rightSideViewVisible&&this.rightSideViewMode===Rt.TextSearch?this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1})):(this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!0})),this.store$.dispatch(ue.set({key:"rightSideViewMode",value:Rt.TextSearch})))}}get zoomInTooltipWithShortcut(){return`${this.translatePipe.transform("ZOOM_IN")} (${ti.getShortcutString(Fi[Re.INCREASE_ZOOM_NUMPAD])})`}get zoomOutTooltipWithShortcut(){return`${this.translatePipe.transform("ZOOM_OUT")} (${ti.getShortcutString(Fi[Re.DECREASE_ZOOM_NUMPAD])})`}zoomIn(t){this.setScale(ee.calculateNextScale(this.scale,!0),!0)}zoomOut(t){this.setScale(ee.calculateNextScale(this.scale,!1),!0)}setScale(t,i=!1){typeof t!="number"||!isFinite(t)||isNaN(t)||this.publishScale(t,i)}onScaleMenuClick(){this.scaleMenuRef?.toggleMenu()}onConfirmScaleInput(){this.changeScaleDropdown(this.scaleFormControl.value)}convertToScalePreset(t){return{label:`${t}%`,command:()=>this.changeScaleDropdown(t)}}onMoreMenuButtonClick(){this.iconMenuRef&&this.iconMenuRef.toggleMenu()}onDragToolMenuExpandClick(){this.dragToolMenuRef?.toggleMenu()}onRightMenuClick(){this.rightMenuRef?.toggleMenu()}onToolbarMenuClick(t){this.mainMenuRef?.closeMenu(),this.iconMenuRef?.closeMenu(),this.dragToolMenuRef?.closeMenu(),this.sideViewMenuRef?.closeMenu(),this.rightMenuRef?.closeMenu(),this.viewerService.toggleSubToolbar(t)}zoom(t){this.setZoom(this.scale+t)}setZoom(t,i=!1){typeof t!="number"||!isFinite(t)||isNaN(t)||this.publishScale(t,i)}fitToWidth(){this.contentService.requestViewChange({fitMode:0}),this.activeFitMode=0,this.changeDetectorRef.markForCheck()}fitToWidthForStatistics(t){this.fitToWidth()}fitToHeight(){this.contentService.requestViewChange({fitMode:1}),this.activeFitMode=1,this.changeDetectorRef.markForCheck()}fitToHeightForStatistics(t){this.fitToHeight()}rotate(t){this.contentService.requestViewChange({degree:this.degree+t})}rotateForStatistics(t,i){this.rotate(i)}saveDoc(t,i){this.changeService.saveDocumentForStatistics(fe.SAVE_DOCUMENT_BY_BUTTON,void 0,t,i)}downloadDoc(){this.downloadService.downloadDocument()}printDoc(){this.dialogService.toggleDialogVisibility(ji.PRINT,!0)}changeViewMode(t){this.viewMode!==t&&this.contentService.requestViewChange({viewMode:t})}changeViewModeForStatistics(t,i){this.changeViewMode(i)}dragModeClicked(t){t&&(this.store$.dispatch(ue.set({key:"dragMode",value:t})),this.store$.dispatch(Ki.unselectTool()),this.selectTextService.publishSelectedText(null),this.annotService.closeEditor())}dragModeClickedForStatistics(t,i){this.dragModeClicked(i)}getSelectedDragMode(){let t=this.dragToolMenus[0]?.menus?.find(i=>i.mode===this.dragMode);return w.isDefined(t)?t:this.dragToolMenus[0].menus[0]}toggleDapView(){this.rightSideViewMode===Rt.DAP?this.rightSideViewVisible?this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1})):this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!0})):(this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!0})),this.store$.dispatch(ue.set({key:"rightSideViewMode",value:Rt.DAP})))}onClickCustomUI(t,i){t.onclick(Zn.simplifyMouseEvent(i))}resize(){this.mainMenuRef!==void 0&&this.mainMenuRef.closeMenu(),this.render()}render(t=!0){this.buildMenu(),t&&this.changeDetectorRef.markForCheck()}buildMenu(){this.mainMenus=this.menuService.buildMainMenu(this),this.subToolbarMenus=this.buildSubToolbarMenu(),this.iconMenus=this.buildIconMenu(),this.dragToolMenus=this.buildDragToolMenu(),this.rightMenus=[{items:this.menuService.buildRightMenu()}],this.disableMenuWhenNoDoc(),this.changeDetectorRef.markForCheck()}disableMenuWhenNoDoc(){this.doc||[...this.mainMenus].forEach(t=>{t.items.forEach(i=>{["PREFERENCES","SLIDESHOW"].map(n=>this.translatePipe.transform(n)).includes(i.label)||(i.disabled=!0)})})}buildDragToolMenu(){let t=[];return K.get(ie.DRAG_MODE_MOVE_BUTTON)&&!this.hidableMenus[B.TOOLBAR_DRAG_MODE_MOVE]&&t.push({mode:Mt.MOVE,icon:"papycon papycon-hand",action:()=>this.dragModeClickedForStatistics(fe.CHANGE_DRAGMODE_TO_SCROLL_MODE_BY_BUTTON,Mt.MOVE),isActive:()=>this.dragMode===Mt.MOVE,tooltip:this.translatePipe.transform("SCROLL_MODE")}),K.get(ie.DRAG_MODE_SELECT_TEXT_BUTTON)&&!this.hidableMenus[B.TOOLBAR_DRAG_MODE_SELECT_TEXT]&&t.push({mode:Mt.SELECT_TEXT,icon:"papycon papycon-selection-annotation-text",action:()=>this.dragModeClickedForStatistics(fe.CHANGE_DRAGMODE_TO_SELECT_TEXT_BY_BUTTON,Mt.SELECT_TEXT),isActive:()=>this.dragMode===Mt.SELECT_TEXT,tooltip:this.translatePipe.transform("SELECT_TEXT"),disabled:!this.doc}),K.get(ie.DRAG_MODE_MAGNIFY_BUTTON)&&!this.hidableMenus[B.TOOLBAR_DRAG_MODE_ZOOM]&&!G.isTouchableDevice()&&t.push({mode:Mt.MAGNIFY,icon:"papycon papycon-area-zoom2",action:()=>this.dragModeClickedForStatistics(fe.CHANGE_DRAGMODE_TO_MAGNIFY_TOOL_BY_BUTTON,Mt.MAGNIFY),isActive:()=>this.dragMode===Mt.MAGNIFY,tooltip:this.translatePipe.transform("MAGNIFY_TOOL")}),[{menus:t,align:"center"}]}buildIconMenu(){let t=[];return K.get(ie.VIEW_MODE_BUTTON)&&!this.hidableMenus[B.TOOLBAR_VIEW_MODE]&&t.push({label:this.translatePipe.transform("PAGE_DISPLAY"),align:G.isSmallWidth()?"justify":"left",wrap:G.isSmallWidth()?"wrap":"nowrap",menus:[{icon:"papycon papycon-one-page3",action:()=>(this.changeViewModeForStatistics(fe.VIEW_MODE_ONE,0),w.isDefined(this.iconMenuRef)||this.loggingService.common("warn",Le.NOT_EXIST,"iconMenuRef"),this.iconMenuRef?.closeMenu(),!0),isActive:()=>this.viewMode===0,tooltip:this.translatePipe.transform("SINGLE_PAGE_VIEW"),disabled:!1},{icon:"papycon papycon-one-page-continuous3",action:()=>(this.changeViewModeForStatistics(fe.VIEW_MODE_ONE_C,1),w.isDefined(this.iconMenuRef)||this.loggingService.common("warn",Le.NOT_EXIST,"iconMenuRef"),this.iconMenuRef?.closeMenu(),!0),isActive:()=>this.viewMode===1,tooltip:this.translatePipe.transform("SINGLE_PAGE_CONTINUOUS"),disabled:!1},{icon:"papycon papycon-two-page3",action:()=>(this.changeViewModeForStatistics(fe.VIEW_MODE_TWO,2),w.isDefined(this.iconMenuRef)||this.loggingService.common("warn",Le.NOT_EXIST,"iconMenuRef"),this.iconMenuRef?.closeMenu(),!0),isActive:()=>this.viewMode===2,tooltip:this.translatePipe.transform("TWO_PAGE_VIEW"),disabled:!1},{icon:"papycon papycon-two-page-continuous3",action:()=>(this.changeViewModeForStatistics(fe.VIEW_MODE_TWO_C,3),w.isDefined(this.iconMenuRef)||this.loggingService.common("warn",Le.NOT_EXIST,"iconMenuRef"),this.iconMenuRef?.closeMenu(),!0),isActive:()=>this.viewMode===3,tooltip:this.translatePipe.transform("TWO_PAGE_CONTINUOUS"),disabled:!1}]}),K.get(ie.ROTATION_BUTTON)&&!this.hidableMenus[B.TOOLBAR_ROTATE]&&t.push({label:this.translatePipe.transform("ROTATE"),align:G.isSmallWidth()?"justify":"left",menus:[{icon:"papycon papycon-reverse",action:()=>(this.rotateForStatistics(fe.ROTATE_DOCUMENT_BY_BUTTON,-90),!0),tooltip:this.translatePipe.transform("ROTATE_CCW"),disabled:this.isEbookMode()},{icon:"papycon papycon-rotate",action:()=>(this.rotateForStatistics(fe.ROTATE_DOCUMENT_BY_BUTTON,90),!0),tooltip:this.translatePipe.transform("ROTATE_CW"),disabled:this.isEbookMode()}]}),this.doc||t.forEach(i=>{let e=["PAGE_DISPLAY"].map(n=>this.translatePipe.transform(n));w.isDefined(i.label)&&e.includes(i.label)||i.menus.forEach(n=>n.disabled=!0)}),t}buildSubToolbarMenu(){let t={items:[]};return this.canShowAnnotToolbar&&t.items.push({label:this.translatePipe.transform("ANNOTATE"),command:()=>this.onToolbarMenuClick(lt.ANNOTATE),data:lt.ANNOTATE}),t.items.push({label:this.translatePipe.transform("TOOLBAR_REDACT"),command:()=>this.onToolbarMenuClick(lt.REDACT),data:lt.REDACT}),[t]}publishScale(t,i){this.contentService.requestViewChange({scale:t,checkScale:i})}subscribeZoomHotkey(){this.subscriptionService.push(ut(this.shortcutService.getShortcutEvent(Re.INCREASE_ZOOM),this.shortcutService.getShortcutEvent(Re.INCREASE_ZOOM_NUMPAD)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.changeZoomByShortcut(Re.INCREASE_ZOOM)}}),ut(this.shortcutService.getShortcutEvent(Re.DECREASE_ZOOM),this.shortcutService.getShortcutEvent(Re.DECREASE_ZOOM_NUMPAD)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.changeZoomByShortcut(Re.DECREASE_ZOOM)}}),ut(this.shortcutService.getShortcutEvent(Re.RESTORE_ZOOM),this.shortcutService.getShortcutEvent(Re.RESTORE_ZOOM_NUMPAD)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.changeZoomByShortcut(Re.RESTORE_ZOOM)}}))}subscribeUndoRedo(){this.subscriptionService.push(this.actionHistoryService.availableUndoCount$.pipe(F(()=>K.get(Tt.UNDO_REDO_BUTTONS))).subscribe({next:t=>{this.canUndo=t>0;let i=this.mainMenus[0]?.items.find(e=>e.label===this.translatePipe.transform("UNDO"));this.mainMenus.length&&G.width<640&&w.isDefined(i)&&(i.disabled=!this.canUndo)}}),this.actionHistoryService.availableRedoCount$.pipe(F(()=>K.get(Tt.UNDO_REDO_BUTTONS))).subscribe({next:t=>{this.canRedo=t>0;let i=this.mainMenus[0]?.items.find(e=>e.label===this.translatePipe.transform("REDO"));this.mainMenus.length&&G.width<640&&w.isDefined(i)&&(i.disabled=!this.canRedo)}}),this.shortcutService.getShortcutEvent(Re.UNDO_ACTION).pipe(F(()=>K.get(ie.SHORTCUT_UNDO_REDO))).subscribe({next:t=>{if(t.preventDefault(),this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:Gt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}this.annotSelectedService.unselectAll(),this.actionHistoryService.undo()}}),ut(this.shortcutService.getShortcutEvent(Re.REDO_ACTION),this.shortcutService.getShortcutEvent(Re.REDO_ACTION2)).pipe(F(()=>K.get(ie.SHORTCUT_UNDO_REDO))).subscribe({next:t=>{if(t.preventDefault(),this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:Gt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}this.annotSelectedService.unselectAll(),this.actionHistoryService.redo()}}))}subscribePrint(){this.subscriptionService.push(this.shortcutService.getShortcutEvent(Re.PRINT).subscribe({next:t=>{if(t.preventDefault(),K.get(ie.SHORTCUT_PRINT)&&K.get(Tt.PRINT_DIALOG)&&this.hasPrintPermission&&!this.hidableMenus[B.TOOLBAR_PRINT]){this.dialogService.toggleDialogVisibility(ji.PRINT,!0);return}this.toastService.create({toastStyle:Gt.FAILURE,header:this.translatePipe.transform("INFO"),content:this.translatePipe.transform("NO_PRINT_PERMISSION")})}}))}get isMainMenuVisible(){return!this.hidableMenus[B.TOOLBAR_LEFT]&&this.mainMenus.length>0}get isSideMenuVisible(){return this.isSideViewButtonVisible||this.isQuickActionButtonVisible||this.isCaptureModeButtonVisible}get isSideViewButtonVisible(){return(this.isDAP?K.get(ie.THUMBNAIL_VIEW_BUTTON):K.get(Tt.LEFT_SIDE_VIEW_BUTTON))&&!this.isSpreadsheets&&this.sideViewMenus[0]?.items.length>0}get isQuickActionButtonVisible(){return K.get(ie.QUICK_ACTION_BUTTON)&&!this.hidableMenus[B.TOOLBAR_QUICK_ACTION]&&!this.isSpreadsheets&&!G.isSmallWidth()}get isCaptureModeButtonVisible(){return K.get(ie.CAPTURE_MODE_BUTTON)&&!this.hidableMenus[B.TOOLBAR_CAPTURE_MODE]&&!this.isSpreadsheets&&!G.isSmallWidth()}get isScaleMenuVisible(){return K.get(ie.SCALE_DROPDOWN)&&!this.hidableMenus[B.TOOLBAR_ZOOM]&&!this.isLessThanDesktopWidth}get isPageMenuVisible(){return K.get(ie.PAGE_NAVIGATION)&&!this.isLessThanDesktopWidth}get isSearchMenuVisible(){return K.get(Tt.SEARCH_BUTTON)}get isFitMenuVisible(){return K.get(ie.FIT_BUTTON)&&!this.hidableMenus[B.TOOLBAR_SCREEN_FIT]&&!this.isEbookMode()&&!this.isSpreadsheets}get isViewModeVisible(){return K.get(Tt.VIEW_MODE_BUTTON)&&this.iconMenus.length>0&&!this.isSpreadsheets}get isDragModeMenuVisible(){return K.get(Tt.DRAG_MODE_BUTTONS)&&this.hasDragTools&&this.hidableDragMode&&!this.isEbookMode()&&!this.isSpreadsheets}get isDapButtonVisible(){return K.get(Tt.DAP_VIEW)&&K.get(ie.DAP_VIEW_BUTTON)&&this.isDAP&&!this.isLessThanMobileWidth&&!this.isSpreadsheets}initRegisterQuickActions(){this.quickActionService.registerActions([{id:Se.FIT_TO_WIDTH,actionFn:()=>this.fitToWidthForStatistics(fe.CHANGE_ZOOM_TO_FIT_BY_QUICK_SEARCH)},{id:Se.FIT_TO_HEIGHT,actionFn:()=>this.fitToHeightForStatistics(fe.CHANGE_ZOOM_TO_FIT_BY_QUICK_SEARCH)},{id:Se.SINGLE_PAGE_VIEW,actionFn:()=>this.changeViewModeForStatistics(fe.CHANGE_VIEWMODE_TO_SINGLE_PAGE_VIEW_BY_QUICK_SEARCH,0)},{id:Se.SINGLE_PAGE_CONTINUOUS,actionFn:()=>this.changeViewModeForStatistics(fe.CHANGE_VIEWMODE_TO_SINGLE_PAGE_CONTINUOUS_BY_QUICK_SEARCH,1)},{id:Se.TWO_PAGE_VIEW,actionFn:()=>this.changeViewModeForStatistics(fe.CHANGE_VIEWMODE_TO_TWO_PAGE_VIEW_BY_QUICK_SEARCH,2)},{id:Se.TWO_PAGE_CONTINUOUS,actionFn:()=>this.changeViewModeForStatistics(fe.CHANGE_VIEWMODE_TO_TWO_PAGE_CONTINUOUS_BY_QUICK_SEARCH,3)},{id:Se.ROTATE_CCW,actionFn:()=>this.rotateForStatistics(fe.ROTATE_DOCUMENT_BY_QUICK_SEARCH,-90)},{id:Se.ROTATE_CW,actionFn:()=>this.rotateForStatistics(fe.ROTATE_DOCUMENT_BY_QUICK_SEARCH,90)},{id:Se.SCROLL_MODE,actionFn:()=>this.dragModeClickedForStatistics(fe.CHANGE_DRAGMODE_TO_SCROLL_MODE_BY_QUICK_SEARCH,Mt.MOVE)},{id:Se.SELECT_TEXT,actionFn:()=>this.dragModeClickedForStatistics(fe.CHANGE_DRAGMODE_TO_SELECT_TEXT_BY_QUICK_SEARCH,Mt.SELECT_TEXT)},{id:Se.MAGNIFY_TOOL,actionFn:()=>this.dragModeClickedForStatistics(fe.CHANGE_DRAGMODE_TO_MAGNIFY_TOOL_BY_QUICK_SEARCH,Mt.MAGNIFY)},{id:Se.SELECT_ANNOT_TOOL,actionFn:()=>this.dragModeClickedForStatistics(fe.CHANGE_DRAGMODE_TO_SELECT_ANNOT_TOOL_BY_QUICK_SEARCH,Mt.SELECT_ANNOT)}])}enableFormControl(){this.pageNoFormControl.enable(),this.scaleFormControl.enable({emitEvent:!1})}disableFormControl(){this.pageNoFormControl.disable(),this.scaleFormControl.disable({emitEvent:!1})}closeSideViewToolbar(){this.store$.dispatch(ue.set({key:"sideViewVisible",value:!1})),this.isOpenedSideView=!1}undoDragMode(){this.store$.dispatch(ue.set({key:"dragMode",value:this.previousDragMode})),this.store$.dispatch(Ki.unselectTool()),this.selectTextService.publishSelectedText(null),this.annotService.closeEditor()}changeScaleDropdown(t){let i=typeof t=="string"?Number.parseFloat(t):t;this.setZoom(Number.isNaN(i)?this.scale:i)}changeZoomByShortcut(t){switch(t){case Re.INCREASE_ZOOM:case Re.INCREASE_ZOOM_NUMPAD:this.setZoom(ee.calculateNextScale(this.scale,!0),!0);break;case Re.DECREASE_ZOOM:case Re.DECREASE_ZOOM_NUMPAD:this.setZoom(ee.calculateNextScale(this.scale,!1),!0);break;case Re.RESTORE_ZOOM:case Re.RESTORE_ZOOM_NUMPAD:this.zoom(100-this.scale);break}}onSubToolbarMenuClick(){this.subToolbarRef?.toggleMenu()}};D(as,"\u0275fac",function(i){return new(i||as)(_(at),_(li),_(jr),_(En),_(Me),_(tr),_(ct),_(Ko),_(sn),_(rn),_(J),_(eo),_(Di),_(Ee),_(He),_(yn),_(Xo),_(Wr),_(cn),_(Fp),_(Yt),_(Jt),_(ln),_(Ai),_(Po),_(Kr),_(zi),_(Zt))}),D(as,"\u0275cmp",Ce({type:as,selectors:[["sd-toolbar"]],viewQuery:function(i,e){if(i&1&&(Ye(Mf,5),Ye(Rf,5),Ye(If,5),Ye(Af,5),Ye(Df,5),Ye(Nf,5),Ye(kf,5)),i&2){let n;Ie(n=Ae())&&(e.mainMenuRef=n.first),Ie(n=Ae())&&(e.subToolbarRef=n.first),Ie(n=Ae())&&(e.sideViewMenuRef=n.first),Ie(n=Ae())&&(e.iconMenuRef=n.first),Ie(n=Ae())&&(e.dragToolMenuRef=n.first),Ie(n=Ae())&&(e.rightMenuRef=n.first),Ie(n=Ae())&&(e.scaleMenuRef=n.first)}},inputs:{doc:"doc"},standalone:!1,features:[xe([tr,J,{provide:Qn,useValue:new Vt(300)}]),tn],decls:4,vars:4,consts:[["sideViewMenuRef",""],["subToolbarRef",""],["scaleMenuRef",""],["iconMenuRef",""],["rightMenuRef",""],["class","left",4,"ngIf"],["class","center",4,"ngIf"],["class","right",4,"ngIf"],[4,"ngIf"],[1,"left"],["class","side-menu-container",4,"ngIf"],["class","divider",4,"ngIf"],[1,"toolbar-menu-container"],["class","ep-text-button custom-ui",3,"dark","title","tooltip","click",4,"ngFor","ngForOf"],[1,"sub-toolbar-container"],[1,"side-menu-container"],[1,"ep-text-button","side-view-menu",3,"click","mousedown","touchstart","tooltip"],["class","side-view-menu",3,"size","menus",4,"ngIf"],[1,"side-view-menu",3,"size","menus"],[1,"divider"],[1,"logo-container"],[3,"src"],[1,"ep-text-button","custom-ui",3,"click","title","tooltip"],[3,"ngClass"],[1,"ep-text-button","tool-button",3,"active"],[1,"ep-text-button","tool-button",3,"click","mousedown","touchstart"],["color","dark",1,"ep-text-button","subtoolbar-menu-button",3,"click","mousedown","touchstart"],[1,"papycon","papycon-chevron3-down"],[3,"menus"],[1,"center"],[1,"scale-menus"],[1,"page-menus"],["aria-controls","search-tool",1,"ep-text-button","search-button",3,"dark","disabled","title","tooltip"],[1,"more-menu-container"],[1,"ep-text-button",3,"click","disabled","title","tooltip"],[1,"papycon","papycon-minus"],[1,"scale-dropdown"],["type","text","maxlength","4",3,"keyup.enter","blur","disabled","formControl"],[1,"ep-text-button",3,"click"],[1,"papycon","papycon-plus"],["size","tiny","align","left",1,"current-page-index",3,"keydown.enter","blur","autoResize","maxLength","formControl","ariaLabel"],[1,"page-label"],["aria-controls","search-tool",1,"ep-text-button","search-button",3,"click","disabled","title","tooltip"],[1,"papycon","papycon-search"],[1,"ep-text-button","more-button",3,"click","mousedown","touchstart","title","tooltip"],[1,"papycon","papycon-chevron3-down","expand-icon"],[1,"more-menu",3,"iconMenus","isMobile","isDarkMode"],[1,"right"],[1,"file-menus"],["class","ep-text-button dap-button",3,"dark","tooltip","click","mousedown","touchstart",4,"ngIf"],["class","ep-text-button print",3,"dark","disabled","title","tooltip","click",4,"ngIf"],["class","ep-text-button download",3,"dark","disabled","title","tooltip","click",4,"ngIf"],[1,"ep-text-button","print",3,"click","disabled","title","tooltip"],[1,"papycon","papycon-print"],[1,"ep-text-button","download",3,"click","disabled","title","tooltip"],[1,"papycon","papycon-download"],[1,"ep-text-button",3,"click","mousedown","touchstart","title","tooltip"],[1,"papycon","papycon-more-symbol3"],[3,"size","menus"],[1,"ep-text-button","dap-button",3,"click","mousedown","touchstart","tooltip"],[1,"papycon","papycon-composite-document"],[1,"side-view-toolbar"],[1,"close"],[1,"ep-text-button","close-button",3,"click","title"],[1,"papycon","papycon-cross"],[1,"side-view-toolbar-menu-container"],[4,"ngFor","ngForOf"],[1,"ep-text-button",3,"click","title","disabled"]],template:function(i,e){i&1&&se(0,Xf,9,6,"section",5)(1,tm,7,6,"section",6)(2,cm,3,2,"section",7)(3,dm,10,10,"ng-container",8),i&2&&(T("ngIf",!e.hidableMenus[e.HidableView.TOOLBAR_LEFT]),x(),T("ngIf",!e.hidableMenus[e.HidableView.TOOLBAR_CENTER]),x(),T("ngIf",!e.hidableMenus[e.HidableView.TOOLBAR_RIGHT]),x(),T("ngIf",e.isLessThanMobileWidth&&e.isOpenedSideView))},dependencies:[xo,Ei,bt,Os,On,ca,Vn,op,ap,ws,Dn,He],styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}[_nghost-%COMP%]{position:relative;display:flex;justify-content:space-between;box-sizing:border-box;background:var(--mono-00);border-bottom:1px solid var(--mono-30);z-index:3}.ep-text-button[_ngcontent-%COMP%]:has(i.papycon){border-width:0;outline-offset:-2px;padding:2px}.ep-text-button[_ngcontent-%COMP%]:has(i.papycon)   i.papycon-chevron3-down[_ngcontent-%COMP%]{font-size:12px}.ep-text-button[_ngcontent-%COMP%]:has(i.papycon)   i.papycon[_ngcontent-%COMP%]:not(.papycon-chevron3-down){font-size:20px}section[_ngcontent-%COMP%]{display:flex}section[_ngcontent-%COMP%] > .divider[_ngcontent-%COMP%]{width:1px;background-color:var(--mono-30);margin:8px 0}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%], section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]{position:relative;display:flex}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:auto 16px}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%], section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover, section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%], section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;min-width:148px}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]     .menu .division-line .line, section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]     .menu .division-line .line{background-color:var(--mono-30)}section.left[_ngcontent-%COMP%]   div.main-menu-container.main-menu[_ngcontent-%COMP%]     pu-menu .menu-item, section.left[_ngcontent-%COMP%]   div.side-menu-container.main-menu[_ngcontent-%COMP%]     pu-menu .menu-item{padding-right:24px}section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:0}section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-of-type{margin-right:16px}section.left[_ngcontent-%COMP%]   i.papycon-chevron3-down[_ngcontent-%COMP%]{color:var(--mono-70)}section.left[_ngcontent-%COMP%]   .logo-container[_ngcontent-%COMP%]{padding:0 16px;height:100%;display:flex;align-items:center}section.left[_ngcontent-%COMP%]   .logo-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:24px;max-width:100px;object-fit:fill;-webkit-user-select:none;user-select:none;pointer-events:none}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]{margin:0 16px}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   div.sub-toolbar-container[_ngcontent-%COMP%]{display:flex;align-items:center;position:relative}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   div.sub-toolbar-container[_ngcontent-%COMP%]   .subtoolbar-menu-button[_ngcontent-%COMP%]{padding:8px;height:29px;display:flex;gap:4px;align-items:center;border-radius:6px}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   div.sub-toolbar-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]{top:100%;left:0}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button[_ngcontent-%COMP%]{padding:8px 12px;outline-offset:-2px;border-width:0}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button.tool-button[_ngcontent-%COMP%]{margin:6.5px 0;border-radius:6px;font-size:13px;line-height:1}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button.custom-ui[_ngcontent-%COMP%]{margin:auto 16px;padding:2px}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button.active[_ngcontent-%COMP%]{background-color:#f166251a}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]{display:flex;align-items:center}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:14px}section.center[_ngcontent-%COMP%]{display:flex;column-gap:12px;align-items:center;height:100%;position:absolute;left:50%;transform:translate(-50%)}section.center[_ngcontent-%COMP%] > .divider[_ngcontent-%COMP%]{display:none;height:26px}section.center[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + .divider[_ngcontent-%COMP%]{display:block}section.center[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.center[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.center[_ngcontent-%COMP%]   div.scale-menus[_ngcontent-%COMP%]{display:flex;align-items:center;column-gap:8px}section.center[_ngcontent-%COMP%]   div.page-menus[_ngcontent-%COMP%]{display:flex;align-items:center}section.center[_ngcontent-%COMP%]   div.page-menus[_ngcontent-%COMP%]   pu-input.current-page-index[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--input);border-radius:2px;box-sizing:content-box}section.center[_ngcontent-%COMP%]   div.page-menus[_ngcontent-%COMP%]   div.page-label[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);white-space:pre}section.center[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]{display:flex;position:relative;box-sizing:border-box;padding:3px 4px 3px 10px;width:70px;border:1px solid var(--mono-30);border-radius:4px;background-color:var(--input-background)}section.center[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]:has(input:focus){border-color:var(--primary-50)}section.center[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-family:NotoSans-Regular,sans-serif;font-size:14px;line-height:24px;padding:0;width:100%;border:0;-webkit-appearance:none;appearance:none;caret-color:var(--primary-50);background-color:var(--input-background);color:var(--input)}section.center[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:0}section.center[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled{background-color:transparent}section.center[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0;color:var(--input)}section.center[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0}section.center[_ngcontent-%COMP%]   div.more-menu-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;height:100%}section.center[_ngcontent-%COMP%]   div.more-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;height:34px}section.center[_ngcontent-%COMP%]   div.more-menu-container[_ngcontent-%COMP%]   pu-icon-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:0}section.right[_ngcontent-%COMP%]{position:relative;margin-right:16px;height:100%}section.right[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.right[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.right[_ngcontent-%COMP%]   i.papycon-chevron3-down[_ngcontent-%COMP%]{color:var(--mono-70)}section.right[_ngcontent-%COMP%]   div.toolbar-menu-container[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center}section.right[_ngcontent-%COMP%]   div.toolbar-menu-container[_ngcontent-%COMP%]   button.toolbar-menu-button[_ngcontent-%COMP%]{position:relative}section.right[_ngcontent-%COMP%]   div.toolbar-menu-container[_ngcontent-%COMP%]   pu-menu.toolbar-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:calc(100% - 51px);min-width:120px}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]{display:flex;align-items:center;position:relative;margin-left:24px}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}@media screen and (max-width: 991px){section.center[_ngcontent-%COMP%]{position:unset;left:0;transform:none;margin-left:auto}section.right[_ngcontent-%COMP%]{margin-left:0;margin-right:0}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]{margin:auto 12px;height:100%}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]{top:100%;right:0}}@media screen and (max-width: 575px){section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]{margin:0}section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:auto 8px}section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-of-type{margin-right:8px}section.center[_ngcontent-%COMP%]{left:0;position:relative;margin-right:6px}section.center[_ngcontent-%COMP%]   button.fit[_ngcontent-%COMP%]{display:none}section.center[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] + div[_ngcontent-%COMP%]{margin-left:20px}section.center[_ngcontent-%COMP%]   div.spreadsheets-zoom-container[_ngcontent-%COMP%]   button.ep-text-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px}section.side-view-toolbar[_ngcontent-%COMP%]{background:var(--mono-00);position:absolute;width:100%;height:100%}section.side-view-toolbar[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{margin:auto 12px}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]{position:relative;display:flex;overflow-x:scroll;overflow-y:hidden;-ms-overflow-style:none;scrollbar-width:none}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:auto 12px}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button[_ngcontent-%COMP%]{width:24px;height:24px}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]   button.expandable[_ngcontent-%COMP%]{margin-right:0}}"],changeDetection:0}));var mn=as;ze([ot(it.floatingNavComp.changeZoom,1e3)],mn.prototype,"zoomIn",null);ze([ot(it.floatingNavComp.changeZoom,1e3)],mn.prototype,"zoomOut",null);ze([ot(it.mainToolbarComp.changeZoomToFit,1e3)],mn.prototype,"fitToWidthForStatistics",null);ze([ot(it.mainToolbarComp.changeZoomToFit,1e3)],mn.prototype,"fitToHeightForStatistics",null);ze([ot(it.mainToolbarComp.rotateForStatistics,1e3)],mn.prototype,"rotateForStatistics",null);ze([ot(it.mainToolbarComp.changeViewModeForStatistics)],mn.prototype,"changeViewModeForStatistics",null);ze([ot(it.mainToolbarComp.dragModeClickedForStatistics)],mn.prototype,"dragModeClickedForStatistics",null);ze([ot(it.mainToolbarComp.changeScaleDropdown)],mn.prototype,"changeScaleDropdown",null);ze([ot(it.mainToolbarComp.changeZoomByShortcut,1e3)],mn.prototype,"changeZoomByShortcut",null);var kd=(()=>{let t=class t{};D(t,"\u0275fac",function(n){return new(n||t)}),D(t,"\u0275mod",ai({type:t})),D(t,"\u0275inj",ri({providers:[Kr,Po],imports:[$i,Nr,wn,np,Vr,cp,kr,Ta]}));let s=t;return s})();var cs=(()=>{let t=class t{baseHref;http;downloadService;latestVersion=Ze.sdPluginVersion;sdAgentEnableHTTPS=Ze.sdAgentEnableHTTPS;sdAgentURLScheme=this.sdAgentEnableHTTPS?"https://":"http://";sdAgentURLPrefix=`${this.sdAgentURLScheme}127.0.0.1:`;sdAgentHeaders;sdAgentHttpPorts=[13980,23980,33980];sdAgentHttpsPorts=[13981,23981,33981];constructor(e,n,r){this.baseHref=e,this.http=n,this.downloadService=r,this.sdAgentHeaders={"Papyrus-Module":Ze.sdAgentModule,"Content-Type":"application/x-www-form-urlencoded"}}reqAgent(e,n){let r=this.sdAgentEnableHTTPS?this.sdAgentHttpsPorts:this.sdAgentHttpPorts,c=r.length;return new Et(g=>{let v=()=>{c||g.error();let y=`${this.sdAgentURLPrefix}${r[r.length-c]}${e}`;this.http.post(y,n,{observe:"response",responseType:"text",headers:this.sdAgentHeaders}).subscribe({next:M=>{g.next(M),g.complete()},error:M=>{--c>0?setTimeout(v,100):g.error(M)}})};v()})}checkVersion(){return this.reqAgent("/version/info",w.EMPTY_STRING)}print(e,n,r,c,g,v,y){let M=new Ll().set("host",e).set("path",n).set("port",r).set("protocol",c).set("hide-timestamp",String(!Ze.printTimestampInPlugin)).set("current-page-index",v).set("withoutDialog",String(Ze.printWithoutDialogInPlugin)).set("open-without-memory",String(Ze.openWithoutMemory));return Number.isNaN(Ze.defaultPluginPrintScale)||(M=M.set("print-scale",Ze.defaultPluginPrintScale)),w.isDefined(y)&&(M=M.set("pageRange",y)),Dr.token?.accessToken&&(document.cookie=`accessToken=${Dr.token.accessToken}`,M=M.set("cookie",document.cookie)),g&&(M=M.set("timestamp-status",g)),this.reqAgent("/print/execute",M.toString())}isLatestVersion(e){let n=e.match(/(\d+)\.(\d+)\.(\d+).*/)?.slice(1,4),r=this.latestVersion.split(".");if(n===void 0||!n.every(this.isValidPart)||!r.every(this.isValidPart)||n.length!==r.length)return!1;let c=n.map(Number),g=r.map(Number);for(let v=0;v<c.length;++v){if(g.length===v)return!0;if(c[v]!==g[v])return c[v]>g[v]}return!0}isValidPart(e){return/^\d+$/.test(e)}downloadSDAgent(){let e=`${this.baseHref}v4/resources/sdagent-modern`;this.downloadService.executeFileDownloader(e)}};D(t,"\u0275fac",function(n){return new(n||t)(ke(kl),ke(Fl),ke(Ko))}),D(t,"\u0275prov",oi({token:t,factory:t.\u0275fac}));let s=t;return s})();var aE=(()=>{let t=class t{static forRoot(){return{ngModule:t,providers:[cs]}}};D(t,"\u0275fac",function(n){return new(n||t)}),D(t,"\u0275mod",ai({type:t})),D(t,"\u0275inj",ri({}));let s=t;return s})();var Dc=(()=>{let t=class t{modalParam;modalService;agentService;portalRef;subscriptionService;get status(){return this.modalParam.status}constructor(e,n,r,c,g){this.modalParam=e,this.modalService=n,this.agentService=r,this.portalRef=c,this.subscriptionService=g}ngOnInit(){this.subscriptionService.push(Ge(window,"keydown",{capture:!0}).pipe(F(e=>e.key==="Escape"),F(()=>this.modalService.lastModal===this.portalRef)).subscribe({next:()=>this.onButtonClick(!1)}))}onButtonClick(e){e&&this.agentService.downloadSDAgent(),this.portalRef.dispose()}};D(t,"\u0275fac",function(n){return new(n||t)(_(na),_(on),_(cs),_(oa),_(J))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-module-download"]],standalone:!1,features:[xe([J])],decls:16,vars:18,consts:[["color","grey","size","tiny",1,"ep-button",3,"click"],["color","primary","size","small",1,"ep-button",3,"click"]],template:function(n,r){n&1&&(I(0,"h3"),_e(1),Y(2,"translate"),N(),I(3,"main")(4,"div"),_e(5),Y(6,"translate"),N(),I(7,"button",0),Y(8,"translate"),ae("click",function(){return r.onButtonClick(!0)}),_e(9),Y(10,"translate"),N()(),I(11,"footer")(12,"button",1),Y(13,"translate"),ae("click",function(){return r.onButtonClick(!1)}),_e(14),Y(15,"translate"),N()()),n&2&&(x(),we(X(2,6,r.status==="notInstall"?"INSTALL_PLUGIN":"UPDATE_PLUGIN")),x(4),we(X(6,8,r.status==="notInstall"?"NO_PRINT_PLUGIN":"NEW_VERSION_AVAILABLE")),x(2),ge("aria-label",X(8,10,"DOWNLOAD")),x(2),we(X(10,12,"DOWNLOAD")),x(3),ge("aria-label",X(13,14,"OK")),x(2),we(X(15,16,"OK")))},dependencies:[He],styles:["h3[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin:8px 0}main[_ngcontent-%COMP%]{font-size:13px;line-height:22px;color:var(--mono-70);white-space:pre-wrap}main[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:20px}footer[_ngcontent-%COMP%]{text-align:right;margin-top:32px}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:var(--mono-00)}"],changeDetection:0}));let s=t;return s})();function gm(s,t){if(s&1){let i=ve();I(0,"section",9)(1,"pu-radio-group"),Y(2,"translate"),I(3,"pu-radio-button",10),Y(4,"translate"),Ii("ngModelChange",function(n){j(i);let r=E(3);return Ri(r.pageOption,n)||(r.pageOption=n),W(n)}),N(),I(5,"pu-radio-button",11),Y(6,"translate"),Ii("ngModelChange",function(n){j(i);let r=E(3);return Ri(r.pageOption,n)||(r.pageOption=n),W(n)}),N()(),I(7,"span",12),_e(8),Y(9,"translate"),N(),I(10,"pu-input",13),Y(11,"translate"),Ii("ngModelChange",function(n){j(i);let r=E(3);return Ri(r.pageRange,n)||(r.pageRange=n),W(n)}),N()()}if(s&2){let i=E(3);x(),ge("aria-label",X(2,12,"SELECT_PRINT_RANGE")),x(2),T("label",X(4,14,"ALL")),Mi("ngModel",i.pageOption),x(2),T("label",X(6,16,"SPECIFY_PRINT_RANGE")),Mi("ngModel",i.pageOption),x(2),$e("disabled",i.pageOption!=="partial"),x(),we(X(9,18,"RANGE")),x(2),T("ariaLabel",X(11,20,"RANGE"))("disabled",i.pageOption!=="partial")("placeholder",i.pageRangePlaceholder),Mi("ngModel",i.pageRange)}}function fm(s,t){if(s&1&&(se(0,gm,12,22,"section",8),Y(1,"async")),s&2){let i=E(2);T("ngIf",!X(1,1,i.donePrint))}}function mm(s,t){s&1&&(I(0,"section",9)(1,"span",14),_e(2),Y(3,"translate"),N()()),s&2&&(x(2),we(X(3,1,"DONE_PRINT_MODAL")))}function vm(s,t){if(s&1){let i=ve();I(0,"button",15),ae("click",function(){j(i);let n=E(2);return W(n.onClose())}),_e(1),Y(2,"translate"),N(),I(3,"button",16),Y(4,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.onConfirm(!0))}),_e(5),Y(6,"translate"),N()}if(s&2){let i=E(2);$e("dark",i.isDarkMode),x(),we(X(2,5,"CANCEL")),x(2),ge("aria-label",X(4,7,"PRINT")),x(2),we(X(6,9,"PRINT"))}}function _m(s,t){if(s&1){let i=ve();I(0,"button",17),Y(1,"translate"),ae("click",function(){j(i);let n=E(2);return W(n.onClose(!0))}),_e(2),Y(3,"translate"),N()}s&2&&(ge("aria-label",X(1,2,"CLOSE")),x(2),we(X(3,4,"CLOSE")))}function Sm(s,t){if(s&1){let i=ve();I(0,"pu-dialog",7),Y(1,"async"),Y(2,"async"),Y(3,"translate"),ae("close",function(){j(i);let n=E();return W(n.onClose())}),se(4,fm,2,3,"ng-template",null,0,Vi)(6,mm,4,3,"ng-template",null,1,Vi)(8,vm,7,11,"ng-template",null,2,Vi)(10,_m,4,6,"ng-template",null,3,Vi),N()}if(s&2){let i=yi(5),e=yi(7),n=yi(9),r=yi(11),c=E();T("bodyTemplate",X(1,3,c.donePrint)?e:i)("footerTemplate",X(2,5,c.donePrint)?r:n)("header",X(3,7,"PRINT"))}}function bm(s,t){if(s&1){let i=ve();I(0,"div")(1,"img",18),ae("load",function(){j(i);let n=E();return W(n.onLoad())})("error",function(n){j(i);let r=E();return W(r.onError(n))}),N()()}if(s&2){let i=t.$implicit;x(),ge("src",i,Sn)}}var ls=class ls{elementRef;annotService;acroFormService;contentService;changeDetectorRef;dataService;modalService;toastService;agentService;pageService;changeService;documentService;subscriptionService;dapService;store$;translatePipe;dialogService;downloadService;apiEventBridgeService;authService;printService;invisibleTracerService;muPDFService;renderingService;signatureService;PRINT_PROGRESS_RATIO=80;get RuntimeEnvKey(){return ie}get runtimeEnv(){return K}get lastCommonModal(){return(this.modalService.lastModal?.instance).nestedRef?.instance}get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}doc;immediatePrintConfig;finish=new Lo;currentPageNo=0;pageOption="all";pageRange=w.EMPTY_STRING;printImagesDataUrls=[];_dialogVisible=!0;tempDocId="";enablePdfPages=[];pageNumbers=[];nLoadedImage=0;pageDescriptions=[];dominantPageOrientation="portrait";dejavuToken="";tracerImageUrl="";screenTheme="light";constructor(t,i,e,n,r,c,g,v,y,M,k,Z,le,pe,he,Te,p,ht,_t,gt,Pi,At,hi,vi,Oe){this.elementRef=t,this.annotService=i,this.acroFormService=e,this.contentService=n,this.changeDetectorRef=r,this.dataService=c,this.modalService=g,this.toastService=v,this.agentService=y,this.pageService=M,this.changeService=k,this.documentService=Z,this.subscriptionService=le,this.dapService=pe,this.store$=he,this.translatePipe=Te,this.dialogService=p,this.downloadService=ht,this.apiEventBridgeService=_t,this.authService=gt,this.printService=Pi,this.invisibleTracerService=At,this.muPDFService=hi,this.renderingService=vi,this.signatureService=Oe}get dialogVisible(){return this._dialogVisible}get pdfPages(){return this.enablePdfPages.length>0?this.enablePdfPages:this.pageService.originalPdfPages}get pageRangePlaceholder(){return`${this.translatePipe.transform("EX")} 1-5, 8, 11-13`}get openedDialogByApi(){return this.dialogService.openedDialogByApi}get donePrint(){return this.printService.doneEvent$}ngOnInit(){if(this.subscriptionService.push(this.store$.pipe(ci("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("currentPageNo")).subscribe({next:t=>this.currentPageNo=t}),this.documentService.pdfInfo$.pipe(F(t=>t.DocumentType==="DAP")).subscribe({next:()=>this.initDapInfoSubscription()})),this.immediatePrintConfig){this._dialogVisible=!1,this.immediatePrint();return}!K.get(ie.BROWSER_PRINT)&&K.get(ie.PLUGIN_PRINT)&&!this.openedDialogByApi&&(this._dialogVisible=!1,this.onConfirm(!1)),this.dialogVisible&&this.elementRef.nativeElement.focus()}ngOnDestroy(){this.printImagesDataUrls.splice(0)}onConfirm(t){if(!window.print||G.isKakaoInAppBrowser()){this.onClose(),t&&this.authService.deleteCookie("accessToken"),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:zt.ERROR,content:this.translatePipe.transform("NOT_SUPPORTED_BROWSER_PRINT"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint());return}this.modalService.createCommonModal({type:zt.BASIC,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PREPARING_TO_PRINT")}),this.subscriptionService.set("mainSub",lc(this.documentService.isDAP?this.validateDAPInfo():_n,this.validatePageRange(),this.muPDFService.docRaw===null?this.checkPrintStatus(this.doc.streamdocsId):_n,t?_n:this.checkLatestModuleInstallation(),t&&this.invisibleTracerService.isEnabled?this.prepareInvisibleTracer():_n,this.saveChanges(t),t&&this.muPDFService.docRaw===null?this.getDejavuToken():_n,bo(()=>(this.pdfPages&&this.pdfPages.length!==0&&(this.dominantPageOrientation=this.determineDominantPageOrientation()),_n)),bo(()=>t?this.printUsingBrowser():this.printUsingModule())).subscribe({next:i=>{this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:zt.INFO,content:i||"",confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint())},error:i=>{this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!1,error:i instanceof Error?i:new ur(`Failed to print. (${i})`)}),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:zt.ERROR,content:i?.message??this.translatePipe.transform("FAILED_TO_PRINT"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint())},complete:()=>{!t||this.muPDFService.docRaw!==null||(this.dataService.getPostPrint(this.tempDocId,this.dejavuToken,this.tempDocId!==this.doc.streamdocsId?this.doc.streamdocsId:void 0).subscribe(),this.authService.deleteCookie("accessToken"))}}))}onClose(t){if(this.dialogService.openedDialogByApi=!1,!t&&(G.isTablet()||G.isMobile()||G.isSamsungBrowser())){this.dialogService.toggleDialogVisibility(ji.PRINT,!0),this.printService.finishPrint();return}this.dialogService.toggleDialogVisibility(ji.PRINT,!1),this.nLoadedImage=0,this.finish.emit()}onLoad(){++this.nLoadedImage;let t=this.nLoadedImage/this.pageNumbers.length*(100-this.PRINT_PROGRESS_RATIO);this.lastCommonModal?.setProgressValue(this.PRINT_PROGRESS_RATIO+t),this.nLoadedImage===this.pageNumbers.length&&(window.print(),this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!0,data:{status:"PRINTED"}}),this.modalService.lastModal?.dispose(),this.onClose())}onError(t){console.error(this.translatePipe.transform("FAILED_TO_LOAD_IMAGE"),t),this.changeDetectorRef.markForCheck(),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:zt.ERROR,content:this.translatePipe.transform("FAILED_TO_LOAD_DOC_TO_PRINT"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint())}trackByImage(t){return t}immediatePrint(){this.immediatePrintConfig.pageRange&&this.immediatePrintConfig.pageRange!=="all"&&(this.pageRange=this.immediatePrintConfig.pageRange,this.pageOption="partial"),this.onConfirm(!0)}initDapInfoSubscription(){this.subscriptionService.push(this.documentService.pageDescriptions$.pipe(F(w.isDefined)).subscribe({next:t=>{this.pageDescriptions=t,this.calcEnablePages()}}))}calcEnablePages(){let t=[];this.pageService.originalPdfPages.forEach((i,e)=>{this.dapService.isDisabled(this.dapService.getPageRefId(i))&&t.push(e)}),this.enablePdfPages=w.deepClone(this.pageService.originalPdfPages),t.sort((i,e)=>e-i),t.forEach(i=>this.enablePdfPages.splice(i,1))}finishPrint(){this.subscriptionService.get("mainSub")?.unsubscribe(),this.dialogVisible||this.onClose()}validateDAPInfo(){return new Et(t=>{if(!this.pageDescriptions){t.error(new Gl("Printing is temporarily unavailable.")),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:zt.WARN,content:this.translatePipe.transform("FAILED_TO_PRINT_TEMPORARILY"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint());return}if(this.pageDescriptions.reduce((e,n)=>e.includes(n.refId)?e:e.concat(n.refId),[]).every(e=>this.dapService.isDisabled(e))){t.error(new zl("No document has been selected for printing.")),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:zt.WARN,content:this.translatePipe.transform("ALL_DAP_DISABLED"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint());return}t.complete()})}validatePageRange(){return new Et(t=>{if(this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:zt.BASIC,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("CHECKING_PAGE_RANGE")}),this.pageOption!=="all"?(this.pageNumbers=Nn.parse(this.pageRange,{min:1,max:this.pdfPages.length})??[],this.immediatePrintConfig&&this.pageNumbers.length>0&&(this.pageNumbers=this.pageNumbers.map(i=>i+1))):this.pageNumbers=Array.from({length:this.pdfPages.length}).map((i,e)=>e+1),!this.pageNumbers||this.pageNumbers.length===0||this.pageNumbers.filter(i=>!i||i>this.pdfPages.length).length>0){t.error(new $l(`Invalid page range. (min: 0, max: ${this.pdfPages.length})`)),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:zt.WARN,content:this.translatePipe.transform("INVALID_PAGE_RANGE"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint());return}this.pageNumbers.length>Ze.printCriticalPageLength?(this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:zt.WARN,content:G.isPlatformWindows?this.translatePipe.transform("RECOMMEND_PRINT_PLUGIN"):this.translatePipe.transform("WARN_MANY_PAGES_PRINT"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CONTINUE"),cancelButton:!0}).addOnDisposeListener(i=>{if(!i){this.finishPrint();return}t.complete()})):t.complete()})}checkLatestModuleInstallation(){return new Et(t=>{this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:zt.BASIC,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("CHECKING_PRINT_PLUGIN")}),this.agentService.checkVersion().subscribe({next:i=>{if(i.body&&this.agentService.isLatestVersion(i.body)){t.complete();return}t.error(new Wl("Please update the plugin.")),this.modalService.lastModal?.dispose(),this.modalService.createModal(Dc,{status:"needUpdate"}).addOnDisposeListener(()=>this.finishPrint())},error:()=>{t.error(new jl("The plugin is not installed.")),this.modalService.lastModal?.dispose(),this.modalService.createModal(Dc,{status:"notInstall"}).addOnDisposeListener(()=>this.finishPrint())}})})}prepareInvisibleTracer(){return new Et(t=>{if(!this.invisibleTracerService.isEnabled){t.complete();return}this.invisibleTracerService.printBinary$.subscribe(i=>{if(i?.binary?.type==="BLOB")this.tracerImageUrl=URL.createObjectURL(i.binary.data);else if(i?.binary?.type==="BASE64")this.tracerImageUrl=i?.binary.data??"";else{t.error("Binary data type error(RAW)");return}this.changeDetectorRef.markForCheck(),t.complete()})})}applyChangesForDap(t){return this.store$.pipe(Yo("ALL",!0),en(1),st(i=>kn.hasChanges(i)||this.annotService.hasLog()||this.invisibleTracerService.isEnabled?this.exportChanges({streamdocsId:this.tempDocId},t,!0):_n))}saveChanges(t){return new Et(i=>{if(this.muPDFService.docRaw!==null){this.muPDFService.applyChanges(this.annotService.getActionLog(),this.acroFormService.getActionLog(),()=>{this.annotService.clearActionLogs(),this.acroFormService.clearActionLogs()},this.documentService.openedDocument?.streamdocsId).subscribe({error:e=>i.error(e),complete:()=>i.complete()});return}lc(this.exportChanges(this.doc,t),this.prepareDocument(),this.doc.isDap?this.applyChangesForDap(t):_n,bo(()=>this.contentService.tsaValidation$?this.validateTSA():_n),bo(()=>this.renderingService.renderingMode!==gi.CLIENT?_n:this.openChangedDocument(this.doc))).subscribe({next:e=>i.next(e),error:e=>i.error(e),complete:()=>i.complete()})})}validateTSA(){let{fontName:t,text:i,validity:e}=this.contentService.tsaValidation$,n=this.changeService.exportExtraCommand({streamdocsId:this.tempDocId},[{command:"changeTsaAppearance",argument:[{fontName:t,validity:e,text:this.signatureService.shouldRenderTimeStamp?i:""}]}],{incremental:!1,toTemp:!0});if(n===void 0)throw new Xt("Failed to create change observable for document validation.");return n.pipe(rt(r=>this.tempDocId=r.streamdocsId),st(()=>_n))}getNewRotatedImage(t,i){return new Et(e=>{let n=this.getEffectiveRotation(i);if(n===180||n===0)e.next(t),e.complete();else{let r=new Image;r.onload=()=>{let c=document.createElement("canvas"),g=c.getContext("2d");if(g===null){e.error(new St("Failed to get CanvasRenderingContext2D"));return}c.width=r.height,c.height=r.width,g.translate(c.width/2,c.height/2),g.rotate(n*Math.PI/180),g.drawImage(r,-r.width/2,-r.height/2),e.next(c.toDataURL("image/png")),e.complete()},r.onerror=c=>e.error(c),r.src=t}})}getEffectiveRotation(t){let i=this.pdfPages[t];return this.getEffectivePageOrientation(i)===this.dominantPageOrientation?i.r:(i.r+90)%360}getEffectivePageOrientation(t){let i=Math.abs(t.r%360),e=t.bbox.w>t.bbox.h?"landscape":"portrait";return i===270||i===90?e==="portrait"?"landscape":"portrait":e}determineDominantPageOrientation(){let t=this.pdfPages.length,i=3,e=1,r=i-Math.exp(.05*(t-1)),c=Math.max(e,r),g=1,v={portrait:0,landscape:0};return this.pdfPages.forEach((y,M)=>{v[this.getEffectivePageOrientation(y)]+=M===0?c:g}),v.landscape>v.portrait?"landscape":"portrait"}prepareDocument(){return new Et(t=>{if(!this.documentService.isDAP){t.complete();return}if(this.modalService.lastModal?.dispose(),this.pageDescriptions.reduce((n,r)=>n.includes(r.refId)?n:n.concat(r.refId),[]).every(n=>this.dapService.isDisabled(n))){t.next(this.translatePipe.transform("PRINT_CANCELLED"));return}this.modalService.createCommonModal({type:zt.PROGRESS,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PREPARING_TO_PRINT")});let e=this.downloadService.makeDownloadId(this.tempDocId);e.pipe(F(n=>n.status==="progress")).subscribe({next:n=>{n.action==="split"?this.lastCommonModal?.setProgressValue(Math.round(n.progress??0*50)):n.action==="merge"&&this.lastCommonModal?.setProgressValue(50+Math.round(n.progress??0*50))},error:()=>{this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:zt.ERROR,content:this.translatePipe.transform("FAILED_TO_SPLIT_MERGE_TO_PRINT"),confirmButton:!0})}}),e.pipe(F(n=>n.status==="complete")).subscribe({next:n=>{this.tempDocId=n.id??"",t.complete()}})})}exportChanges(t,i,e=!1){return new Et(n=>{this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:zt.BASIC,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("SAVING_CHANGE_TO_PRINT_DOC")});let r=this.changeService.exportChange(t,{reload:!1,incremental:!1,toTemp:!0,print:!0,afterMergingDap:e,addInvisibleTracer:this.invisibleTracerService.isEnabled&&!i});if(!r){this.tempDocId=t.streamdocsId,n.complete();return}r.pipe(rt(c=>this.tempDocId=c.streamdocsId)).subscribe({next:()=>n.complete(),error:()=>n.error(new ur(this.translatePipe.transform("FAILED_TO_SAVE_TO_PRINT")))})})}getDejavuToken(){return new Et(t=>{this.dataService.getDejavuToken(this.tempDocId).subscribe({next:i=>{if(!i||!i.token){t.error(this.translatePipe.transform("FAILED_TO_PRINT"));return}this.dejavuToken=i.token,t.complete()},error:()=>t.error(this.translatePipe.transform("FAILED_TO_PRINT"))})})}checkPrintStatus(t){return new Et(i=>{this.dataService.checkPrintStatus(t).subscribe({next:()=>i.complete(),error:()=>i.error(new ur(this.translatePipe.transform("FAILED_TO_PRINT_LIMIT_EXCEEDED")))})})}openChangedDocument(t){return new Et(i=>{if(this.tempDocId===t.streamdocsId){i.complete();return}this.dataService.getDocRaw(this.tempDocId).pipe(st(e=>this.muPDFService.call(mc.OPEN_DOCUMENT,e.arrayBuffer,"temp.pdf",this.tempDocId)),dr(e=>(console.error(e),e))).subscribe({next:()=>i.complete(),error:()=>i.error(new ur(this.translatePipe.transform("FAILED_TO_OPEN_CHANGED_DOCUMENT_FOR_PRINT")))})})}printUsingBrowser(){return new Et(t=>{this.modalService.lastModal?.dispose();let i=this.modalService.createCommonModal({type:zt.PROGRESS,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PRINTING"),cancelButton:!0});Dr.token!==null&&this.authService.setCookie("accessToken",Dr.token?.accessToken);let e=this.pageNumbers.map(c=>this.muPDFService.call(mc.GET_PRINT_URL,c-1,!0,Ze.dpiForPrint,this.tempDocId).pipe(st(g=>this.renderingService.renderingMode===gi.CLIENT?dt(g):this.renderingService.fetchPrintImage(g)),st(g=>this.getNewRotatedImage(g,c-1)),st(g=>this.invisibleTracerService.isEnabled?this.addInvisibleTracer(g,c-1):dt(g)))),n=0,r=(this.muPDFService.docRaw===null?this.dataService.increasePrintCount(this.doc.streamdocsId):dt(void 0)).pipe(st(()=>So(e)),qs(Ze.browserPrintImageRequestChunkSize),Qs(c=>Xs(c)),rt(c=>{n+=c.length,this.lastCommonModal?.setProgressValue(Math.floor(n/this.pageNumbers.length*this.PRINT_PROGRESS_RATIO))}),Cl((c,g)=>c.concat(g),[])).subscribe({next:c=>{this.printImagesDataUrls=c,this.changeDetectorRef.markForCheck(),t.complete()},error:c=>t.error(this.translatePipe.transform(c.message))});this.subscriptionService.set("fetchImage",r),i.addOnDisposeListener(c=>{c===!1&&(this.subscriptionService.get("fetchImage")?.unsubscribe(),this.toastService.create({toastStyle:Gt.NOTIFICATION,content:this.translatePipe.transform("PRINT_CANCELLED"),header:this.translatePipe.transform("BROWSER_PRINT")}),this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!1,error:new ur(this.translatePipe.transform("PRINT_CANCELLED"))}),this.finishPrint())})})}addInvisibleTracer(t,i){return new Et(e=>{let n=document.createElement("canvas"),r=n.getContext("2d");if(r===null)throw new St("Failed to get CanvasRenderingContext2D");let{w:c,h:g}=this.pdfPages[i].bbox,v=Math.round(fc.convert(xs.POINT,xs.INCH,c)*Ze.invisibleTracerDpiForPrint),y=Math.round(fc.convert(xs.POINT,xs.INCH,g)*Ze.invisibleTracerDpiForPrint),M=new Image,k=new Image;M.crossOrigin="Anonymous";let Z=new Oi,le=new Oi,pe=pr(Z,le).pipe(en(1)).subscribe({next:()=>{let he=Math.min(Math.ceil(M.naturalWidth/v),2);n.width=v*he,n.height=y*he,r.drawImage(M,0,0,n.width,n.height),r.globalAlpha=this.invisibleTracerService.getOpacity(!1);let Te=Ze.printInvisibleTracerSize*he;for(let p=0;p<n.width;p+=Te)for(let ht=0;ht<n.height;ht+=Te)r.drawImage(k,p,ht,Te,Te);e.next(n.toDataURL(vp.png)),e.complete()}});k.onload=()=>le.next(),k.onerror=he=>{pe.unsubscribe(),e.error(he)},M.onload=()=>Z.next(),M.onerror=he=>{pe.unsubscribe(),e.error(he)},M.src=t,k.src=this.tracerImageUrl})}printUsingModule(){if(this.modalService.lastModal?.dispose(),this.printService.pluginPrintSub&&!this.printService.pluginPrintSub.closed)return new Et(i=>{this.toastService.create({toastStyle:Gt.NOTIFICATION,header:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PENDING_PLUGIN_PRINT_REQUEST")}),i.complete()});let t=this.toastService.create({toastStyle:Gt.NOTIFICATION,header:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PRINTING"),timeout:null});return this.printService.pluginPrintSub=this.dataService.getDownloadUrl({docId:this.tempDocId,originalId:this.tempDocId!==this.doc.streamdocsId?this.doc.streamdocsId:void 0}).pipe(st(i=>{let e=G.nativeWindow;return this.agentService.print(e.location.hostname,i,e.location.port,e.location.protocol,this.contentService.tsaValidation$?.validity??"",`${this.currentPageNo-1}`,this.pageNumbers&&this.pageRange.length>0?Nn.stringify(this.pageNumbers):void 0)}),Ue(i=>{if(i.body===null)throw new Xl("No response body received.");return/([a-zA-Z]+#)?(\-?[0-9]+)/.exec(i.body)?.[2]||"Unknown"}),Ue(i=>{let e={success:!1,canceled:!1,message:""};if(Number(i)<0)switch(i){case"-3":e.canceled=!0,e.message=this.translatePipe.transform("PRINT_CANCELLED");break;case"-20":e.message=this.translatePipe.transform("FAILED_TO_LOAD_DOC_TO_PRINT");break;default:e.message=`${this.translatePipe.transform("FAILED_TO_PRINT")}
(${this.translatePipe.transform("ERROR_CODE")}: ${i})`;break}else e.success=!0,e.message=this.translatePipe.transform("PRINT_COMPLETED");return e}),st(i=>i.success?this.dataService.increasePrintCount(this.doc.streamdocsId).pipe(Ue(()=>i)):dt(i)),rt(i=>{if(i.success||i.canceled){this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!0,data:{status:i.canceled?"CANCELLED":"PRINTED"}});return}this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!1,error:new ur(`Failed to print. (${i.message})`)})}),dr(()=>{throw this.translatePipe.transform("FAILED_TO_PRINT")})).subscribe({next:i=>{t.dispose(),this.printService.pluginPrintSub=null,this.toastService.create({toastStyle:i.success?Gt.SUCCESS:Gt.FAILURE,header:this.translatePipe.transform("PRINT"),content:i.message})},error:i=>{t.dispose(),this.printService.pluginPrintSub=null,this.toastService.create({toastStyle:Gt.FAILURE,header:this.translatePipe.transform("PRINT"),content:i})}}),new Et(i=>{this.onClose(),i.complete()})}};D(ls,"\u0275fac",function(i){return new(i||ls)(_(si),_(li),_(yn),_(at),_(Me),_(ma),_(on),_(sn),_(cs),_(Yt),_(Xo),_(ct),_(J),_(Sa),_(Ee),_(He),_(En),_(Ko),_(Zt),_(dp),_(zr),_(_a),_($o),_(jo),_(Gr))}),D(ls,"\u0275cmp",Ce({type:ls,selectors:[["sd-print-view"]],inputs:{doc:"doc",immediatePrintConfig:"immediatePrintConfig"},outputs:{finish:"finish"},standalone:!1,features:[xe([J])],decls:3,vars:3,consts:[["dialogBody",""],["finishDialogBody",""],["dialogFooter",""],["finishDialogFooter",""],["width","360",3,"bodyTemplate","footerTemplate","header","close",4,"ngIf"],["id","print-container"],[4,"ngFor","ngForOf","ngForTrackBy"],["width","360",3,"close","bodyTemplate","footerTemplate","header"],["class","dialog-body",4,"ngIf"],[1,"dialog-body"],["value","all",3,"ngModelChange","label","ngModel"],["value","partial",3,"ngModelChange","label","ngModel"],[1,"range-label"],["size","tiny",3,"ngModelChange","ariaLabel","disabled","placeholder","ngModel"],[1,"complete-description"],["color","white","size","small",1,"ep-button","cancel",3,"click"],["color","primary","size","small",1,"ep-button","print",3,"click"],["color","white","size","small",1,"ep-button",3,"click"],[3,"load","error"]],template:function(i,e){i&1&&(se(0,Sm,12,9,"pu-dialog",4),I(1,"div",5),se(2,bm,2,1,"div",6),N()),i&2&&(T("ngIf",e.dialogVisible),x(2),T("ngForOf",e.printImagesDataUrls)("ngForTrackBy",e.trackByImage))},dependencies:[Ei,bt,On,Eo,la,Vn,ha,lp,Vl,He],styles:[".dialog-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:24px;margin-bottom:32px}.dialog-body[_ngcontent-%COMP%]   pu-radio-button[_ngcontent-%COMP%]{margin-top:16px}.dialog-body[_ngcontent-%COMP%]   pu-radio-button[_ngcontent-%COMP%]:first-child{margin-top:0}.dialog-body[_ngcontent-%COMP%]   .range-label[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-70);margin-top:18px}.dialog-body[_ngcontent-%COMP%]   .range-label.disabled[_ngcontent-%COMP%]{opacity:.5}.dialog-body[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{width:160px}.dialog-body[_ngcontent-%COMP%]   .horizontal-division-line[_ngcontent-%COMP%]{width:100%;height:1px;margin:16px 0;background-color:var(--mono-30)}.dialog-body[_ngcontent-%COMP%]   .plugin-label[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);display:block}.dialog-body[_ngcontent-%COMP%]   .plugin-description[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70);margin-top:6px}.dialog-body[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]{margin-top:24px}.dialog-body[_ngcontent-%COMP%]   .complete-description[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70)}button[_ngcontent-%COMP%]{color:var(--mono-00)}button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:8px}button.print[_ngcontent-%COMP%]{color:var(--mono-00)}button.cancel.dark[_ngcontent-%COMP%]{color:var(--mono-90);background-color:var(--mono-30);border-color:var(--mono-30)}img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{display:none}"],changeDetection:0}));var ps=ls;ze([ot(it.printViewComp.printUsingBrowser)],ps.prototype,"printUsingBrowser",null);ze([ot(it.printViewComp.printUsingModule)],ps.prototype,"printUsingModule",null);var Tm=["sdToastOutlet"],Om=["sdModalOutlet"],wm=s=>({error:s});function ym(s,t){if(s&1){let i=ve();I(0,"sd-toolbar",19),ae("contextmenu",function(n){j(i);let r=E(2);return W(r.onContextMenu(n))}),N()}if(s&2){let i=E(2);nn("display",i.isVisibleToolbar?void 0:"none"),T("doc",i.doc)}}function Em(s,t){if(s&1&&q(0,"sd-annot-toolbar"),s&2){let i=E(2);nn("display",!i.isSubToolbarOpened||i.isEbookMode()?"none":void 0)}}function Pm(s,t){if(s&1&&(I(0,"aside"),q(1,"sd-side-view",18),N()),s&2){let i=E(2);$e("side-view",!i.isRedactingOnMobile),T("@sideViewAnimation",i.isSmallWidthScreen&&!i.isRedactingOnMobile),x(),T("pdfDoc",i.doc)}}function Mm(s,t){if(s&1&&(I(0,"aside",20),q(1,"sd-right-side-view",18),N()),s&2){let i=E(2);T("@rightSideViewAnimation",i.isSmallWidthScreen),x(),T("pdfDoc",i.doc)}}function Rm(s,t){if(s&1&&q(0,"sd-content-view",23),s&2){let i=E(3);T("pdfDoc",i.doc)("centerPoint",i.centerPointParam)("overWrittenZoom",i.zoomParam)("ngStyle",i.contentViewStyle)}}function Im(s,t){s&1&&q(0,"sd-ruler")}function Am(s,t){if(s&1){let i=ve();I(0,"span",24),ae("contextmenu",function(n){j(i);let r=E(3);return W(r.onContextMenu(n))}),_e(1),N()}if(s&2){let i=E(3);ge("aria-label",i.pageNumberAriaLabel),x(),ea("",i.currentPageNo,"/",i.pageCount,"")}}function Dm(s,t){if(s&1&&(Ht(0),se(1,Rm,1,4,"sd-content-view",21)(2,Im,1,0,"sd-ruler",5)(3,Am,2,3,"span",22),$t()),s&2){let i=E(2);x(),T("ngIf",i.doc),x(),T("ngIf",i.rulerActive),x(),T("ngIf",i.isPageIdxIndicatorVisible)}}function Nm(s,t){s&1&&q(0,"sd-spreadsheets-view")}function km(s,t){if(s&1&&(I(0,"div",29),_e(1),N()),s&2){let i=E(4);x(),we(i.passwordErrorMessage)}}function Vm(s,t){if(s&1){let i=ve();I(0,"div",26),_e(1),Y(2,"translate"),N(),I(3,"pu-input",27),Y(4,"translate"),Y(5,"translate"),Ii("ngModelChange",function(n){j(i);let r=E(3);return Ri(r.password,n)||(r.password=n),W(n)}),ae("keydown.enter",function(){j(i);let n=E(3);return W(n.password&&!n.passwordChecking?n.checkPassword():null)}),N(),se(6,km,2,1,"div",28)}if(s&2){let i=E(3);x(),we(X(2,8,"THIS_DOCUMENT_WAS_ENCRYPTED")),x(2),T("autofocus",!0)("ngClass",vt(14,wm,i.passwordErrorMessage))("placeholder",X(4,10,"INPUT_PASSWORD"))("ariaLabel",X(5,12,"INPUT_PASSWORD"))("readonly",i.passwordChecking),Mi("ngModel",i.password),x(3),T("ngIf",i.passwordErrorMessage)}}function Lm(s,t){if(s&1){let i=ve();I(0,"button",30),Y(1,"translate"),ae("click",function(){j(i);let n=E(3);return W(n.checkPassword())}),_e(2),Y(3,"translate"),N()}if(s&2){let i=E(3);T("disabled",!i.password||i.passwordChecking),ge("aria-label",X(1,3,"OK")),x(2),we(X(3,5,"OK"))}}function Fm(s,t){if(s&1&&(I(0,"pu-dialog",25),Y(1,"translate"),se(2,Vm,7,16,"ng-template",null,3,Vi)(4,Lm,4,7,"ng-template",null,4,Vi),N()),s&2){let i=yi(3),e=yi(5);T("bodyTemplate",i)("footerTemplate",e)("header",X(1,4,"ENCRYPTED_DOCUMENT"))("headerIcon","papycon papycon-questionmark")}}function Bm(s,t){if(s&1){let i=ve();I(0,"sd-print-view",31),ae("finish",function(){j(i);let n=E(2);return W(n.onFinishPrint())}),N()}if(s&2){let i=E(2);T("doc",i.doc)("immediatePrintConfig",i.immediatePrintConfig)}}function Um(s,t){if(s&1){let i=ve();Ht(0),se(1,ym,1,3,"sd-toolbar",6)(2,Em,1,2,"sd-annot-toolbar",7),I(3,"div",8),ae("contextmenu",function(n){j(i);let r=E();return W(r.onContextMenu(n))}),se(4,Pm,2,4,"aside",9)(5,Mm,2,2,"aside",10),I(6,"section",11),se(7,Dm,4,3,"ng-container",12)(8,Nm,1,0,"ng-template",null,0,Vi),I(10,"div",13),Co(11,null,1),N(),I(13,"div",14),Co(14,null,2),N()()(),I(16,"section",15),se(17,Fm,6,6,"pu-dialog",16),N(),se(18,Bm,1,2,"sd-print-view",17),q(19,"sd-dialog",18),$t()}if(s&2){let i=yi(9),e=E();x(),T("ngIf",!e.hidableMenus[e.HidableView.TOOLBAR]),x(),T("ngIf",!e.supportTTS&&e.isSubToolbarOpened),x(2),T("ngIf",e.sideViewVisible),x(),T("ngIf",e.rightSideViewVisible),x(),T("ngClass",e.DragMode[e.dragMode]),x(),T("ngIf",!e.isSpreadsheets)("ngIfElse",i),x(10),T("ngIf",e.suspendedDocId),x(),T("ngIf",e.printDialogView||e.immediatePrintConfig),x(),T("pdfDoc",e.doc)}}var _P=(()=>{let t=class t{acroFormService;contentService;annotService;modalService;changeDetectorRef;textSearchService;dataService;toastService;annotSelectedService;documentService;viewerService;shortcutService;subscriptionService;sdContextMenuService;store$;externalApiService;dialogService;printService;apiEventBridgeService;translatePipe;localStorageService;configsService;preferencesService;router;muPDFService;redactionService;autoSaveService;loggingService;get DragMode(){return Mt}sdToastOutlet;sdModalOutlet;viewMode;dragMode;pageCount;currentPageNo;supportTTS;rulerActive;sideViewSize;rightSideViewSize;get contentViewStyle(){if(!this.rulerActive)return{};let e=`${36}px`,n=`calc(100% - ${36}px)`;return{top:e,left:e,width:n,height:n}}printDialogView=!1;immediatePrintConfig=null;suspendedDocId=w.EMPTY_STRING;password=w.EMPTY_STRING;passwordChecking=!1;passwordErrorMessage=w.EMPTY_STRING;sideViewVisible=!1;rightSideViewVisible=!1;isSmallWidthScreen=G.isSmallWidth();loading=this.checkDelayLoading;isSpreadsheets=K.get(ie.USE_SPREADSHEETS_VIEWER);get checkDelayLoading(){return!!K.get(ie.DELAY_LOADING)&&!G.isRootWindow()}get doc(){return this._doc}get isSubToolbarOpened(){return!this.viewerService.isSubToolbarType(null)}get HidableView(){return B}get isRedactingOnMobile(){return this.redactionService.isRedactingOnMobile()}get useLastViewedPage(){return this.localStorageService.isEnabledLocalStorage&&Ze.continueFromLastView}get isVisibleToolbar(){return K.get(ie.SAVE_BUTTON)&&!K.get(ie.AUTO_SAVE)||K.get(ie.ORIGINAL_DOWNLOAD_BUTTON)||K.get(ie.PDF_DOWNLOAD_BUTTON)||K.get(ie.PRINT_BUTTON)&&K.get(Tt.PRINT_DIALOG)||K.get(ie.DOCUMENT_INFO_BUTTON)&&K.get(Tt.DOCUMENT_INFO_DIALOG)||K.get(ie.SLIDESHOW_BUTTON)||K.get(ie.EBOOK_BUTTON)||K.get(ie.PREFERENCES_BUTTON)&&K.get(Tt.PREFERENCES_DIALOG)||K.get(ie.SCREEN_THEME_MENU)||K.get(ie.SD_INFO_BUTTON)||K.get(Tt.LEFT_SIDE_VIEW_BUTTON)||K.get(ie.SCALE_DROPDOWN)||K.get(ie.FIT_BUTTON)||K.get(Tt.VIEW_MODE_BUTTON)||K.get(Tt.DRAG_MODE_BUTTONS)||K.get(Tt.ANNOT_TOOLBAR)||K.get(Tt.FORM_TOOLBAR)||K.get(Tt.PKI_SIGNATURE_TOOLBAR)||this.documentService.isDAP&&K.get(Tt.DAP_VIEW)&&K.get(ie.DAP_VIEW_BUTTON)}get isPageIdxIndicatorVisible(){return!!this.pageCount&&!this.hidableMenus[B.INDICATOR]&&!this.hidableMenus[B.INDICATOR_PAGE_NUMBER]}get pageNumberAriaLabel(){return this.translatePipe.transform("CURRENT_PAGE_AND_TOTAL_PAGE").replace("%d",this.currentPageNo.toString()).replace("%d",this.pageCount.toString())}_doc=null;isFullScreen=w.isFullscreenMode();isContextMenuOpened=!1;hidableMenus={};zoomParam;centerPointParam=null;currentPageNoParam;constructor(e,n,r,c,g,v,y,M,k,Z,le,pe,he,Te,p,ht,_t,gt,Pi,At,hi,vi,Oe,Fe,h,u,b,O){this.acroFormService=e,this.contentService=n,this.annotService=r,this.modalService=c,this.changeDetectorRef=g,this.textSearchService=v,this.dataService=y,this.toastService=M,this.annotSelectedService=k,this.documentService=Z,this.viewerService=le,this.shortcutService=pe,this.subscriptionService=he,this.sdContextMenuService=Te,this.store$=p,this.externalApiService=ht,this.dialogService=_t,this.printService=gt,this.apiEventBridgeService=Pi,this.translatePipe=At,this.localStorageService=hi,this.configsService=vi,this.preferencesService=Oe,this.router=Fe,this.muPDFService=h,this.redactionService=u,this.autoSaveService=b,this.loggingService=O}ngOnInit(){this.checkDelayLoading||this.contentService.togglePageLoader(!1),this.initializeConfigToStore(),this.subscribe(),this.bindParams(),this.initSearchResult(),this.annotSelectedService.unselectAll(),this.subscriptionService.push(this.autoSaveService.initAutoSave(),this.shortcutService.getShortcutEvent(Re.FULLSCREEN).subscribe({next:e=>{e.preventDefault(),e.stopPropagation(),this.isFullScreen?G.exitFullScreen():G.enterFullScreen()}}),G.windowResize$.pipe(rt(()=>this.isSmallWidthScreen=G.isSmallWidth()),F(()=>this.isFullScreen!==w.isFullscreenMode()),st(()=>_l(100).pipe(F(()=>!w.isFullscreenMode()),en(1)))).subscribe({next:()=>{G.exitFullScreen()}}),this.documentService.openedDocument$.subscribe({next:e=>{if(this.initPassword(),!e){this.closeDocument();return}this._doc=e,this.viewerService.closeSubToolbar(),w.isDefined(this.currentPageNoParam)||this.checkLastViewedPage(),this.acroFormService.resetAcroFieldByPage(),this.changeDetectorRef.markForCheck()}}),this.localStorageService.localStorage$.subscribe({next:()=>{this.toastService.create({toastStyle:Gt.FAILURE,content:this.translatePipe.transform("FAILED_TO_ACCESS_LOCAL_STORAGE")})}})),this.printService.setBrowserPrintGripperMargin(Ze.defaultPrintMargin),this.localStorageService.isEnabledLocalStorage||this.toastService.create({toastStyle:Gt.FAILURE,content:this.translatePipe.transform("FAILED_TO_ACCESS_LOCAL_STORAGE")})}ngOnDestroy(){this.viewerService.closeDocument()}ngAfterViewChecked(){this.sdToastOutlet&&this.sdModalOutlet&&(this.toastService.registerOutlet(this.sdToastOutlet),this.modalService.registerOutlet(this.sdModalOutlet))}isEbookMode(){return this.viewMode===4}checkPassword(e){this.passwordChecking=!0,this.passwordErrorMessage=w.EMPTY_STRING;let n=e||this.suspendedDocId;if(!w.isDefined(n))throw new Cn("No valid document ID provided.");this.viewerService.openDocument(n,!Ze.skipPasswordCheck,this.password).pipe(Xn(()=>this.passwordChecking=!1)).subscribe({next:()=>{this.suspendedDocId=null},error:r=>{if(this.viewerService.closeSubToolbar(),r.fail){let c=Ze.skipPasswordCheck&&r.log.status===401?`errorCode=${r.errorCode}`:"",g=[`view/error-pages/${r.log.status}`,c].join(";");this.router.navigateByUrl(g)}else this.suspendedDocId=e||this.suspendedDocId,e||(this.passwordErrorMessage=this.translatePipe.transform("WRONG_PASSWORD"));this.changeDetectorRef.markForCheck()}})}onContextMenu(e){e.preventDefault(),e.stopPropagation()}onFinishPrint(){this.immediatePrintConfig&&(this.immediatePrintConfig=null)}initSearchResult(){this.textSearchService.clear(),this.textSearchService.searchRedactionMark([]),this.textSearchService.searchRedactionResult([])}bindParams(){let{streamdocsId:e,currentPage:n,viewMode:r,zoom:c,supportTTS:g,option:v,centerPoint:y}={},M=Number.parseInt(v,16),k={singlePage:0,singlePageScroll:1,doublePage:2,doublePageScroll:3,eBook:4};n!==""&&!Number.isNaN(Number(n))&&(this.currentPageNoParam=Number(n),this.store$.dispatch(ue.set({key:"currentPageNo",value:Number(n)}))),k.hasOwnProperty(r)&&this.store$.dispatch(ue.set({key:"viewMode",value:k[r]})),this.zoomParam=c,this.centerPointParam=typeof y=="string"?(()=>{let[Z,le]=y.split(",").map(Number);return w.isDefined(Z)&&w.isDefined(le)&&!Number.isNaN(Z)&&!Number.isNaN(le)?{x:Math.floor(Z),y:Math.floor(le)}:null})():null,this.store$.dispatch(ue.set({key:"supportTTS",value:g==="true"})),this.store$.dispatch(ue.set({key:"isScreenReaderActive",value:K.get(ie.PAGE_TEXT_FOR_SCREEN_READER)})),this.store$.dispatch(Np.set({value:Number.isNaN(M)?0:M})),e&&this.checkPassword(e)}checkLastViewedPage(){if(!this.useLastViewedPage||!this.doc)return;let e=JSON.parse(this.localStorageService.get("SD_History","{}")),n=e[this.doc.streamdocsId]?.lastViewedPage;if(!e[this.doc.streamdocsId]){this.loggingService.common("debug",Le.NOT_EXIST,"history",`(${this.translatePipe.transform("LOCAL_STORAGE")})`);return}this.store$.dispatch(ue.set({key:"currentPageNo",value:n>0?n:1}))}updateLastViewedPage(e){if(!this.useLastViewedPage||!this.doc)return;let n=JSON.parse(this.localStorageService.get("SD_History","{}"));n[this.doc.streamdocsId]?n[this.doc.streamdocsId].lastViewedPage=e>0?e:1:n[this.doc.streamdocsId]={lastViewedPage:e>0?e:1},this.localStorageService.set("SD_History",JSON.stringify(n))}subscribe(){this.subscriptionService.push(this.store$.pipe(Br("isSpreadsheets")).subscribe({next:e=>this.isSpreadsheets=e}),Ge(window,"mousedown").pipe(F(()=>this.isContextMenuOpened)).subscribe({next:()=>{this.sdContextMenuService.publishContextMenuStatus(!1)}}),this.store$.pipe($("viewMode")).subscribe({next:e=>this.viewMode=e}),this.store$.pipe($("pageCount")).subscribe({next:e=>this.pageCount=e}),this.store$.pipe($("currentPageNo")).subscribe({next:e=>{this.currentPageNo=e,this.updateLastViewedPage(e)}}),this.store$.pipe($("supportTTS")).subscribe({next:e=>this.supportTTS=e}),this.store$.pipe($("dragMode")).subscribe({next:e=>this.dragMode=e}),this.store$.pipe($("sideViewVisible")).subscribe({next:e=>{this.sideViewVisible=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("rightSideViewVisible")).subscribe({next:e=>{this.rightSideViewVisible=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("sideViewSize")).subscribe({next:e=>{this.sideViewSize=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe($("rightSideViewSize")).subscribe({next:e=>{this.rightSideViewSize=e,this.changeDetectorRef.markForCheck()}}),this.printService.print$.pipe(F(e=>e!==null)).subscribe({next:e=>{this.immediatePrintConfig=e,this.changeDetectorRef.markForCheck()}}),this.dialogService.dialogVisibilityChange$.subscribe({next:()=>{if(this.dialogService.dialogVisibility[ji.PRINT]){if(!this.documentService.checkAuthority(Ne.PRINT_DOCUMENT)){this.apiEventBridgeService.dialogVisibilityChangedSrc.next({ok:!1,error:new St("Unauthorized")});return}if(!this.doc){this.toastService.create({toastStyle:Gt.NOTIFICATION,header:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("SELECT_FILE")});return}}this.printDialogView=!!this.dialogService.dialogVisibility[ji.PRINT],this.changeDetectorRef.markForCheck(),setTimeout(()=>this.apiEventBridgeService.dialogVisibilityChangedSrc.next({ok:!0,data:void 0}))}}),G.windowResize$.subscribe({next:()=>{this.changeDetectorRef.markForCheck(),!ee.canSideViewBeDisplayed(this.sideViewVisible,this.rightSideViewVisible,this.sideViewSize,this.rightSideViewSize)&&(!this.sideViewVisible&&!this.rightSideViewVisible||(this.sideViewVisible&&this.store$.dispatch(ue.set({key:"sideViewVisible",value:!1})),this.rightSideViewVisible&&this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1}))))}}),ut(G.windowResize$,this.store$.pipe($("sideViewVisible")),this.store$.pipe($("sideViewSize")),this.store$.pipe($("rightSideViewVisible")),this.store$.pipe($("rightSideViewSize"))).subscribe({next:()=>{this.changeDetectorRef.detectChanges()}}),this.documentService.pdfInfo$.subscribe({next:e=>{e.DocumentType==="DAP"&&K.get(Tt.DAP_VIEW)&&K.get(ie.DAP_VIEW_BUTTON)&&K.get(ie.DAP_VIEW_DEFAULT_OPEN)?G.width>Ze.rightSideView.initialSize*2&&(this.store$.dispatch(ue.set({key:"rightSideViewMode",value:Rt.DAP})),this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!0}))):(this.store$.dispatch(ue.set({key:"rightSideViewMode",value:Rt.TextSearch})),this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1})))}}),G.fullScreenState$.subscribe({next:e=>this.isFullScreen=e}),this.acroFormService.acroFieldsChange$.pipe(ni(300),st(()=>w.isDefined(this.doc)?this.acroFormService.updateAcroFieldByPage(this.doc.streamdocsId):Gn(()=>new Cn("Document is not defined.")))).subscribe(),this.store$.pipe($("rulerActive")).subscribe({next:e=>{this.rulerActive=e,this.changeDetectorRef.markForCheck()}}),this.contentService.reload$.pipe(F(e=>Go.type(e,zo.AcroForm)),st(()=>(this.acroFormService.resetAcroFieldByPage(),w.isDefined(this.doc)?this.dataService.getPdfAcroFields(this.doc.streamdocsId):Gn(()=>new Cn("Document is not defined.")))),st(({fields:e,props:n})=>(this.acroFormService.publishAcroFields(e,n),w.isDefined(this.doc)?this.acroFormService.updateAcroFieldByPage(this.doc.streamdocsId):Gn(()=>new Cn("Document is not defined."))))).subscribe(),Ge(document,"visibilitychange").pipe(F(()=>document.visibilityState==="hidden")).subscribe({next:()=>this.autoSaveService.fireAutoSave(_c.EXIT)}),Ge(window,"beforeunload").pipe(rt(()=>this.autoSaveService.fireAutoSave(_c.EXIT)),F(()=>{if(G.isAOS()){let e=window.parent.document.referrer,n=window.parent.location.hostname,r=e?new URL(e).hostname!==n:!0;return(K.get(ie.WARNING_LEAVE_WITHOUT_SAVE)||K.get(ie.AUTO_SAVE))&&!!this.annotService.getActionLog().length&&!(history.length<=1||!e||r)}return(K.get(ie.WARNING_LEAVE_WITHOUT_SAVE)||K.get(ie.AUTO_SAVE))&&!!this.annotService.getActionLog().length})).subscribe({next:e=>e.preventDefault()}),this.sdContextMenuService.contextMenuStatus$.subscribe({next:e=>this.isContextMenuOpened=e}),Ji([this.store$.pipe($("renderingMode"),F(e=>e!==gi.SERVER)),this.viewerService.loadMuPDF$.pipe(F(e=>e?.length>0),rt(()=>this.muPDFService.closeDocument()))]).subscribe({next:([e,n])=>{let r=e===gi.CLIENT;dt(this.muPDFService.docRaw).pipe(F(w.isDefined),st(({arrayBuffer:c,filename:g})=>this.muPDFService.prepareDocument(n,c,g,r)),Xn(()=>this.modalService.lastModal?.dispose())).subscribe()}}),this.viewerService.requestPasswordToUser$.subscribe({next:e=>{this.initPassword(),this.suspendedDocId=e,this.changeDetectorRef.markForCheck()}}),this.shortcutService.getShortcutEvent(Re.SEARCH).subscribe({next:e=>{e.preventDefault(),e.stopPropagation()}})),K.get(ie.RULER_BUTTON)&&this.subscriptionService.push(this.shortcutService.getShortcutEvent(Re.RULER_VISIBILITY).subscribe({next:()=>this.store$.dispatch(ue.set({key:"rulerActive",value:!this.rulerActive}))})),this.checkDelayLoading&&this.subscriptionService.push(this.contentService.pageLoader$.pipe(F(e=>!e),en(1)).subscribe({next:e=>{this.loading=e,this.changeDetectorRef.markForCheck()}})),this.subscriptionService.push(this.store$.pipe(fi([B.TOOLBAR,B.TOOLBAR_LEFT,B.TOOLBAR_CENTER,B.TOOLBAR_RIGHT,B.INDICATOR,B.INDICATOR_PAGE_NUMBER])).subscribe({next:e=>{Object.assign(this.hidableMenus,e),this.changeDetectorRef.markForCheck()}}))}closeDocument(){this._doc=null,this.store$.dispatch(ue.set({key:"sideViewVisible",value:!1})),this.store$.dispatch(ue.set({key:"rightSideViewVisible",value:!1})),this.dialogService.closeAll(),this.store$.dispatch(ue.set({key:"fitMode",value:null})),this.changeDetectorRef.detectChanges()}initializeConfigToStore(){let e=this.configsService.radioConfig,n=this.preferencesService.savedPreferences,r=gi.SERVER;K.get(ie.USE_CLIENT_RENDERING)&&(this.muPDFService.initWorker(),r=gi.CLIENT),this.store$.dispatch(ue.set({key:"renderingMode",value:r})),[Ho.DEFAULT_VIEW_MODE,Ho.DEFAULT_DRAG_MODE].forEach(c=>{if(!Oo.hasDefinedProp(e,c))throw new Cs(`Configuration for '${c}' is not defined in radioConfig.`);e[c].items.forEach(g=>{if(!K.get(g.key))return;let[v,y,M]=g.key.split(".");this.store$.dispatch(ue.set({key:M,value:g.value}))})}),[Ho.DEFAULT_ZOOM,Ho.RENDERING_OPTION,Ho.DEFAULT_SCREEN_THEME,Ho.DEFAULT_CONTINUE_WRITING].forEach(c=>{if(!Oo.hasDefinedProp(e,c))throw new Cs(`Configuration for '${c}' is not defined in radioConfig.`);e[c].items.forEach(g=>{if(!K.get(g.key))return;let[v,y,M]=g.key.split("."),k=[M];switch(c){case Ho.DEFAULT_CONTINUE_WRITING:if(k=["annot","continueWriting"],w.isDefined(n.annot?.continueWriting))return;break;default:if(Oo.hasDefinedProp(n,M))return}this.store$.dispatch(up.update({payload:{keys:k,value:g.value}}))})})}initPassword(){this.password=w.EMPTY_STRING,this.passwordChecking=!1,this.passwordErrorMessage=w.EMPTY_STRING,this.suspendedDocId=w.EMPTY_STRING}};D(t,"\u0275fac",function(n){return new(n||t)(_(yn),_(at),_(li),_(on),_(Me),_(to),_(ma),_(sn),_(Di),_(ct),_(Jt),_(rn),_(J),_(qo),_(Ee),_(Sr),_(En),_(zr),_(Zt),_(He),_(Fr),_(Up),_(Uo),_(Ir),_($o),_($r),_(jr),_(Ai))}),D(t,"\u0275cmp",Ce({type:t,selectors:[["sd-viewer"]],viewQuery:function(n,r){if(n&1&&(Ye(Tm,5,pc),Ye(Om,5,pc)),n&2){let c;Ie(c=Ae())&&(r.sdToastOutlet=c.first),Ie(c=Ae())&&(r.sdModalOutlet=c.first)}},standalone:!1,features:[xe([J])],decls:1,vars:1,consts:[["spreadsheetsViewRef",""],["sdToastOutlet",""],["sdModalOutlet",""],["dialogBody",""],["dialogFooter",""],[4,"ngIf"],[3,"doc","display","contextmenu",4,"ngIf"],[3,"display",4,"ngIf"],[1,"main-window",3,"contextmenu"],[3,"side-view",4,"ngIf"],["class","right-side-view",4,"ngIf"],[1,"main-view",3,"ngClass"],[4,"ngIf","ngIfElse"],[1,"sd-toast-container"],[1,"sd-modal-container"],[1,"dialogs"],["width","360","height","300",3,"bodyTemplate","footerTemplate","header","headerIcon",4,"ngIf"],[3,"doc","immediatePrintConfig","finish",4,"ngIf"],[3,"pdfDoc"],[3,"contextmenu","doc"],[1,"right-side-view"],[3,"pdfDoc","centerPoint","overWrittenZoom","ngStyle",4,"ngIf"],["class","page",3,"contextmenu",4,"ngIf"],[3,"pdfDoc","centerPoint","overWrittenZoom","ngStyle"],[1,"page",3,"contextmenu"],["width","360","height","300",3,"bodyTemplate","footerTemplate","header","headerIcon"],[1,"password-dialog-label"],["size","tiny","type","password",3,"ngModelChange","keydown.enter","autofocus","ngClass","placeholder","ariaLabel","readonly","ngModel"],["class","password-dialog-error",4,"ngIf"],[1,"password-dialog-error"],["color","primary","size","small",1,"ep-button",3,"click","disabled"],[3,"finish","doc","immediatePrintConfig"]],template:function(n,r){n&1&&se(0,Um,20,10,"ng-container",5),n&2&&T("ngIf",!r.loading)},dependencies:[Mo,xo,bt,Wt,Io,wp,On,Eo,Xp,mn,la,Vn,Hp,Vp,Mp,ps,He],styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}@media print{[_nghost-%COMP%]   *[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   sd-print-view[_ngcontent-%COMP%]{display:block}}[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%}.pre-wrap[_ngcontent-%COMP%]{white-space:pre-wrap}sd-toolbar[_ngcontent-%COMP%], sd-annot-toolbar[_ngcontent-%COMP%]{flex:0 0 43px}.main-window[_ngcontent-%COMP%]{overflow:hidden;flex:1}.main-view[_ngcontent-%COMP%]{display:block;height:100%;position:relative;overflow:hidden}sd-content-view[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:block}.side-view[_ngcontent-%COMP%]{display:block;height:100%;position:relative;float:left}sd-side-view[_ngcontent-%COMP%]{height:100%;position:relative}.right-side-view[_ngcontent-%COMP%]{display:block;height:100%;position:relative;float:right}.sd-toast-container[_ngcontent-%COMP%]{position:absolute;top:40px;right:50px;display:flex;flex-direction:column;pointer-events:none;z-index:5}span.page[_ngcontent-%COMP%]{font-family:NotoSans-Regular,sans-serif;position:absolute;bottom:20px;right:40px;font-size:12px;color:var(--mono-70)}.password-dialog-label[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-70);margin-top:10px}.password-dialog-error[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Medium,sans-serif;color:var(--exception)}pu-input[_ngcontent-%COMP%]{width:100%;margin-top:2px}pu-input.error[_ngcontent-%COMP%]  input{border-color:var(--exception)}sd-dialog[_ngcontent-%COMP%]{z-index:5}@media screen and (max-width: 577px){.main-window[_ngcontent-%COMP%]{position:relative}.side-view[_ngcontent-%COMP%], .right-side-view[_ngcontent-%COMP%]{position:absolute;width:100%;z-index:1}.sd-toast-container[_ngcontent-%COMP%]{top:32px;right:16px}}"],data:{animation:[Ts.slideInOut("sideViewAnimation","left"),Ts.slideInOut("rightSideViewAnimation","right")]},changeDetection:0}));let s=t;return s})();var WP=(()=>{let t=class t{};D(t,"\u0275fac",function(n){return new(n||t)}),D(t,"\u0275mod",ai({type:t})),D(t,"\u0275inj",ri({providers:[ya,ln,Sr],imports:[gd,Pa,$i,Nd,Ap,Nr,wa,wn,kd,pa,Vr,da,ua,pp,kr,$p,Ta,Rp,xp]}));let s=t;return s})();export{qr as a,M_ as b,ya as c,o0 as d,s_ as e,U_ as f,pd as g,Sr as h,aE as i,WP as j,_P as k};
